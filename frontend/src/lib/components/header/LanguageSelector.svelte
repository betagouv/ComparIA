<script lang="ts">
  import { Button } from '$components/dsfr'
  import { LOCALES } from '$lib/global.svelte'
  import { m } from '$lib/i18n/messages'
  import { getLocale, setLocale } from '$lib/i18n/runtime'

  let { id }: { id: string } = $props()

  const currentLocale = getLocale()
</script>

<nav class="fr-translate fr-nav">
  <div class="fr-nav__item">
    <Button
      aria-controls={id}
      aria-expanded="false"
      title={m['actions.selectLanguage']()}
      variant="tertiary-no-outline"
      native
      class="fr-translate__btn before:content-none!"
    >
      <img
        src={`/flags/${currentLocale}.png`}
        aria-hidden="true"
        alt=""
        class="me-2 max-w-[30px] rounded-md"
      />
      {LOCALES.find((locale) => locale.code === currentLocale)!.short}
    </Button>

    <div class="fr-collapse fr-translate__menu fr-menu" {id}>
      <ul class="fr-menu__list">
        {#each LOCALES as locale}
          <li>
            <button
              class="fr-translate__language fr-nav__link"
              lang={locale.code}
              aria-current={locale.code == currentLocale}
              onclick={() => setLocale(locale.code)}
            >
              {locale.long}
            </button>
          </li>
        {/each}
      </ul>
    </div>
  </div>
</nav>
