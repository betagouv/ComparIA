{"version":3,"file":"webgpuEngine-BMNqKJ9l.js","sources":["../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuTextureHelper.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuPerfCounter.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/thinWebGPUEngine.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuConstants.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuShaderProcessor.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuPipelineContext.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuShaderProcessingContext.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Misc/codeStringParsingTools.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuShaderProcessorsGLSL.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuShaderProcessorsWGSL.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuHardwareTexture.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuTextureManager.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Meshes/WebGPU/webgpuDataBuffer.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuBufferManager.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuCacheSampler.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Buffers/buffer.nonFloatVertexBuffers.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuCacheRenderPipeline.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuCacheRenderPipelineTree.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuStencilStateComposer.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuDepthCullingState.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Materials/Textures/externalTexture.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuMaterialContext.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuDrawContext.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuCacheBindGroups.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/ShadersWGSL/clearQuad.vertex.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/ShadersWGSL/clearQuad.fragment.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuClearQuad.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuBundleList.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuQuerySet.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuTimestampQuery.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuOcclusionQuery.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/Processors/shaderCodeInliner.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuTintWASM.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuSnapshotRendering.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Buffers/buffer.align.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuExternalTexture.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/Extensions/engine.alpha.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/Extensions/engine.rawTexture.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/Extensions/engine.readTexture.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/Extensions/engine.cubeTexture.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/webgpuRenderTargetWrapper.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/Extensions/engine.renderTarget.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/Extensions/engine.renderTargetTexture.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/Extensions/engine.renderTargetCube.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/AbstractEngine/abstractEngine.query.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/WebGPU/Extensions/engine.query.js","../../../../node_modules/.pnpm/@babylonjs+core@8.2.0/node_modules/@babylonjs/core/Engines/webgpuEngine.js"],"sourcesContent":["import { ILog2 } from \"../../Maths/math.scalar.functions.js\";\n\n/** @internal */\nexport class WebGPUTextureHelper {\n    static ComputeNumMipmapLevels(width, height) {\n        return ILog2(Math.max(width, height)) + 1;\n    }\n    static GetTextureTypeFromFormat(format) {\n        switch (format) {\n            // One Component = 8 bits unsigned\n            case \"r8unorm\" /* WebGPUConstants.TextureFormat.R8Unorm */:\n            case \"r8uint\" /* WebGPUConstants.TextureFormat.R8Uint */:\n            case \"rg8unorm\" /* WebGPUConstants.TextureFormat.RG8Unorm */:\n            case \"rg8uint\" /* WebGPUConstants.TextureFormat.RG8Uint */:\n            case \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */:\n            case \"rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.RGBA8UnormSRGB */:\n            case \"rgba8uint\" /* WebGPUConstants.TextureFormat.RGBA8Uint */:\n            case \"bgra8unorm\" /* WebGPUConstants.TextureFormat.BGRA8Unorm */:\n            case \"bgra8unorm-srgb\" /* WebGPUConstants.TextureFormat.BGRA8UnormSRGB */:\n            case \"rgb10a2uint\" /* WebGPUConstants.TextureFormat.RGB10A2UINT */: // composite format - let's say it's byte...\n            case \"rgb10a2unorm\" /* WebGPUConstants.TextureFormat.RGB10A2Unorm */: // composite format - let's say it's byte...\n            case \"rgb9e5ufloat\" /* WebGPUConstants.TextureFormat.RGB9E5UFloat */: // composite format - let's say it's byte...\n            case \"rg11b10ufloat\" /* WebGPUConstants.TextureFormat.RG11B10UFloat */: // composite format - let's say it's byte...\n            case \"bc7-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC7RGBAUnorm */:\n            case \"bc7-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB */:\n            case \"bc6h-rgb-ufloat\" /* WebGPUConstants.TextureFormat.BC6HRGBUFloat */:\n            case \"bc5-rg-unorm\" /* WebGPUConstants.TextureFormat.BC5RGUnorm */:\n            case \"bc3-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC3RGBAUnorm */:\n            case \"bc3-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB */:\n            case \"bc2-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC2RGBAUnorm */:\n            case \"bc2-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB */:\n            case \"bc4-r-unorm\" /* WebGPUConstants.TextureFormat.BC4RUnorm */:\n            case \"bc1-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC1RGBAUnorm */:\n            case \"bc1-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB */:\n            case \"etc2-rgb8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8Unorm */:\n            case \"etc2-rgb8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB */:\n            case \"etc2-rgb8a1unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8A1Unorm */:\n            case \"etc2-rgb8a1unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8A1UnormSRGB */:\n            case \"etc2-rgba8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGBA8Unorm */:\n            case \"etc2-rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB */:\n            case \"eac-r11unorm\" /* WebGPUConstants.TextureFormat.EACR11Unorm */:\n            case \"eac-rg11unorm\" /* WebGPUConstants.TextureFormat.EACRG11Unorm */:\n            case \"astc-4x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC4x4Unorm */:\n            case \"astc-4x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB */:\n            case \"astc-5x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC5x4Unorm */:\n            case \"astc-5x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC5x4UnormSRGB */:\n            case \"astc-5x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC5x5Unorm */:\n            case \"astc-5x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC5x5UnormSRGB */:\n            case \"astc-6x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC6x5Unorm */:\n            case \"astc-6x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC6x5UnormSRGB */:\n            case \"astc-6x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC6x6Unorm */:\n            case \"astc-6x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC6x6UnormSRGB */:\n            case \"astc-8x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x5Unorm */:\n            case \"astc-8x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x5UnormSRGB */:\n            case \"astc-8x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x6Unorm */:\n            case \"astc-8x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x6UnormSRGB */:\n            case \"astc-8x8-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x8Unorm */:\n            case \"astc-8x8-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x8UnormSRGB */:\n            case \"astc-10x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x5Unorm */:\n            case \"astc-10x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x5UnormSRGB */:\n            case \"astc-10x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x6Unorm */:\n            case \"astc-10x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x6UnormSRGB */:\n            case \"astc-10x8-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x8Unorm */:\n            case \"astc-10x8-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x8UnormSRGB */:\n            case \"astc-10x10-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x10Unorm */:\n            case \"astc-10x10-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x10UnormSRGB */:\n            case \"astc-12x10-unorm\" /* WebGPUConstants.TextureFormat.ASTC12x10Unorm */:\n            case \"astc-12x10-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC12x10UnormSRGB */:\n            case \"astc-12x12-unorm\" /* WebGPUConstants.TextureFormat.ASTC12x12Unorm */:\n            case \"astc-12x12-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC12x12UnormSRGB */:\n            case \"stencil8\" /* WebGPUConstants.TextureFormat.Stencil8 */:\n                return 0;\n            // One Component = 8 bits signed\n            case \"r8snorm\" /* WebGPUConstants.TextureFormat.R8Snorm */:\n            case \"r8sint\" /* WebGPUConstants.TextureFormat.R8Sint */:\n            case \"rg8snorm\" /* WebGPUConstants.TextureFormat.RG8Snorm */:\n            case \"rg8sint\" /* WebGPUConstants.TextureFormat.RG8Sint */:\n            case \"rgba8snorm\" /* WebGPUConstants.TextureFormat.RGBA8Snorm */:\n            case \"rgba8sint\" /* WebGPUConstants.TextureFormat.RGBA8Sint */:\n            case \"bc6h-rgb-float\" /* WebGPUConstants.TextureFormat.BC6HRGBFloat */:\n            case \"bc5-rg-snorm\" /* WebGPUConstants.TextureFormat.BC5RGSnorm */:\n            case \"bc4-r-snorm\" /* WebGPUConstants.TextureFormat.BC4RSnorm */:\n            case \"eac-r11snorm\" /* WebGPUConstants.TextureFormat.EACR11Snorm */:\n            case \"eac-rg11snorm\" /* WebGPUConstants.TextureFormat.EACRG11Snorm */:\n                return 3;\n            // One component = 16 bits unsigned\n            case \"r16uint\" /* WebGPUConstants.TextureFormat.R16Uint */:\n            case \"r16unorm\" /* WebGPUConstants.TextureFormat.R16Unorm */:\n            case \"rg16unorm\" /* WebGPUConstants.TextureFormat.RG16Unorm */:\n            case \"rgba16unorm\" /* WebGPUConstants.TextureFormat.RGBA16Unorm */:\n            case \"rg16uint\" /* WebGPUConstants.TextureFormat.RG16Uint */:\n            case \"rgba16uint\" /* WebGPUConstants.TextureFormat.RGBA16Uint */:\n            case \"depth16unorm\" /* WebGPUConstants.TextureFormat.Depth16Unorm */:\n                return 5;\n            // One component = 16 bits signed\n            case \"r16sint\" /* WebGPUConstants.TextureFormat.R16Sint */:\n            case \"r16snorm\" /* WebGPUConstants.TextureFormat.R16Snorm */:\n            case \"rg16snorm\" /* WebGPUConstants.TextureFormat.RG16Snorm */:\n            case \"rgba16snorm\" /* WebGPUConstants.TextureFormat.RGBA16Snorm */:\n            case \"rg16sint\" /* WebGPUConstants.TextureFormat.RG16Sint */:\n            case \"rgba16sint\" /* WebGPUConstants.TextureFormat.RGBA16Sint */:\n                return 4;\n            case \"r16float\" /* WebGPUConstants.TextureFormat.R16Float */:\n            case \"rg16float\" /* WebGPUConstants.TextureFormat.RG16Float */:\n            case \"rgba16float\" /* WebGPUConstants.TextureFormat.RGBA16Float */:\n                return 2;\n            // One component = 32 bits unsigned\n            case \"r32uint\" /* WebGPUConstants.TextureFormat.R32Uint */:\n            case \"rg32uint\" /* WebGPUConstants.TextureFormat.RG32Uint */:\n            case \"rgba32uint\" /* WebGPUConstants.TextureFormat.RGBA32Uint */:\n                return 7;\n            // One component = 32 bits signed\n            case \"r32sint\" /* WebGPUConstants.TextureFormat.R32Sint */:\n            case \"rg32sint\" /* WebGPUConstants.TextureFormat.RG32Sint */:\n            case \"rgba32sint\" /* WebGPUConstants.TextureFormat.RGBA32Sint */:\n                return 7;\n            case \"r32float\" /* WebGPUConstants.TextureFormat.R32Float */:\n            case \"rg32float\" /* WebGPUConstants.TextureFormat.RG32Float */:\n            case \"rgba32float\" /* WebGPUConstants.TextureFormat.RGBA32Float */:\n            case \"depth32float\" /* WebGPUConstants.TextureFormat.Depth32Float */:\n            case \"depth32float-stencil8\" /* WebGPUConstants.TextureFormat.Depth32FloatStencil8 */:\n            case \"depth24plus\" /* WebGPUConstants.TextureFormat.Depth24Plus */:\n            case \"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */:\n                return 1;\n        }\n        return 0;\n    }\n    static GetBlockInformationFromFormat(format) {\n        switch (format) {\n            // 8 bits formats\n            case \"r8unorm\" /* WebGPUConstants.TextureFormat.R8Unorm */:\n            case \"r8snorm\" /* WebGPUConstants.TextureFormat.R8Snorm */:\n            case \"r8uint\" /* WebGPUConstants.TextureFormat.R8Uint */:\n            case \"r8sint\" /* WebGPUConstants.TextureFormat.R8Sint */:\n                return { width: 1, height: 1, length: 1 };\n            // 16 bits formats\n            case \"r16uint\" /* WebGPUConstants.TextureFormat.R16Uint */:\n            case \"r16sint\" /* WebGPUConstants.TextureFormat.R16Sint */:\n            case \"r16unorm\" /* WebGPUConstants.TextureFormat.R16Unorm */:\n            case \"rg16unorm\" /* WebGPUConstants.TextureFormat.RG16Unorm */:\n            case \"rgba16unorm\" /* WebGPUConstants.TextureFormat.RGBA16Unorm */:\n            case \"r16snorm\" /* WebGPUConstants.TextureFormat.R16Snorm */:\n            case \"rg16snorm\" /* WebGPUConstants.TextureFormat.RG16Snorm */:\n            case \"rgba16snorm\" /* WebGPUConstants.TextureFormat.RGBA16Snorm */:\n            case \"r16float\" /* WebGPUConstants.TextureFormat.R16Float */:\n            case \"rg8unorm\" /* WebGPUConstants.TextureFormat.RG8Unorm */:\n            case \"rg8snorm\" /* WebGPUConstants.TextureFormat.RG8Snorm */:\n            case \"rg8uint\" /* WebGPUConstants.TextureFormat.RG8Uint */:\n            case \"rg8sint\" /* WebGPUConstants.TextureFormat.RG8Sint */:\n                return { width: 1, height: 1, length: 2 };\n            // 32 bits formats\n            case \"r32uint\" /* WebGPUConstants.TextureFormat.R32Uint */:\n            case \"r32sint\" /* WebGPUConstants.TextureFormat.R32Sint */:\n            case \"r32float\" /* WebGPUConstants.TextureFormat.R32Float */:\n            case \"rg16uint\" /* WebGPUConstants.TextureFormat.RG16Uint */:\n            case \"rg16sint\" /* WebGPUConstants.TextureFormat.RG16Sint */:\n            case \"rg16float\" /* WebGPUConstants.TextureFormat.RG16Float */:\n            case \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */:\n            case \"rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.RGBA8UnormSRGB */:\n            case \"rgba8snorm\" /* WebGPUConstants.TextureFormat.RGBA8Snorm */:\n            case \"rgba8uint\" /* WebGPUConstants.TextureFormat.RGBA8Uint */:\n            case \"rgba8sint\" /* WebGPUConstants.TextureFormat.RGBA8Sint */:\n            case \"bgra8unorm\" /* WebGPUConstants.TextureFormat.BGRA8Unorm */:\n            case \"bgra8unorm-srgb\" /* WebGPUConstants.TextureFormat.BGRA8UnormSRGB */:\n            case \"rgb9e5ufloat\" /* WebGPUConstants.TextureFormat.RGB9E5UFloat */:\n            case \"rgb10a2uint\" /* WebGPUConstants.TextureFormat.RGB10A2UINT */:\n            case \"rgb10a2unorm\" /* WebGPUConstants.TextureFormat.RGB10A2Unorm */:\n            case \"rg11b10ufloat\" /* WebGPUConstants.TextureFormat.RG11B10UFloat */:\n                return { width: 1, height: 1, length: 4 };\n            // 64 bits formats\n            case \"rg32uint\" /* WebGPUConstants.TextureFormat.RG32Uint */:\n            case \"rg32sint\" /* WebGPUConstants.TextureFormat.RG32Sint */:\n            case \"rg32float\" /* WebGPUConstants.TextureFormat.RG32Float */:\n            case \"rgba16uint\" /* WebGPUConstants.TextureFormat.RGBA16Uint */:\n            case \"rgba16sint\" /* WebGPUConstants.TextureFormat.RGBA16Sint */:\n            case \"rgba16float\" /* WebGPUConstants.TextureFormat.RGBA16Float */:\n                return { width: 1, height: 1, length: 8 };\n            // 128 bits formats\n            case \"rgba32uint\" /* WebGPUConstants.TextureFormat.RGBA32Uint */:\n            case \"rgba32sint\" /* WebGPUConstants.TextureFormat.RGBA32Sint */:\n            case \"rgba32float\" /* WebGPUConstants.TextureFormat.RGBA32Float */:\n                return { width: 1, height: 1, length: 16 };\n            // Depth and stencil formats\n            case \"stencil8\" /* WebGPUConstants.TextureFormat.Stencil8 */:\n                // eslint-disable-next-line no-throw-literal\n                throw \"No fixed size for Stencil8 format!\";\n            case \"depth16unorm\" /* WebGPUConstants.TextureFormat.Depth16Unorm */:\n                return { width: 1, height: 1, length: 2 };\n            case \"depth24plus\" /* WebGPUConstants.TextureFormat.Depth24Plus */:\n                // eslint-disable-next-line no-throw-literal\n                throw \"No fixed size for Depth24Plus format!\";\n            case \"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */:\n                // eslint-disable-next-line no-throw-literal\n                throw \"No fixed size for Depth24PlusStencil8 format!\";\n            case \"depth32float\" /* WebGPUConstants.TextureFormat.Depth32Float */:\n                return { width: 1, height: 1, length: 4 };\n            case \"depth32float-stencil8\" /* WebGPUConstants.TextureFormat.Depth32FloatStencil8 */:\n                return { width: 1, height: 1, length: 5 };\n            // BC compressed formats usable if \"texture-compression-bc\" is both\n            // supported by the device/user agent and enabled in requestDevice.\n            case \"bc7-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC7RGBAUnorm */:\n            case \"bc7-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB */:\n            case \"bc6h-rgb-ufloat\" /* WebGPUConstants.TextureFormat.BC6HRGBUFloat */:\n            case \"bc6h-rgb-float\" /* WebGPUConstants.TextureFormat.BC6HRGBFloat */:\n            case \"bc5-rg-unorm\" /* WebGPUConstants.TextureFormat.BC5RGUnorm */:\n            case \"bc5-rg-snorm\" /* WebGPUConstants.TextureFormat.BC5RGSnorm */:\n            case \"bc3-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC3RGBAUnorm */:\n            case \"bc3-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB */:\n            case \"bc2-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC2RGBAUnorm */:\n            case \"bc2-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB */:\n                return { width: 4, height: 4, length: 16 };\n            case \"bc4-r-unorm\" /* WebGPUConstants.TextureFormat.BC4RUnorm */:\n            case \"bc4-r-snorm\" /* WebGPUConstants.TextureFormat.BC4RSnorm */:\n            case \"bc1-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC1RGBAUnorm */:\n            case \"bc1-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB */:\n                return { width: 4, height: 4, length: 8 };\n            // ETC2 compressed formats usable if \"texture-compression-etc2\" is both\n            // supported by the device/user agent and enabled in requestDevice.\n            case \"etc2-rgb8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8Unorm */:\n            case \"etc2-rgb8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB */:\n            case \"etc2-rgb8a1unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8A1Unorm */:\n            case \"etc2-rgb8a1unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8A1UnormSRGB */:\n            case \"eac-r11unorm\" /* WebGPUConstants.TextureFormat.EACR11Unorm */:\n            case \"eac-r11snorm\" /* WebGPUConstants.TextureFormat.EACR11Snorm */:\n                return { width: 4, height: 4, length: 8 };\n            case \"etc2-rgba8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGBA8Unorm */:\n            case \"etc2-rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB */:\n            case \"eac-rg11unorm\" /* WebGPUConstants.TextureFormat.EACRG11Unorm */:\n            case \"eac-rg11snorm\" /* WebGPUConstants.TextureFormat.EACRG11Snorm */:\n                return { width: 4, height: 4, length: 16 };\n            // ASTC compressed formats usable if \"texture-compression-astc\" is both\n            // supported by the device/user agent and enabled in requestDevice.\n            case \"astc-4x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC4x4Unorm */:\n            case \"astc-4x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB */:\n                return { width: 4, height: 4, length: 16 };\n            case \"astc-5x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC5x4Unorm */:\n            case \"astc-5x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC5x4UnormSRGB */:\n                return { width: 5, height: 4, length: 16 };\n            case \"astc-5x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC5x5Unorm */:\n            case \"astc-5x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC5x5UnormSRGB */:\n                return { width: 5, height: 5, length: 16 };\n            case \"astc-6x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC6x5Unorm */:\n            case \"astc-6x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC6x5UnormSRGB */:\n                return { width: 6, height: 5, length: 16 };\n            case \"astc-6x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC6x6Unorm */:\n            case \"astc-6x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC6x6UnormSRGB */:\n                return { width: 6, height: 6, length: 16 };\n            case \"astc-8x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x5Unorm */:\n            case \"astc-8x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x5UnormSRGB */:\n                return { width: 8, height: 5, length: 16 };\n            case \"astc-8x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x6Unorm */:\n            case \"astc-8x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x6UnormSRGB */:\n                return { width: 8, height: 6, length: 16 };\n            case \"astc-8x8-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x8Unorm */:\n            case \"astc-8x8-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x8UnormSRGB */:\n                return { width: 8, height: 8, length: 16 };\n            case \"astc-10x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x5Unorm */:\n            case \"astc-10x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x5UnormSRGB */:\n                return { width: 10, height: 5, length: 16 };\n            case \"astc-10x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x6Unorm */:\n            case \"astc-10x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x6UnormSRGB */:\n                return { width: 10, height: 6, length: 16 };\n            case \"astc-10x8-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x8Unorm */:\n            case \"astc-10x8-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x8UnormSRGB */:\n                return { width: 10, height: 8, length: 16 };\n            case \"astc-10x10-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x10Unorm */:\n            case \"astc-10x10-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x10UnormSRGB */:\n                return { width: 10, height: 10, length: 16 };\n            case \"astc-12x10-unorm\" /* WebGPUConstants.TextureFormat.ASTC12x10Unorm */:\n            case \"astc-12x10-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC12x10UnormSRGB */:\n                return { width: 12, height: 10, length: 16 };\n            case \"astc-12x12-unorm\" /* WebGPUConstants.TextureFormat.ASTC12x12Unorm */:\n            case \"astc-12x12-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC12x12UnormSRGB */:\n                return { width: 12, height: 12, length: 16 };\n        }\n        return { width: 1, height: 1, length: 4 };\n    }\n    static IsHardwareTexture(texture) {\n        return !!texture.release;\n    }\n    static IsInternalTexture(texture) {\n        return !!texture.dispose;\n    }\n    static IsImageBitmap(imageBitmap) {\n        return imageBitmap.close !== undefined;\n    }\n    static IsImageBitmapArray(imageBitmap) {\n        return Array.isArray(imageBitmap) && imageBitmap[0].close !== undefined;\n    }\n    static IsCompressedFormat(format) {\n        switch (format) {\n            case \"bc7-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB */:\n            case \"bc7-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC7RGBAUnorm */:\n            case \"bc6h-rgb-float\" /* WebGPUConstants.TextureFormat.BC6HRGBFloat */:\n            case \"bc6h-rgb-ufloat\" /* WebGPUConstants.TextureFormat.BC6HRGBUFloat */:\n            case \"bc5-rg-snorm\" /* WebGPUConstants.TextureFormat.BC5RGSnorm */:\n            case \"bc5-rg-unorm\" /* WebGPUConstants.TextureFormat.BC5RGUnorm */:\n            case \"bc4-r-snorm\" /* WebGPUConstants.TextureFormat.BC4RSnorm */:\n            case \"bc4-r-unorm\" /* WebGPUConstants.TextureFormat.BC4RUnorm */:\n            case \"bc3-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB */:\n            case \"bc3-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC3RGBAUnorm */:\n            case \"bc2-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB */:\n            case \"bc2-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC2RGBAUnorm */:\n            case \"bc1-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB */:\n            case \"bc1-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC1RGBAUnorm */:\n            case \"etc2-rgb8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8Unorm */:\n            case \"etc2-rgb8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB */:\n            case \"etc2-rgb8a1unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8A1Unorm */:\n            case \"etc2-rgb8a1unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8A1UnormSRGB */:\n            case \"etc2-rgba8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGBA8Unorm */:\n            case \"etc2-rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB */:\n            case \"eac-r11unorm\" /* WebGPUConstants.TextureFormat.EACR11Unorm */:\n            case \"eac-r11snorm\" /* WebGPUConstants.TextureFormat.EACR11Snorm */:\n            case \"eac-rg11unorm\" /* WebGPUConstants.TextureFormat.EACRG11Unorm */:\n            case \"eac-rg11snorm\" /* WebGPUConstants.TextureFormat.EACRG11Snorm */:\n            case \"astc-4x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC4x4Unorm */:\n            case \"astc-4x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB */:\n            case \"astc-5x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC5x4Unorm */:\n            case \"astc-5x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC5x4UnormSRGB */:\n            case \"astc-5x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC5x5Unorm */:\n            case \"astc-5x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC5x5UnormSRGB */:\n            case \"astc-6x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC6x5Unorm */:\n            case \"astc-6x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC6x5UnormSRGB */:\n            case \"astc-6x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC6x6Unorm */:\n            case \"astc-6x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC6x6UnormSRGB */:\n            case \"astc-8x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x5Unorm */:\n            case \"astc-8x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x5UnormSRGB */:\n            case \"astc-8x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x6Unorm */:\n            case \"astc-8x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x6UnormSRGB */:\n            case \"astc-8x8-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x8Unorm */:\n            case \"astc-8x8-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x8UnormSRGB */:\n            case \"astc-10x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x5Unorm */:\n            case \"astc-10x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x5UnormSRGB */:\n            case \"astc-10x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x6Unorm */:\n            case \"astc-10x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x6UnormSRGB */:\n            case \"astc-10x8-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x8Unorm */:\n            case \"astc-10x8-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x8UnormSRGB */:\n            case \"astc-10x10-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x10Unorm */:\n            case \"astc-10x10-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x10UnormSRGB */:\n            case \"astc-12x10-unorm\" /* WebGPUConstants.TextureFormat.ASTC12x10Unorm */:\n            case \"astc-12x10-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC12x10UnormSRGB */:\n            case \"astc-12x12-unorm\" /* WebGPUConstants.TextureFormat.ASTC12x12Unorm */:\n            case \"astc-12x12-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC12x12UnormSRGB */:\n                return true;\n        }\n        return false;\n    }\n    static GetWebGPUTextureFormat(type, format, useSRGBBuffer = false) {\n        switch (format) {\n            case 15:\n                return \"depth16unorm\" /* WebGPUConstants.TextureFormat.Depth16Unorm */;\n            case 16:\n                return \"depth24plus\" /* WebGPUConstants.TextureFormat.Depth24Plus */;\n            case 13:\n                return \"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */;\n            case 14:\n                return \"depth32float\" /* WebGPUConstants.TextureFormat.Depth32Float */;\n            case 18:\n                return \"depth32float-stencil8\" /* WebGPUConstants.TextureFormat.Depth32FloatStencil8 */;\n            case 19:\n                return \"stencil8\" /* WebGPUConstants.TextureFormat.Stencil8 */;\n            case 36492:\n                return useSRGBBuffer ? \"bc7-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB */ : \"bc7-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC7RGBAUnorm */;\n            case 36495:\n                return \"bc6h-rgb-ufloat\" /* WebGPUConstants.TextureFormat.BC6HRGBUFloat */;\n            case 36494:\n                return \"bc6h-rgb-float\" /* WebGPUConstants.TextureFormat.BC6HRGBFloat */;\n            case 33779:\n                return useSRGBBuffer ? \"bc3-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB */ : \"bc3-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC3RGBAUnorm */;\n            case 33778:\n                return useSRGBBuffer ? \"bc2-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB */ : \"bc2-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC2RGBAUnorm */;\n            case 33777:\n            case 33776:\n                return useSRGBBuffer ? \"bc1-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB */ : \"bc1-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC1RGBAUnorm */;\n            case 37808:\n                return useSRGBBuffer ? \"astc-4x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB */ : \"astc-4x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC4x4Unorm */;\n            case 36196:\n            case 37492:\n                return useSRGBBuffer ? \"etc2-rgb8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB */ : \"etc2-rgb8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8Unorm */;\n            case 37496:\n                return useSRGBBuffer ? \"etc2-rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB */ : \"etc2-rgba8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGBA8Unorm */;\n        }\n        switch (type) {\n            case 3:\n                switch (format) {\n                    case 6:\n                        return \"r8snorm\" /* WebGPUConstants.TextureFormat.R8Snorm */;\n                    case 7:\n                        return \"rg8snorm\" /* WebGPUConstants.TextureFormat.RG8Snorm */;\n                    case 4:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"RGB format not supported in WebGPU\";\n                    case 8:\n                        return \"r8sint\" /* WebGPUConstants.TextureFormat.R8Sint */;\n                    case 9:\n                        return \"rg8sint\" /* WebGPUConstants.TextureFormat.RG8Sint */;\n                    case 10:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"RGB_INTEGER format not supported in WebGPU\";\n                    case 11:\n                        return \"rgba8sint\" /* WebGPUConstants.TextureFormat.RGBA8Sint */;\n                    default:\n                        return \"rgba8snorm\" /* WebGPUConstants.TextureFormat.RGBA8Snorm */;\n                }\n            case 0:\n                switch (format) {\n                    case 6:\n                        return \"r8unorm\" /* WebGPUConstants.TextureFormat.R8Unorm */;\n                    case 7:\n                        return \"rg8unorm\" /* WebGPUConstants.TextureFormat.RG8Unorm */;\n                    case 4:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGB format not supported in WebGPU\";\n                    case 5:\n                        return useSRGBBuffer ? \"rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.RGBA8UnormSRGB */ : \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */;\n                    case 12:\n                        return useSRGBBuffer ? \"bgra8unorm-srgb\" /* WebGPUConstants.TextureFormat.BGRA8UnormSRGB */ : \"bgra8unorm\" /* WebGPUConstants.TextureFormat.BGRA8Unorm */;\n                    case 8:\n                        return \"r8uint\" /* WebGPUConstants.TextureFormat.R8Uint */;\n                    case 9:\n                        return \"rg8uint\" /* WebGPUConstants.TextureFormat.RG8Uint */;\n                    case 10:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"RGB_INTEGER format not supported in WebGPU\";\n                    case 11:\n                        return \"rgba8uint\" /* WebGPUConstants.TextureFormat.RGBA8Uint */;\n                    case 0:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_ALPHA format not supported in WebGPU\";\n                    case 1:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_LUMINANCE format not supported in WebGPU\";\n                    case 2:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_LUMINANCE_ALPHA format not supported in WebGPU\";\n                    default:\n                        return \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */;\n                }\n            case 4:\n                switch (format) {\n                    case 8:\n                        return \"r16sint\" /* WebGPUConstants.TextureFormat.R16Sint */;\n                    case 9:\n                        return \"rg16sint\" /* WebGPUConstants.TextureFormat.RG16Sint */;\n                    case 10:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU\";\n                    case 11:\n                        return \"rgba16sint\" /* WebGPUConstants.TextureFormat.RGBA16Sint */;\n                    default:\n                        return \"rgba16sint\" /* WebGPUConstants.TextureFormat.RGBA16Sint */;\n                }\n            case 5:\n                switch (format) {\n                    case 8:\n                        return \"r16uint\" /* WebGPUConstants.TextureFormat.R16Uint */;\n                    case 9:\n                        return \"rg16uint\" /* WebGPUConstants.TextureFormat.RG16Uint */;\n                    case 10:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU\";\n                    case 11:\n                        return \"rgba16uint\" /* WebGPUConstants.TextureFormat.RGBA16Uint */;\n                    default:\n                        return \"rgba16uint\" /* WebGPUConstants.TextureFormat.RGBA16Uint */;\n                }\n            case 6:\n                switch (format) {\n                    case 8:\n                        return \"r32sint\" /* WebGPUConstants.TextureFormat.R32Sint */;\n                    case 9:\n                        return \"rg32sint\" /* WebGPUConstants.TextureFormat.RG32Sint */;\n                    case 10:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU\";\n                    case 11:\n                        return \"rgba32sint\" /* WebGPUConstants.TextureFormat.RGBA32Sint */;\n                    default:\n                        return \"rgba32sint\" /* WebGPUConstants.TextureFormat.RGBA32Sint */;\n                }\n            case 7: // Refers to UNSIGNED_INT\n                switch (format) {\n                    case 8:\n                        return \"r32uint\" /* WebGPUConstants.TextureFormat.R32Uint */;\n                    case 9:\n                        return \"rg32uint\" /* WebGPUConstants.TextureFormat.RG32Uint */;\n                    case 10:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU\";\n                    case 11:\n                        return \"rgba32uint\" /* WebGPUConstants.TextureFormat.RGBA32Uint */;\n                    default:\n                        return \"rgba32uint\" /* WebGPUConstants.TextureFormat.RGBA32Uint */;\n                }\n            case 1:\n                switch (format) {\n                    case 6:\n                        return \"r32float\" /* WebGPUConstants.TextureFormat.R32Float */; // By default. Other possibility is R16Float.\n                    case 7:\n                        return \"rg32float\" /* WebGPUConstants.TextureFormat.RG32Float */; // By default. Other possibility is RG16Float.\n                    case 4:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGB format not supported in WebGPU\";\n                    case 5:\n                        return \"rgba32float\" /* WebGPUConstants.TextureFormat.RGBA32Float */; // By default. Other possibility is RGBA16Float.\n                    default:\n                        return \"rgba32float\" /* WebGPUConstants.TextureFormat.RGBA32Float */;\n                }\n            case 2:\n                switch (format) {\n                    case 6:\n                        return \"r16float\" /* WebGPUConstants.TextureFormat.R16Float */;\n                    case 7:\n                        return \"rg16float\" /* WebGPUConstants.TextureFormat.RG16Float */;\n                    case 4:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGB format not supported in WebGPU\";\n                    case 5:\n                        return \"rgba16float\" /* WebGPUConstants.TextureFormat.RGBA16Float */;\n                    default:\n                        return \"rgba16float\" /* WebGPUConstants.TextureFormat.RGBA16Float */;\n                }\n            case 10:\n                // eslint-disable-next-line no-throw-literal\n                throw \"TEXTURETYPE_UNSIGNED_SHORT_5_6_5 format not supported in WebGPU\";\n            case 13:\n                switch (format) {\n                    case 5:\n                        return \"rg11b10ufloat\" /* WebGPUConstants.TextureFormat.RG11B10UFloat */;\n                    case 11:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV\";\n                    default:\n                        return \"rg11b10ufloat\" /* WebGPUConstants.TextureFormat.RG11B10UFloat */;\n                }\n            case 14:\n                switch (format) {\n                    case 5:\n                        return \"rgb9e5ufloat\" /* WebGPUConstants.TextureFormat.RGB9E5UFloat */;\n                    case 11:\n                        // eslint-disable-next-line no-throw-literal\n                        throw \"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV\";\n                    default:\n                        return \"rgb9e5ufloat\" /* WebGPUConstants.TextureFormat.RGB9E5UFloat */;\n                }\n            case 8:\n                // eslint-disable-next-line no-throw-literal\n                throw \"TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 format not supported in WebGPU\";\n            case 9:\n                // eslint-disable-next-line no-throw-literal\n                throw \"TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 format not supported in WebGPU\";\n            case 11:\n                switch (format) {\n                    case 5:\n                        return \"rgb10a2unorm\" /* WebGPUConstants.TextureFormat.RGB10A2Unorm */;\n                    case 11:\n                        return \"rgb10a2uint\" /* WebGPUConstants.TextureFormat.RGB10A2UINT */;\n                    default:\n                        return \"rgb10a2unorm\" /* WebGPUConstants.TextureFormat.RGB10A2Unorm */;\n                }\n        }\n        return useSRGBBuffer ? \"rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.RGBA8UnormSRGB */ : \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */;\n    }\n    static GetNumChannelsFromWebGPUTextureFormat(format) {\n        switch (format) {\n            case \"r8unorm\" /* WebGPUConstants.TextureFormat.R8Unorm */:\n            case \"r8snorm\" /* WebGPUConstants.TextureFormat.R8Snorm */:\n            case \"r8uint\" /* WebGPUConstants.TextureFormat.R8Uint */:\n            case \"r8sint\" /* WebGPUConstants.TextureFormat.R8Sint */:\n            case \"bc4-r-unorm\" /* WebGPUConstants.TextureFormat.BC4RUnorm */:\n            case \"bc4-r-snorm\" /* WebGPUConstants.TextureFormat.BC4RSnorm */:\n            case \"r16uint\" /* WebGPUConstants.TextureFormat.R16Uint */:\n            case \"r16sint\" /* WebGPUConstants.TextureFormat.R16Sint */:\n            case \"depth16unorm\" /* WebGPUConstants.TextureFormat.Depth16Unorm */:\n            case \"r16float\" /* WebGPUConstants.TextureFormat.R16Float */:\n            case \"r16unorm\" /* WebGPUConstants.TextureFormat.R16Unorm */:\n            case \"r16snorm\" /* WebGPUConstants.TextureFormat.R16Snorm */:\n            case \"r32uint\" /* WebGPUConstants.TextureFormat.R32Uint */:\n            case \"r32sint\" /* WebGPUConstants.TextureFormat.R32Sint */:\n            case \"r32float\" /* WebGPUConstants.TextureFormat.R32Float */:\n            case \"depth32float\" /* WebGPUConstants.TextureFormat.Depth32Float */:\n            case \"stencil8\" /* WebGPUConstants.TextureFormat.Stencil8 */:\n            case \"depth24plus\" /* WebGPUConstants.TextureFormat.Depth24Plus */:\n            case \"eac-r11unorm\" /* WebGPUConstants.TextureFormat.EACR11Unorm */:\n            case \"eac-r11snorm\" /* WebGPUConstants.TextureFormat.EACR11Snorm */:\n                return 1;\n            case \"rg8unorm\" /* WebGPUConstants.TextureFormat.RG8Unorm */:\n            case \"rg8snorm\" /* WebGPUConstants.TextureFormat.RG8Snorm */:\n            case \"rg8uint\" /* WebGPUConstants.TextureFormat.RG8Uint */:\n            case \"rg8sint\" /* WebGPUConstants.TextureFormat.RG8Sint */:\n            case \"depth32float-stencil8\" /* WebGPUConstants.TextureFormat.Depth32FloatStencil8 */:\n            case \"bc5-rg-unorm\" /* WebGPUConstants.TextureFormat.BC5RGUnorm */:\n            case \"bc5-rg-snorm\" /* WebGPUConstants.TextureFormat.BC5RGSnorm */:\n            case \"rg16uint\" /* WebGPUConstants.TextureFormat.RG16Uint */:\n            case \"rg16sint\" /* WebGPUConstants.TextureFormat.RG16Sint */:\n            case \"rg16float\" /* WebGPUConstants.TextureFormat.RG16Float */:\n            case \"rg16unorm\" /* WebGPUConstants.TextureFormat.RG16Unorm */:\n            case \"rg16snorm\" /* WebGPUConstants.TextureFormat.RG16Snorm */:\n            case \"rg32uint\" /* WebGPUConstants.TextureFormat.RG32Uint */:\n            case \"rg32sint\" /* WebGPUConstants.TextureFormat.RG32Sint */:\n            case \"rg32float\" /* WebGPUConstants.TextureFormat.RG32Float */:\n            case \"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */:\n            case \"eac-rg11unorm\" /* WebGPUConstants.TextureFormat.EACRG11Unorm */:\n            case \"eac-rg11snorm\" /* WebGPUConstants.TextureFormat.EACRG11Snorm */:\n                return 2;\n            case \"rgb9e5ufloat\" /* WebGPUConstants.TextureFormat.RGB9E5UFloat */:\n            case \"rg11b10ufloat\" /* WebGPUConstants.TextureFormat.RG11B10UFloat */:\n            case \"bc6h-rgb-ufloat\" /* WebGPUConstants.TextureFormat.BC6HRGBUFloat */:\n            case \"bc6h-rgb-float\" /* WebGPUConstants.TextureFormat.BC6HRGBFloat */:\n            case \"etc2-rgb8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8Unorm */:\n            case \"etc2-rgb8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8UnormSRGB */:\n                return 3;\n            case \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */:\n            case \"rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.RGBA8UnormSRGB */:\n            case \"rgba8snorm\" /* WebGPUConstants.TextureFormat.RGBA8Snorm */:\n            case \"rgba8uint\" /* WebGPUConstants.TextureFormat.RGBA8Uint */:\n            case \"rgba8sint\" /* WebGPUConstants.TextureFormat.RGBA8Sint */:\n            case \"bgra8unorm\" /* WebGPUConstants.TextureFormat.BGRA8Unorm */:\n            case \"bgra8unorm-srgb\" /* WebGPUConstants.TextureFormat.BGRA8UnormSRGB */:\n            case \"rgba16unorm\" /* WebGPUConstants.TextureFormat.RGBA16Unorm */:\n            case \"rgba16snorm\" /* WebGPUConstants.TextureFormat.RGBA16Snorm */:\n            case \"rgb10a2uint\" /* WebGPUConstants.TextureFormat.RGB10A2UINT */:\n            case \"rgb10a2unorm\" /* WebGPUConstants.TextureFormat.RGB10A2Unorm */:\n            case \"bc7-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC7RGBAUnorm */:\n            case \"bc7-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC7RGBAUnormSRGB */:\n            case \"bc3-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC3RGBAUnorm */:\n            case \"bc3-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC3RGBAUnormSRGB */:\n            case \"bc2-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC2RGBAUnorm */:\n            case \"bc2-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC2RGBAUnormSRGB */:\n            case \"bc1-rgba-unorm\" /* WebGPUConstants.TextureFormat.BC1RGBAUnorm */:\n            case \"bc1-rgba-unorm-srgb\" /* WebGPUConstants.TextureFormat.BC1RGBAUnormSRGB */:\n            case \"rgba16uint\" /* WebGPUConstants.TextureFormat.RGBA16Uint */:\n            case \"rgba16sint\" /* WebGPUConstants.TextureFormat.RGBA16Sint */:\n            case \"rgba16float\" /* WebGPUConstants.TextureFormat.RGBA16Float */:\n            case \"rgba32uint\" /* WebGPUConstants.TextureFormat.RGBA32Uint */:\n            case \"rgba32sint\" /* WebGPUConstants.TextureFormat.RGBA32Sint */:\n            case \"rgba32float\" /* WebGPUConstants.TextureFormat.RGBA32Float */:\n            case \"etc2-rgb8a1unorm\" /* WebGPUConstants.TextureFormat.ETC2RGB8A1Unorm */:\n            case \"etc2-rgb8a1unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGB8A1UnormSRGB */:\n            case \"etc2-rgba8unorm\" /* WebGPUConstants.TextureFormat.ETC2RGBA8Unorm */:\n            case \"etc2-rgba8unorm-srgb\" /* WebGPUConstants.TextureFormat.ETC2RGBA8UnormSRGB */:\n            case \"astc-4x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC4x4Unorm */:\n            case \"astc-4x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC4x4UnormSRGB */:\n            case \"astc-5x4-unorm\" /* WebGPUConstants.TextureFormat.ASTC5x4Unorm */:\n            case \"astc-5x4-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC5x4UnormSRGB */:\n            case \"astc-5x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC5x5Unorm */:\n            case \"astc-5x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC5x5UnormSRGB */:\n            case \"astc-6x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC6x5Unorm */:\n            case \"astc-6x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC6x5UnormSRGB */:\n            case \"astc-6x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC6x6Unorm */:\n            case \"astc-6x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC6x6UnormSRGB */:\n            case \"astc-8x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x5Unorm */:\n            case \"astc-8x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x5UnormSRGB */:\n            case \"astc-8x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x6Unorm */:\n            case \"astc-8x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x6UnormSRGB */:\n            case \"astc-8x8-unorm\" /* WebGPUConstants.TextureFormat.ASTC8x8Unorm */:\n            case \"astc-8x8-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC8x8UnormSRGB */:\n            case \"astc-10x5-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x5Unorm */:\n            case \"astc-10x5-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x5UnormSRGB */:\n            case \"astc-10x6-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x6Unorm */:\n            case \"astc-10x6-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x6UnormSRGB */:\n            case \"astc-10x8-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x8Unorm */:\n            case \"astc-10x8-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x8UnormSRGB */:\n            case \"astc-10x10-unorm\" /* WebGPUConstants.TextureFormat.ASTC10x10Unorm */:\n            case \"astc-10x10-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC10x10UnormSRGB */:\n            case \"astc-12x10-unorm\" /* WebGPUConstants.TextureFormat.ASTC12x10Unorm */:\n            case \"astc-12x10-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC12x10UnormSRGB */:\n            case \"astc-12x12-unorm\" /* WebGPUConstants.TextureFormat.ASTC12x12Unorm */:\n            case \"astc-12x12-unorm-srgb\" /* WebGPUConstants.TextureFormat.ASTC12x12UnormSRGB */:\n                return 4;\n        }\n        // eslint-disable-next-line no-throw-literal\n        throw `Unknown format ${format}!`;\n    }\n    static HasStencilAspect(format) {\n        switch (format) {\n            case \"stencil8\" /* WebGPUConstants.TextureFormat.Stencil8 */:\n            case \"depth32float-stencil8\" /* WebGPUConstants.TextureFormat.Depth32FloatStencil8 */:\n            case \"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */:\n                return true;\n        }\n        return false;\n    }\n    static HasDepthAndStencilAspects(format) {\n        switch (format) {\n            case \"depth32float-stencil8\" /* WebGPUConstants.TextureFormat.Depth32FloatStencil8 */:\n            case \"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */:\n                return true;\n        }\n        return false;\n    }\n    static GetDepthFormatOnly(format) {\n        switch (format) {\n            case \"depth16unorm\" /* WebGPUConstants.TextureFormat.Depth16Unorm */:\n                return \"depth16unorm\" /* WebGPUConstants.TextureFormat.Depth16Unorm */;\n            case \"depth24plus\" /* WebGPUConstants.TextureFormat.Depth24Plus */:\n                return \"depth24plus\" /* WebGPUConstants.TextureFormat.Depth24Plus */;\n            case \"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */:\n                return \"depth24plus\" /* WebGPUConstants.TextureFormat.Depth24Plus */;\n            case \"depth32float\" /* WebGPUConstants.TextureFormat.Depth32Float */:\n                return \"depth32float\" /* WebGPUConstants.TextureFormat.Depth32Float */;\n            case \"depth32float-stencil8\" /* WebGPUConstants.TextureFormat.Depth32FloatStencil8 */:\n                return \"depth32float\" /* WebGPUConstants.TextureFormat.Depth32Float */;\n        }\n        return format;\n    }\n    static GetSample(sampleCount) {\n        // WebGPU only supports 1 or 4\n        return sampleCount > 1 ? 4 : 1;\n    }\n}\n//# sourceMappingURL=webgpuTextureHelper.js.map","import { PerfCounter } from \"../../Misc/perfCounter.js\";\n/**\n * Class used to define a WebGPU performance counter\n */\nexport class WebGPUPerfCounter {\n    constructor() {\n        this._gpuTimeInFrameId = -1;\n        /**\n         * The GPU time in nanoseconds spent in the last frame\n         */\n        this.counter = new PerfCounter();\n    }\n    /**\n     * @internal\n     */\n    _addDuration(currentFrameId, duration) {\n        if (currentFrameId < this._gpuTimeInFrameId) {\n            return;\n        }\n        if (this._gpuTimeInFrameId !== currentFrameId) {\n            this.counter._fetchResult();\n            this.counter.fetchNewFrame();\n            this.counter.addCount(duration, false);\n            this._gpuTimeInFrameId = currentFrameId;\n        }\n        else {\n            this.counter.addCount(duration, false);\n        }\n    }\n}\n//# sourceMappingURL=webgpuPerfCounter.js.map","import { AbstractEngine } from \"./abstractEngine.js\";\nimport { Logger } from \"../Misc/logger.js\";\nimport { WebGPUTextureHelper } from \"./WebGPU/webgpuTextureHelper.js\";\nimport { WebGPUPerfCounter } from \"./WebGPU/webgpuPerfCounter.js\";\n\n/**\n * The base engine class for WebGPU\n */\nexport class ThinWebGPUEngine extends AbstractEngine {\n    constructor() {\n        super(...arguments);\n        // TODO WEBGPU remove those variables when code stabilized\n        /** @internal */\n        this.dbgShowShaderCode = false;\n        /** @internal */\n        this.dbgSanityChecks = true;\n        /** @internal */\n        this.dbgVerboseLogsNumFrames = 10;\n        /** @internal */\n        this.dbgLogIfNotDrawWrapper = true;\n        /** @internal */\n        this.dbgShowEmptyEnableEffectCalls = true;\n        /** @internal */\n        this.dbgVerboseLogsForFirstFrames = false;\n        /** @internal */\n        this._currentRenderPass = null;\n        this._snapshotRenderingMode = 0;\n        /** @internal */\n        this._timestampIndex = 0;\n        /** @internal */\n        this._debugStackRenderPass = [];\n    }\n    /**\n     * Enables or disables GPU timing measurements.\n     * Note that this is only supported if the \"timestamp-query\" extension is enabled in the options.\n     */\n    get enableGPUTimingMeasurements() {\n        return this._timestampQuery.enable;\n    }\n    set enableGPUTimingMeasurements(enable) {\n        if (this._timestampQuery.enable === enable) {\n            return;\n        }\n        this.gpuTimeInFrameForMainPass = enable ? new WebGPUPerfCounter() : undefined;\n        this._timestampQuery.enable = enable;\n    }\n    _currentPassIsMainPass() {\n        return this._currentRenderTarget === null;\n    }\n    /** @internal */\n    _endCurrentRenderPass() {\n        if (!this._currentRenderPass) {\n            return 0;\n        }\n        if (this._debugStackRenderPass.length !== 0) {\n            for (let i = 0; i < this._debugStackRenderPass.length; ++i) {\n                this._currentRenderPass.popDebugGroup();\n            }\n        }\n        const currentPassIndex = this._currentPassIsMainPass() ? 2 : 1;\n        if (!this._snapshotRendering.endRenderPass(this._currentRenderPass) && !this.compatibilityMode) {\n            this._bundleList.run(this._currentRenderPass);\n            this._bundleList.reset();\n        }\n        this._currentRenderPass.end();\n        this._timestampQuery.endPass(this._timestampIndex, (this._currentRenderTarget && this._currentRenderTarget.gpuTimeInFrame\n            ? this._currentRenderTarget.gpuTimeInFrame\n            : this.gpuTimeInFrameForMainPass));\n        this._timestampIndex += 2;\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log(\"frame #\" +\n                    this._count +\n                    \" - \" +\n                    (currentPassIndex === 2 ? \"main\" : \"render target\") +\n                    \" end pass\" +\n                    (currentPassIndex === 1 ? \" - internalTexture.uniqueId=\" + this._currentRenderTarget?.texture?.uniqueId : \"\"));\n            }\n        }\n        this._debugPopGroup?.(0);\n        this._currentRenderPass = null;\n        return currentPassIndex;\n    }\n    /**\n     * @internal\n     */\n    _generateMipmaps(texture, commandEncoder) {\n        commandEncoder = commandEncoder ?? this._renderEncoder;\n        const gpuHardwareTexture = texture._hardwareTexture;\n        if (!gpuHardwareTexture) {\n            return;\n        }\n        if (commandEncoder === this._renderEncoder) {\n            // We must close the current pass (if any) because we are going to use the render encoder to generate the mipmaps (so, we are going to create a new render pass)\n            this._endCurrentRenderPass();\n        }\n        const format = texture._hardwareTexture.format;\n        const mipmapCount = WebGPUTextureHelper.ComputeNumMipmapLevels(texture.width, texture.height);\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log(\"frame #\" +\n                    this._count +\n                    \" - generate mipmaps - width=\" +\n                    texture.width +\n                    \", height=\" +\n                    texture.height +\n                    \", isCube=\" +\n                    texture.isCube +\n                    \", command encoder=\" +\n                    (commandEncoder === this._renderEncoder ? \"render\" : \"copy\"));\n            }\n        }\n        if (texture.isCube) {\n            this._textureHelper.generateCubeMipmaps(gpuHardwareTexture, format, mipmapCount, commandEncoder);\n        }\n        else {\n            this._textureHelper.generateMipmaps(gpuHardwareTexture, format, mipmapCount, 0, texture.is3D, commandEncoder);\n        }\n    }\n}\n//# sourceMappingURL=thinWebGPUEngine.js.map","/** @internal */\n// eslint-disable-next-line import/export\nexport var PowerPreference;\n(function (PowerPreference) {\n    PowerPreference[\"LowPower\"] = \"low-power\";\n    PowerPreference[\"HighPerformance\"] = \"high-performance\";\n})(PowerPreference || (PowerPreference = {}));\n/** @internal */\nexport var FeatureName;\n(function (FeatureName) {\n    FeatureName[\"DepthClipControl\"] = \"depth-clip-control\";\n    FeatureName[\"Depth32FloatStencil8\"] = \"depth32float-stencil8\";\n    FeatureName[\"TextureCompressionBC\"] = \"texture-compression-bc\";\n    FeatureName[\"TextureCompressionBCSliced3D\"] = \"texture-compression-bc-sliced-3d\";\n    FeatureName[\"TextureCompressionETC2\"] = \"texture-compression-etc2\";\n    FeatureName[\"TextureCompressionASTC\"] = \"texture-compression-astc\";\n    FeatureName[\"TextureCompressionASTCSliced3D\"] = \"texture-compression-astc-sliced-3d\";\n    FeatureName[\"TimestampQuery\"] = \"timestamp-query\";\n    FeatureName[\"IndirectFirstInstance\"] = \"indirect-first-instance\";\n    FeatureName[\"ShaderF16\"] = \"shader-f16\";\n    FeatureName[\"RG11B10UFloatRenderable\"] = \"rg11b10ufloat-renderable\";\n    FeatureName[\"BGRA8UnormStorage\"] = \"bgra8unorm-storage\";\n    FeatureName[\"Float32Filterable\"] = \"float32-filterable\";\n    FeatureName[\"Float32Blendable\"] = \"float32-blendable\";\n    FeatureName[\"ClipDistances\"] = \"clip-distances\";\n    FeatureName[\"DualSourceBlending\"] = \"dual-source-blending\";\n})(FeatureName || (FeatureName = {}));\n/** @internal */\nexport var BufferMapState;\n(function (BufferMapState) {\n    BufferMapState[\"Unmapped\"] = \"unmapped\";\n    BufferMapState[\"Pending\"] = \"pending\";\n    BufferMapState[\"Mapped\"] = \"mapped\";\n})(BufferMapState || (BufferMapState = {}));\n/** @internal */\nexport var BufferUsage;\n(function (BufferUsage) {\n    BufferUsage[BufferUsage[\"MapRead\"] = 1] = \"MapRead\";\n    BufferUsage[BufferUsage[\"MapWrite\"] = 2] = \"MapWrite\";\n    BufferUsage[BufferUsage[\"CopySrc\"] = 4] = \"CopySrc\";\n    BufferUsage[BufferUsage[\"CopyDst\"] = 8] = \"CopyDst\";\n    BufferUsage[BufferUsage[\"Index\"] = 16] = \"Index\";\n    BufferUsage[BufferUsage[\"Vertex\"] = 32] = \"Vertex\";\n    BufferUsage[BufferUsage[\"Uniform\"] = 64] = \"Uniform\";\n    BufferUsage[BufferUsage[\"Storage\"] = 128] = \"Storage\";\n    BufferUsage[BufferUsage[\"Indirect\"] = 256] = \"Indirect\";\n    BufferUsage[BufferUsage[\"QueryResolve\"] = 512] = \"QueryResolve\";\n})(BufferUsage || (BufferUsage = {}));\n/** @internal */\nexport var MapMode;\n(function (MapMode) {\n    MapMode[MapMode[\"Read\"] = 1] = \"Read\";\n    MapMode[MapMode[\"Write\"] = 2] = \"Write\";\n})(MapMode || (MapMode = {}));\n/** @internal */\nexport var TextureDimension;\n(function (TextureDimension) {\n    TextureDimension[\"E1d\"] = \"1d\";\n    TextureDimension[\"E2d\"] = \"2d\";\n    TextureDimension[\"E3d\"] = \"3d\";\n})(TextureDimension || (TextureDimension = {}));\n/** @internal */\nexport var TextureUsage;\n(function (TextureUsage) {\n    TextureUsage[TextureUsage[\"CopySrc\"] = 1] = \"CopySrc\";\n    TextureUsage[TextureUsage[\"CopyDst\"] = 2] = \"CopyDst\";\n    TextureUsage[TextureUsage[\"TextureBinding\"] = 4] = \"TextureBinding\";\n    TextureUsage[TextureUsage[\"StorageBinding\"] = 8] = \"StorageBinding\";\n    TextureUsage[TextureUsage[\"RenderAttachment\"] = 16] = \"RenderAttachment\";\n})(TextureUsage || (TextureUsage = {}));\n/** @internal */\nexport var TextureViewDimension;\n(function (TextureViewDimension) {\n    TextureViewDimension[\"E1d\"] = \"1d\";\n    TextureViewDimension[\"E2d\"] = \"2d\";\n    TextureViewDimension[\"E2dArray\"] = \"2d-array\";\n    TextureViewDimension[\"Cube\"] = \"cube\";\n    TextureViewDimension[\"CubeArray\"] = \"cube-array\";\n    TextureViewDimension[\"E3d\"] = \"3d\";\n})(TextureViewDimension || (TextureViewDimension = {}));\n/** @internal */\nexport var TextureAspect;\n(function (TextureAspect) {\n    TextureAspect[\"All\"] = \"all\";\n    TextureAspect[\"StencilOnly\"] = \"stencil-only\";\n    TextureAspect[\"DepthOnly\"] = \"depth-only\";\n})(TextureAspect || (TextureAspect = {}));\n/**\n * Comments taken from https://github.com/gfx-rs/wgpu/blob/master/wgpu-types/src/lib.rs\n * @internal\n */\nexport var TextureFormat;\n(function (TextureFormat) {\n    // 8-bit formats\n    TextureFormat[\"R8Unorm\"] = \"r8unorm\";\n    TextureFormat[\"R8Snorm\"] = \"r8snorm\";\n    TextureFormat[\"R8Uint\"] = \"r8uint\";\n    TextureFormat[\"R8Sint\"] = \"r8sint\";\n    // 16-bit formats\n    TextureFormat[\"R16Uint\"] = \"r16uint\";\n    TextureFormat[\"R16Sint\"] = \"r16sint\";\n    TextureFormat[\"R16Float\"] = \"r16float\";\n    TextureFormat[\"RG8Unorm\"] = \"rg8unorm\";\n    TextureFormat[\"RG8Snorm\"] = \"rg8snorm\";\n    TextureFormat[\"RG8Uint\"] = \"rg8uint\";\n    TextureFormat[\"RG8Sint\"] = \"rg8sint\";\n    TextureFormat[\"R16Unorm\"] = \"r16unorm\";\n    TextureFormat[\"R16Snorm\"] = \"r16snorm\";\n    TextureFormat[\"RG16Unorm\"] = \"rg16unorm\";\n    TextureFormat[\"RG16Snorm\"] = \"rg16snorm\";\n    TextureFormat[\"RGBA16Unorm\"] = \"rgba16unorm\";\n    TextureFormat[\"RGBA16Snorm\"] = \"rgba16snorm\";\n    // 32-bit formats\n    TextureFormat[\"R32Uint\"] = \"r32uint\";\n    TextureFormat[\"R32Sint\"] = \"r32sint\";\n    TextureFormat[\"R32Float\"] = \"r32float\";\n    TextureFormat[\"RG16Uint\"] = \"rg16uint\";\n    TextureFormat[\"RG16Sint\"] = \"rg16sint\";\n    TextureFormat[\"RG16Float\"] = \"rg16float\";\n    TextureFormat[\"RGBA8Unorm\"] = \"rgba8unorm\";\n    TextureFormat[\"RGBA8UnormSRGB\"] = \"rgba8unorm-srgb\";\n    TextureFormat[\"RGBA8Snorm\"] = \"rgba8snorm\";\n    TextureFormat[\"RGBA8Uint\"] = \"rgba8uint\";\n    TextureFormat[\"RGBA8Sint\"] = \"rgba8sint\";\n    TextureFormat[\"BGRA8Unorm\"] = \"bgra8unorm\";\n    TextureFormat[\"BGRA8UnormSRGB\"] = \"bgra8unorm-srgb\";\n    // Packed 32-bit formats\n    TextureFormat[\"RGB9E5UFloat\"] = \"rgb9e5ufloat\";\n    TextureFormat[\"RGB10A2UINT\"] = \"rgb10a2uint\";\n    TextureFormat[\"RGB10A2Unorm\"] = \"rgb10a2unorm\";\n    TextureFormat[\"RG11B10UFloat\"] = \"rg11b10ufloat\";\n    // 64-bit formats\n    TextureFormat[\"RG32Uint\"] = \"rg32uint\";\n    TextureFormat[\"RG32Sint\"] = \"rg32sint\";\n    TextureFormat[\"RG32Float\"] = \"rg32float\";\n    TextureFormat[\"RGBA16Uint\"] = \"rgba16uint\";\n    TextureFormat[\"RGBA16Sint\"] = \"rgba16sint\";\n    TextureFormat[\"RGBA16Float\"] = \"rgba16float\";\n    // 128-bit formats\n    TextureFormat[\"RGBA32Uint\"] = \"rgba32uint\";\n    TextureFormat[\"RGBA32Sint\"] = \"rgba32sint\";\n    TextureFormat[\"RGBA32Float\"] = \"rgba32float\";\n    // Depth and stencil formats\n    TextureFormat[\"Stencil8\"] = \"stencil8\";\n    TextureFormat[\"Depth16Unorm\"] = \"depth16unorm\";\n    TextureFormat[\"Depth24Plus\"] = \"depth24plus\";\n    TextureFormat[\"Depth24PlusStencil8\"] = \"depth24plus-stencil8\";\n    TextureFormat[\"Depth32Float\"] = \"depth32float\";\n    // BC compressed formats usable if \"texture-compression-bc\" is both\n    // supported by the device/user agent and enabled in requestDevice.\n    TextureFormat[\"BC1RGBAUnorm\"] = \"bc1-rgba-unorm\";\n    TextureFormat[\"BC1RGBAUnormSRGB\"] = \"bc1-rgba-unorm-srgb\";\n    TextureFormat[\"BC2RGBAUnorm\"] = \"bc2-rgba-unorm\";\n    TextureFormat[\"BC2RGBAUnormSRGB\"] = \"bc2-rgba-unorm-srgb\";\n    TextureFormat[\"BC3RGBAUnorm\"] = \"bc3-rgba-unorm\";\n    TextureFormat[\"BC3RGBAUnormSRGB\"] = \"bc3-rgba-unorm-srgb\";\n    TextureFormat[\"BC4RUnorm\"] = \"bc4-r-unorm\";\n    TextureFormat[\"BC4RSnorm\"] = \"bc4-r-snorm\";\n    TextureFormat[\"BC5RGUnorm\"] = \"bc5-rg-unorm\";\n    TextureFormat[\"BC5RGSnorm\"] = \"bc5-rg-snorm\";\n    TextureFormat[\"BC6HRGBUFloat\"] = \"bc6h-rgb-ufloat\";\n    TextureFormat[\"BC6HRGBFloat\"] = \"bc6h-rgb-float\";\n    TextureFormat[\"BC7RGBAUnorm\"] = \"bc7-rgba-unorm\";\n    TextureFormat[\"BC7RGBAUnormSRGB\"] = \"bc7-rgba-unorm-srgb\";\n    // ETC2 compressed formats usable if \"texture-compression-etc2\" is both\n    // supported by the device/user agent and enabled in requestDevice.\n    TextureFormat[\"ETC2RGB8Unorm\"] = \"etc2-rgb8unorm\";\n    TextureFormat[\"ETC2RGB8UnormSRGB\"] = \"etc2-rgb8unorm-srgb\";\n    TextureFormat[\"ETC2RGB8A1Unorm\"] = \"etc2-rgb8a1unorm\";\n    TextureFormat[\"ETC2RGB8A1UnormSRGB\"] = \"etc2-rgb8a1unorm-srgb\";\n    TextureFormat[\"ETC2RGBA8Unorm\"] = \"etc2-rgba8unorm\";\n    TextureFormat[\"ETC2RGBA8UnormSRGB\"] = \"etc2-rgba8unorm-srgb\";\n    TextureFormat[\"EACR11Unorm\"] = \"eac-r11unorm\";\n    TextureFormat[\"EACR11Snorm\"] = \"eac-r11snorm\";\n    TextureFormat[\"EACRG11Unorm\"] = \"eac-rg11unorm\";\n    TextureFormat[\"EACRG11Snorm\"] = \"eac-rg11snorm\";\n    // ASTC compressed formats usable if \"texture-compression-astc\" is both\n    // supported by the device/user agent and enabled in requestDevice.\n    TextureFormat[\"ASTC4x4Unorm\"] = \"astc-4x4-unorm\";\n    TextureFormat[\"ASTC4x4UnormSRGB\"] = \"astc-4x4-unorm-srgb\";\n    TextureFormat[\"ASTC5x4Unorm\"] = \"astc-5x4-unorm\";\n    TextureFormat[\"ASTC5x4UnormSRGB\"] = \"astc-5x4-unorm-srgb\";\n    TextureFormat[\"ASTC5x5Unorm\"] = \"astc-5x5-unorm\";\n    TextureFormat[\"ASTC5x5UnormSRGB\"] = \"astc-5x5-unorm-srgb\";\n    TextureFormat[\"ASTC6x5Unorm\"] = \"astc-6x5-unorm\";\n    TextureFormat[\"ASTC6x5UnormSRGB\"] = \"astc-6x5-unorm-srgb\";\n    TextureFormat[\"ASTC6x6Unorm\"] = \"astc-6x6-unorm\";\n    TextureFormat[\"ASTC6x6UnormSRGB\"] = \"astc-6x6-unorm-srgb\";\n    TextureFormat[\"ASTC8x5Unorm\"] = \"astc-8x5-unorm\";\n    TextureFormat[\"ASTC8x5UnormSRGB\"] = \"astc-8x5-unorm-srgb\";\n    TextureFormat[\"ASTC8x6Unorm\"] = \"astc-8x6-unorm\";\n    TextureFormat[\"ASTC8x6UnormSRGB\"] = \"astc-8x6-unorm-srgb\";\n    TextureFormat[\"ASTC8x8Unorm\"] = \"astc-8x8-unorm\";\n    TextureFormat[\"ASTC8x8UnormSRGB\"] = \"astc-8x8-unorm-srgb\";\n    TextureFormat[\"ASTC10x5Unorm\"] = \"astc-10x5-unorm\";\n    TextureFormat[\"ASTC10x5UnormSRGB\"] = \"astc-10x5-unorm-srgb\";\n    TextureFormat[\"ASTC10x6Unorm\"] = \"astc-10x6-unorm\";\n    TextureFormat[\"ASTC10x6UnormSRGB\"] = \"astc-10x6-unorm-srgb\";\n    TextureFormat[\"ASTC10x8Unorm\"] = \"astc-10x8-unorm\";\n    TextureFormat[\"ASTC10x8UnormSRGB\"] = \"astc-10x8-unorm-srgb\";\n    TextureFormat[\"ASTC10x10Unorm\"] = \"astc-10x10-unorm\";\n    TextureFormat[\"ASTC10x10UnormSRGB\"] = \"astc-10x10-unorm-srgb\";\n    TextureFormat[\"ASTC12x10Unorm\"] = \"astc-12x10-unorm\";\n    TextureFormat[\"ASTC12x10UnormSRGB\"] = \"astc-12x10-unorm-srgb\";\n    TextureFormat[\"ASTC12x12Unorm\"] = \"astc-12x12-unorm\";\n    TextureFormat[\"ASTC12x12UnormSRGB\"] = \"astc-12x12-unorm-srgb\";\n    // \"depth32float-stencil8\" feature\n    TextureFormat[\"Depth32FloatStencil8\"] = \"depth32float-stencil8\";\n})(TextureFormat || (TextureFormat = {}));\n/** @internal */\nexport var AddressMode;\n(function (AddressMode) {\n    AddressMode[\"ClampToEdge\"] = \"clamp-to-edge\";\n    AddressMode[\"Repeat\"] = \"repeat\";\n    AddressMode[\"MirrorRepeat\"] = \"mirror-repeat\";\n})(AddressMode || (AddressMode = {}));\n/** @internal */\nexport var FilterMode;\n(function (FilterMode) {\n    FilterMode[\"Nearest\"] = \"nearest\";\n    FilterMode[\"Linear\"] = \"linear\";\n})(FilterMode || (FilterMode = {}));\n/** @internal */\nexport var MipmapFilterMode;\n(function (MipmapFilterMode) {\n    MipmapFilterMode[\"Nearest\"] = \"nearest\";\n    MipmapFilterMode[\"Linear\"] = \"linear\";\n})(MipmapFilterMode || (MipmapFilterMode = {}));\n/** @internal */\nexport var CompareFunction;\n(function (CompareFunction) {\n    CompareFunction[\"Never\"] = \"never\";\n    CompareFunction[\"Less\"] = \"less\";\n    CompareFunction[\"Equal\"] = \"equal\";\n    CompareFunction[\"LessEqual\"] = \"less-equal\";\n    CompareFunction[\"Greater\"] = \"greater\";\n    CompareFunction[\"NotEqual\"] = \"not-equal\";\n    CompareFunction[\"GreaterEqual\"] = \"greater-equal\";\n    CompareFunction[\"Always\"] = \"always\";\n})(CompareFunction || (CompareFunction = {}));\n/** @internal */\nexport var ShaderStage;\n(function (ShaderStage) {\n    ShaderStage[ShaderStage[\"Vertex\"] = 1] = \"Vertex\";\n    ShaderStage[ShaderStage[\"Fragment\"] = 2] = \"Fragment\";\n    ShaderStage[ShaderStage[\"Compute\"] = 4] = \"Compute\";\n})(ShaderStage || (ShaderStage = {}));\n/** @internal */\nexport var BufferBindingType;\n(function (BufferBindingType) {\n    BufferBindingType[\"Uniform\"] = \"uniform\";\n    BufferBindingType[\"Storage\"] = \"storage\";\n    BufferBindingType[\"ReadOnlyStorage\"] = \"read-only-storage\";\n})(BufferBindingType || (BufferBindingType = {}));\n/** @internal */\nexport var SamplerBindingType;\n(function (SamplerBindingType) {\n    SamplerBindingType[\"Filtering\"] = \"filtering\";\n    SamplerBindingType[\"NonFiltering\"] = \"non-filtering\";\n    SamplerBindingType[\"Comparison\"] = \"comparison\";\n})(SamplerBindingType || (SamplerBindingType = {}));\n/** @internal */\nexport var TextureSampleType;\n(function (TextureSampleType) {\n    TextureSampleType[\"Float\"] = \"float\";\n    TextureSampleType[\"UnfilterableFloat\"] = \"unfilterable-float\";\n    TextureSampleType[\"Depth\"] = \"depth\";\n    TextureSampleType[\"Sint\"] = \"sint\";\n    TextureSampleType[\"Uint\"] = \"uint\";\n})(TextureSampleType || (TextureSampleType = {}));\n/** @internal */\nexport var StorageTextureAccess;\n(function (StorageTextureAccess) {\n    StorageTextureAccess[\"WriteOnly\"] = \"write-only\";\n    StorageTextureAccess[\"ReadOnly\"] = \"read-only\";\n    StorageTextureAccess[\"ReadWrite\"] = \"read-write\";\n})(StorageTextureAccess || (StorageTextureAccess = {}));\n/** @internal */\nexport var CompilationMessageType;\n(function (CompilationMessageType) {\n    CompilationMessageType[\"Error\"] = \"error\";\n    CompilationMessageType[\"Warning\"] = \"warning\";\n    CompilationMessageType[\"Info\"] = \"info\";\n})(CompilationMessageType || (CompilationMessageType = {}));\n/** @internal */\nexport var PipelineErrorReason;\n(function (PipelineErrorReason) {\n    PipelineErrorReason[\"Validation\"] = \"validation\";\n    PipelineErrorReason[\"Internal\"] = \"internal\";\n})(PipelineErrorReason || (PipelineErrorReason = {}));\n/** @internal */\nexport var AutoLayoutMode;\n(function (AutoLayoutMode) {\n    AutoLayoutMode[\"Auto\"] = \"auto\";\n})(AutoLayoutMode || (AutoLayoutMode = {}));\n/** @internal */\nexport var PrimitiveTopology;\n(function (PrimitiveTopology) {\n    PrimitiveTopology[\"PointList\"] = \"point-list\";\n    PrimitiveTopology[\"LineList\"] = \"line-list\";\n    PrimitiveTopology[\"LineStrip\"] = \"line-strip\";\n    PrimitiveTopology[\"TriangleList\"] = \"triangle-list\";\n    PrimitiveTopology[\"TriangleStrip\"] = \"triangle-strip\";\n})(PrimitiveTopology || (PrimitiveTopology = {}));\n/** @internal */\nexport var FrontFace;\n(function (FrontFace) {\n    FrontFace[\"CCW\"] = \"ccw\";\n    FrontFace[\"CW\"] = \"cw\";\n})(FrontFace || (FrontFace = {}));\n/** @internal */\nexport var CullMode;\n(function (CullMode) {\n    CullMode[\"None\"] = \"none\";\n    CullMode[\"Front\"] = \"front\";\n    CullMode[\"Back\"] = \"back\";\n})(CullMode || (CullMode = {}));\n/** @internal */\nexport var ColorWrite;\n(function (ColorWrite) {\n    ColorWrite[ColorWrite[\"Red\"] = 1] = \"Red\";\n    ColorWrite[ColorWrite[\"Green\"] = 2] = \"Green\";\n    ColorWrite[ColorWrite[\"Blue\"] = 4] = \"Blue\";\n    ColorWrite[ColorWrite[\"Alpha\"] = 8] = \"Alpha\";\n    ColorWrite[ColorWrite[\"All\"] = 15] = \"All\";\n})(ColorWrite || (ColorWrite = {}));\n/** @internal */\nexport var BlendFactor;\n(function (BlendFactor) {\n    BlendFactor[\"Zero\"] = \"zero\";\n    BlendFactor[\"One\"] = \"one\";\n    BlendFactor[\"Src\"] = \"src\";\n    BlendFactor[\"OneMinusSrc\"] = \"one-minus-src\";\n    BlendFactor[\"SrcAlpha\"] = \"src-alpha\";\n    BlendFactor[\"OneMinusSrcAlpha\"] = \"one-minus-src-alpha\";\n    BlendFactor[\"Dst\"] = \"dst\";\n    BlendFactor[\"OneMinusDst\"] = \"one-minus-dst\";\n    BlendFactor[\"DstAlpha\"] = \"dst-alpha\";\n    BlendFactor[\"OneMinusDstAlpha\"] = \"one-minus-dst-alpha\";\n    BlendFactor[\"SrcAlphaSaturated\"] = \"src-alpha-saturated\";\n    BlendFactor[\"Constant\"] = \"constant\";\n    BlendFactor[\"OneMinusConstant\"] = \"one-minus-constant\";\n    BlendFactor[\"Src1\"] = \"src1\";\n    BlendFactor[\"OneMinusSrc1\"] = \"one-minus-src1\";\n    BlendFactor[\"Src1Alpha\"] = \"src1-alpha\";\n    BlendFactor[\"OneMinusSrc1Alpha\"] = \"one-minus-src1-alpha\";\n})(BlendFactor || (BlendFactor = {}));\n/** @internal */\nexport var BlendOperation;\n(function (BlendOperation) {\n    BlendOperation[\"Add\"] = \"add\";\n    BlendOperation[\"Subtract\"] = \"subtract\";\n    BlendOperation[\"ReverseSubtract\"] = \"reverse-subtract\";\n    BlendOperation[\"Min\"] = \"min\";\n    BlendOperation[\"Max\"] = \"max\";\n})(BlendOperation || (BlendOperation = {}));\n/** @internal */\nexport var StencilOperation;\n(function (StencilOperation) {\n    StencilOperation[\"Keep\"] = \"keep\";\n    StencilOperation[\"Zero\"] = \"zero\";\n    StencilOperation[\"Replace\"] = \"replace\";\n    StencilOperation[\"Invert\"] = \"invert\";\n    StencilOperation[\"IncrementClamp\"] = \"increment-clamp\";\n    StencilOperation[\"DecrementClamp\"] = \"decrement-clamp\";\n    StencilOperation[\"IncrementWrap\"] = \"increment-wrap\";\n    StencilOperation[\"DecrementWrap\"] = \"decrement-wrap\";\n})(StencilOperation || (StencilOperation = {}));\n/** @internal */\nexport var IndexFormat;\n(function (IndexFormat) {\n    IndexFormat[\"Uint16\"] = \"uint16\";\n    IndexFormat[\"Uint32\"] = \"uint32\";\n})(IndexFormat || (IndexFormat = {}));\n/** @internal */\nexport var VertexFormat;\n(function (VertexFormat) {\n    VertexFormat[\"Uint8x2\"] = \"uint8x2\";\n    VertexFormat[\"Uint8x4\"] = \"uint8x4\";\n    VertexFormat[\"Sint8x2\"] = \"sint8x2\";\n    VertexFormat[\"Sint8x4\"] = \"sint8x4\";\n    VertexFormat[\"Unorm8x2\"] = \"unorm8x2\";\n    VertexFormat[\"Unorm8x4\"] = \"unorm8x4\";\n    VertexFormat[\"Snorm8x2\"] = \"snorm8x2\";\n    VertexFormat[\"Snorm8x4\"] = \"snorm8x4\";\n    VertexFormat[\"Uint16x2\"] = \"uint16x2\";\n    VertexFormat[\"Uint16x4\"] = \"uint16x4\";\n    VertexFormat[\"Sint16x2\"] = \"sint16x2\";\n    VertexFormat[\"Sint16x4\"] = \"sint16x4\";\n    VertexFormat[\"Unorm16x2\"] = \"unorm16x2\";\n    VertexFormat[\"Unorm16x4\"] = \"unorm16x4\";\n    VertexFormat[\"Snorm16x2\"] = \"snorm16x2\";\n    VertexFormat[\"Snorm16x4\"] = \"snorm16x4\";\n    VertexFormat[\"Float16x2\"] = \"float16x2\";\n    VertexFormat[\"Float16x4\"] = \"float16x4\";\n    VertexFormat[\"Float32\"] = \"float32\";\n    VertexFormat[\"Float32x2\"] = \"float32x2\";\n    VertexFormat[\"Float32x3\"] = \"float32x3\";\n    VertexFormat[\"Float32x4\"] = \"float32x4\";\n    VertexFormat[\"Uint32\"] = \"uint32\";\n    VertexFormat[\"Uint32x2\"] = \"uint32x2\";\n    VertexFormat[\"Uint32x3\"] = \"uint32x3\";\n    VertexFormat[\"Uint32x4\"] = \"uint32x4\";\n    VertexFormat[\"Sint32\"] = \"sint32\";\n    VertexFormat[\"Sint32x2\"] = \"sint32x2\";\n    VertexFormat[\"Sint32x3\"] = \"sint32x3\";\n    VertexFormat[\"Sint32x4\"] = \"sint32x4\";\n    VertexFormat[\"UNORM10x10x10x2\"] = \"unorm10-10-10-2\";\n})(VertexFormat || (VertexFormat = {}));\n/** @internal */\nexport var VertexStepMode;\n(function (VertexStepMode) {\n    VertexStepMode[\"Vertex\"] = \"vertex\";\n    VertexStepMode[\"Instance\"] = \"instance\";\n})(VertexStepMode || (VertexStepMode = {}));\n/** @internal */\nexport var ComputePassTimestampLocation;\n(function (ComputePassTimestampLocation) {\n    ComputePassTimestampLocation[\"Beginning\"] = \"beginning\";\n    ComputePassTimestampLocation[\"End\"] = \"end\";\n})(ComputePassTimestampLocation || (ComputePassTimestampLocation = {}));\n/** @internal */\nexport var RenderPassTimestampLocation;\n(function (RenderPassTimestampLocation) {\n    RenderPassTimestampLocation[\"Beginning\"] = \"beginning\";\n    RenderPassTimestampLocation[\"End\"] = \"end\";\n})(RenderPassTimestampLocation || (RenderPassTimestampLocation = {}));\n/** @internal */\nexport var LoadOp;\n(function (LoadOp) {\n    LoadOp[\"Load\"] = \"load\";\n    LoadOp[\"Clear\"] = \"clear\";\n})(LoadOp || (LoadOp = {}));\n/** @internal */\nexport var StoreOp;\n(function (StoreOp) {\n    StoreOp[\"Store\"] = \"store\";\n    StoreOp[\"Discard\"] = \"discard\";\n})(StoreOp || (StoreOp = {}));\n/** @internal */\nexport var QueryType;\n(function (QueryType) {\n    QueryType[\"Occlusion\"] = \"occlusion\";\n    QueryType[\"Timestamp\"] = \"timestamp\";\n})(QueryType || (QueryType = {}));\n/** @internal */\nexport var CanvasAlphaMode;\n(function (CanvasAlphaMode) {\n    CanvasAlphaMode[\"Opaque\"] = \"opaque\";\n    CanvasAlphaMode[\"Premultiplied\"] = \"premultiplied\";\n})(CanvasAlphaMode || (CanvasAlphaMode = {}));\n/** @internal */\nexport var CanvasToneMappingMode;\n(function (CanvasToneMappingMode) {\n    CanvasToneMappingMode[\"Standard\"] = \"standard\";\n    CanvasToneMappingMode[\"Extended\"] = \"extended\";\n})(CanvasToneMappingMode || (CanvasToneMappingMode = {}));\n/** @internal */\nexport var DeviceLostReason;\n(function (DeviceLostReason) {\n    DeviceLostReason[\"Unknown\"] = \"unknown\";\n    DeviceLostReason[\"Destroyed\"] = \"destroyed\";\n})(DeviceLostReason || (DeviceLostReason = {}));\n/** @internal */\nexport var ErrorFilter;\n(function (ErrorFilter) {\n    ErrorFilter[\"Validation\"] = \"validation\";\n    ErrorFilter[\"OutOfMemory\"] = \"out-of-memory\";\n    ErrorFilter[\"Internal\"] = \"internal\";\n})(ErrorFilter || (ErrorFilter = {}));\n//# sourceMappingURL=webgpuConstants.js.map","/** @internal */\nexport class WebGPUShaderProcessor {\n    constructor() {\n        this.shaderLanguage = 0 /* ShaderLanguage.GLSL */;\n    }\n    _addUniformToLeftOverUBO(name, uniformType, preProcessors) {\n        let length = 0;\n        [name, uniformType, length] = this._getArraySize(name, uniformType, preProcessors);\n        for (let i = 0; i < this._webgpuProcessingContext.leftOverUniforms.length; i++) {\n            if (this._webgpuProcessingContext.leftOverUniforms[i].name === name) {\n                return;\n            }\n        }\n        this._webgpuProcessingContext.leftOverUniforms.push({\n            name,\n            type: uniformType,\n            length,\n        });\n    }\n    _buildLeftOverUBO() {\n        if (!this._webgpuProcessingContext.leftOverUniforms.length) {\n            return \"\";\n        }\n        const name = WebGPUShaderProcessor.LeftOvertUBOName;\n        let availableUBO = this._webgpuProcessingContext.availableBuffers[name];\n        if (!availableUBO) {\n            availableUBO = {\n                binding: this._webgpuProcessingContext.getNextFreeUBOBinding(),\n            };\n            this._webgpuProcessingContext.availableBuffers[name] = availableUBO;\n            this._addBufferBindingDescription(name, availableUBO, \"uniform\" /* WebGPUConstants.BufferBindingType.Uniform */, true);\n            this._addBufferBindingDescription(name, availableUBO, \"uniform\" /* WebGPUConstants.BufferBindingType.Uniform */, false);\n        }\n        return this._generateLeftOverUBOCode(name, availableUBO);\n    }\n    _collectBindingNames() {\n        // collect all the binding names for faster processing in WebGPUCacheBindGroup\n        for (let i = 0; i < this._webgpuProcessingContext.bindGroupLayoutEntries.length; i++) {\n            const setDefinition = this._webgpuProcessingContext.bindGroupLayoutEntries[i];\n            if (setDefinition === undefined) {\n                this._webgpuProcessingContext.bindGroupLayoutEntries[i] = [];\n                continue;\n            }\n            for (let j = 0; j < setDefinition.length; j++) {\n                const entry = this._webgpuProcessingContext.bindGroupLayoutEntries[i][j];\n                const name = this._webgpuProcessingContext.bindGroupLayoutEntryInfo[i][entry.binding].name;\n                const nameInArrayOfTexture = this._webgpuProcessingContext.bindGroupLayoutEntryInfo[i][entry.binding].nameInArrayOfTexture;\n                if (entry) {\n                    if (entry.texture || entry.externalTexture || entry.storageTexture) {\n                        this._webgpuProcessingContext.textureNames.push(nameInArrayOfTexture);\n                    }\n                    else if (entry.sampler) {\n                        this._webgpuProcessingContext.samplerNames.push(name);\n                    }\n                    else if (entry.buffer) {\n                        this._webgpuProcessingContext.bufferNames.push(name);\n                    }\n                }\n            }\n        }\n    }\n    _preCreateBindGroupEntries() {\n        const bindGroupEntries = this._webgpuProcessingContext.bindGroupEntries;\n        for (let i = 0; i < this._webgpuProcessingContext.bindGroupLayoutEntries.length; i++) {\n            const setDefinition = this._webgpuProcessingContext.bindGroupLayoutEntries[i];\n            const entries = [];\n            for (let j = 0; j < setDefinition.length; j++) {\n                const entry = this._webgpuProcessingContext.bindGroupLayoutEntries[i][j];\n                if (entry.sampler || entry.texture || entry.storageTexture || entry.externalTexture) {\n                    entries.push({\n                        binding: entry.binding,\n                        resource: undefined,\n                    });\n                }\n                else if (entry.buffer) {\n                    entries.push({\n                        binding: entry.binding,\n                        resource: {\n                            buffer: undefined,\n                            offset: 0,\n                            size: 0,\n                        },\n                    });\n                }\n            }\n            bindGroupEntries[i] = entries;\n        }\n    }\n    _addTextureBindingDescription(name, textureInfo, textureIndex, dimension, format, isVertex) {\n        // eslint-disable-next-line prefer-const\n        let { groupIndex, bindingIndex } = textureInfo.textures[textureIndex];\n        if (!this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex]) {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex] = [];\n            this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex] = [];\n        }\n        if (!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex]) {\n            let len;\n            if (dimension === null) {\n                len = this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex].push({\n                    binding: bindingIndex,\n                    visibility: 0,\n                    externalTexture: {},\n                });\n            }\n            else if (format) {\n                len = this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex].push({\n                    binding: bindingIndex,\n                    visibility: 0,\n                    storageTexture: {\n                        access: \"write-only\" /* WebGPUConstants.StorageTextureAccess.WriteOnly */,\n                        format,\n                        viewDimension: dimension,\n                    },\n                });\n            }\n            else {\n                len = this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex].push({\n                    binding: bindingIndex,\n                    visibility: 0,\n                    texture: {\n                        sampleType: textureInfo.sampleType,\n                        viewDimension: dimension,\n                        multisampled: false,\n                    },\n                });\n            }\n            const textureName = textureInfo.isTextureArray ? name + textureIndex : name;\n            this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex] = { name, index: len - 1, nameInArrayOfTexture: textureName };\n        }\n        bindingIndex = this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex].index;\n        if (isVertex) {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex][bindingIndex].visibility |= 1 /* WebGPUConstants.ShaderStage.Vertex */;\n        }\n        else {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex][bindingIndex].visibility |= 2 /* WebGPUConstants.ShaderStage.Fragment */;\n        }\n    }\n    _addSamplerBindingDescription(name, samplerInfo, isVertex) {\n        // eslint-disable-next-line prefer-const\n        let { groupIndex, bindingIndex } = samplerInfo.binding;\n        if (!this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex]) {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex] = [];\n            this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex] = [];\n        }\n        if (!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex]) {\n            const len = this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex].push({\n                binding: bindingIndex,\n                visibility: 0,\n                sampler: {\n                    type: samplerInfo.type,\n                },\n            });\n            this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex] = { name, index: len - 1 };\n        }\n        bindingIndex = this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex].index;\n        if (isVertex) {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex][bindingIndex].visibility |= 1 /* WebGPUConstants.ShaderStage.Vertex */;\n        }\n        else {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex][bindingIndex].visibility |= 2 /* WebGPUConstants.ShaderStage.Fragment */;\n        }\n    }\n    _addBufferBindingDescription(name, uniformBufferInfo, bufferType, isVertex) {\n        // eslint-disable-next-line prefer-const\n        let { groupIndex, bindingIndex } = uniformBufferInfo.binding;\n        if (!this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex]) {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex] = [];\n            this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex] = [];\n        }\n        if (!this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex]) {\n            const len = this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex].push({\n                binding: bindingIndex,\n                visibility: 0,\n                buffer: {\n                    type: bufferType,\n                },\n            });\n            this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex] = { name, index: len - 1 };\n        }\n        bindingIndex = this._webgpuProcessingContext.bindGroupLayoutEntryInfo[groupIndex][bindingIndex].index;\n        if (isVertex) {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex][bindingIndex].visibility |= 1 /* WebGPUConstants.ShaderStage.Vertex */;\n        }\n        else {\n            this._webgpuProcessingContext.bindGroupLayoutEntries[groupIndex][bindingIndex].visibility |= 2 /* WebGPUConstants.ShaderStage.Fragment */;\n        }\n    }\n}\nWebGPUShaderProcessor.LeftOvertUBOName = \"LeftOver\";\nWebGPUShaderProcessor.InternalsUBOName = \"Internals\";\nWebGPUShaderProcessor.UniformSizes = {\n    // GLSL types\n    bool: 1,\n    int: 1,\n    float: 1,\n    vec2: 2,\n    ivec2: 2,\n    uvec2: 2,\n    vec3: 3,\n    ivec3: 3,\n    uvec3: 3,\n    vec4: 4,\n    ivec4: 4,\n    uvec4: 4,\n    mat2: 4,\n    mat3: 12,\n    mat4: 16,\n    // WGSL types\n    i32: 1,\n    u32: 1,\n    f32: 1,\n    mat2x2: 4,\n    mat3x3: 12,\n    mat4x4: 16,\n    mat2x2f: 4,\n    mat3x3f: 12,\n    mat4x4f: 16,\n    vec2i: 2,\n    vec3i: 3,\n    vec4i: 4,\n    vec2u: 2,\n    vec3u: 3,\n    vec4u: 4,\n    vec2f: 2,\n    vec3f: 3,\n    vec4f: 4,\n    vec2h: 1,\n    vec3h: 2,\n    vec4h: 2,\n};\n// eslint-disable-next-line @typescript-eslint/naming-convention\nWebGPUShaderProcessor._SamplerFunctionByWebGLSamplerType = {\n    sampler2D: \"sampler2D\",\n    sampler2DArray: \"sampler2DArray\",\n    sampler2DShadow: \"sampler2DShadow\",\n    sampler2DArrayShadow: \"sampler2DArrayShadow\",\n    samplerCube: \"samplerCube\",\n    sampler3D: \"sampler3D\",\n};\n// eslint-disable-next-line @typescript-eslint/naming-convention\nWebGPUShaderProcessor._TextureTypeByWebGLSamplerType = {\n    sampler2D: \"texture2D\",\n    sampler2DArray: \"texture2DArray\",\n    sampler2DShadow: \"texture2D\",\n    sampler2DArrayShadow: \"texture2DArray\",\n    samplerCube: \"textureCube\",\n    samplerCubeArray: \"textureCubeArray\",\n    sampler3D: \"texture3D\",\n};\n// eslint-disable-next-line @typescript-eslint/naming-convention\nWebGPUShaderProcessor._GpuTextureViewDimensionByWebGPUTextureType = {\n    textureCube: \"cube\" /* WebGPUConstants.TextureViewDimension.Cube */,\n    textureCubeArray: \"cube-array\" /* WebGPUConstants.TextureViewDimension.CubeArray */,\n    texture2D: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n    texture2DArray: \"2d-array\" /* WebGPUConstants.TextureViewDimension.E2dArray */,\n    texture3D: \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */,\n};\n// if the webgl sampler type is not listed in this array, \"sampler\" is taken by default\n// eslint-disable-next-line @typescript-eslint/naming-convention\nWebGPUShaderProcessor._SamplerTypeByWebGLSamplerType = {\n    sampler2DShadow: \"samplerShadow\",\n    sampler2DArrayShadow: \"samplerShadow\",\n};\n// eslint-disable-next-line @typescript-eslint/naming-convention\nWebGPUShaderProcessor._IsComparisonSamplerByWebGPUSamplerType = {\n    samplerShadow: true,\n    samplerArrayShadow: true,\n    sampler: false,\n};\n//# sourceMappingURL=webgpuShaderProcessor.js.map","import { UniformBuffer } from \"../../Materials/uniformBuffer.js\";\nimport { WebGPUShaderProcessor } from \"./webgpuShaderProcessor.js\";\n/** @internal */\nexport class WebGPUPipelineContext {\n    get isAsync() {\n        return false;\n    }\n    get isReady() {\n        if (this.stages) {\n            return true;\n        }\n        return false;\n    }\n    constructor(shaderProcessingContext, engine) {\n        // The field is indexed by textureState. See @WebGPUMaterialContext.textureState for more information.\n        this.bindGroupLayouts = {};\n        this._name = \"unnamed\";\n        this.shaderProcessingContext = shaderProcessingContext;\n        this._leftOverUniformsByName = {};\n        this.engine = engine;\n        this.vertexBufferKindToType = {};\n    }\n    _handlesSpectorRebuildCallback() {\n        // Nothing to do yet for spector.\n    }\n    _fillEffectInformation(effect, uniformBuffersNames, uniformsNames, uniforms, samplerList, samplers, attributesNames, attributes) {\n        const engine = this.engine;\n        if (engine._doNotHandleContextLost) {\n            effect._fragmentSourceCode = \"\";\n            effect._vertexSourceCode = \"\";\n        }\n        const foundSamplers = this.shaderProcessingContext.availableTextures;\n        let index;\n        for (index = 0; index < samplerList.length; index++) {\n            const name = samplerList[index];\n            const sampler = foundSamplers[samplerList[index]];\n            if (sampler == null || sampler == undefined) {\n                samplerList.splice(index, 1);\n                index--;\n            }\n            else {\n                samplers[name] = index;\n            }\n        }\n        for (const attr of engine.getAttributes(this, attributesNames)) {\n            attributes.push(attr);\n        }\n        // Build the uniform layout for the left over uniforms.\n        this.buildUniformLayout();\n        const attributeNamesFromEffect = [];\n        const attributeLocationsFromEffect = [];\n        for (index = 0; index < attributesNames.length; index++) {\n            const location = attributes[index];\n            if (location >= 0) {\n                attributeNamesFromEffect.push(attributesNames[index]);\n                attributeLocationsFromEffect.push(location);\n            }\n        }\n        this.shaderProcessingContext.attributeNamesFromEffect = attributeNamesFromEffect;\n        this.shaderProcessingContext.attributeLocationsFromEffect = attributeLocationsFromEffect;\n    }\n    /** @internal */\n    /**\n     * Build the uniform buffer used in the material.\n     */\n    buildUniformLayout() {\n        if (!this.shaderProcessingContext.leftOverUniforms.length) {\n            return;\n        }\n        this.uniformBuffer?.dispose();\n        this.uniformBuffer = new UniformBuffer(this.engine, undefined, undefined, \"leftOver-\" + this._name);\n        for (const leftOverUniform of this.shaderProcessingContext.leftOverUniforms) {\n            const type = leftOverUniform.type.replace(/^(.*?)(<.*>)?$/, \"$1\");\n            const size = WebGPUShaderProcessor.UniformSizes[type];\n            this.uniformBuffer.addUniform(leftOverUniform.name, size, leftOverUniform.length);\n            this._leftOverUniformsByName[leftOverUniform.name] = leftOverUniform.type;\n        }\n        this.uniformBuffer.create();\n    }\n    setEngine(engine) {\n        this.engine = engine;\n    }\n    /**\n     * Release all associated resources.\n     **/\n    dispose() {\n        if (this.uniformBuffer) {\n            this.uniformBuffer.dispose();\n        }\n    }\n    /**\n     * Sets an integer value on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param value Value to be set.\n     */\n    setInt(uniformName, value) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateInt(uniformName, value);\n    }\n    /**\n     * Sets an int2 value on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First int in int2.\n     * @param y Second int in int2.\n     */\n    setInt2(uniformName, x, y) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateInt2(uniformName, x, y);\n    }\n    /**\n     * Sets an int3 value on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First int in int3.\n     * @param y Second int in int3.\n     * @param z Third int in int3.\n     */\n    setInt3(uniformName, x, y, z) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateInt3(uniformName, x, y, z);\n    }\n    /**\n     * Sets an int4 value on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First int in int4.\n     * @param y Second int in int4.\n     * @param z Third int in int4.\n     * @param w Fourth int in int4.\n     */\n    setInt4(uniformName, x, y, z, w) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateInt4(uniformName, x, y, z, w);\n    }\n    /**\n     * Sets an int array on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setIntArray(uniformName, array) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateIntArray(uniformName, array);\n    }\n    /**\n     * Sets an int array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setIntArray2(uniformName, array) {\n        this.setIntArray(uniformName, array);\n    }\n    /**\n     * Sets an int array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setIntArray3(uniformName, array) {\n        this.setIntArray(uniformName, array);\n    }\n    /**\n     * Sets an int array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setIntArray4(uniformName, array) {\n        this.setIntArray(uniformName, array);\n    }\n    /**\n     * Sets an unsigned integer value on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param value Value to be set.\n     */\n    setUInt(uniformName, value) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateUInt(uniformName, value);\n    }\n    /**\n     * Sets an unsigned int2 value on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First unsigned int in uint2.\n     * @param y Second unsigned int in uint2.\n     */\n    setUInt2(uniformName, x, y) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateUInt2(uniformName, x, y);\n    }\n    /**\n     * Sets an unsigned int3 value on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First unsigned int in uint3.\n     * @param y Second unsigned int in uint3.\n     * @param z Third unsigned int in uint3.\n     */\n    setUInt3(uniformName, x, y, z) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateUInt3(uniformName, x, y, z);\n    }\n    /**\n     * Sets an unsigned int4 value on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First unsigned int in uint4.\n     * @param y Second unsigned int in uint4.\n     * @param z Third unsigned int in uint4.\n     * @param w Fourth unsigned int in uint4.\n     */\n    setUInt4(uniformName, x, y, z, w) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateUInt4(uniformName, x, y, z, w);\n    }\n    /**\n     * Sets an unsigned int array on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setUIntArray(uniformName, array) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateUIntArray(uniformName, array);\n    }\n    /**\n     * Sets an unsigned int array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setUIntArray2(uniformName, array) {\n        this.setUIntArray(uniformName, array);\n    }\n    /**\n     * Sets an unsigned int array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setUIntArray3(uniformName, array) {\n        this.setUIntArray(uniformName, array);\n    }\n    /**\n     * Sets an unsigned int array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setUIntArray4(uniformName, array) {\n        this.setUIntArray(uniformName, array);\n    }\n    /**\n     * Sets an array on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setArray(uniformName, array) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateArray(uniformName, array);\n    }\n    /**\n     * Sets an array 2 on a uniform variable. (Array is specified as single array eg. [1,2,3,4] will result in [[1,2],[3,4]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setArray2(uniformName, array) {\n        this.setArray(uniformName, array);\n    }\n    /**\n     * Sets an array 3 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6] will result in [[1,2,3],[4,5,6]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setArray3(uniformName, array) {\n        this.setArray(uniformName, array);\n    }\n    /**\n     * Sets an array 4 on a uniform variable. (Array is specified as single array eg. [1,2,3,4,5,6,7,8] will result in [[1,2,3,4],[5,6,7,8]] in the shader)\n     * @param uniformName Name of the variable.\n     * @param array array to be set.\n     */\n    setArray4(uniformName, array) {\n        this.setArray(uniformName, array);\n    }\n    /**\n     * Sets matrices on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param matrices matrices to be set.\n     */\n    setMatrices(uniformName, matrices) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateMatrices(uniformName, matrices);\n    }\n    /**\n     * Sets matrix on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param matrix matrix to be set.\n     */\n    setMatrix(uniformName, matrix) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateMatrix(uniformName, matrix);\n    }\n    /**\n     * Sets a 3x3 matrix on a uniform variable. (Specified as [1,2,3,4,5,6,7,8,9] will result in [1,2,3][4,5,6][7,8,9] matrix)\n     * @param uniformName Name of the variable.\n     * @param matrix matrix to be set.\n     */\n    setMatrix3x3(uniformName, matrix) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateMatrix3x3(uniformName, matrix);\n    }\n    /**\n     * Sets a 2x2 matrix on a uniform variable. (Specified as [1,2,3,4] will result in [1,2][3,4] matrix)\n     * @param uniformName Name of the variable.\n     * @param matrix matrix to be set.\n     */\n    setMatrix2x2(uniformName, matrix) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateMatrix2x2(uniformName, matrix);\n    }\n    /**\n     * Sets a float on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param value value to be set.\n     */\n    setFloat(uniformName, value) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateFloat(uniformName, value);\n    }\n    /**\n     * Sets a Vector2 on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param vector2 vector2 to be set.\n     */\n    setVector2(uniformName, vector2) {\n        this.setFloat2(uniformName, vector2.x, vector2.y);\n    }\n    /**\n     * Sets a float2 on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First float in float2.\n     * @param y Second float in float2.\n     */\n    setFloat2(uniformName, x, y) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateFloat2(uniformName, x, y);\n    }\n    /**\n     * Sets a Vector3 on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param vector3 Value to be set.\n     */\n    setVector3(uniformName, vector3) {\n        this.setFloat3(uniformName, vector3.x, vector3.y, vector3.z);\n    }\n    /**\n     * Sets a float3 on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First float in float3.\n     * @param y Second float in float3.\n     * @param z Third float in float3.\n     */\n    setFloat3(uniformName, x, y, z) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateFloat3(uniformName, x, y, z);\n    }\n    /**\n     * Sets a Vector4 on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param vector4 Value to be set.\n     */\n    setVector4(uniformName, vector4) {\n        this.setFloat4(uniformName, vector4.x, vector4.y, vector4.z, vector4.w);\n    }\n    /**\n     * Sets a Quaternion on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param quaternion Value to be set.\n     */\n    setQuaternion(uniformName, quaternion) {\n        this.setFloat4(uniformName, quaternion.x, quaternion.y, quaternion.z, quaternion.w);\n    }\n    /**\n     * Sets a float4 on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param x First float in float4.\n     * @param y Second float in float4.\n     * @param z Third float in float4.\n     * @param w Fourth float in float4.\n     */\n    setFloat4(uniformName, x, y, z, w) {\n        if (!this.uniformBuffer || !this._leftOverUniformsByName[uniformName]) {\n            return;\n        }\n        this.uniformBuffer.updateFloat4(uniformName, x, y, z, w);\n    }\n    /**\n     * Sets a Color3 on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param color3 Value to be set.\n     */\n    setColor3(uniformName, color3) {\n        this.setFloat3(uniformName, color3.r, color3.g, color3.b);\n    }\n    /**\n     * Sets a Color4 on a uniform variable.\n     * @param uniformName Name of the variable.\n     * @param color3 Value to be set.\n     * @param alpha Alpha value to be set.\n     */\n    setColor4(uniformName, color3, alpha) {\n        this.setFloat4(uniformName, color3.r, color3.g, color3.b, alpha);\n    }\n    /**\n     * Sets a Color4 on a uniform variable\n     * @param uniformName defines the name of the variable\n     * @param color4 defines the value to be set\n     */\n    setDirectColor4(uniformName, color4) {\n        this.setFloat4(uniformName, color4.r, color4.g, color4.b, color4.a);\n    }\n    _getVertexShaderCode() {\n        return this.sources?.vertex;\n    }\n    _getFragmentShaderCode() {\n        return this.sources?.fragment;\n    }\n}\n//# sourceMappingURL=webgpuPipelineContext.js.map","const _maxGroups = 4;\nconst _maxBindingsPerGroup = 1 << 16;\n// all types not listed are assumed to consume 1 location\nconst _typeToLocationSize = {\n    // GLSL types\n    mat2: 2,\n    mat3: 3,\n    mat4: 4,\n    // WGSL types\n    mat2x2: 2,\n    mat3x3: 3,\n    mat4x4: 4,\n};\n/**\n * @internal\n */\nexport class WebGPUShaderProcessingContext {\n    static get KnownUBOs() {\n        return WebGPUShaderProcessingContext._SimplifiedKnownBindings ? WebGPUShaderProcessingContext._SimplifiedKnownUBOs : WebGPUShaderProcessingContext._KnownUBOs;\n    }\n    constructor(shaderLanguage, pureMode = false) {\n        this.vertexBufferKindToNumberOfComponents = {};\n        this.shaderLanguage = shaderLanguage;\n        this._attributeNextLocation = 0;\n        this._varyingNextLocation = 0;\n        this.freeGroupIndex = 0;\n        this.freeBindingIndex = 0;\n        this.availableVaryings = {};\n        this.availableAttributes = {};\n        this.availableBuffers = {};\n        this.availableTextures = {};\n        this.availableSamplers = {};\n        this.orderedAttributes = [];\n        this.bindGroupLayoutEntries = [];\n        this.bindGroupLayoutEntryInfo = [];\n        this.bindGroupEntries = [];\n        this.bufferNames = [];\n        this.textureNames = [];\n        this.samplerNames = [];\n        this.leftOverUniforms = [];\n        if (!pureMode) {\n            this._findStartingGroupBinding();\n        }\n    }\n    _findStartingGroupBinding() {\n        const knownUBOs = WebGPUShaderProcessingContext.KnownUBOs;\n        const groups = [];\n        for (const name in knownUBOs) {\n            const binding = knownUBOs[name].binding;\n            if (binding.groupIndex === -1) {\n                continue;\n            }\n            if (groups[binding.groupIndex] === undefined) {\n                groups[binding.groupIndex] = binding.bindingIndex;\n            }\n            else {\n                groups[binding.groupIndex] = Math.max(groups[binding.groupIndex], binding.bindingIndex);\n            }\n        }\n        this.freeGroupIndex = groups.length - 1;\n        if (this.freeGroupIndex === 0) {\n            this.freeGroupIndex++;\n            this.freeBindingIndex = 0;\n        }\n        else {\n            this.freeBindingIndex = groups[groups.length - 1] + 1;\n        }\n    }\n    getAttributeNextLocation(dataType, arrayLength = 0) {\n        const index = this._attributeNextLocation;\n        this._attributeNextLocation += (_typeToLocationSize[dataType] ?? 1) * (arrayLength || 1);\n        return index;\n    }\n    getVaryingNextLocation(dataType, arrayLength = 0) {\n        const index = this._varyingNextLocation;\n        this._varyingNextLocation += (_typeToLocationSize[dataType] ?? 1) * (arrayLength || 1);\n        return index;\n    }\n    getNextFreeUBOBinding() {\n        return this._getNextFreeBinding(1);\n    }\n    _getNextFreeBinding(bindingCount) {\n        if (this.freeBindingIndex > _maxBindingsPerGroup - bindingCount) {\n            this.freeGroupIndex++;\n            this.freeBindingIndex = 0;\n        }\n        if (this.freeGroupIndex === _maxGroups) {\n            // eslint-disable-next-line no-throw-literal\n            throw \"Too many textures or UBOs have been declared and it is not supported in WebGPU.\";\n        }\n        const returnValue = {\n            groupIndex: this.freeGroupIndex,\n            bindingIndex: this.freeBindingIndex,\n        };\n        this.freeBindingIndex += bindingCount;\n        return returnValue;\n    }\n}\n/** @internal */\nWebGPUShaderProcessingContext._SimplifiedKnownBindings = true; // if true, use only group=0,binding=0 as a known group/binding for the Scene ubo and use group=1,binding=X for all other bindings\n// if false, see _KnownUBOs for the known groups/bindings used\nWebGPUShaderProcessingContext._SimplifiedKnownUBOs = {\n    Scene: { binding: { groupIndex: 0, bindingIndex: 0 } },\n    Light0: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light1: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light2: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light3: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light4: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light5: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light6: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light7: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light8: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light9: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light10: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light11: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light12: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light13: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light14: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light15: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light16: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light17: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light18: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light19: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light20: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light21: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light22: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light23: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light24: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light25: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light26: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light27: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light28: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light29: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light30: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Light31: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Material: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Mesh: { binding: { groupIndex: -1, bindingIndex: -1 } },\n    Internals: { binding: { groupIndex: -1, bindingIndex: -1 } },\n};\nWebGPUShaderProcessingContext._KnownUBOs = {\n    Scene: { binding: { groupIndex: 0, bindingIndex: 0 } },\n    Light0: { binding: { groupIndex: 1, bindingIndex: 0 } },\n    Light1: { binding: { groupIndex: 1, bindingIndex: 1 } },\n    Light2: { binding: { groupIndex: 1, bindingIndex: 2 } },\n    Light3: { binding: { groupIndex: 1, bindingIndex: 3 } },\n    Light4: { binding: { groupIndex: 1, bindingIndex: 4 } },\n    Light5: { binding: { groupIndex: 1, bindingIndex: 5 } },\n    Light6: { binding: { groupIndex: 1, bindingIndex: 6 } },\n    Light7: { binding: { groupIndex: 1, bindingIndex: 7 } },\n    Light8: { binding: { groupIndex: 1, bindingIndex: 8 } },\n    Light9: { binding: { groupIndex: 1, bindingIndex: 9 } },\n    Light10: { binding: { groupIndex: 1, bindingIndex: 10 } },\n    Light11: { binding: { groupIndex: 1, bindingIndex: 11 } },\n    Light12: { binding: { groupIndex: 1, bindingIndex: 12 } },\n    Light13: { binding: { groupIndex: 1, bindingIndex: 13 } },\n    Light14: { binding: { groupIndex: 1, bindingIndex: 14 } },\n    Light15: { binding: { groupIndex: 1, bindingIndex: 15 } },\n    Light16: { binding: { groupIndex: 1, bindingIndex: 16 } },\n    Light17: { binding: { groupIndex: 1, bindingIndex: 17 } },\n    Light18: { binding: { groupIndex: 1, bindingIndex: 18 } },\n    Light19: { binding: { groupIndex: 1, bindingIndex: 19 } },\n    Light20: { binding: { groupIndex: 1, bindingIndex: 20 } },\n    Light21: { binding: { groupIndex: 1, bindingIndex: 21 } },\n    Light22: { binding: { groupIndex: 1, bindingIndex: 22 } },\n    Light23: { binding: { groupIndex: 1, bindingIndex: 23 } },\n    Light24: { binding: { groupIndex: 1, bindingIndex: 24 } },\n    Light25: { binding: { groupIndex: 1, bindingIndex: 25 } },\n    Light26: { binding: { groupIndex: 1, bindingIndex: 26 } },\n    Light27: { binding: { groupIndex: 1, bindingIndex: 27 } },\n    Light28: { binding: { groupIndex: 1, bindingIndex: 28 } },\n    Light29: { binding: { groupIndex: 1, bindingIndex: 29 } },\n    Light30: { binding: { groupIndex: 1, bindingIndex: 30 } },\n    Light31: { binding: { groupIndex: 1, bindingIndex: 31 } },\n    Material: { binding: { groupIndex: 2, bindingIndex: 0 } },\n    Mesh: { binding: { groupIndex: 2, bindingIndex: 1 } },\n    Internals: { binding: { groupIndex: 2, bindingIndex: 2 } },\n};\n//# sourceMappingURL=webgpuShaderProcessingContext.js.map","/**\n * Extracts the characters between two markers (for eg, between \"(\" and \")\"). The function handles nested markers as well as markers inside strings (delimited by \", ' or `) and comments\n * @param markerOpen opening marker\n * @param markerClose closing marker\n * @param block code block to parse\n * @param startIndex starting index in block where the extraction must start. The character at block[startIndex] should be the markerOpen character!\n * @returns index of the last character for the extraction (or -1 if the string is invalid - no matching closing marker found). The string to extract (without the markers) is the string between startIndex + 1 and the returned value (exclusive)\n */\nexport function ExtractBetweenMarkers(markerOpen, markerClose, block, startIndex) {\n    let currPos = startIndex, openMarkers = 0, waitForChar = \"\";\n    while (currPos < block.length) {\n        const currChar = block.charAt(currPos);\n        if (!waitForChar) {\n            switch (currChar) {\n                case markerOpen:\n                    openMarkers++;\n                    break;\n                case markerClose:\n                    openMarkers--;\n                    break;\n                case '\"':\n                case \"'\":\n                case \"`\":\n                    waitForChar = currChar;\n                    break;\n                case \"/\":\n                    if (currPos + 1 < block.length) {\n                        const nextChar = block.charAt(currPos + 1);\n                        if (nextChar === \"/\") {\n                            waitForChar = \"\\n\";\n                        }\n                        else if (nextChar === \"*\") {\n                            waitForChar = \"*/\";\n                        }\n                    }\n                    break;\n            }\n        }\n        else {\n            if (currChar === waitForChar) {\n                if (waitForChar === '\"' || waitForChar === \"'\") {\n                    block.charAt(currPos - 1) !== \"\\\\\" && (waitForChar = \"\");\n                }\n                else {\n                    waitForChar = \"\";\n                }\n            }\n            else if (waitForChar === \"*/\" && currChar === \"*\" && currPos + 1 < block.length) {\n                block.charAt(currPos + 1) === \"/\" && (waitForChar = \"\");\n                if (waitForChar === \"\") {\n                    currPos++;\n                }\n            }\n        }\n        currPos++;\n        if (openMarkers === 0) {\n            break;\n        }\n    }\n    return openMarkers === 0 ? currPos - 1 : -1;\n}\n/**\n * Parses a string and skip whitespaces\n * @param s string to parse\n * @param index index where to start parsing\n * @returns the index after all whitespaces have been skipped\n */\nexport function SkipWhitespaces(s, index) {\n    while (index < s.length) {\n        const c = s[index];\n        if (c !== \" \" && c !== \"\\n\" && c !== \"\\r\" && c !== \"\\t\" && c !== \"\\u000a\" && c !== \"\\u00a0\") {\n            break;\n        }\n        index++;\n    }\n    return index;\n}\n/**\n * Checks if a character is an identifier character (meaning, if it is 0-9, A-Z, a-z or _)\n * @param c character to check\n * @returns true if the character is an identifier character\n */\nexport function IsIdentifierChar(c) {\n    const v = c.charCodeAt(0);\n    return ((v >= 48 && v <= 57) || // 0-9\n        (v >= 65 && v <= 90) || // A-Z\n        (v >= 97 && v <= 122) || // a-z\n        v == 95); // _\n}\n/**\n * Removes the comments of a code block\n * @param block code block to parse\n * @returns block with the comments removed\n */\nexport function RemoveComments(block) {\n    let currPos = 0, waitForChar = \"\", inComments = false;\n    const s = [];\n    while (currPos < block.length) {\n        const currChar = block.charAt(currPos);\n        if (!waitForChar) {\n            switch (currChar) {\n                case '\"':\n                case \"'\":\n                case \"`\":\n                    waitForChar = currChar;\n                    break;\n                case \"/\":\n                    if (currPos + 1 < block.length) {\n                        const nextChar = block.charAt(currPos + 1);\n                        if (nextChar === \"/\") {\n                            waitForChar = \"\\n\";\n                            inComments = true;\n                        }\n                        else if (nextChar === \"*\") {\n                            waitForChar = \"*/\";\n                            inComments = true;\n                        }\n                    }\n                    break;\n            }\n            if (!inComments) {\n                s.push(currChar);\n            }\n        }\n        else {\n            if (currChar === waitForChar) {\n                if (waitForChar === '\"' || waitForChar === \"'\") {\n                    block.charAt(currPos - 1) !== \"\\\\\" && (waitForChar = \"\");\n                    s.push(currChar);\n                }\n                else {\n                    waitForChar = \"\";\n                    inComments = false;\n                }\n            }\n            else if (waitForChar === \"*/\" && currChar === \"*\" && currPos + 1 < block.length) {\n                block.charAt(currPos + 1) === \"/\" && (waitForChar = \"\");\n                if (waitForChar === \"\") {\n                    inComments = false;\n                    currPos++;\n                }\n            }\n            else {\n                if (!inComments) {\n                    s.push(currChar);\n                }\n            }\n        }\n        currPos++;\n    }\n    return s.join(\"\");\n}\n/**\n * Finds the first occurrence of a character in a string going backward\n * @param s the string to parse\n * @param index starting index in the string\n * @param c the character to find\n * @param c2 an optional second character to find\n * @returns the index of the character if found, else -1\n */\nexport function FindBackward(s, index, c, c2) {\n    while (index >= 0 && s.charAt(index) !== c && (!c2 || s.charAt(index) !== c2)) {\n        index--;\n    }\n    return index;\n}\n/**\n * Escapes a string so that it is usable as a regular expression\n * @param s string to escape\n * @returns escaped string\n */\nexport function EscapeRegExp(s) {\n    return s.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n/**\n * Injects code at the beginning and/or end of a function.\n * The function is identified by \"mainFuncDecl\". The starting code is injected just after the first \"\\{\" found after the mainFuncDecl.\n * The ending code is injected just before the last \"\\}\" of the whole block of code (so, it is assumed that the function is the last of the block of code).\n * @param code code to inject into\n * @param mainFuncDecl Function declaration to find in the code (for eg: \"void main\")\n * @param startingCode The code to inject at the beginning of the function\n * @param endingCode The code to inject at the end of the function\n * @returns The code with the injected code\n */\nexport function InjectStartingAndEndingCode(code, mainFuncDecl, startingCode, endingCode) {\n    let idx = code.indexOf(mainFuncDecl);\n    if (idx < 0) {\n        return code;\n    }\n    if (startingCode) {\n        // eslint-disable-next-line no-empty\n        while (idx++ < code.length && code.charAt(idx) != \"{\") { }\n        if (idx < code.length) {\n            const part1 = code.substring(0, idx + 1);\n            const part2 = code.substring(idx + 1);\n            code = part1 + startingCode + part2;\n        }\n    }\n    if (endingCode) {\n        const lastClosingCurly = code.lastIndexOf(\"}\");\n        code = code.substring(0, lastClosingCurly);\n        code += endingCode + \"\\n}\";\n    }\n    return code;\n}\n//# sourceMappingURL=codeStringParsingTools.js.map","import { WebGPUShaderProcessingContext } from \"./webgpuShaderProcessingContext.js\";\nimport { Logger } from \"../../Misc/logger.js\";\nimport { WebGPUShaderProcessor } from \"./webgpuShaderProcessor.js\";\nimport { InjectStartingAndEndingCode } from \"../../Misc/codeStringParsingTools.js\";\n\n/** @internal */\nexport class WebGPUShaderProcessorGLSL extends WebGPUShaderProcessor {\n    constructor() {\n        super(...arguments);\n        this._missingVaryings = [];\n        this._textureArrayProcessing = [];\n        this._vertexIsGLES3 = false;\n        this._fragmentIsGLES3 = false;\n        this.shaderLanguage = 0 /* ShaderLanguage.GLSL */;\n        this.parseGLES3 = true;\n    }\n    _getArraySize(name, type, preProcessors) {\n        let length = 0;\n        const startArray = name.indexOf(\"[\");\n        const endArray = name.indexOf(\"]\");\n        if (startArray > 0 && endArray > 0) {\n            const lengthInString = name.substring(startArray + 1, endArray);\n            length = +lengthInString;\n            if (isNaN(length)) {\n                length = +preProcessors[lengthInString.trim()];\n            }\n            name = name.substring(0, startArray);\n        }\n        return [name, type, length];\n    }\n    initializeShaders(processingContext) {\n        this._webgpuProcessingContext = processingContext;\n        this._missingVaryings.length = 0;\n        this._textureArrayProcessing.length = 0;\n        this.attributeKeywordName = undefined;\n        this.varyingVertexKeywordName = undefined;\n        this.varyingFragmentKeywordName = undefined;\n    }\n    preProcessShaderCode(code, isFragment) {\n        const ubDeclaration = `// Internals UBO\\nuniform ${WebGPUShaderProcessor.InternalsUBOName} {\\nfloat yFactor_;\\nfloat textureOutputHeight_;\\n};\\n`;\n        const alreadyInjected = code.indexOf(\"// Internals UBO\") !== -1;\n        if (isFragment) {\n            this._fragmentIsGLES3 = code.indexOf(\"#version 3\") !== -1;\n            if (this._fragmentIsGLES3) {\n                this.varyingFragmentKeywordName = \"in\";\n            }\n            return alreadyInjected ? code : ubDeclaration + \"##INJECTCODE##\\n\" + code;\n        }\n        this._vertexIsGLES3 = code.indexOf(\"#version 3\") !== -1;\n        if (this._vertexIsGLES3) {\n            this.attributeKeywordName = \"in\";\n            this.varyingVertexKeywordName = \"out\";\n        }\n        return alreadyInjected ? code : ubDeclaration + code;\n    }\n    varyingCheck(varying, isFragment) {\n        const outRegex = /(flat\\s)?\\s*\\bout\\b/;\n        const inRegex = /(flat\\s)?\\s*\\bin\\b/;\n        const varyingRegex = /(flat\\s)?\\s*\\bvarying\\b/;\n        const regex = isFragment && this._fragmentIsGLES3 ? inRegex : !isFragment && this._vertexIsGLES3 ? outRegex : varyingRegex;\n        return regex.test(varying);\n    }\n    varyingProcessor(varying, isFragment, preProcessors) {\n        this._preProcessors = preProcessors;\n        const outRegex = /\\s*(flat)?\\s*out\\s+(?:(?:highp)?|(?:lowp)?)\\s*(\\S+)\\s+(\\S+)\\s*;/gm;\n        const inRegex = /\\s*(flat)?\\s*in\\s+(?:(?:highp)?|(?:lowp)?)\\s*(\\S+)\\s+(\\S+)\\s*;/gm;\n        const varyingRegex = /\\s*(flat)?\\s*varying\\s+(?:(?:highp)?|(?:lowp)?)\\s*(\\S+)\\s+(\\S+)\\s*;/gm;\n        const regex = isFragment && this._fragmentIsGLES3 ? inRegex : !isFragment && this._vertexIsGLES3 ? outRegex : varyingRegex;\n        const match = regex.exec(varying);\n        if (match !== null) {\n            const interpolationQualifier = match[1] ?? \"\";\n            const varyingType = match[2];\n            const name = match[3];\n            let location;\n            if (isFragment) {\n                location = this._webgpuProcessingContext.availableVaryings[name];\n                this._missingVaryings[location] = \"\";\n                if (location === undefined) {\n                    Logger.Warn(`Invalid fragment shader: The varying named \"${name}\" is not declared in the vertex shader! This declaration will be ignored.`);\n                }\n            }\n            else {\n                location = this._webgpuProcessingContext.getVaryingNextLocation(varyingType, this._getArraySize(name, varyingType, preProcessors)[2]);\n                this._webgpuProcessingContext.availableVaryings[name] = location;\n                this._missingVaryings[location] = `layout(location = ${location}) ${interpolationQualifier} in ${varyingType} ${name};`;\n            }\n            varying = varying.replace(match[0], location === undefined ? \"\" : `layout(location = ${location}) ${interpolationQualifier} ${isFragment ? \"in\" : \"out\"} ${varyingType} ${name};`);\n        }\n        return varying;\n    }\n    attributeProcessor(attribute, preProcessors) {\n        this._preProcessors = preProcessors;\n        const inRegex = /\\s*in\\s+(\\S+)\\s+(\\S+)\\s*;/gm;\n        const attribRegex = /\\s*attribute\\s+(\\S+)\\s+(\\S+)\\s*;/gm;\n        const regex = this._vertexIsGLES3 ? inRegex : attribRegex;\n        const match = regex.exec(attribute);\n        if (match !== null) {\n            const attributeType = match[1];\n            const name = match[2];\n            const location = this._webgpuProcessingContext.getAttributeNextLocation(attributeType, this._getArraySize(name, attributeType, preProcessors)[2]);\n            this._webgpuProcessingContext.availableAttributes[name] = location;\n            this._webgpuProcessingContext.orderedAttributes[location] = name;\n            const numComponents = this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents[name];\n            if (numComponents !== undefined) {\n                // Special case for an int/ivecX vertex buffer that is used as a float/vecX attribute in the shader.\n                const newType = numComponents < 0 ? (numComponents === -1 ? \"int\" : \"ivec\" + -numComponents) : numComponents === 1 ? \"uint\" : \"uvec\" + numComponents;\n                const newName = `_int_${name}_`;\n                attribute = attribute.replace(match[0], `layout(location = ${location}) in ${newType} ${newName}; ${attributeType} ${name} = ${attributeType}(${newName});`);\n            }\n            else {\n                attribute = attribute.replace(match[0], `layout(location = ${location}) in ${attributeType} ${name};`);\n            }\n        }\n        return attribute;\n    }\n    uniformProcessor(uniform, isFragment, preProcessors) {\n        this._preProcessors = preProcessors;\n        const uniformRegex = /\\s*uniform\\s+(?:(?:highp)?|(?:lowp)?)\\s*(\\S+)\\s+(\\S+)\\s*;/gm;\n        const match = uniformRegex.exec(uniform);\n        if (match !== null) {\n            let uniformType = match[1];\n            let name = match[2];\n            if (uniformType.indexOf(\"sampler\") === 0 || uniformType.indexOf(\"sampler\") === 1) {\n                let arraySize = 0; // 0 means the texture is not declared as an array\n                [name, uniformType, arraySize] = this._getArraySize(name, uniformType, preProcessors);\n                let textureInfo = this._webgpuProcessingContext.availableTextures[name];\n                if (!textureInfo) {\n                    textureInfo = {\n                        autoBindSampler: true,\n                        isTextureArray: arraySize > 0,\n                        isStorageTexture: false,\n                        textures: [],\n                        sampleType: \"float\" /* WebGPUConstants.TextureSampleType.Float */,\n                    };\n                    for (let i = 0; i < (arraySize || 1); ++i) {\n                        textureInfo.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding());\n                    }\n                }\n                const samplerType = WebGPUShaderProcessor._SamplerTypeByWebGLSamplerType[uniformType] ?? \"sampler\";\n                const isComparisonSampler = !!WebGPUShaderProcessor._IsComparisonSamplerByWebGPUSamplerType[samplerType];\n                const samplerBindingType = isComparisonSampler ? \"comparison\" /* WebGPUConstants.SamplerBindingType.Comparison */ : \"filtering\" /* WebGPUConstants.SamplerBindingType.Filtering */;\n                const samplerName = name + `Sampler`;\n                let samplerInfo = this._webgpuProcessingContext.availableSamplers[samplerName];\n                if (!samplerInfo) {\n                    samplerInfo = {\n                        binding: this._webgpuProcessingContext.getNextFreeUBOBinding(),\n                        type: samplerBindingType,\n                    };\n                }\n                const componentType = uniformType.charAt(0) === \"u\" ? \"u\" : uniformType.charAt(0) === \"i\" ? \"i\" : \"\";\n                if (componentType) {\n                    uniformType = uniformType.substring(1);\n                }\n                const sampleType = isComparisonSampler\n                    ? \"depth\" /* WebGPUConstants.TextureSampleType.Depth */\n                    : componentType === \"u\"\n                        ? \"uint\" /* WebGPUConstants.TextureSampleType.Uint */\n                        : componentType === \"i\"\n                            ? \"sint\" /* WebGPUConstants.TextureSampleType.Sint */\n                            : \"float\" /* WebGPUConstants.TextureSampleType.Float */;\n                textureInfo.sampleType = sampleType;\n                const isTextureArray = arraySize > 0;\n                const samplerGroupIndex = samplerInfo.binding.groupIndex;\n                const samplerBindingIndex = samplerInfo.binding.bindingIndex;\n                const samplerFunction = WebGPUShaderProcessor._SamplerFunctionByWebGLSamplerType[uniformType];\n                const textureType = WebGPUShaderProcessor._TextureTypeByWebGLSamplerType[uniformType];\n                const textureDimension = WebGPUShaderProcessor._GpuTextureViewDimensionByWebGPUTextureType[textureType];\n                // Manage textures and samplers.\n                if (!isTextureArray) {\n                    arraySize = 1;\n                    uniform = `layout(set = ${samplerGroupIndex}, binding = ${samplerBindingIndex}) uniform ${samplerType} ${samplerName};\r\n                        layout(set = ${textureInfo.textures[0].groupIndex}, binding = ${textureInfo.textures[0].bindingIndex}) uniform ${componentType}${textureType} ${name}Texture;\r\n                        #define ${name} ${componentType}${samplerFunction}(${name}Texture, ${samplerName})`;\n                }\n                else {\n                    const layouts = [];\n                    layouts.push(`layout(set = ${samplerGroupIndex}, binding = ${samplerBindingIndex}) uniform ${componentType}${samplerType} ${samplerName};`);\n                    uniform = `\\n`;\n                    for (let i = 0; i < arraySize; ++i) {\n                        const textureSetIndex = textureInfo.textures[i].groupIndex;\n                        const textureBindingIndex = textureInfo.textures[i].bindingIndex;\n                        layouts.push(`layout(set = ${textureSetIndex}, binding = ${textureBindingIndex}) uniform ${textureType} ${name}Texture${i};`);\n                        uniform += `${i > 0 ? \"\\n\" : \"\"}#define ${name}${i} ${componentType}${samplerFunction}(${name}Texture${i}, ${samplerName})`;\n                    }\n                    uniform = layouts.join(\"\\n\") + uniform;\n                    this._textureArrayProcessing.push(name);\n                }\n                this._webgpuProcessingContext.availableTextures[name] = textureInfo;\n                this._webgpuProcessingContext.availableSamplers[samplerName] = samplerInfo;\n                this._addSamplerBindingDescription(samplerName, samplerInfo, !isFragment);\n                for (let i = 0; i < arraySize; ++i) {\n                    this._addTextureBindingDescription(name, textureInfo, i, textureDimension, null, !isFragment);\n                }\n            }\n            else {\n                this._addUniformToLeftOverUBO(name, uniformType, preProcessors);\n                uniform = \"\";\n            }\n        }\n        return uniform;\n    }\n    uniformBufferProcessor(uniformBuffer, isFragment) {\n        const uboRegex = /uniform\\s+(\\w+)/gm;\n        const match = uboRegex.exec(uniformBuffer);\n        if (match !== null) {\n            const name = match[1];\n            let uniformBufferInfo = this._webgpuProcessingContext.availableBuffers[name];\n            if (!uniformBufferInfo) {\n                const knownUBO = WebGPUShaderProcessingContext.KnownUBOs[name];\n                let binding;\n                if (knownUBO && knownUBO.binding.groupIndex !== -1) {\n                    binding = knownUBO.binding;\n                }\n                else {\n                    binding = this._webgpuProcessingContext.getNextFreeUBOBinding();\n                }\n                uniformBufferInfo = { binding };\n                this._webgpuProcessingContext.availableBuffers[name] = uniformBufferInfo;\n            }\n            this._addBufferBindingDescription(name, uniformBufferInfo, \"uniform\" /* WebGPUConstants.BufferBindingType.Uniform */, !isFragment);\n            uniformBuffer = uniformBuffer.replace(\"uniform\", `layout(set = ${uniformBufferInfo.binding.groupIndex}, binding = ${uniformBufferInfo.binding.bindingIndex}) uniform`);\n        }\n        return uniformBuffer;\n    }\n    postProcessor(code, defines, isFragment, _processingContext, _parameters) {\n        const hasDrawBuffersExtension = code.search(/#extension.+GL_EXT_draw_buffers.+require/) !== -1;\n        // Remove extensions\n        const regex = /#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;\n        code = code.replace(regex, \"\");\n        // Replace instructions\n        code = code.replace(/texture2D\\s*\\(/g, \"texture(\");\n        if (isFragment) {\n            const hasFragCoord = code.indexOf(\"gl_FragCoord\") >= 0;\n            const fragCoordCode = `\r\n                glFragCoord_ = gl_FragCoord;\r\n                if (yFactor_ == 1.) {\r\n                    glFragCoord_.y = textureOutputHeight_ - glFragCoord_.y;\r\n                }\r\n            `;\n            const injectCode = hasFragCoord ? \"vec4 glFragCoord_;\\n\" : \"\";\n            const hasOutput = code.search(/layout *\\(location *= *0\\) *out/g) !== -1;\n            code = code.replace(/texture2DLodEXT\\s*\\(/g, \"textureLod(\");\n            code = code.replace(/textureCubeLodEXT\\s*\\(/g, \"textureLod(\");\n            code = code.replace(/textureCube\\s*\\(/g, \"texture(\");\n            code = code.replace(/gl_FragDepthEXT/g, \"gl_FragDepth\");\n            code = code.replace(/gl_FragColor/g, \"glFragColor\");\n            code = code.replace(/gl_FragData/g, \"glFragData\");\n            code = code.replace(/gl_FragCoord/g, \"glFragCoord_\");\n            if (!this._fragmentIsGLES3) {\n                code = code.replace(/void\\s+?main\\s*\\(/g, (hasDrawBuffersExtension || hasOutput ? \"\" : \"layout(location = 0) out vec4 glFragColor;\\n\") + \"void main(\");\n            }\n            else {\n                const match = /^\\s*out\\s+\\S+\\s+\\S+\\s*;/gm.exec(code);\n                if (match !== null) {\n                    code = code.substring(0, match.index) + \"layout(location = 0) \" + code.substring(match.index);\n                }\n            }\n            code = code.replace(/dFdy/g, \"(-yFactor_)*dFdy\"); // will also handle dFdyCoarse and dFdyFine\n            code = code.replace(\"##INJECTCODE##\", injectCode);\n            if (hasFragCoord) {\n                code = InjectStartingAndEndingCode(code, \"void main\", fragCoordCode);\n            }\n        }\n        else {\n            code = code.replace(/gl_InstanceID/g, \"gl_InstanceIndex\");\n            code = code.replace(/gl_VertexID/g, \"gl_VertexIndex\");\n            const hasMultiviewExtension = defines.indexOf(\"#define MULTIVIEW\") !== -1;\n            if (hasMultiviewExtension) {\n                return \"#extension GL_OVR_multiview2 : require\\nlayout (num_views = 2) in;\\n\" + code;\n            }\n        }\n        // Flip Y + convert z range from [-1,1] to [0,1]\n        if (!isFragment) {\n            const lastClosingCurly = code.lastIndexOf(\"}\");\n            code = code.substring(0, lastClosingCurly);\n            code += \"gl_Position.y *= yFactor_;\\n\";\n            // isNDCHalfZRange is always true in WebGPU\n            code += \"}\";\n        }\n        return code;\n    }\n    _applyTextureArrayProcessing(code, name) {\n        // Replaces the occurrences of name[XX] by nameXX\n        const regex = new RegExp(name + \"\\\\s*\\\\[(.+)?\\\\]\", \"gm\");\n        let match = regex.exec(code);\n        while (match !== null) {\n            const index = match[1];\n            let iindex = +index;\n            if (this._preProcessors && isNaN(iindex)) {\n                iindex = +this._preProcessors[index.trim()];\n            }\n            code = code.replace(match[0], name + iindex);\n            match = regex.exec(code);\n        }\n        return code;\n    }\n    _generateLeftOverUBOCode(name, uniformBufferDescription) {\n        let ubo = `layout(set = ${uniformBufferDescription.binding.groupIndex}, binding = ${uniformBufferDescription.binding.bindingIndex}) uniform ${name} {\\n    `;\n        for (const leftOverUniform of this._webgpuProcessingContext.leftOverUniforms) {\n            if (leftOverUniform.length > 0) {\n                ubo += `    ${leftOverUniform.type} ${leftOverUniform.name}[${leftOverUniform.length}];\\n`;\n            }\n            else {\n                ubo += `    ${leftOverUniform.type} ${leftOverUniform.name};\\n`;\n            }\n        }\n        ubo += \"};\\n\\n\";\n        return ubo;\n    }\n    finalizeShaders(vertexCode, fragmentCode) {\n        // make replacements for texture names in the texture array case\n        for (let i = 0; i < this._textureArrayProcessing.length; ++i) {\n            const name = this._textureArrayProcessing[i];\n            vertexCode = this._applyTextureArrayProcessing(vertexCode, name);\n            fragmentCode = this._applyTextureArrayProcessing(fragmentCode, name);\n        }\n        // inject the missing varying in the fragment shader\n        for (let i = 0; i < this._missingVaryings.length; ++i) {\n            const decl = this._missingVaryings[i];\n            if (decl && decl.length > 0) {\n                fragmentCode = decl + \"\\n\" + fragmentCode;\n            }\n        }\n        // Builds the leftover UBOs.\n        const leftOverUBO = this._buildLeftOverUBO();\n        vertexCode = leftOverUBO + vertexCode;\n        fragmentCode = leftOverUBO + fragmentCode;\n        this._collectBindingNames();\n        this._preCreateBindGroupEntries();\n        this._preProcessors = null;\n        this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents = {};\n        return { vertexCode, fragmentCode };\n    }\n}\n//# sourceMappingURL=webgpuShaderProcessorsGLSL.js.map","import { WebGPUShaderProcessingContext } from \"./webgpuShaderProcessingContext.js\";\nimport { Logger } from \"../../Misc/logger.js\";\nimport { WebGPUShaderProcessor } from \"./webgpuShaderProcessor.js\";\nimport { RemoveComments, InjectStartingAndEndingCode } from \"../../Misc/codeStringParsingTools.js\";\n\nimport \"../../ShadersWGSL/ShadersInclude/bakedVertexAnimationDeclaration.js\";\nimport \"../../ShadersWGSL/ShadersInclude/bakedVertexAnimation.js\";\nimport \"../../ShadersWGSL/ShadersInclude/instancesDeclaration.js\";\nimport \"../../ShadersWGSL/ShadersInclude/instancesVertex.js\";\nimport \"../../ShadersWGSL/ShadersInclude/helperFunctions.js\";\nimport \"../../ShadersWGSL/ShadersInclude/fresnelFunction.js\";\nimport \"../../ShadersWGSL/ShadersInclude/meshUboDeclaration.js\";\nimport \"../../ShadersWGSL/ShadersInclude/sceneUboDeclaration.js\";\nimport \"../../ShadersWGSL/ShadersInclude/decalFragment.js\";\nconst builtInName_frag_depth = \"fragmentOutputs.fragDepth\";\nconst leftOverVarName = \"uniforms\";\nconst internalsVarName = \"internals\";\nconst gpuTextureViewDimensionByWebGPUTextureFunction = {\n    texture_1d: \"1d\" /* WebGPUConstants.TextureViewDimension.E1d */,\n    texture_2d: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n    texture_2d_array: \"2d-array\" /* WebGPUConstants.TextureViewDimension.E2dArray */,\n    texture_3d: \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */,\n    texture_cube: \"cube\" /* WebGPUConstants.TextureViewDimension.Cube */,\n    texture_cube_array: \"cube-array\" /* WebGPUConstants.TextureViewDimension.CubeArray */,\n    texture_multisampled_2d: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n    texture_depth_2d: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n    texture_depth_2d_array: \"2d-array\" /* WebGPUConstants.TextureViewDimension.E2dArray */,\n    texture_depth_cube: \"cube\" /* WebGPUConstants.TextureViewDimension.Cube */,\n    texture_depth_cube_array: \"cube-array\" /* WebGPUConstants.TextureViewDimension.CubeArray */,\n    texture_depth_multisampled_2d: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n    texture_storage_1d: \"1d\" /* WebGPUConstants.TextureViewDimension.E1d */,\n    texture_storage_2d: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n    texture_storage_2d_array: \"2d-array\" /* WebGPUConstants.TextureViewDimension.E2dArray */,\n    texture_storage_3d: \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */,\n    texture_external: null,\n};\n/** @internal */\nexport class WebGPUShaderProcessorWGSL extends WebGPUShaderProcessor {\n    constructor() {\n        super(...arguments);\n        this.shaderLanguage = 1 /* ShaderLanguage.WGSL */;\n        this.uniformRegexp = /uniform\\s+(\\w+)\\s*:\\s*(.+)\\s*;/;\n        this.textureRegexp = /var\\s+(\\w+)\\s*:\\s*((array<\\s*)?(texture_\\w+)\\s*(<\\s*(.+)\\s*>)?\\s*(,\\s*\\w+\\s*>\\s*)?);/;\n        this.noPrecision = true;\n        this.pureMode = false;\n    }\n    preProcessor(code, defines, preProcessors, isFragment, processingContext) {\n        // Convert defines into const\n        for (const key in preProcessors) {\n            if (key === \"__VERSION__\") {\n                continue;\n            }\n            const value = preProcessors[key];\n            if (!isNaN(parseInt(value)) || !isNaN(parseFloat(value))) {\n                code = `const ${key} = ${value};\\n` + code;\n            }\n        }\n        return code;\n    }\n    _getArraySize(name, uniformType, preProcessors) {\n        let length = 0;\n        const endArray = uniformType.lastIndexOf(\">\");\n        if (uniformType.indexOf(\"array\") >= 0 && endArray > 0) {\n            let startArray = endArray;\n            while (startArray > 0 && uniformType.charAt(startArray) !== \" \" && uniformType.charAt(startArray) !== \",\") {\n                startArray--;\n            }\n            const lengthInString = uniformType.substring(startArray + 1, endArray);\n            length = +lengthInString;\n            if (isNaN(length)) {\n                length = +preProcessors[lengthInString.trim()];\n            }\n            while (startArray > 0 && (uniformType.charAt(startArray) === \" \" || uniformType.charAt(startArray) === \",\")) {\n                startArray--;\n            }\n            uniformType = uniformType.substring(uniformType.indexOf(\"<\") + 1, startArray + 1);\n        }\n        return [name, uniformType, length];\n    }\n    initializeShaders(processingContext) {\n        this._webgpuProcessingContext = processingContext;\n        this._attributesInputWGSL = [];\n        this._attributesWGSL = [];\n        this._attributesConversionCodeWGSL = [];\n        this._hasNonFloatAttribute = false;\n        this._varyingsWGSL = [];\n        this._varyingNamesWGSL = [];\n        this._stridedUniformArrays = [];\n    }\n    preProcessShaderCode(code) {\n        // Same check as in webgpuShaderProcessorsGLSL to avoid same ubDelcaration to be injected twice.\n        const ubDeclaration = this.pureMode\n            ? \"\"\n            : `struct ${WebGPUShaderProcessor.InternalsUBOName} {\\n  yFactor_: f32,\\n  textureOutputHeight_: f32,\\n};\\nvar<uniform> ${internalsVarName} : ${WebGPUShaderProcessor.InternalsUBOName};\\n`;\n        const alreadyInjected = code.indexOf(ubDeclaration) !== -1;\n        return alreadyInjected ? code : ubDeclaration + RemoveComments(code);\n    }\n    varyingCheck(varying) {\n        const regex = /(flat|linear|perspective)?\\s*(center|centroid|sample)?\\s*\\bvarying\\b/;\n        return regex.test(varying);\n    }\n    varyingProcessor(varying, isFragment, preProcessors) {\n        const varyingRegex = /\\s*(flat|linear|perspective)?\\s*(center|centroid|sample)?\\s*varying\\s+(?:(?:highp)?|(?:lowp)?)\\s*(\\S+)\\s*:\\s*(.+)\\s*;/gm;\n        const match = varyingRegex.exec(varying);\n        if (match !== null) {\n            const interpolationType = match[1] ?? \"perspective\";\n            const interpolationSampling = match[2] ?? \"center\";\n            const varyingType = match[4];\n            const name = match[3];\n            const interpolation = interpolationType === \"flat\" ? `@interpolate(${interpolationType})` : `@interpolate(${interpolationType}, ${interpolationSampling})`;\n            let location;\n            if (isFragment) {\n                location = this._webgpuProcessingContext.availableVaryings[name];\n                if (location === undefined) {\n                    Logger.Warn(`Invalid fragment shader: The varying named \"${name}\" is not declared in the vertex shader! This declaration will be ignored.`);\n                }\n            }\n            else {\n                location = this._webgpuProcessingContext.getVaryingNextLocation(varyingType, this._getArraySize(name, varyingType, preProcessors)[2]);\n                this._webgpuProcessingContext.availableVaryings[name] = location;\n                this._varyingsWGSL.push(`  @location(${location}) ${interpolation} ${name} : ${varyingType},`);\n                this._varyingNamesWGSL.push(name);\n            }\n            varying = \"\";\n        }\n        return varying;\n    }\n    attributeProcessor(attribute, preProcessors) {\n        const attribRegex = /\\s*attribute\\s+(\\S+)\\s*:\\s*(.+)\\s*;/gm;\n        const match = attribRegex.exec(attribute);\n        if (match !== null) {\n            const attributeType = match[2];\n            const name = match[1];\n            const location = this._webgpuProcessingContext.getAttributeNextLocation(attributeType, this._getArraySize(name, attributeType, preProcessors)[2]);\n            this._webgpuProcessingContext.availableAttributes[name] = location;\n            this._webgpuProcessingContext.orderedAttributes[location] = name;\n            const numComponents = this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents[name];\n            if (numComponents !== undefined) {\n                // Special case for an int/ivecX vertex buffer that is used as a float/vecX attribute in the shader.\n                const newType = numComponents < 0 ? (numComponents === -1 ? \"i32\" : \"vec\" + -numComponents + \"<i32>\") : numComponents === 1 ? \"u32\" : \"vec\" + numComponents + \"<u32>\";\n                const newName = `_int_${name}_`;\n                this._attributesInputWGSL.push(`@location(${location}) ${newName} : ${newType},`);\n                this._attributesWGSL.push(`${name} : ${attributeType},`);\n                this._attributesConversionCodeWGSL.push(`vertexInputs.${name} = ${attributeType}(vertexInputs_.${newName});`);\n                this._hasNonFloatAttribute = true;\n            }\n            else {\n                this._attributesInputWGSL.push(`@location(${location}) ${name} : ${attributeType},`);\n                this._attributesWGSL.push(`${name} : ${attributeType},`);\n                this._attributesConversionCodeWGSL.push(`vertexInputs.${name} = vertexInputs_.${name};`);\n            }\n            attribute = \"\";\n        }\n        return attribute;\n    }\n    uniformProcessor(uniform, isFragment, preProcessors) {\n        const match = this.uniformRegexp.exec(uniform);\n        if (match !== null) {\n            const uniformType = match[2];\n            const name = match[1];\n            this._addUniformToLeftOverUBO(name, uniformType, preProcessors);\n            uniform = \"\";\n        }\n        return uniform;\n    }\n    textureProcessor(texture, isFragment, preProcessors) {\n        const match = this.textureRegexp.exec(texture);\n        if (match !== null) {\n            const name = match[1]; // name of the variable\n            const type = match[2]; // texture_2d<f32> or array<texture_2d_array<f32>, 5> for eg\n            const isArrayOfTexture = !!match[3];\n            const textureFunc = match[4]; // texture_2d, texture_depth_2d, etc\n            const isStorageTexture = textureFunc.indexOf(\"storage\") > 0;\n            const componentType = match[6]; // f32 or i32 or u32 or undefined\n            const storageTextureFormat = isStorageTexture ? componentType.substring(0, componentType.indexOf(\",\")).trim() : null;\n            let arraySize = isArrayOfTexture ? this._getArraySize(name, type, preProcessors)[2] : 0;\n            let textureInfo = this._webgpuProcessingContext.availableTextures[name];\n            if (!textureInfo) {\n                textureInfo = {\n                    isTextureArray: arraySize > 0,\n                    isStorageTexture,\n                    textures: [],\n                    sampleType: \"float\" /* WebGPUConstants.TextureSampleType.Float */,\n                };\n                arraySize = arraySize || 1;\n                for (let i = 0; i < arraySize; ++i) {\n                    textureInfo.textures.push(this._webgpuProcessingContext.getNextFreeUBOBinding());\n                }\n            }\n            else {\n                arraySize = textureInfo.textures.length;\n            }\n            this._webgpuProcessingContext.availableTextures[name] = textureInfo;\n            const isDepthTexture = textureFunc.indexOf(\"depth\") > 0;\n            const textureDimension = gpuTextureViewDimensionByWebGPUTextureFunction[textureFunc];\n            const sampleType = isDepthTexture\n                ? \"depth\" /* WebGPUConstants.TextureSampleType.Depth */\n                : componentType === \"u32\"\n                    ? \"uint\" /* WebGPUConstants.TextureSampleType.Uint */\n                    : componentType === \"i32\"\n                        ? \"sint\" /* WebGPUConstants.TextureSampleType.Sint */\n                        : \"float\" /* WebGPUConstants.TextureSampleType.Float */;\n            textureInfo.sampleType = sampleType;\n            if (textureDimension === undefined) {\n                // eslint-disable-next-line no-throw-literal\n                throw `Can't get the texture dimension corresponding to the texture function \"${textureFunc}\"!`;\n            }\n            for (let i = 0; i < arraySize; ++i) {\n                const { groupIndex, bindingIndex } = textureInfo.textures[i];\n                if (i === 0) {\n                    texture = `@group(${groupIndex}) @binding(${bindingIndex}) ${texture}`;\n                }\n                this._addTextureBindingDescription(name, textureInfo, i, textureDimension, storageTextureFormat, !isFragment);\n            }\n        }\n        return texture;\n    }\n    // We need to process defines which are directly in the files themselves\n    postProcessor(code) {\n        const definePattern = /#define (.+?) (.+?)$/gm;\n        let match;\n        while ((match = definePattern.exec(code)) !== null) {\n            code = code.replace(new RegExp(match[1], \"g\"), match[2]);\n        }\n        return code;\n    }\n    finalizeShaders(vertexCode, fragmentCode) {\n        const fragCoordCode = fragmentCode.indexOf(\"fragmentInputs.position\") >= 0 && !this.pureMode\n            ? `\r\n            if (internals.yFactor_ == 1.) {\r\n                fragmentInputs.position.y = internals.textureOutputHeight_ - fragmentInputs.position.y;\r\n            }\r\n        `\n            : \"\";\n        // Add the group/binding info to the sampler declaration (var xxx: sampler|sampler_comparison)\n        vertexCode = this._processSamplers(vertexCode, true);\n        fragmentCode = this._processSamplers(fragmentCode, false);\n        // Add the group/binding info to the uniform/storage buffer declarations (var<uniform> XXX:YYY or var<storage(,read_write|read)> XXX:YYY)\n        vertexCode = this._processCustomBuffers(vertexCode, true);\n        fragmentCode = this._processCustomBuffers(fragmentCode, false);\n        // Builds the leftover UBOs.\n        const leftOverUBO = this._buildLeftOverUBO();\n        vertexCode = leftOverUBO + vertexCode;\n        fragmentCode = leftOverUBO + fragmentCode;\n        // Vertex code\n        vertexCode = vertexCode.replace(/#define (\\w+)\\s+(\\d+\\.?\\d*)/g, \"const $1 = $2;\");\n        vertexCode = vertexCode.replace(/#define /g, \"//#define \");\n        vertexCode = this._processStridedUniformArrays(vertexCode);\n        let vertexInputs = \"struct VertexInputs {\\n  @builtin(vertex_index) vertexIndex : u32,\\n  @builtin(instance_index) instanceIndex : u32,\\n\";\n        if (this._attributesInputWGSL.length > 0) {\n            vertexInputs += this._attributesInputWGSL.join(\"\\n\");\n        }\n        vertexInputs += \"\\n};\\nvar<private> vertexInputs\" + (this._hasNonFloatAttribute ? \"_\" : \"\") + \" : VertexInputs;\\n\";\n        if (this._hasNonFloatAttribute) {\n            vertexInputs += \"struct VertexInputs_ {\\n  vertexIndex : u32, instanceIndex : u32,\\n\";\n            vertexInputs += this._attributesWGSL.join(\"\\n\");\n            vertexInputs += \"\\n};\\nvar<private> vertexInputs : VertexInputs_;\\n\";\n        }\n        let vertexOutputs = \"struct FragmentInputs {\\n  @builtin(position) position : vec4<f32>,\\n\";\n        if (this._varyingsWGSL.length > 0) {\n            vertexOutputs += this._varyingsWGSL.join(\"\\n\");\n        }\n        vertexOutputs += \"\\n};\\nvar<private> vertexOutputs : FragmentInputs;\\n\";\n        vertexCode = vertexInputs + vertexOutputs + vertexCode;\n        let vertexMainStartingCode = `\\n  vertexInputs${this._hasNonFloatAttribute ? \"_\" : \"\"} = input;\\n`;\n        if (this._hasNonFloatAttribute) {\n            vertexMainStartingCode += \"vertexInputs.vertexIndex = vertexInputs_.vertexIndex;\\nvertexInputs.instanceIndex = vertexInputs_.instanceIndex;\\n\";\n            vertexMainStartingCode += this._attributesConversionCodeWGSL.join(\"\\n\");\n            vertexMainStartingCode += \"\\n\";\n        }\n        const vertexMainEndingCode = this.pureMode\n            ? `  return vertexOutputs;`\n            : `  vertexOutputs.position.y = vertexOutputs.position.y * internals.yFactor_;\\n  return vertexOutputs;`;\n        let needDiagnosticOff = vertexCode.indexOf(`#define DISABLE_UNIFORMITY_ANALYSIS`) !== -1;\n        vertexCode =\n            (needDiagnosticOff ? \"diagnostic(off, derivative_uniformity);\\n\" : \"\") +\n                \"diagnostic(off, chromium.unreachable_code);\\n\" +\n                InjectStartingAndEndingCode(vertexCode, \"fn main\", vertexMainStartingCode, vertexMainEndingCode);\n        // fragment code\n        fragmentCode = fragmentCode.replace(/#define (\\w+)\\s+(\\d+\\.?\\d*)/g, \"const $1 = $2;\");\n        fragmentCode = fragmentCode.replace(/#define /g, \"//#define \");\n        fragmentCode = this._processStridedUniformArrays(fragmentCode);\n        if (!this.pureMode) {\n            fragmentCode = fragmentCode.replace(/dpdy/g, \"(-internals.yFactor_)*dpdy\"); // will also handle dpdyCoarse and dpdyFine\n        }\n        let fragmentInputs = \"struct FragmentInputs {\\n  @builtin(position) position : vec4<f32>,\\n  @builtin(front_facing) frontFacing : bool,\\n\";\n        if (this._varyingsWGSL.length > 0) {\n            fragmentInputs += this._varyingsWGSL.join(\"\\n\");\n        }\n        fragmentInputs += \"\\n};\\nvar<private> fragmentInputs : FragmentInputs;\\n\";\n        let fragmentOutputs = \"struct FragmentOutputs {\\n\";\n        // Adding fragData output locations\n        const regexRoot = \"fragmentOutputs\\\\.fragData\";\n        let match = fragmentCode.match(new RegExp(regexRoot + \"0\", \"g\"));\n        let indexLocation = 0;\n        if (match) {\n            fragmentOutputs += ` @location(${indexLocation}) fragData0 : vec4<f32>,\\n`;\n            indexLocation++;\n            for (let index = 1; index < 8; index++) {\n                match = fragmentCode.match(new RegExp(regexRoot + index, \"g\"));\n                if (match) {\n                    fragmentOutputs += ` @location(${indexLocation}) fragData${indexLocation} : vec4<f32>,\\n`;\n                    indexLocation++;\n                }\n            }\n            if (fragmentCode.indexOf(\"MRT_AND_COLOR\") !== -1) {\n                fragmentOutputs += `  @location(${indexLocation}) color : vec4<f32>,\\n`;\n                indexLocation++;\n            }\n        }\n        // Adding fragData output locations\n        const regex = /oitDepthSampler/;\n        match = fragmentCode.match(regex);\n        if (match) {\n            fragmentOutputs += ` @location(${indexLocation++}) depth : vec2<f32>,\\n`;\n            fragmentOutputs += ` @location(${indexLocation++}) frontColor : vec4<f32>,\\n`;\n            fragmentOutputs += ` @location(${indexLocation++}) backColor : vec4<f32>,\\n`;\n        }\n        if (indexLocation === 0) {\n            fragmentOutputs += \"  @location(0) color : vec4<f32>,\\n\";\n            indexLocation++;\n        }\n        // FragDepth\n        let hasFragDepth = false;\n        let idx = 0;\n        while (!hasFragDepth) {\n            idx = fragmentCode.indexOf(builtInName_frag_depth, idx);\n            if (idx < 0) {\n                break;\n            }\n            const saveIndex = idx;\n            hasFragDepth = true;\n            while (idx > 1 && fragmentCode.charAt(idx) !== \"\\n\") {\n                if (fragmentCode.charAt(idx) === \"/\" && fragmentCode.charAt(idx - 1) === \"/\") {\n                    hasFragDepth = false;\n                    break;\n                }\n                idx--;\n            }\n            idx = saveIndex + builtInName_frag_depth.length;\n        }\n        if (hasFragDepth) {\n            fragmentOutputs += \"  @builtin(frag_depth) fragDepth: f32,\\n\";\n        }\n        fragmentOutputs += \"};\\nvar<private> fragmentOutputs : FragmentOutputs;\\n\";\n        fragmentCode = fragmentInputs + fragmentOutputs + fragmentCode;\n        const fragmentStartingCode = \"  fragmentInputs = input;\\n  \" + fragCoordCode;\n        const fragmentEndingCode = \"  return fragmentOutputs;\";\n        needDiagnosticOff = fragmentCode.indexOf(`#define DISABLE_UNIFORMITY_ANALYSIS`) !== -1;\n        fragmentCode =\n            (needDiagnosticOff ? \"diagnostic(off, derivative_uniformity);\\n\" : \"\") +\n                \"diagnostic(off, chromium.unreachable_code);\\n\" +\n                InjectStartingAndEndingCode(fragmentCode, \"fn main\", fragmentStartingCode, fragmentEndingCode);\n        this._collectBindingNames();\n        this._preCreateBindGroupEntries();\n        this._webgpuProcessingContext.vertexBufferKindToNumberOfComponents = {};\n        return { vertexCode, fragmentCode };\n    }\n    _generateLeftOverUBOCode(name, uniformBufferDescription) {\n        let stridedArrays = \"\";\n        let ubo = `struct ${name} {\\n`;\n        for (const leftOverUniform of this._webgpuProcessingContext.leftOverUniforms) {\n            const type = leftOverUniform.type.replace(/^(.*?)(<.*>)?$/, \"$1\");\n            const size = WebGPUShaderProcessor.UniformSizes[type];\n            if (leftOverUniform.length > 0) {\n                if (size <= 2) {\n                    const stridedArrayType = `${name}_${this._stridedUniformArrays.length}_strided_arr`;\n                    stridedArrays += `struct ${stridedArrayType} {\r\n                        @size(16)\r\n                        el: ${type},\r\n                    }`;\n                    this._stridedUniformArrays.push(leftOverUniform.name);\n                    ubo += ` @align(16) ${leftOverUniform.name} : array<${stridedArrayType}, ${leftOverUniform.length}>,\\n`;\n                }\n                else {\n                    ubo += ` ${leftOverUniform.name} : array<${leftOverUniform.type}, ${leftOverUniform.length}>,\\n`;\n                }\n            }\n            else {\n                ubo += `  ${leftOverUniform.name} : ${leftOverUniform.type},\\n`;\n            }\n        }\n        ubo += \"};\\n\";\n        ubo = `${stridedArrays}\\n${ubo}`;\n        ubo += `@group(${uniformBufferDescription.binding.groupIndex}) @binding(${uniformBufferDescription.binding.bindingIndex}) var<uniform> ${leftOverVarName} : ${name};\\n`;\n        return ubo;\n    }\n    _processSamplers(code, isVertex) {\n        const samplerRegexp = /var\\s+(\\w+Sampler)\\s*:\\s*(sampler|sampler_comparison)\\s*;/gm;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            const match = samplerRegexp.exec(code);\n            if (match === null) {\n                break;\n            }\n            const name = match[1]; // name of the variable\n            const samplerType = match[2]; // sampler or sampler_comparison\n            const suffixLessLength = name.length - `Sampler`.length;\n            const textureName = name.lastIndexOf(`Sampler`) === suffixLessLength ? name.substring(0, suffixLessLength) : null;\n            const samplerBindingType = samplerType === \"sampler_comparison\" ? \"comparison\" /* WebGPUConstants.SamplerBindingType.Comparison */ : \"filtering\" /* WebGPUConstants.SamplerBindingType.Filtering */;\n            if (textureName) {\n                const textureInfo = this._webgpuProcessingContext.availableTextures[textureName];\n                if (textureInfo) {\n                    textureInfo.autoBindSampler = true;\n                }\n            }\n            let samplerInfo = this._webgpuProcessingContext.availableSamplers[name];\n            if (!samplerInfo) {\n                samplerInfo = {\n                    binding: this._webgpuProcessingContext.getNextFreeUBOBinding(),\n                    type: samplerBindingType,\n                };\n                this._webgpuProcessingContext.availableSamplers[name] = samplerInfo;\n            }\n            this._addSamplerBindingDescription(name, samplerInfo, isVertex);\n            const part1 = code.substring(0, match.index);\n            const insertPart = `@group(${samplerInfo.binding.groupIndex}) @binding(${samplerInfo.binding.bindingIndex}) `;\n            const part2 = code.substring(match.index);\n            code = part1 + insertPart + part2;\n            samplerRegexp.lastIndex += insertPart.length;\n        }\n        return code;\n    }\n    _processCustomBuffers(code, isVertex) {\n        const instantiateBufferRegexp = /var<\\s*(uniform|storage)\\s*(,\\s*(read|read_write)\\s*)?>\\s+(\\S+)\\s*:\\s*(\\S+)\\s*;/gm;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            const match = instantiateBufferRegexp.exec(code);\n            if (match === null) {\n                break;\n            }\n            const type = match[1];\n            const decoration = match[3];\n            let name = match[4];\n            const structName = match[5];\n            let bufferInfo = this._webgpuProcessingContext.availableBuffers[name];\n            if (!bufferInfo) {\n                const knownUBO = type === \"uniform\" ? WebGPUShaderProcessingContext.KnownUBOs[structName] : null;\n                let binding;\n                if (knownUBO) {\n                    name = structName;\n                    binding = knownUBO.binding;\n                    if (binding.groupIndex === -1) {\n                        binding = this._webgpuProcessingContext.availableBuffers[name]?.binding;\n                        if (!binding) {\n                            binding = this._webgpuProcessingContext.getNextFreeUBOBinding();\n                        }\n                    }\n                }\n                else {\n                    binding = this._webgpuProcessingContext.getNextFreeUBOBinding();\n                }\n                bufferInfo = { binding };\n                this._webgpuProcessingContext.availableBuffers[name] = bufferInfo;\n            }\n            this._addBufferBindingDescription(name, this._webgpuProcessingContext.availableBuffers[name], decoration === \"read_write\"\n                ? \"storage\" /* WebGPUConstants.BufferBindingType.Storage */\n                : type === \"storage\"\n                    ? \"read-only-storage\" /* WebGPUConstants.BufferBindingType.ReadOnlyStorage */\n                    : \"uniform\" /* WebGPUConstants.BufferBindingType.Uniform */, isVertex);\n            const groupIndex = bufferInfo.binding.groupIndex;\n            const bindingIndex = bufferInfo.binding.bindingIndex;\n            const part1 = code.substring(0, match.index);\n            const insertPart = `@group(${groupIndex}) @binding(${bindingIndex}) `;\n            const part2 = code.substring(match.index);\n            code = part1 + insertPart + part2;\n            instantiateBufferRegexp.lastIndex += insertPart.length;\n        }\n        return code;\n    }\n    _processStridedUniformArrays(code) {\n        for (const uniformArrayName of this._stridedUniformArrays) {\n            code = code.replace(new RegExp(`${uniformArrayName}\\\\s*\\\\[(.*?)\\\\]`, \"g\"), `${uniformArrayName}[$1].el`);\n        }\n        return code;\n    }\n}\n//# sourceMappingURL=webgpuShaderProcessorsWGSL.js.map","import { ILog2 } from \"../../Maths/math.scalar.functions.js\";\nimport { WebGPUTextureHelper } from \"./webgpuTextureHelper.js\";\n/** @internal */\nexport class WebGPUHardwareTexture {\n    get underlyingResource() {\n        return this._webgpuTexture;\n    }\n    getMSAATexture(index) {\n        return this._webgpuMSAATexture?.[index] ?? null;\n    }\n    setMSAATexture(texture, index) {\n        if (!this._webgpuMSAATexture) {\n            this._webgpuMSAATexture = [];\n        }\n        this._webgpuMSAATexture[index] = texture;\n    }\n    releaseMSAATexture(index) {\n        if (this._webgpuMSAATexture) {\n            if (index !== undefined) {\n                this._engine._textureHelper.releaseTexture(this._webgpuMSAATexture[index]);\n                delete this._webgpuMSAATexture[index];\n            }\n            else {\n                for (const texture of this._webgpuMSAATexture) {\n                    this._engine._textureHelper.releaseTexture(texture);\n                }\n                this._webgpuMSAATexture = null;\n            }\n        }\n    }\n    constructor(_engine, existingTexture = null) {\n        this._engine = _engine;\n        /** @internal */\n        this._originalFormatIsRGB = false;\n        this.format = \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */;\n        this.textureUsages = 0;\n        this.textureAdditionalUsages = 0;\n        this._webgpuTexture = existingTexture;\n        this._webgpuMSAATexture = null;\n        this.view = null;\n        this.viewForWriting = null;\n    }\n    set(hardwareTexture) {\n        this._webgpuTexture = hardwareTexture;\n    }\n    setUsage(_textureSource, generateMipMaps, is2DArray, isCube, is3D, width, height, depth) {\n        let viewDimension = \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */;\n        let arrayLayerCount = 1;\n        if (isCube) {\n            viewDimension = is2DArray ? \"cube-array\" /* WebGPUConstants.TextureViewDimension.CubeArray */ : \"cube\" /* WebGPUConstants.TextureViewDimension.Cube */;\n            arrayLayerCount = 6 * (depth || 1);\n        }\n        else if (is3D) {\n            viewDimension = \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */;\n            arrayLayerCount = 1;\n        }\n        else if (is2DArray) {\n            viewDimension = \"2d-array\" /* WebGPUConstants.TextureViewDimension.E2dArray */;\n            arrayLayerCount = depth;\n        }\n        const format = WebGPUTextureHelper.GetDepthFormatOnly(this.format);\n        const aspect = WebGPUTextureHelper.HasDepthAndStencilAspects(this.format) ? \"depth-only\" /* WebGPUConstants.TextureAspect.DepthOnly */ : \"all\" /* WebGPUConstants.TextureAspect.All */;\n        this.createView({\n            label: `TextureView${is3D ? \"3D\" : isCube ? \"Cube\" : \"2D\"}${is2DArray ? \"_Array\" + arrayLayerCount : \"\"}_${width}x${height}_${generateMipMaps ? \"wmips\" : \"womips\"}_${this.format}_${viewDimension}`,\n            format,\n            dimension: viewDimension,\n            mipLevelCount: generateMipMaps ? ILog2(Math.max(width, height)) + 1 : 1,\n            baseArrayLayer: 0,\n            baseMipLevel: 0,\n            arrayLayerCount,\n            aspect,\n        });\n    }\n    createView(descriptor, createViewForWriting = false) {\n        this.view = this._webgpuTexture.createView(descriptor);\n        if (createViewForWriting && descriptor) {\n            const saveNumMipMaps = descriptor.mipLevelCount;\n            descriptor.mipLevelCount = 1;\n            this.viewForWriting = this._webgpuTexture.createView(descriptor);\n            descriptor.mipLevelCount = saveNumMipMaps;\n        }\n    }\n    reset() {\n        this._webgpuTexture = null;\n        this._webgpuMSAATexture = null;\n        this.view = null;\n        this.viewForWriting = null;\n    }\n    release() {\n        this._webgpuTexture?.destroy();\n        this.releaseMSAATexture();\n        this._copyInvertYTempTexture?.destroy();\n        this.reset();\n    }\n}\n//# sourceMappingURL=webgpuHardwareTexture.js.map","/* eslint-disable @typescript-eslint/naming-convention */\n/* eslint-disable babylonjs/available */\n/* eslint-disable jsdoc/require-jsdoc */\n// License for the mipmap generation code:\n//\n// Copyright 2020 Brandon Jones\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\nimport * as WebGPUConstants from \"./webgpuConstants.js\";\n\nimport { WebGPUHardwareTexture } from \"./webgpuHardwareTexture.js\";\nimport { WebGPUTextureHelper } from \"./webgpuTextureHelper.js\";\nimport { Finalize, Initialize, Process } from \"../Processors/shaderProcessor.js\";\n// TODO WEBGPU improve mipmap generation by using compute shaders\nconst mipmapVertexSource = `\r\n    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));\r\n    const tex = array<vec2<f32>, 4>( vec2f(0.0f, 0.0f),  vec2f(1.0f, 0.0f),  vec2f(0.0f, 1.0f),  vec2f(1.0f, 1.0f));\r\n\r\n    varying vTex: vec2f;\r\n\r\n    @vertex\r\n    fn main(input : VertexInputs) -> FragmentInputs {\r\n        vertexOutputs.vTex = tex[input.vertexIndex];\r\n        vertexOutputs.position = vec4f(pos[input.vertexIndex], 0.0, 1.0);\r\n    }\r\n    `;\nconst mipmapFragmentSource = `\r\n    var imgSampler: sampler;\r\n    var img: texture_2d<f32>;\r\n\r\n    varying vTex: vec2f;\r\n\r\n    @fragment\r\n    fn main(input: FragmentInputs) -> FragmentOutputs {\r\n        fragmentOutputs.color = textureSample(img, imgSampler, input.vTex);\r\n    }\r\n    `;\nconst invertYPreMultiplyAlphaVertexSource = `\r\n    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));\r\n    const tex = array<vec2<f32>, 4>( vec2f(0.0f, 0.0f),  vec2f(1.0f, 0.0f),  vec2f(0.0f, 1.0f),  vec2f(1.0f, 1.0f));\r\n\r\n    var img: texture_2d<f32>;\r\n\r\n    #ifdef INVERTY\r\n        varying vTextureSize: vec2f;\r\n    #endif\r\n\r\n    @vertex\r\n    fn main(input : VertexInputs) -> FragmentInputs {\r\n        #ifdef INVERTY\r\n            vertexOutputs.vTextureSize = vec2f(textureDimensions(img, 0));\r\n        #endif\r\n        vertexOutputs.position =  vec4f(pos[input.vertexIndex], 0.0, 1.0);\r\n    }\r\n    `;\nconst invertYPreMultiplyAlphaFragmentSource = `\r\n    var img: texture_2d<f32>;\r\n\r\n    #ifdef INVERTY\r\n        varying vTextureSize: vec2f;\r\n    #endif\r\n\r\n    @fragment\r\n    fn main(input: FragmentInputs) -> FragmentOutputs {\r\n    #ifdef INVERTY\r\n        var color: vec4f = textureLoad(img, vec2i(i32(input.position.x), i32(input.vTextureSize.y - input.position.y)), 0);\r\n    #else\r\n        var color: vec4f = textureLoad(img, vec2i(input.position.xy), 0);\r\n    #endif\r\n    #ifdef PREMULTIPLYALPHA\r\n        color = vec4f(color.rgb * color.a, color.a);\r\n    #endif\r\n        fragmentOutputs.color = color;\r\n    }\r\n    `;\nconst invertYPreMultiplyAlphaWithOfstVertexSource = invertYPreMultiplyAlphaVertexSource;\nconst invertYPreMultiplyAlphaWithOfstFragmentSource = `\r\n    var img: texture_2d<f32>;\r\n    uniform ofstX: f32;\r\n    uniform ofstY: f32;\r\n    uniform width: f32;\r\n    uniform height: f32;\r\n\r\n    #ifdef INVERTY\r\n        varying vTextureSize: vec2f;\r\n    #endif\r\n\r\n    @fragment\r\n    fn main(input: FragmentInputs) -> FragmentOutputs {\r\n        if (input.position.x < uniforms.ofstX || input.position.x >= uniforms.ofstX + uniforms.width) {\r\n            discard;\r\n        }\r\n        if (input.position.y < uniforms.ofstY || input.position.y >= uniforms.ofstY + uniforms.height) {\r\n            discard;\r\n        }\r\n    #ifdef INVERTY\r\n        var color: vec4f = textureLoad(img, vec2i(i32(input.position.x), i32(uniforms.ofstY + uniforms.height - (input.position.y - uniforms.ofstY))), 0);\r\n    #else\r\n        var color: vec4f = textureLoad(img, vec2i(input.position.xy), 0);\r\n    #endif\r\n    #ifdef PREMULTIPLYALPHA\r\n        color = vec4f(color.rgb * color.a, color.a);\r\n    #endif\r\n        fragmentOutputs.color = color;\r\n    }\r\n    `;\nconst clearVertexSource = `\r\n    const pos = array<vec2<f32>, 4>( vec2f(-1.0f, 1.0f),  vec2f(1.0f, 1.0f),  vec2f(-1.0f, -1.0f),  vec2f(1.0f, -1.0f));\r\n\r\n    @vertex\r\n    fn main(input : VertexInputs) -> FragmentInputs {\r\n        vertexOutputs.position =  vec4f(pos[input.vertexIndex], 0.0, 1.0);\r\n    }\r\n    `;\nconst clearFragmentSource = `\r\n    uniform color: vec4f;\r\n\r\n\r\n    @fragment\r\n    fn main(input: FragmentInputs) -> FragmentOutputs {\r\n        fragmentOutputs.color = uniforms.color;\r\n    }\r\n    `;\nconst copyVideoToTextureVertexSource = `\r\n    struct VertexOutput {\r\n        @builtin(position) Position : vec4<f32>,\r\n        @location(0) fragUV : vec2<f32>\r\n    }\r\n\r\n    @vertex\r\n    fn main(\r\n        @builtin(vertex_index) VertexIndex : u32\r\n    ) -> VertexOutput {\r\n        var pos = array<vec2<f32>, 4>(\r\n            vec2(-1.0,  1.0),\r\n            vec2( 1.0,  1.0),\r\n            vec2(-1.0, -1.0),\r\n            vec2( 1.0, -1.0)\r\n        );\r\n        var tex = array<vec2<f32>, 4>(\r\n            vec2(0.0, 0.0),\r\n            vec2(1.0, 0.0),\r\n            vec2(0.0, 1.0),\r\n            vec2(1.0, 1.0)\r\n        );\r\n\r\n        var output: VertexOutput;\r\n\r\n        output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);\r\n        output.fragUV = tex[VertexIndex];\r\n\r\n        return output;\r\n    }\r\n    `;\nconst copyVideoToTextureFragmentSource = `\r\n    @group(0) @binding(0) var videoSampler: sampler;\r\n    @group(0) @binding(1) var videoTexture: texture_external;\r\n\r\n    @fragment\r\n    fn main(\r\n        @location(0) fragUV: vec2<f32>\r\n    ) -> @location(0) vec4<f32> {\r\n        return textureSampleBaseClampToEdge(videoTexture, videoSampler, fragUV);\r\n    }\r\n    `;\nconst copyVideoToTextureInvertYFragmentSource = `\r\n    @group(0) @binding(0) var videoSampler: sampler;\r\n    @group(0) @binding(1) var videoTexture: texture_external;\r\n\r\n    @fragment\r\n    fn main(\r\n        @location(0) fragUV: vec2<f32>\r\n    ) -> @location(0) vec4<f32> {\r\n        return textureSampleBaseClampToEdge(videoTexture, videoSampler, vec2<f32>(fragUV.x, 1.0 - fragUV.y));\r\n    }\r\n    `;\nvar PipelineType;\n(function (PipelineType) {\n    PipelineType[PipelineType[\"MipMap\"] = 0] = \"MipMap\";\n    PipelineType[PipelineType[\"InvertYPremultiplyAlpha\"] = 1] = \"InvertYPremultiplyAlpha\";\n    PipelineType[PipelineType[\"Clear\"] = 2] = \"Clear\";\n    PipelineType[PipelineType[\"InvertYPremultiplyAlphaWithOfst\"] = 3] = \"InvertYPremultiplyAlphaWithOfst\";\n})(PipelineType || (PipelineType = {}));\nvar VideoPipelineType;\n(function (VideoPipelineType) {\n    VideoPipelineType[VideoPipelineType[\"DontInvertY\"] = 0] = \"DontInvertY\";\n    VideoPipelineType[VideoPipelineType[\"InvertY\"] = 1] = \"InvertY\";\n})(VideoPipelineType || (VideoPipelineType = {}));\nconst shadersForPipelineType = [\n    { vertex: mipmapVertexSource, fragment: mipmapFragmentSource },\n    { vertex: invertYPreMultiplyAlphaVertexSource, fragment: invertYPreMultiplyAlphaFragmentSource },\n    { vertex: clearVertexSource, fragment: clearFragmentSource },\n    { vertex: invertYPreMultiplyAlphaWithOfstVertexSource, fragment: invertYPreMultiplyAlphaWithOfstFragmentSource },\n];\n/**\n * Map a (renderable) texture format (GPUTextureFormat) to an index for fast lookup (in caches for eg)\n * The number of entries should not go over 64! Else, the code in WebGPUCacheRenderPipeline.setMRT should be updated\n */\nexport const renderableTextureFormatToIndex = {\n    \"\": 0,\n    r8unorm: 1,\n    r8uint: 2,\n    r8sint: 3,\n    r16uint: 4,\n    r16sint: 5,\n    r16float: 6,\n    rg8unorm: 7,\n    rg8uint: 8,\n    rg8sint: 9,\n    r32uint: 10,\n    r32sint: 11,\n    r32float: 12,\n    rg16uint: 13,\n    rg16sint: 14,\n    rg16float: 15,\n    rgba8unorm: 16,\n    \"rgba8unorm-srgb\": 17,\n    rgba8uint: 18,\n    rgba8sint: 19,\n    bgra8unorm: 20,\n    \"bgra8unorm-srgb\": 21,\n    rgb10a2uint: 22,\n    rgb10a2unorm: 23,\n    /* rg11b10ufloat: this entry is dynamically added if the \"RG11B10UFloatRenderable\" extension is supported */\n    rg32uint: 24,\n    rg32sint: 25,\n    rg32float: 26,\n    rgba16uint: 27,\n    rgba16sint: 28,\n    rgba16float: 29,\n    rgba32uint: 30,\n    rgba32sint: 31,\n    rgba32float: 32,\n    stencil8: 33,\n    depth16unorm: 34,\n    depth24plus: 35,\n    \"depth24plus-stencil8\": 36,\n    depth32float: 37,\n    \"depth32float-stencil8\": 38,\n    r16unorm: 39,\n    rg16unorm: 40,\n    rgba16unorm: 41,\n    r16snorm: 42,\n    rg16snorm: 43,\n    rgba16snorm: 44,\n};\n/** @internal */\nexport class WebGPUTextureManager {\n    //------------------------------------------------------------------------------\n    //                         Initialization / Helpers\n    //------------------------------------------------------------------------------\n    constructor(engine, device, bufferManager, enabledExtensions) {\n        this._pipelines = {};\n        this._compiledShaders = [];\n        this._videoPipelines = {};\n        this._videoCompiledShaders = [];\n        this._deferredReleaseTextures = [];\n        this._engine = engine;\n        this._device = device;\n        this._bufferManager = bufferManager;\n        if (enabledExtensions.indexOf(\"rg11b10ufloat-renderable\" /* WebGPUConstants.FeatureName.RG11B10UFloatRenderable */) !== -1) {\n            const keys = Object.keys(renderableTextureFormatToIndex);\n            renderableTextureFormatToIndex[\"rg11b10ufloat\" /* WebGPUConstants.TextureFormat.RG11B10UFloat */] = renderableTextureFormatToIndex[keys[keys.length - 1]] + 1;\n        }\n        this._mipmapSampler = device.createSampler({ minFilter: \"linear\" /* WebGPUConstants.FilterMode.Linear */ });\n        this._videoSampler = device.createSampler({ minFilter: \"linear\" /* WebGPUConstants.FilterMode.Linear */ });\n        this._ubCopyWithOfst = this._bufferManager.createBuffer(4 * 4, WebGPUConstants.BufferUsage.Uniform | WebGPUConstants.BufferUsage.CopyDst, \"UBCopyWithOffset\").underlyingResource;\n        this._getPipeline(\"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */);\n        this._getVideoPipeline(\"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */);\n    }\n    _getPipeline(format, type = PipelineType.MipMap, params) {\n        const index = type === PipelineType.MipMap\n            ? 1 << 0\n            : type === PipelineType.InvertYPremultiplyAlpha\n                ? ((params.invertY ? 1 : 0) << 1) + ((params.premultiplyAlpha ? 1 : 0) << 2)\n                : type === PipelineType.Clear\n                    ? 1 << 3\n                    : type === PipelineType.InvertYPremultiplyAlphaWithOfst\n                        ? ((params.invertY ? 1 : 0) << 4) + ((params.premultiplyAlpha ? 1 : 0) << 5)\n                        : 0;\n        if (!this._pipelines[format]) {\n            this._pipelines[format] = [];\n        }\n        let pipelineAndBGL = this._pipelines[format][index];\n        if (!pipelineAndBGL) {\n            let defines = \"\";\n            if (type === PipelineType.InvertYPremultiplyAlpha || type === PipelineType.InvertYPremultiplyAlphaWithOfst) {\n                if (params.invertY) {\n                    defines += \"#define INVERTY\\n\";\n                }\n                if (params.premultiplyAlpha) {\n                    defines += \"#define PREMULTIPLYALPHA\\n\";\n                }\n            }\n            let modules = this._compiledShaders[index];\n            if (!modules) {\n                let vertexCode = shadersForPipelineType[type].vertex;\n                let fragmentCode = shadersForPipelineType[type].fragment;\n                const processorOptions = {\n                    defines: defines.split(\"\\n\"),\n                    indexParameters: null,\n                    isFragment: false,\n                    shouldUseHighPrecisionShader: true,\n                    processor: this._engine._getShaderProcessor(1 /* ShaderLanguage.WGSL */),\n                    supportsUniformBuffers: true,\n                    shadersRepository: \"\",\n                    includesShadersStore: {},\n                    version: (this._engine.version * 100).toString(),\n                    platformName: this._engine.shaderPlatformName,\n                    processingContext: this._engine._getShaderProcessingContext(1 /* ShaderLanguage.WGSL */, true),\n                    isNDCHalfZRange: this._engine.isNDCHalfZRange,\n                    useReverseDepthBuffer: this._engine.useReverseDepthBuffer,\n                };\n                Initialize(processorOptions);\n                // Disable special additions not needed here\n                processorOptions.processor.pureMode = true;\n                Process(vertexCode, processorOptions, (migratedVertexCode) => {\n                    vertexCode = migratedVertexCode;\n                }, this._engine);\n                processorOptions.isFragment = true;\n                Process(fragmentCode, processorOptions, (migratedFragmentCode) => {\n                    fragmentCode = migratedFragmentCode;\n                }, this._engine);\n                const final = Finalize(vertexCode, fragmentCode, processorOptions);\n                // Restore\n                processorOptions.processor.pureMode = false;\n                const vertexModule = this._device.createShaderModule({\n                    label: `BabylonWebGPUDevice${this._engine.uniqueId}_InternalVertexShader_${index}`,\n                    code: final.vertexCode,\n                });\n                const fragmentModule = this._device.createShaderModule({\n                    label: `BabylonWebGPUDevice${this._engine.uniqueId}_InternalFragmentShader_${index}`,\n                    code: final.fragmentCode,\n                });\n                modules = this._compiledShaders[index] = [vertexModule, fragmentModule];\n            }\n            const pipeline = this._device.createRenderPipeline({\n                label: `BabylonWebGPUDevice${this._engine.uniqueId}_InternalPipeline_${format}_${index}`,\n                layout: \"auto\" /* WebGPUConstants.AutoLayoutMode.Auto */,\n                vertex: {\n                    module: modules[0],\n                    entryPoint: \"main\",\n                },\n                fragment: {\n                    module: modules[1],\n                    entryPoint: \"main\",\n                    targets: [\n                        {\n                            format,\n                        },\n                    ],\n                },\n                primitive: {\n                    topology: \"triangle-strip\" /* WebGPUConstants.PrimitiveTopology.TriangleStrip */,\n                    stripIndexFormat: \"uint16\" /* WebGPUConstants.IndexFormat.Uint16 */,\n                },\n            });\n            pipelineAndBGL = this._pipelines[format][index] = [pipeline, pipeline.getBindGroupLayout(0)];\n        }\n        return pipelineAndBGL;\n    }\n    _getVideoPipeline(format, type = VideoPipelineType.DontInvertY) {\n        const index = type === VideoPipelineType.InvertY ? 1 << 0 : 0;\n        if (!this._videoPipelines[format]) {\n            this._videoPipelines[format] = [];\n        }\n        let pipelineAndBGL = this._videoPipelines[format][index];\n        if (!pipelineAndBGL) {\n            let modules = this._videoCompiledShaders[index];\n            if (!modules) {\n                const vertexModule = this._device.createShaderModule({\n                    code: copyVideoToTextureVertexSource,\n                    label: `BabylonWebGPUDevice${this._engine.uniqueId}_CopyVideoToTexture_VertexShader`,\n                });\n                const fragmentModule = this._device.createShaderModule({\n                    code: index === 0 ? copyVideoToTextureFragmentSource : copyVideoToTextureInvertYFragmentSource,\n                    label: `BabylonWebGPUDevice${this._engine.uniqueId}_CopyVideoToTexture_FragmentShader_${index === 0 ? \"DontInvertY\" : \"InvertY\"}`,\n                });\n                modules = this._videoCompiledShaders[index] = [vertexModule, fragmentModule];\n            }\n            const pipeline = this._device.createRenderPipeline({\n                label: `BabylonWebGPUDevice${this._engine.uniqueId}_InternalVideoPipeline_${format}_${index === 0 ? \"DontInvertY\" : \"InvertY\"}`,\n                layout: \"auto\" /* WebGPUConstants.AutoLayoutMode.Auto */,\n                vertex: {\n                    module: modules[0],\n                    entryPoint: \"main\",\n                },\n                fragment: {\n                    module: modules[1],\n                    entryPoint: \"main\",\n                    targets: [\n                        {\n                            format,\n                        },\n                    ],\n                },\n                primitive: {\n                    topology: \"triangle-strip\" /* WebGPUConstants.PrimitiveTopology.TriangleStrip */,\n                    stripIndexFormat: \"uint16\" /* WebGPUConstants.IndexFormat.Uint16 */,\n                },\n            });\n            pipelineAndBGL = this._videoPipelines[format][index] = [pipeline, pipeline.getBindGroupLayout(0)];\n        }\n        return pipelineAndBGL;\n    }\n    setCommandEncoder(encoder) {\n        this._commandEncoderForCreation = encoder;\n    }\n    copyVideoToTexture(video, texture, format, invertY = false, commandEncoder) {\n        const useOwnCommandEncoder = commandEncoder === undefined;\n        const [pipeline, bindGroupLayout] = this._getVideoPipeline(format, invertY ? VideoPipelineType.InvertY : VideoPipelineType.DontInvertY);\n        if (useOwnCommandEncoder) {\n            commandEncoder = this._device.createCommandEncoder({});\n        }\n        commandEncoder.pushDebugGroup?.(`copy video to texture - invertY=${invertY}`);\n        const webgpuHardwareTexture = texture._hardwareTexture;\n        const renderPassDescriptor = {\n            label: `BabylonWebGPUDevice${this._engine.uniqueId}_copyVideoToTexture_${format}_${invertY ? \"InvertY\" : \"DontInvertY\"}${texture.label ? \"_\" + texture.label : \"\"}`,\n            colorAttachments: [\n                {\n                    view: webgpuHardwareTexture.underlyingResource.createView({\n                        format,\n                        dimension: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n                        mipLevelCount: 1,\n                        baseArrayLayer: 0,\n                        baseMipLevel: 0,\n                        arrayLayerCount: 1,\n                        aspect: \"all\" /* WebGPUConstants.TextureAspect.All */,\n                    }),\n                    loadOp: \"load\" /* WebGPUConstants.LoadOp.Load */,\n                    storeOp: \"store\" /* WebGPUConstants.StoreOp.Store */,\n                },\n            ],\n        };\n        const passEncoder = commandEncoder.beginRenderPass(renderPassDescriptor);\n        const descriptor = {\n            layout: bindGroupLayout,\n            entries: [\n                {\n                    binding: 0,\n                    resource: this._videoSampler,\n                },\n                {\n                    binding: 1,\n                    resource: this._device.importExternalTexture({\n                        source: video.underlyingResource,\n                    }),\n                },\n            ],\n        };\n        const bindGroup = this._device.createBindGroup(descriptor);\n        passEncoder.setPipeline(pipeline);\n        passEncoder.setBindGroup(0, bindGroup);\n        passEncoder.draw(4, 1, 0, 0);\n        passEncoder.end();\n        commandEncoder.popDebugGroup?.();\n        if (useOwnCommandEncoder) {\n            this._device.queue.submit([commandEncoder.finish()]);\n            commandEncoder = null;\n        }\n    }\n    invertYPreMultiplyAlpha(gpuOrHdwTexture, width, height, format, invertY = false, premultiplyAlpha = false, faceIndex = 0, mipLevel = 0, layers = 1, ofstX = 0, ofstY = 0, rectWidth = 0, rectHeight = 0, commandEncoder, \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    allowGPUOptimization) {\n        const useRect = rectWidth !== 0;\n        const useOwnCommandEncoder = commandEncoder === undefined;\n        const [pipeline, bindGroupLayout] = this._getPipeline(format, useRect ? PipelineType.InvertYPremultiplyAlphaWithOfst : PipelineType.InvertYPremultiplyAlpha, {\n            invertY,\n            premultiplyAlpha,\n        });\n        faceIndex = Math.max(faceIndex, 0);\n        if (useOwnCommandEncoder) {\n            commandEncoder = this._device.createCommandEncoder({});\n        }\n        commandEncoder.pushDebugGroup?.(`internal process texture - invertY=${invertY} premultiplyAlpha=${premultiplyAlpha}`);\n        let gpuTexture;\n        if (WebGPUTextureHelper.IsHardwareTexture(gpuOrHdwTexture)) {\n            gpuTexture = gpuOrHdwTexture.underlyingResource;\n            if (!(invertY && !premultiplyAlpha && layers === 1 && faceIndex === 0)) {\n                // we optimize only for the most likely case (invertY=true, premultiplyAlpha=false, layers=1, faceIndex=0) to avoid dealing with big caches\n                gpuOrHdwTexture = undefined;\n            }\n        }\n        else {\n            gpuTexture = gpuOrHdwTexture;\n            gpuOrHdwTexture = undefined;\n        }\n        if (!gpuTexture) {\n            return;\n        }\n        if (useRect) {\n            this._bufferManager.setRawData(this._ubCopyWithOfst, 0, new Float32Array([ofstX, ofstY, rectWidth, rectHeight]), 0, 4 * 4);\n        }\n        const webgpuHardwareTexture = gpuOrHdwTexture;\n        const outputTexture = webgpuHardwareTexture?._copyInvertYTempTexture ??\n            this.createTexture({ width, height, layers: 1 }, false, false, false, false, false, format, 1, commandEncoder, 1 /* WebGPUConstants.TextureUsage.CopySrc */ | 16 /* WebGPUConstants.TextureUsage.RenderAttachment */ | 4 /* WebGPUConstants.TextureUsage.TextureBinding */, undefined, \"TempTextureForCopyWithInvertY\");\n        const renderPassDescriptor = webgpuHardwareTexture?._copyInvertYRenderPassDescr ?? {\n            label: `BabylonWebGPUDevice${this._engine.uniqueId}_invertYPreMultiplyAlpha_${format}_${invertY ? \"InvertY\" : \"DontInvertY\"}_${premultiplyAlpha ? \"PremultiplyAlpha\" : \"DontPremultiplyAlpha\"}`,\n            colorAttachments: [\n                {\n                    view: outputTexture.createView({\n                        format,\n                        dimension: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n                        baseMipLevel: 0,\n                        mipLevelCount: 1,\n                        arrayLayerCount: 1,\n                        baseArrayLayer: 0,\n                    }),\n                    loadOp: \"load\" /* WebGPUConstants.LoadOp.Load */,\n                    storeOp: \"store\" /* WebGPUConstants.StoreOp.Store */,\n                },\n            ],\n        };\n        const passEncoder = commandEncoder.beginRenderPass(renderPassDescriptor);\n        let bindGroup = useRect ? webgpuHardwareTexture?._copyInvertYBindGroupWithOfst : webgpuHardwareTexture?._copyInvertYBindGroup;\n        if (!bindGroup) {\n            const descriptor = {\n                layout: bindGroupLayout,\n                entries: [\n                    {\n                        binding: 0,\n                        resource: gpuTexture.createView({\n                            format,\n                            dimension: \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n                            baseMipLevel: mipLevel,\n                            mipLevelCount: 1,\n                            arrayLayerCount: layers,\n                            baseArrayLayer: faceIndex,\n                        }),\n                    },\n                ],\n            };\n            if (useRect) {\n                descriptor.entries.push({\n                    binding: 1,\n                    resource: {\n                        buffer: this._ubCopyWithOfst,\n                    },\n                });\n            }\n            bindGroup = this._device.createBindGroup(descriptor);\n        }\n        passEncoder.setPipeline(pipeline);\n        passEncoder.setBindGroup(0, bindGroup);\n        passEncoder.draw(4, 1, 0, 0);\n        passEncoder.end();\n        commandEncoder.copyTextureToTexture({\n            texture: outputTexture,\n        }, {\n            texture: gpuTexture,\n            mipLevel,\n            origin: {\n                x: 0,\n                y: 0,\n                z: faceIndex,\n            },\n        }, {\n            width: rectWidth || width,\n            height: rectHeight || height,\n            depthOrArrayLayers: 1,\n        });\n        if (webgpuHardwareTexture) {\n            webgpuHardwareTexture._copyInvertYTempTexture = outputTexture;\n            webgpuHardwareTexture._copyInvertYRenderPassDescr = renderPassDescriptor;\n            if (useRect) {\n                webgpuHardwareTexture._copyInvertYBindGroupWithOfst = bindGroup;\n            }\n            else {\n                webgpuHardwareTexture._copyInvertYBindGroup = bindGroup;\n            }\n        }\n        else {\n            this._deferredReleaseTextures.push([outputTexture, null]);\n        }\n        commandEncoder.popDebugGroup?.();\n        if (useOwnCommandEncoder) {\n            this._device.queue.submit([commandEncoder.finish()]);\n            commandEncoder = null;\n        }\n    }\n    //------------------------------------------------------------------------------\n    //                               Creation\n    //------------------------------------------------------------------------------\n    createTexture(imageBitmap, hasMipmaps = false, generateMipmaps = false, invertY = false, premultiplyAlpha = false, is3D = false, format = \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */, sampleCount = 1, commandEncoder, usage = -1, additionalUsages = 0, label) {\n        sampleCount = WebGPUTextureHelper.GetSample(sampleCount);\n        const layerCount = imageBitmap.layers || 1;\n        const textureSize = {\n            width: imageBitmap.width,\n            height: imageBitmap.height,\n            depthOrArrayLayers: layerCount,\n        };\n        const renderAttachmentFlag = renderableTextureFormatToIndex[format] ? 16 /* WebGPUConstants.TextureUsage.RenderAttachment */ : 0;\n        const isCompressedFormat = WebGPUTextureHelper.IsCompressedFormat(format);\n        const mipLevelCount = hasMipmaps ? WebGPUTextureHelper.ComputeNumMipmapLevels(imageBitmap.width, imageBitmap.height) : 1;\n        const usages = usage >= 0 ? usage : 1 /* WebGPUConstants.TextureUsage.CopySrc */ | 2 /* WebGPUConstants.TextureUsage.CopyDst */ | 4 /* WebGPUConstants.TextureUsage.TextureBinding */;\n        additionalUsages |= hasMipmaps && !isCompressedFormat ? 1 /* WebGPUConstants.TextureUsage.CopySrc */ | renderAttachmentFlag : 0;\n        if (!isCompressedFormat && !is3D) {\n            // we don't know in advance if the texture will be updated with copyExternalImageToTexture (which requires to have those flags), so we need to force the flags all the times\n            additionalUsages |= renderAttachmentFlag | 2 /* WebGPUConstants.TextureUsage.CopyDst */;\n        }\n        const gpuTexture = this._device.createTexture({\n            label: `BabylonWebGPUDevice${this._engine.uniqueId}_Texture${is3D ? \"3D\" : \"2D\"}_${label ? label + \"_\" : \"\"}${textureSize.width}x${textureSize.height}x${textureSize.depthOrArrayLayers}_${hasMipmaps ? \"wmips\" : \"womips\"}_${format}_samples${sampleCount}`,\n            size: textureSize,\n            dimension: is3D ? \"3d\" /* WebGPUConstants.TextureDimension.E3d */ : \"2d\" /* WebGPUConstants.TextureDimension.E2d */,\n            format,\n            usage: usages | additionalUsages,\n            sampleCount,\n            mipLevelCount,\n        });\n        if (WebGPUTextureHelper.IsImageBitmap(imageBitmap)) {\n            this.updateTexture(imageBitmap, gpuTexture, imageBitmap.width, imageBitmap.height, layerCount, format, 0, 0, invertY, premultiplyAlpha, 0, 0);\n            if (hasMipmaps && generateMipmaps) {\n                this.generateMipmaps(gpuTexture, format, mipLevelCount, 0, is3D, commandEncoder);\n            }\n        }\n        return gpuTexture;\n    }\n    createCubeTexture(imageBitmaps, hasMipmaps = false, generateMipmaps = false, invertY = false, premultiplyAlpha = false, format = \"rgba8unorm\" /* WebGPUConstants.TextureFormat.RGBA8Unorm */, sampleCount = 1, commandEncoder, usage = -1, additionalUsages = 0, label) {\n        sampleCount = WebGPUTextureHelper.GetSample(sampleCount);\n        const width = WebGPUTextureHelper.IsImageBitmapArray(imageBitmaps) ? imageBitmaps[0].width : imageBitmaps.width;\n        const height = WebGPUTextureHelper.IsImageBitmapArray(imageBitmaps) ? imageBitmaps[0].height : imageBitmaps.height;\n        const renderAttachmentFlag = renderableTextureFormatToIndex[format] ? 16 /* WebGPUConstants.TextureUsage.RenderAttachment */ : 0;\n        const isCompressedFormat = WebGPUTextureHelper.IsCompressedFormat(format);\n        const mipLevelCount = hasMipmaps ? WebGPUTextureHelper.ComputeNumMipmapLevels(width, height) : 1;\n        const usages = usage >= 0 ? usage : 1 /* WebGPUConstants.TextureUsage.CopySrc */ | 2 /* WebGPUConstants.TextureUsage.CopyDst */ | 4 /* WebGPUConstants.TextureUsage.TextureBinding */;\n        additionalUsages |= hasMipmaps && !isCompressedFormat ? 1 /* WebGPUConstants.TextureUsage.CopySrc */ | renderAttachmentFlag : 0;\n        if (!isCompressedFormat) {\n            // we don't know in advance if the texture will be updated with copyExternalImageToTexture (which requires to have those flags), so we need to force the flags all the times\n            additionalUsages |= renderAttachmentFlag | 2 /* WebGPUConstants.TextureUsage.CopyDst */;\n        }\n        const gpuTexture = this._device.createTexture({\n            label: `BabylonWebGPUDevice${this._engine.uniqueId}_TextureCube_${label ? label + \"_\" : \"\"}${width}x${height}x6_${hasMipmaps ? \"wmips\" : \"womips\"}_${format}_samples${sampleCount}`,\n            size: {\n                width,\n                height,\n                depthOrArrayLayers: 6,\n            },\n            dimension: \"2d\" /* WebGPUConstants.TextureDimension.E2d */,\n            format,\n            usage: usages | additionalUsages,\n            sampleCount,\n            mipLevelCount,\n        });\n        if (WebGPUTextureHelper.IsImageBitmapArray(imageBitmaps)) {\n            this.updateCubeTextures(imageBitmaps, gpuTexture, width, height, format, invertY, premultiplyAlpha, 0, 0);\n            if (hasMipmaps && generateMipmaps) {\n                this.generateCubeMipmaps(gpuTexture, format, mipLevelCount, commandEncoder);\n            }\n        }\n        return gpuTexture;\n    }\n    generateCubeMipmaps(gpuTexture, format, mipLevelCount, commandEncoder) {\n        const useOwnCommandEncoder = commandEncoder === undefined;\n        if (useOwnCommandEncoder) {\n            commandEncoder = this._device.createCommandEncoder({});\n        }\n        commandEncoder.pushDebugGroup?.(`create cube mipmaps - ${mipLevelCount} levels`);\n        for (let f = 0; f < 6; ++f) {\n            this.generateMipmaps(gpuTexture, format, mipLevelCount, f, false, commandEncoder);\n        }\n        commandEncoder.popDebugGroup?.();\n        if (useOwnCommandEncoder) {\n            this._device.queue.submit([commandEncoder.finish()]);\n            commandEncoder = null;\n        }\n    }\n    generateMipmaps(gpuOrHdwTexture, format, mipLevelCount, faceIndex = 0, is3D = false, commandEncoder) {\n        const useOwnCommandEncoder = commandEncoder === undefined;\n        const [pipeline, bindGroupLayout] = this._getPipeline(format);\n        faceIndex = Math.max(faceIndex, 0);\n        if (useOwnCommandEncoder) {\n            commandEncoder = this._device.createCommandEncoder({});\n        }\n        commandEncoder.pushDebugGroup?.(`create mipmaps for face #${faceIndex} - ${mipLevelCount} levels`);\n        let gpuTexture;\n        if (WebGPUTextureHelper.IsHardwareTexture(gpuOrHdwTexture)) {\n            gpuTexture = gpuOrHdwTexture.underlyingResource;\n            gpuOrHdwTexture._mipmapGenRenderPassDescr = gpuOrHdwTexture._mipmapGenRenderPassDescr || [];\n            gpuOrHdwTexture._mipmapGenBindGroup = gpuOrHdwTexture._mipmapGenBindGroup || [];\n        }\n        else {\n            gpuTexture = gpuOrHdwTexture;\n            gpuOrHdwTexture = undefined;\n        }\n        if (!gpuTexture) {\n            return;\n        }\n        const webgpuHardwareTexture = gpuOrHdwTexture;\n        for (let i = 1; i < mipLevelCount; ++i) {\n            const renderPassDescriptor = webgpuHardwareTexture?._mipmapGenRenderPassDescr[faceIndex]?.[i - 1] ?? {\n                label: `BabylonWebGPUDevice${this._engine.uniqueId}_generateMipmaps_${format}_faceIndex${faceIndex}_level${i}`,\n                colorAttachments: [\n                    {\n                        view: gpuTexture.createView({\n                            format,\n                            dimension: is3D ? \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */ : \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n                            baseMipLevel: i,\n                            mipLevelCount: 1,\n                            arrayLayerCount: 1,\n                            baseArrayLayer: faceIndex,\n                        }),\n                        loadOp: \"load\" /* WebGPUConstants.LoadOp.Load */,\n                        storeOp: \"store\" /* WebGPUConstants.StoreOp.Store */,\n                    },\n                ],\n            };\n            if (webgpuHardwareTexture) {\n                webgpuHardwareTexture._mipmapGenRenderPassDescr[faceIndex] = webgpuHardwareTexture._mipmapGenRenderPassDescr[faceIndex] || [];\n                webgpuHardwareTexture._mipmapGenRenderPassDescr[faceIndex][i - 1] = renderPassDescriptor;\n            }\n            const passEncoder = commandEncoder.beginRenderPass(renderPassDescriptor);\n            const bindGroup = webgpuHardwareTexture?._mipmapGenBindGroup[faceIndex]?.[i - 1] ??\n                this._device.createBindGroup({\n                    layout: bindGroupLayout,\n                    entries: [\n                        {\n                            binding: 0,\n                            resource: gpuTexture.createView({\n                                format,\n                                dimension: is3D ? \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */ : \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n                                baseMipLevel: i - 1,\n                                mipLevelCount: 1,\n                                arrayLayerCount: 1,\n                                baseArrayLayer: faceIndex,\n                            }),\n                        },\n                        {\n                            binding: 1,\n                            resource: this._mipmapSampler,\n                        },\n                    ],\n                });\n            if (webgpuHardwareTexture) {\n                webgpuHardwareTexture._mipmapGenBindGroup[faceIndex] = webgpuHardwareTexture._mipmapGenBindGroup[faceIndex] || [];\n                webgpuHardwareTexture._mipmapGenBindGroup[faceIndex][i - 1] = bindGroup;\n            }\n            passEncoder.setPipeline(pipeline);\n            passEncoder.setBindGroup(0, bindGroup);\n            passEncoder.draw(4, 1, 0, 0);\n            passEncoder.end();\n        }\n        commandEncoder.popDebugGroup?.();\n        if (useOwnCommandEncoder) {\n            this._device.queue.submit([commandEncoder.finish()]);\n            commandEncoder = null;\n        }\n    }\n    createGPUTextureForInternalTexture(texture, width, height, depth, creationFlags, dontCreateMSAATexture) {\n        if (!texture._hardwareTexture) {\n            texture._hardwareTexture = new WebGPUHardwareTexture(this._engine);\n        }\n        if (width === undefined) {\n            width = texture.width;\n        }\n        if (height === undefined) {\n            height = texture.height;\n        }\n        if (depth === undefined) {\n            depth = texture.depth;\n        }\n        const gpuTextureWrapper = texture._hardwareTexture;\n        const isStorageTexture = ((creationFlags ?? 0) & 1) !== 0;\n        gpuTextureWrapper.format = WebGPUTextureHelper.GetWebGPUTextureFormat(texture.type, texture.format, texture._useSRGBBuffer);\n        gpuTextureWrapper.textureUsages =\n            texture._source === 5 /* InternalTextureSource.RenderTarget */ || texture.source === 6 /* InternalTextureSource.MultiRenderTarget */\n                ? 4 /* WebGPUConstants.TextureUsage.TextureBinding */ | 1 /* WebGPUConstants.TextureUsage.CopySrc */ | 16 /* WebGPUConstants.TextureUsage.RenderAttachment */\n                : texture._source === 12 /* InternalTextureSource.DepthStencil */\n                    ? 4 /* WebGPUConstants.TextureUsage.TextureBinding */ | 16 /* WebGPUConstants.TextureUsage.RenderAttachment */\n                    : -1;\n        gpuTextureWrapper.textureAdditionalUsages = isStorageTexture ? 8 /* WebGPUConstants.TextureUsage.StorageBinding */ : 0;\n        const hasMipMaps = texture.generateMipMaps;\n        const layerCount = depth || 1;\n        let mipmapCount;\n        if (texture._maxLodLevel !== null) {\n            mipmapCount = texture._maxLodLevel;\n        }\n        else {\n            mipmapCount = hasMipMaps ? WebGPUTextureHelper.ComputeNumMipmapLevels(width, height) : 1;\n        }\n        if (texture.isCube) {\n            const gpuTexture = this.createCubeTexture({ width, height }, texture.generateMipMaps, texture.generateMipMaps, texture.invertY, false, gpuTextureWrapper.format, 1, this._commandEncoderForCreation, gpuTextureWrapper.textureUsages, gpuTextureWrapper.textureAdditionalUsages, texture.label);\n            gpuTextureWrapper.set(gpuTexture);\n            const arrayLayerCount = texture.is3D ? 1 : layerCount;\n            const format = WebGPUTextureHelper.GetDepthFormatOnly(gpuTextureWrapper.format);\n            const aspect = WebGPUTextureHelper.HasDepthAndStencilAspects(gpuTextureWrapper.format) ? \"depth-only\" /* WebGPUConstants.TextureAspect.DepthOnly */ : \"all\" /* WebGPUConstants.TextureAspect.All */;\n            const dimension = texture.is2DArray ? \"cube-array\" /* WebGPUConstants.TextureViewDimension.CubeArray */ : \"cube\" /* WebGPUConstants.TextureViewDimension.Cube */;\n            gpuTextureWrapper.createView({\n                label: `BabylonWebGPUDevice${this._engine.uniqueId}_TextureViewCube${texture.is2DArray ? \"_Array\" + arrayLayerCount : \"\"}_${width}x${height}_${hasMipMaps ? \"wmips\" : \"womips\"}_${format}_${dimension}_${aspect}_${texture.label ?? \"noname\"}`,\n                format,\n                dimension,\n                mipLevelCount: mipmapCount,\n                baseArrayLayer: 0,\n                baseMipLevel: 0,\n                arrayLayerCount: 6,\n                aspect,\n            }, isStorageTexture);\n        }\n        else {\n            const gpuTexture = this.createTexture({ width, height, layers: layerCount }, texture.generateMipMaps, texture.generateMipMaps, texture.invertY, false, texture.is3D, gpuTextureWrapper.format, 1, this._commandEncoderForCreation, gpuTextureWrapper.textureUsages, gpuTextureWrapper.textureAdditionalUsages, texture.label);\n            gpuTextureWrapper.set(gpuTexture);\n            const arrayLayerCount = texture.is3D ? 1 : layerCount;\n            const format = WebGPUTextureHelper.GetDepthFormatOnly(gpuTextureWrapper.format);\n            const aspect = WebGPUTextureHelper.HasDepthAndStencilAspects(gpuTextureWrapper.format) ? \"depth-only\" /* WebGPUConstants.TextureAspect.DepthOnly */ : \"all\" /* WebGPUConstants.TextureAspect.All */;\n            const dimension = texture.is2DArray\n                ? \"2d-array\" /* WebGPUConstants.TextureViewDimension.E2dArray */\n                : texture.is3D\n                    ? \"3d\" /* WebGPUConstants.TextureDimension.E3d */\n                    : \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */;\n            gpuTextureWrapper.createView({\n                label: `BabylonWebGPUDevice${this._engine.uniqueId}_TextureView${texture.is3D ? \"3D\" : \"2D\"}${texture.is2DArray ? \"_Array\" + arrayLayerCount : \"\"}_${width}x${height}${texture.is3D ? \"x\" + layerCount : \"\"}_${hasMipMaps ? \"wmips\" : \"womips\"}_${format}_${dimension}_${aspect}_${texture.label ?? \"noname\"}`,\n                format,\n                dimension,\n                mipLevelCount: mipmapCount,\n                baseArrayLayer: 0,\n                baseMipLevel: 0,\n                arrayLayerCount,\n                aspect,\n            }, isStorageTexture);\n        }\n        texture.width = texture.baseWidth = width;\n        texture.height = texture.baseHeight = height;\n        texture.depth = texture.baseDepth = depth;\n        if (!dontCreateMSAATexture) {\n            this.createMSAATexture(texture, texture.samples);\n        }\n        return gpuTextureWrapper;\n    }\n    createMSAATexture(texture, samples, releaseExisting = true, index = 0) {\n        const gpuTextureWrapper = texture._hardwareTexture;\n        if (releaseExisting) {\n            gpuTextureWrapper?.releaseMSAATexture();\n        }\n        if (!gpuTextureWrapper || (samples ?? 1) <= 1) {\n            return;\n        }\n        const width = texture.width;\n        const height = texture.height;\n        const gpuMSAATexture = this.createTexture({ width, height, layers: 1 }, false, false, false, false, false, gpuTextureWrapper.format, samples, this._commandEncoderForCreation, 16 /* WebGPUConstants.TextureUsage.RenderAttachment */, 0, texture.label ? \"MSAA_\" + texture.label : \"MSAA\");\n        gpuTextureWrapper.setMSAATexture(gpuMSAATexture, index);\n    }\n    //------------------------------------------------------------------------------\n    //                                  Update\n    //------------------------------------------------------------------------------\n    updateCubeTextures(imageBitmaps, gpuTexture, width, height, format, invertY = false, premultiplyAlpha = false, offsetX = 0, offsetY = 0) {\n        const faces = [0, 3, 1, 4, 2, 5];\n        for (let f = 0; f < faces.length; ++f) {\n            const imageBitmap = imageBitmaps[faces[f]];\n            this.updateTexture(imageBitmap, gpuTexture, width, height, 1, format, f, 0, invertY, premultiplyAlpha, offsetX, offsetY);\n        }\n    }\n    // TODO WEBGPU handle data source not being in the same format than the destination texture?\n    updateTexture(imageBitmap, texture, width, height, layers, format, faceIndex = 0, mipLevel = 0, invertY = false, premultiplyAlpha = false, offsetX = 0, offsetY = 0, allowGPUOptimization) {\n        const gpuTexture = WebGPUTextureHelper.IsInternalTexture(texture) ? texture._hardwareTexture.underlyingResource : texture;\n        const blockInformation = WebGPUTextureHelper.GetBlockInformationFromFormat(format);\n        const gpuOrHdwTexture = WebGPUTextureHelper.IsInternalTexture(texture) ? texture._hardwareTexture : texture;\n        const textureCopyView = {\n            texture: gpuTexture,\n            origin: {\n                x: offsetX,\n                y: offsetY,\n                z: Math.max(faceIndex, 0),\n            },\n            mipLevel: mipLevel,\n            premultipliedAlpha: premultiplyAlpha,\n        };\n        const textureExtent = {\n            width: Math.ceil(width / blockInformation.width) * blockInformation.width,\n            height: Math.ceil(height / blockInformation.height) * blockInformation.height,\n            depthOrArrayLayers: layers || 1,\n        };\n        if (imageBitmap.byteLength !== undefined) {\n            imageBitmap = imageBitmap;\n            const bytesPerRow = Math.ceil(width / blockInformation.width) * blockInformation.length;\n            const aligned = Math.ceil(bytesPerRow / 256) * 256 === bytesPerRow;\n            if (aligned) {\n                const commandEncoder = this._device.createCommandEncoder({});\n                const buffer = this._bufferManager.createRawBuffer(imageBitmap.byteLength, WebGPUConstants.BufferUsage.MapWrite | WebGPUConstants.BufferUsage.CopySrc, true, \"TempBufferForUpdateTexture\" + (gpuTexture ? \"_\" + gpuTexture.label : \"\"));\n                const arrayBuffer = buffer.getMappedRange();\n                new Uint8Array(arrayBuffer).set(imageBitmap);\n                buffer.unmap();\n                commandEncoder.copyBufferToTexture({\n                    buffer: buffer,\n                    offset: 0,\n                    bytesPerRow,\n                    rowsPerImage: height,\n                }, textureCopyView, textureExtent);\n                this._device.queue.submit([commandEncoder.finish()]);\n                this._bufferManager.releaseBuffer(buffer);\n            }\n            else {\n                this._device.queue.writeTexture(textureCopyView, imageBitmap, {\n                    offset: 0,\n                    bytesPerRow,\n                    rowsPerImage: height,\n                }, textureExtent);\n            }\n            if (invertY || premultiplyAlpha) {\n                if (WebGPUTextureHelper.IsInternalTexture(texture)) {\n                    const dontUseRect = offsetX === 0 && offsetY === 0 && width === texture.width && height === texture.height;\n                    this.invertYPreMultiplyAlpha(gpuOrHdwTexture, texture.width, texture.height, format, invertY, premultiplyAlpha, faceIndex, mipLevel, layers || 1, offsetX, offsetY, dontUseRect ? 0 : width, dontUseRect ? 0 : height, undefined, allowGPUOptimization);\n                }\n                else {\n                    // we should never take this code path\n                    // eslint-disable-next-line no-throw-literal\n                    throw \"updateTexture: Can't process the texture data because a GPUTexture was provided instead of an InternalTexture!\";\n                }\n            }\n        }\n        else {\n            imageBitmap = imageBitmap;\n            this._device.queue.copyExternalImageToTexture({ source: imageBitmap, flipY: invertY }, textureCopyView, textureExtent);\n        }\n    }\n    readPixels(texture, x, y, width, height, format, faceIndex = 0, mipLevel = 0, buffer = null, noDataConversion = false) {\n        const blockInformation = WebGPUTextureHelper.GetBlockInformationFromFormat(format);\n        const bytesPerRow = Math.ceil(width / blockInformation.width) * blockInformation.length;\n        const bytesPerRowAligned = Math.ceil(bytesPerRow / 256) * 256;\n        const size = bytesPerRowAligned * height;\n        const gpuBuffer = this._bufferManager.createRawBuffer(size, WebGPUConstants.BufferUsage.MapRead | WebGPUConstants.BufferUsage.CopyDst, undefined, \"TempBufferForReadPixels\" + (texture.label ? \"_\" + texture.label : \"\"));\n        const commandEncoder = this._device.createCommandEncoder({});\n        commandEncoder.copyTextureToBuffer({\n            texture,\n            mipLevel,\n            origin: {\n                x,\n                y,\n                z: Math.max(faceIndex, 0),\n            },\n        }, {\n            buffer: gpuBuffer,\n            offset: 0,\n            bytesPerRow: bytesPerRowAligned,\n        }, {\n            width,\n            height,\n            depthOrArrayLayers: 1,\n        });\n        this._device.queue.submit([commandEncoder.finish()]);\n        return this._bufferManager.readDataFromBuffer(gpuBuffer, size, width, height, bytesPerRow, bytesPerRowAligned, WebGPUTextureHelper.GetTextureTypeFromFormat(format), 0, buffer, true, noDataConversion);\n    }\n    //------------------------------------------------------------------------------\n    //                              Dispose\n    //------------------------------------------------------------------------------\n    releaseTexture(texture) {\n        if (WebGPUTextureHelper.IsInternalTexture(texture)) {\n            const hardwareTexture = texture._hardwareTexture;\n            const irradianceTexture = texture._irradianceTexture;\n            // We can't destroy the objects just now because they could be used in the current frame - we delay the destroying after the end of the frame\n            this._deferredReleaseTextures.push([hardwareTexture, irradianceTexture]);\n        }\n        else {\n            this._deferredReleaseTextures.push([texture, null]);\n        }\n    }\n    destroyDeferredTextures() {\n        for (let i = 0; i < this._deferredReleaseTextures.length; ++i) {\n            const [hardwareTexture, irradianceTexture] = this._deferredReleaseTextures[i];\n            if (hardwareTexture) {\n                if (WebGPUTextureHelper.IsHardwareTexture(hardwareTexture)) {\n                    hardwareTexture.release();\n                }\n                else {\n                    hardwareTexture.destroy();\n                }\n            }\n            irradianceTexture?.dispose();\n        }\n        this._deferredReleaseTextures.length = 0;\n    }\n}\n//# sourceMappingURL=webgpuTextureManager.js.map","import { DataBuffer } from \"../../Buffers/dataBuffer.js\";\n/** @internal */\nexport class WebGPUDataBuffer extends DataBuffer {\n    set buffer(buffer) {\n        this._buffer = buffer;\n    }\n    constructor(resource, capacity = 0) {\n        super();\n        // Used to make sure the buffer is not recreated twice after a context loss/restoration\n        this.engineId = -1;\n        this.capacity = capacity;\n        if (resource) {\n            this._buffer = resource;\n        }\n    }\n    get underlyingResource() {\n        return this._buffer;\n    }\n}\n//# sourceMappingURL=webgpuDataBuffer.js.map","import { WebGPUDataBuffer } from \"../../Meshes/WebGPU/webgpuDataBuffer.js\";\nimport { FromHalfFloat } from \"../../Misc/textureTools.js\";\nimport { allocateAndCopyTypedBuffer } from \"../abstractEngine.functions.js\";\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nimport * as WebGPUConstants from \"./webgpuConstants.js\";\n/** @internal */\nexport class WebGPUBufferManager {\n    static _IsGPUBuffer(buffer) {\n        return buffer.underlyingResource === undefined;\n    }\n    static _FlagsToString(flags, suffix = \"\") {\n        let result = suffix;\n        for (let i = 0; i <= 9; ++i) {\n            if (flags & (1 << i)) {\n                if (result) {\n                    result += \"_\";\n                }\n                result += WebGPUConstants.BufferUsage[1 << i];\n            }\n        }\n        return result;\n    }\n    constructor(engine, device) {\n        this._deferredReleaseBuffers = [];\n        this._engine = engine;\n        this._device = device;\n    }\n    createRawBuffer(viewOrSize, flags, mappedAtCreation = false, label) {\n        const alignedLength = viewOrSize.byteLength !== undefined ? (viewOrSize.byteLength + 3) & ~3 : (viewOrSize + 3) & ~3; // 4 bytes alignments (because of the upload which requires this)\n        const verticesBufferDescriptor = {\n            label: \"BabylonWebGPUDevice\" + this._engine.uniqueId + \"_\" + WebGPUBufferManager._FlagsToString(flags, label ?? \"Buffer\") + \"_size\" + alignedLength,\n            mappedAtCreation,\n            size: alignedLength,\n            usage: flags,\n        };\n        return this._device.createBuffer(verticesBufferDescriptor);\n    }\n    createBuffer(viewOrSize, flags, label) {\n        const isView = viewOrSize.byteLength !== undefined;\n        const dataBuffer = new WebGPUDataBuffer();\n        const labelId = \"DataBufferUniqueId=\" + dataBuffer.uniqueId;\n        dataBuffer.buffer = this.createRawBuffer(viewOrSize, flags, undefined, label ? labelId + \"-\" + label : labelId);\n        dataBuffer.references = 1;\n        dataBuffer.capacity = isView ? viewOrSize.byteLength : viewOrSize;\n        dataBuffer.engineId = this._engine.uniqueId;\n        if (isView) {\n            this.setSubData(dataBuffer, 0, viewOrSize);\n        }\n        return dataBuffer;\n    }\n    // This calls GPUBuffer.writeBuffer() with no alignment corrections\n    // dstByteOffset and byteLength must both be aligned to 4 bytes and bytes moved must be within src and dst arrays\n    setRawData(buffer, dstByteOffset, src, srcByteOffset, byteLength) {\n        srcByteOffset += src.byteOffset;\n        this._device.queue.writeBuffer(buffer, dstByteOffset, src.buffer, srcByteOffset, byteLength);\n    }\n    // This calls GPUBuffer.writeBuffer() with alignment corrections (dstByteOffset and byteLength will be aligned to 4 byte boundaries)\n    // If alignment is needed, src must be a full copy of dataBuffer, or at least should be large enough to cope with the additional bytes copied because of alignment!\n    setSubData(dataBuffer, dstByteOffset, src, srcByteOffset = 0, byteLength = 0) {\n        const buffer = dataBuffer.underlyingResource;\n        byteLength = byteLength || src.byteLength - srcByteOffset;\n        // Make sure the dst offset is aligned to 4 bytes\n        const startPre = dstByteOffset & 3;\n        srcByteOffset -= startPre;\n        dstByteOffset -= startPre;\n        // Make sure the byte length is aligned to 4 bytes\n        const originalByteLength = byteLength;\n        byteLength = (byteLength + startPre + 3) & ~3;\n        // Check if the backing buffer of src is large enough to cope with the additional bytes copied because of alignment\n        const backingBufferSize = src.buffer.byteLength - src.byteOffset;\n        if (backingBufferSize < byteLength) {\n            // Not enough place in the backing buffer for the aligned copy.\n            // Creates a new buffer and copy the source data to it.\n            // The buffer will have byteLength - originalByteLength zeros at the end.\n            const tmpBuffer = new Uint8Array(byteLength);\n            tmpBuffer.set(new Uint8Array(src.buffer, src.byteOffset + srcByteOffset, originalByteLength));\n            src = tmpBuffer;\n            srcByteOffset = 0;\n        }\n        this.setRawData(buffer, dstByteOffset, src, srcByteOffset, byteLength);\n    }\n    _getHalfFloatAsFloatRGBAArrayBuffer(dataLength, arrayBuffer, destArray) {\n        if (!destArray) {\n            destArray = new Float32Array(dataLength);\n        }\n        const srcData = new Uint16Array(arrayBuffer);\n        while (dataLength--) {\n            destArray[dataLength] = FromHalfFloat(srcData[dataLength]);\n        }\n        return destArray;\n    }\n    readDataFromBuffer(gpuBuffer, size, width, height, bytesPerRow, bytesPerRowAligned, type = 0, offset = 0, buffer = null, destroyBuffer = true, noDataConversion = false) {\n        const floatFormat = type === 1 ? 2 : type === 2 ? 1 : 0;\n        const engineId = this._engine.uniqueId;\n        return new Promise((resolve, reject) => {\n            gpuBuffer.mapAsync(1 /* WebGPUConstants.MapMode.Read */, offset, size).then(() => {\n                const copyArrayBuffer = gpuBuffer.getMappedRange(offset, size);\n                let data = buffer;\n                if (noDataConversion) {\n                    if (data === null) {\n                        data = allocateAndCopyTypedBuffer(type, size, true, copyArrayBuffer);\n                    }\n                    else {\n                        data = allocateAndCopyTypedBuffer(type, data.buffer, undefined, copyArrayBuffer);\n                    }\n                }\n                else {\n                    if (data === null) {\n                        switch (floatFormat) {\n                            case 0: // byte format\n                                data = new Uint8Array(size);\n                                data.set(new Uint8Array(copyArrayBuffer));\n                                break;\n                            case 1: // half float\n                                // TODO WEBGPU use computer shaders (or render pass) to make the conversion?\n                                data = this._getHalfFloatAsFloatRGBAArrayBuffer(size / 2, copyArrayBuffer);\n                                break;\n                            case 2: // float\n                                data = new Float32Array(size / 4);\n                                data.set(new Float32Array(copyArrayBuffer));\n                                break;\n                        }\n                    }\n                    else {\n                        switch (floatFormat) {\n                            case 0: // byte format\n                                data = new Uint8Array(data.buffer);\n                                data.set(new Uint8Array(copyArrayBuffer));\n                                break;\n                            case 1: // half float\n                                // TODO WEBGPU use computer shaders (or render pass) to make the conversion?\n                                data = this._getHalfFloatAsFloatRGBAArrayBuffer(size / 2, copyArrayBuffer, buffer);\n                                break;\n                            case 2: // float\n                                data = new Float32Array(data.buffer);\n                                data.set(new Float32Array(copyArrayBuffer));\n                                break;\n                        }\n                    }\n                }\n                if (bytesPerRow !== bytesPerRowAligned) {\n                    // TODO WEBGPU use computer shaders (or render pass) to build the final buffer data?\n                    if (floatFormat === 1 && !noDataConversion) {\n                        // half float have been converted to float above\n                        bytesPerRow *= 2;\n                        bytesPerRowAligned *= 2;\n                    }\n                    const data2 = new Uint8Array(data.buffer);\n                    let offset = bytesPerRow, offset2 = 0;\n                    for (let y = 1; y < height; ++y) {\n                        offset2 = y * bytesPerRowAligned;\n                        for (let x = 0; x < bytesPerRow; ++x) {\n                            data2[offset++] = data2[offset2++];\n                        }\n                    }\n                    if (floatFormat !== 0 && !noDataConversion) {\n                        data = new Float32Array(data2.buffer, 0, offset / 4);\n                    }\n                    else {\n                        data = new Uint8Array(data2.buffer, 0, offset);\n                    }\n                }\n                gpuBuffer.unmap();\n                if (destroyBuffer) {\n                    this.releaseBuffer(gpuBuffer);\n                }\n                resolve(data);\n            }, (reason) => {\n                if (this._engine.isDisposed || this._engine.uniqueId !== engineId) {\n                    // The engine was disposed while waiting for the promise, or a context loss/restoration has occurred: don't reject\n                    resolve(new Uint8Array());\n                }\n                else {\n                    reject(reason);\n                }\n            });\n        });\n    }\n    releaseBuffer(buffer) {\n        if (WebGPUBufferManager._IsGPUBuffer(buffer)) {\n            this._deferredReleaseBuffers.push(buffer);\n            return true;\n        }\n        buffer.references--;\n        if (buffer.references === 0) {\n            this._deferredReleaseBuffers.push(buffer.underlyingResource);\n            return true;\n        }\n        return false;\n    }\n    destroyDeferredBuffers() {\n        for (let i = 0; i < this._deferredReleaseBuffers.length; ++i) {\n            this._deferredReleaseBuffers[i].destroy();\n        }\n        this._deferredReleaseBuffers.length = 0;\n    }\n}\n//# sourceMappingURL=webgpuBufferManager.js.map","\nconst filterToBits = [\n    0 | (0 << 1) | (0 << 2), // not used\n    0 | (0 << 1) | (0 << 2), // TEXTURE_NEAREST_SAMPLINGMODE / TEXTURE_NEAREST_NEAREST\n    1 | (1 << 1) | (0 << 2), // TEXTURE_BILINEAR_SAMPLINGMODE / TEXTURE_LINEAR_LINEAR\n    1 | (1 << 1) | (1 << 2), // TEXTURE_TRILINEAR_SAMPLINGMODE / TEXTURE_LINEAR_LINEAR_MIPLINEAR\n    0 | (0 << 1) | (0 << 2), // TEXTURE_NEAREST_NEAREST_MIPNEAREST\n    0 | (1 << 1) | (0 << 2), // TEXTURE_NEAREST_LINEAR_MIPNEAREST\n    0 | (1 << 1) | (1 << 2), // TEXTURE_NEAREST_LINEAR_MIPLINEAR\n    0 | (1 << 1) | (0 << 2), // TEXTURE_NEAREST_LINEAR\n    0 | (0 << 1) | (1 << 2), // TEXTURE_NEAREST_NEAREST_MIPLINEAR\n    1 | (0 << 1) | (0 << 2), // TEXTURE_LINEAR_NEAREST_MIPNEAREST\n    1 | (0 << 1) | (1 << 2), // TEXTURE_LINEAR_NEAREST_MIPLINEAR\n    1 | (1 << 1) | (0 << 2), // TEXTURE_LINEAR_LINEAR_MIPNEAREST\n    1 | (0 << 1) | (0 << 2), // TEXTURE_LINEAR_NEAREST\n];\n// subtract 0x01FF from the comparison function value before indexing this array!\nconst comparisonFunctionToBits = [\n    (0 << 3) | (0 << 4) | (0 << 5) | (0 << 6), // undefined\n    (0 << 3) | (0 << 4) | (0 << 5) | (1 << 6), // NEVER\n    (0 << 3) | (0 << 4) | (1 << 5) | (0 << 6), // LESS\n    (0 << 3) | (0 << 4) | (1 << 5) | (1 << 6), // EQUAL\n    (0 << 3) | (1 << 4) | (0 << 5) | (0 << 6), // LEQUAL\n    (0 << 3) | (1 << 4) | (0 << 5) | (1 << 6), // GREATER\n    (0 << 3) | (1 << 4) | (1 << 5) | (0 << 6), // NOTEQUAL\n    (0 << 3) | (1 << 4) | (1 << 5) | (1 << 6), // GEQUAL\n    (1 << 3) | (0 << 4) | (0 << 5) | (0 << 6), // ALWAYS\n];\nconst filterNoMipToBits = [\n    0 << 7, // not used\n    1 << 7, // TEXTURE_NEAREST_SAMPLINGMODE / TEXTURE_NEAREST_NEAREST\n    1 << 7, // TEXTURE_BILINEAR_SAMPLINGMODE / TEXTURE_LINEAR_LINEAR\n    0 << 7, // TEXTURE_TRILINEAR_SAMPLINGMODE / TEXTURE_LINEAR_LINEAR_MIPLINEAR\n    0 << 7, // TEXTURE_NEAREST_NEAREST_MIPNEAREST\n    0 << 7, // TEXTURE_NEAREST_LINEAR_MIPNEAREST\n    0 << 7, // TEXTURE_NEAREST_LINEAR_MIPLINEAR\n    1 << 7, // TEXTURE_NEAREST_LINEAR\n    0 << 7, // TEXTURE_NEAREST_NEAREST_MIPLINEAR\n    0 << 7, // TEXTURE_LINEAR_NEAREST_MIPNEAREST\n    0 << 7, // TEXTURE_LINEAR_NEAREST_MIPLINEAR\n    0 << 7, // TEXTURE_LINEAR_LINEAR_MIPNEAREST\n    1 << 7, // TEXTURE_LINEAR_NEAREST\n];\n/** @internal */\nexport class WebGPUCacheSampler {\n    constructor(device) {\n        this._samplers = {};\n        this._device = device;\n        this.disabled = false;\n    }\n    static GetSamplerHashCode(sampler) {\n        // The WebGPU spec currently only allows values 1 and 4 for anisotropy\n        const anisotropy = sampler._cachedAnisotropicFilteringLevel ? sampler._cachedAnisotropicFilteringLevel : 1;\n        const code = filterToBits[sampler.samplingMode] +\n            comparisonFunctionToBits[(sampler._comparisonFunction || 0x0202) - 0x0200 + 1] +\n            filterNoMipToBits[sampler.samplingMode] + // handle the lodMinClamp = lodMaxClamp = 0 case when no filter used for mip mapping\n            ((sampler._cachedWrapU ?? 1) << 8) +\n            ((sampler._cachedWrapV ?? 1) << 10) +\n            ((sampler._cachedWrapR ?? 1) << 12) +\n            ((sampler.useMipMaps ? 1 : 0) << 14) + // need to factor this in because _getSamplerFilterDescriptor depends on samplingMode AND useMipMaps!\n            (anisotropy << 15);\n        return code;\n    }\n    static _GetSamplerFilterDescriptor(sampler, anisotropy) {\n        let magFilter, minFilter, mipmapFilter, lodMinClamp, lodMaxClamp;\n        const useMipMaps = sampler.useMipMaps;\n        switch (sampler.samplingMode) {\n            case 11:\n                magFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                minFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                if (!useMipMaps) {\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                break;\n            case 3:\n            case 3:\n                magFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                minFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                if (!useMipMaps) {\n                    mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                else {\n                    mipmapFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                }\n                break;\n            case 8:\n                magFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                minFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                if (!useMipMaps) {\n                    mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                else {\n                    mipmapFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                }\n                break;\n            case 4:\n                magFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                minFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                if (!useMipMaps) {\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                break;\n            case 5:\n                magFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                minFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                if (!useMipMaps) {\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                break;\n            case 6:\n                magFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                minFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                if (!useMipMaps) {\n                    mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                else {\n                    mipmapFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                }\n                break;\n            case 7:\n                magFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                minFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                lodMinClamp = lodMaxClamp = 0;\n                break;\n            case 1:\n            case 1:\n                magFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                minFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                lodMinClamp = lodMaxClamp = 0;\n                break;\n            case 9:\n                magFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                minFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                if (!useMipMaps) {\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                break;\n            case 10:\n                magFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                minFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                if (!useMipMaps) {\n                    mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                else {\n                    mipmapFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                }\n                break;\n            case 2:\n            case 2:\n                magFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                minFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                // In WebGL, if sampling mode is TEXTURE_BILINEAR_SAMPLINGMODE and anisotropy is greater than 1, anisotropy is enabled for the sampler\n                if (anisotropy > 1) {\n                    mipmapFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                }\n                else {\n                    mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                    lodMinClamp = lodMaxClamp = 0;\n                }\n                break;\n            case 12:\n                magFilter = \"linear\" /* WebGPUConstants.FilterMode.Linear */;\n                minFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                lodMinClamp = lodMaxClamp = 0;\n                break;\n            default:\n                magFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                minFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                mipmapFilter = \"nearest\" /* WebGPUConstants.FilterMode.Nearest */;\n                lodMinClamp = lodMaxClamp = 0;\n                break;\n        }\n        if (anisotropy > 1 && (lodMinClamp !== 0 || lodMaxClamp !== 0)) {\n            return {\n                magFilter: \"linear\" /* WebGPUConstants.FilterMode.Linear */,\n                minFilter: \"linear\" /* WebGPUConstants.FilterMode.Linear */,\n                mipmapFilter: \"linear\" /* WebGPUConstants.FilterMode.Linear */,\n                anisotropyEnabled: true,\n            };\n        }\n        return {\n            magFilter,\n            minFilter,\n            mipmapFilter,\n            lodMinClamp,\n            lodMaxClamp,\n        };\n    }\n    static _GetWrappingMode(mode) {\n        switch (mode) {\n            case 1:\n                return \"repeat\" /* WebGPUConstants.AddressMode.Repeat */;\n            case 0:\n                return \"clamp-to-edge\" /* WebGPUConstants.AddressMode.ClampToEdge */;\n            case 2:\n                return \"mirror-repeat\" /* WebGPUConstants.AddressMode.MirrorRepeat */;\n        }\n        return \"repeat\" /* WebGPUConstants.AddressMode.Repeat */;\n    }\n    static _GetSamplerWrappingDescriptor(sampler) {\n        return {\n            addressModeU: this._GetWrappingMode(sampler._cachedWrapU),\n            addressModeV: this._GetWrappingMode(sampler._cachedWrapV),\n            addressModeW: this._GetWrappingMode(sampler._cachedWrapR),\n        };\n    }\n    static _GetSamplerDescriptor(sampler, label) {\n        // The check with 2 is to be iso with the WebGL implementation\n        let anisotropy = (sampler.useMipMaps || sampler.samplingMode === 2) && sampler._cachedAnisotropicFilteringLevel\n            ? sampler._cachedAnisotropicFilteringLevel\n            : 1;\n        // To be iso with the WebGL implementation\n        if (sampler.samplingMode !== 11 &&\n            sampler.samplingMode !== 3 &&\n            sampler.samplingMode !== 2) {\n            anisotropy = 1;\n        }\n        const filterDescriptor = this._GetSamplerFilterDescriptor(sampler, anisotropy);\n        return {\n            label,\n            ...filterDescriptor,\n            ...this._GetSamplerWrappingDescriptor(sampler),\n            compare: sampler._comparisonFunction ? WebGPUCacheSampler.GetCompareFunction(sampler._comparisonFunction) : undefined,\n            maxAnisotropy: filterDescriptor.anisotropyEnabled ? anisotropy : 1,\n        };\n    }\n    static GetCompareFunction(compareFunction) {\n        switch (compareFunction) {\n            case 519:\n                return \"always\" /* WebGPUConstants.CompareFunction.Always */;\n            case 514:\n                return \"equal\" /* WebGPUConstants.CompareFunction.Equal */;\n            case 516:\n                return \"greater\" /* WebGPUConstants.CompareFunction.Greater */;\n            case 518:\n                return \"greater-equal\" /* WebGPUConstants.CompareFunction.GreaterEqual */;\n            case 513:\n                return \"less\" /* WebGPUConstants.CompareFunction.Less */;\n            case 515:\n                return \"less-equal\" /* WebGPUConstants.CompareFunction.LessEqual */;\n            case 512:\n                return \"never\" /* WebGPUConstants.CompareFunction.Never */;\n            case 517:\n                return \"not-equal\" /* WebGPUConstants.CompareFunction.NotEqual */;\n            default:\n                return \"less\" /* WebGPUConstants.CompareFunction.Less */;\n        }\n    }\n    getSampler(sampler, bypassCache = false, hash = 0, label) {\n        if (this.disabled) {\n            return this._device.createSampler(WebGPUCacheSampler._GetSamplerDescriptor(sampler, label));\n        }\n        if (bypassCache) {\n            hash = 0;\n        }\n        else if (hash === 0) {\n            hash = WebGPUCacheSampler.GetSamplerHashCode(sampler);\n        }\n        let gpuSampler = bypassCache ? undefined : this._samplers[hash];\n        if (!gpuSampler) {\n            gpuSampler = this._device.createSampler(WebGPUCacheSampler._GetSamplerDescriptor(sampler, label));\n            if (!bypassCache) {\n                this._samplers[hash] = gpuSampler;\n            }\n        }\n        return gpuSampler;\n    }\n}\n//# sourceMappingURL=webgpuCacheSampler.js.map","import { VertexBuffer } from \"../Meshes/buffer.js\";\nconst vertexBufferKindForNonFloatProcessing = {\n    [VertexBuffer.PositionKind]: true,\n    [VertexBuffer.NormalKind]: true,\n    [VertexBuffer.TangentKind]: true,\n    [VertexBuffer.UVKind]: true,\n    [VertexBuffer.UV2Kind]: true,\n    [VertexBuffer.UV3Kind]: true,\n    [VertexBuffer.UV4Kind]: true,\n    [VertexBuffer.UV5Kind]: true,\n    [VertexBuffer.UV6Kind]: true,\n    [VertexBuffer.ColorKind]: true,\n    [VertexBuffer.ColorInstanceKind]: true,\n    [VertexBuffer.MatricesIndicesKind]: true,\n    [VertexBuffer.MatricesWeightsKind]: true,\n    [VertexBuffer.MatricesIndicesExtraKind]: true,\n    [VertexBuffer.MatricesWeightsExtraKind]: true,\n};\n/**\n * Indicates if the type is a signed or unsigned type\n * @param type Type to check\n * @returns True if it is a signed type\n */\nfunction isSignedType(type) {\n    switch (type) {\n        case VertexBuffer.BYTE:\n        case VertexBuffer.SHORT:\n        case VertexBuffer.INT:\n        case VertexBuffer.FLOAT:\n            return true;\n        case VertexBuffer.UNSIGNED_BYTE:\n        case VertexBuffer.UNSIGNED_SHORT:\n        case VertexBuffer.UNSIGNED_INT:\n            return false;\n        default:\n            throw new Error(`Invalid type '${type}'`);\n    }\n}\n/**\n * Checks whether some vertex buffers that should be of type float are of a different type (int, byte...).\n * If so, trigger a shader recompilation to give the shader processor the opportunity to update the code accordingly.\n * @param vertexBuffers List of vertex buffers to check\n * @param effect The effect (shaders) that should be recompiled if needed\n */\nexport function checkNonFloatVertexBuffers(vertexBuffers, effect) {\n    const engine = effect.getEngine();\n    const pipelineContext = effect._pipelineContext;\n    if (!pipelineContext?.vertexBufferKindToType) {\n        return;\n    }\n    let shaderProcessingContext = null;\n    for (const kind in vertexBuffers) {\n        const currentVertexBuffer = vertexBuffers[kind];\n        if (!currentVertexBuffer || !vertexBufferKindForNonFloatProcessing[kind]) {\n            continue;\n        }\n        const currentVertexBufferType = currentVertexBuffer.normalized ? VertexBuffer.FLOAT : currentVertexBuffer.type;\n        const vertexBufferType = pipelineContext.vertexBufferKindToType[kind];\n        if ((currentVertexBufferType !== VertexBuffer.FLOAT && vertexBufferType === undefined) ||\n            (vertexBufferType !== undefined && vertexBufferType !== currentVertexBufferType)) {\n            if (!shaderProcessingContext) {\n                shaderProcessingContext = engine._getShaderProcessingContext(effect.shaderLanguage, false);\n            }\n            pipelineContext.vertexBufferKindToType[kind] = currentVertexBufferType;\n            if (currentVertexBufferType !== VertexBuffer.FLOAT) {\n                shaderProcessingContext.vertexBufferKindToNumberOfComponents[kind] = VertexBuffer.DeduceStride(kind);\n                if (isSignedType(currentVertexBufferType)) {\n                    shaderProcessingContext.vertexBufferKindToNumberOfComponents[kind] *= -1;\n                }\n            }\n        }\n    }\n    if (shaderProcessingContext) {\n        // We temporarily disable parallel compilation of shaders because we want new shaders to be compiled after the _processShaderCode call, so that they are in effect for the rest of the frame.\n        // There is no additional call to async so the _processShaderCodeAsync will execute synchronously.\n        const parallelShaderCompile = engine._caps.parallelShaderCompile;\n        engine._caps.parallelShaderCompile = undefined;\n        effect._processShaderCodeAsync(null, engine._features._checkNonFloatVertexBuffersDontRecreatePipelineContext, shaderProcessingContext);\n        engine._caps.parallelShaderCompile = parallelShaderCompile;\n    }\n}\n//# sourceMappingURL=buffer.nonFloatVertexBuffers.js.map","/* eslint-disable @typescript-eslint/naming-convention */\n/* eslint-disable babylonjs/available */\n/* eslint-disable jsdoc/require-jsdoc */\n\nimport { VertexBuffer } from \"../../Buffers/buffer.js\";\nimport { WebGPUTextureHelper } from \"./webgpuTextureHelper.js\";\nimport { renderableTextureFormatToIndex } from \"./webgpuTextureManager.js\";\nimport { checkNonFloatVertexBuffers } from \"../../Buffers/buffer.nonFloatVertexBuffers.js\";\nimport { Logger } from \"../../Misc/logger.js\";\nvar StatePosition;\n(function (StatePosition) {\n    StatePosition[StatePosition[\"StencilReadMask\"] = 0] = \"StencilReadMask\";\n    StatePosition[StatePosition[\"StencilWriteMask\"] = 1] = \"StencilWriteMask\";\n    //DepthBiasClamp = 1, // not used, so remove it to improve perf\n    StatePosition[StatePosition[\"DepthBias\"] = 2] = \"DepthBias\";\n    StatePosition[StatePosition[\"DepthBiasSlopeScale\"] = 3] = \"DepthBiasSlopeScale\";\n    StatePosition[StatePosition[\"DepthStencilState\"] = 4] = \"DepthStencilState\";\n    StatePosition[StatePosition[\"MRTAttachments1\"] = 5] = \"MRTAttachments1\";\n    StatePosition[StatePosition[\"MRTAttachments2\"] = 6] = \"MRTAttachments2\";\n    StatePosition[StatePosition[\"RasterizationState\"] = 7] = \"RasterizationState\";\n    StatePosition[StatePosition[\"ColorStates\"] = 8] = \"ColorStates\";\n    StatePosition[StatePosition[\"ShaderStage\"] = 9] = \"ShaderStage\";\n    StatePosition[StatePosition[\"TextureStage\"] = 10] = \"TextureStage\";\n    StatePosition[StatePosition[\"VertexState\"] = 11] = \"VertexState\";\n    StatePosition[StatePosition[\"NumStates\"] = 12] = \"NumStates\";\n})(StatePosition || (StatePosition = {}));\nconst alphaBlendFactorToIndex = {\n    0: 1, // Zero\n    1: 2, // One\n    0x0300: 3, // SrcColor\n    0x0301: 4, // OneMinusSrcColor\n    0x0302: 5, // SrcAlpha\n    0x0303: 6, // OneMinusSrcAlpha\n    0x0304: 7, // DstAlpha\n    0x0305: 8, // OneMinusDstAlpha\n    0x0306: 9, // DstColor\n    0x0307: 10, // OneMinusDstColor\n    0x0308: 11, // SrcAlphaSaturated\n    0x8001: 12, // BlendColor\n    0x8002: 13, // OneMinusBlendColor\n    0x8003: 12, // BlendColor (alpha)\n    0x8004: 13, // OneMinusBlendColor (alpha)\n};\nconst stencilOpToIndex = {\n    0x0000: 0, // ZERO\n    0x1e00: 1, // KEEP\n    0x1e01: 2, // REPLACE\n    0x1e02: 3, // INCR\n    0x1e03: 4, // DECR\n    0x150a: 5, // INVERT\n    0x8507: 6, // INCR_WRAP\n    0x8508: 7, // DECR_WRAP\n};\n/** @internal */\nexport class WebGPUCacheRenderPipeline {\n    constructor(device, emptyVertexBuffer) {\n        this.mrtTextureCount = 0;\n        this._device = device;\n        this._useTextureStage = true; // we force usage because we must handle depth textures with \"float\" filtering, which can't be fixed by a caps (like \"textureFloatLinearFiltering\" can for float textures)\n        this._states = new Array(30); // pre-allocate enough room so that no new allocation will take place afterwards\n        this._statesLength = 0;\n        this._stateDirtyLowestIndex = 0;\n        this._emptyVertexBuffer = emptyVertexBuffer;\n        this._mrtFormats = [];\n        this._parameter = { token: undefined, pipeline: null };\n        this.disabled = false;\n        this.vertexBuffers = [];\n        this._kMaxVertexBufferStride = device.limits.maxVertexBufferArrayStride || 2048;\n        this.reset();\n    }\n    reset() {\n        this._isDirty = true;\n        this.vertexBuffers.length = 0;\n        this.setAlphaToCoverage(false);\n        this.resetDepthCullingState();\n        this.setClampDepth(false);\n        this.setDepthBias(0);\n        //this.setDepthBiasClamp(0);\n        this._webgpuColorFormat = [\"bgra8unorm\" /* WebGPUConstants.TextureFormat.BGRA8Unorm */];\n        this.setColorFormat(\"bgra8unorm\" /* WebGPUConstants.TextureFormat.BGRA8Unorm */);\n        this.setMRT([]);\n        this.setAlphaBlendEnabled(false);\n        this.setAlphaBlendFactors([null, null, null, null], [null, null]);\n        this.setWriteMask(0xf);\n        this.setDepthStencilFormat(\"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */);\n        this.setStencilEnabled(false);\n        this.resetStencilState();\n        this.setBuffers(null, null, null);\n        this._setTextureState(0);\n    }\n    get colorFormats() {\n        return this._mrtAttachments1 > 0 ? this._mrtFormats : this._webgpuColorFormat;\n    }\n    getRenderPipeline(fillMode, effect, sampleCount, textureState = 0) {\n        sampleCount = WebGPUTextureHelper.GetSample(sampleCount);\n        if (this.disabled) {\n            const topology = WebGPUCacheRenderPipeline._GetTopology(fillMode);\n            this._setVertexState(effect); // to fill this.vertexBuffers with correct data\n            this._setTextureState(textureState);\n            this._parameter.pipeline = this._createRenderPipeline(effect, topology, sampleCount);\n            WebGPUCacheRenderPipeline.NumCacheMiss++;\n            WebGPUCacheRenderPipeline._NumPipelineCreationCurrentFrame++;\n            return this._parameter.pipeline;\n        }\n        this._setShaderStage(effect.uniqueId);\n        this._setRasterizationState(fillMode, sampleCount);\n        this._setColorStates();\n        this._setDepthStencilState();\n        this._setVertexState(effect);\n        this._setTextureState(textureState);\n        this.lastStateDirtyLowestIndex = this._stateDirtyLowestIndex;\n        if (!this._isDirty && this._parameter.pipeline) {\n            this._stateDirtyLowestIndex = this._statesLength;\n            WebGPUCacheRenderPipeline.NumCacheHitWithoutHash++;\n            return this._parameter.pipeline;\n        }\n        this._getRenderPipeline(this._parameter);\n        this._isDirty = false;\n        this._stateDirtyLowestIndex = this._statesLength;\n        if (this._parameter.pipeline) {\n            WebGPUCacheRenderPipeline.NumCacheHitWithHash++;\n            return this._parameter.pipeline;\n        }\n        const topology = WebGPUCacheRenderPipeline._GetTopology(fillMode);\n        this._parameter.pipeline = this._createRenderPipeline(effect, topology, sampleCount);\n        this._setRenderPipeline(this._parameter);\n        WebGPUCacheRenderPipeline.NumCacheMiss++;\n        WebGPUCacheRenderPipeline._NumPipelineCreationCurrentFrame++;\n        return this._parameter.pipeline;\n    }\n    endFrame() {\n        WebGPUCacheRenderPipeline.NumPipelineCreationLastFrame = WebGPUCacheRenderPipeline._NumPipelineCreationCurrentFrame;\n        WebGPUCacheRenderPipeline._NumPipelineCreationCurrentFrame = 0;\n    }\n    setAlphaToCoverage(enabled) {\n        this._alphaToCoverageEnabled = enabled;\n    }\n    setFrontFace(frontFace) {\n        this._frontFace = frontFace;\n    }\n    setCullEnabled(enabled) {\n        this._cullEnabled = enabled;\n    }\n    setCullFace(cullFace) {\n        this._cullFace = cullFace;\n    }\n    setClampDepth(clampDepth) {\n        this._clampDepth = clampDepth;\n    }\n    resetDepthCullingState() {\n        this.setDepthCullingState(false, 2, 1, 0, 0, true, true, 519);\n    }\n    setDepthCullingState(cullEnabled, frontFace, cullFace, zOffset, zOffsetUnits, depthTestEnabled, depthWriteEnabled, depthCompare) {\n        this._depthWriteEnabled = depthWriteEnabled;\n        this._depthTestEnabled = depthTestEnabled;\n        this._depthCompare = (depthCompare ?? 519) - 0x0200;\n        this._cullFace = cullFace;\n        this._cullEnabled = cullEnabled;\n        this._frontFace = frontFace;\n        this.setDepthBiasSlopeScale(zOffset);\n        this.setDepthBias(zOffsetUnits);\n    }\n    setDepthBias(depthBias) {\n        if (this._depthBias !== depthBias) {\n            this._depthBias = depthBias;\n            this._states[StatePosition.DepthBias] = depthBias;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.DepthBias);\n        }\n    }\n    /*public setDepthBiasClamp(depthBiasClamp: number): void {\n        if (this._depthBiasClamp !== depthBiasClamp) {\n            this._depthBiasClamp = depthBiasClamp;\n            this._states[StatePosition.DepthBiasClamp] = depthBiasClamp.toString();\n            this._isDirty = true;\n        }\n    }*/\n    setDepthBiasSlopeScale(depthBiasSlopeScale) {\n        if (this._depthBiasSlopeScale !== depthBiasSlopeScale) {\n            this._depthBiasSlopeScale = depthBiasSlopeScale;\n            this._states[StatePosition.DepthBiasSlopeScale] = depthBiasSlopeScale;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.DepthBiasSlopeScale);\n        }\n    }\n    setColorFormat(format) {\n        this._webgpuColorFormat[0] = format;\n        this._colorFormat = renderableTextureFormatToIndex[format ?? \"\"];\n    }\n    setMRTAttachments(attachments) {\n        this.mrtAttachments = attachments;\n        let mask = 0;\n        for (let i = 0; i < attachments.length; ++i) {\n            if (attachments[i] !== 0) {\n                mask += 1 << i;\n            }\n        }\n        if (this._mrtEnabledMask !== mask) {\n            this._mrtEnabledMask = mask;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.MRTAttachments1);\n        }\n    }\n    setMRT(textureArray, textureCount) {\n        textureCount = textureCount ?? textureArray.length;\n        if (textureCount > 10) {\n            // If we want more than 10 attachments we need to change this method (and the StatePosition enum) but 10 seems plenty: note that WebGPU only supports 8 at the time (2021/12/13)!\n            // As we need ~39 different values we are using 6 bits to encode a texture format, meaning we can encode 5 texture formats in 32 bits\n            // We are using 2x32 bit values to handle 10 textures\n            // eslint-disable-next-line no-throw-literal\n            throw \"Can't handle more than 10 attachments for a MRT in cache render pipeline!\";\n        }\n        this.mrtTextureArray = textureArray;\n        this.mrtTextureCount = textureCount;\n        this._mrtEnabledMask = 0xffff; // all textures are enabled at start (meaning we can write to them). Calls to setMRTAttachments may disable some\n        const bits = [0, 0];\n        let indexBits = 0, mask = 0, numRT = 0;\n        for (let i = 0; i < textureCount; ++i) {\n            const texture = textureArray[i];\n            const gpuWrapper = texture?._hardwareTexture;\n            this._mrtFormats[numRT] = gpuWrapper?.format ?? this._webgpuColorFormat[0];\n            bits[indexBits] += renderableTextureFormatToIndex[this._mrtFormats[numRT] ?? \"\"] << mask;\n            mask += 6;\n            numRT++;\n            if (mask >= 32) {\n                mask = 0;\n                indexBits++;\n            }\n        }\n        this._mrtFormats.length = numRT;\n        if (this._mrtAttachments1 !== bits[0] || this._mrtAttachments2 !== bits[1]) {\n            this._mrtAttachments1 = bits[0];\n            this._mrtAttachments2 = bits[1];\n            this._states[StatePosition.MRTAttachments1] = bits[0];\n            this._states[StatePosition.MRTAttachments2] = bits[1];\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.MRTAttachments1);\n        }\n    }\n    setAlphaBlendEnabled(enabled) {\n        this._alphaBlendEnabled = enabled;\n    }\n    setAlphaBlendFactors(factors, operations) {\n        this._alphaBlendFuncParams = factors;\n        this._alphaBlendEqParams = operations;\n    }\n    setWriteMask(mask) {\n        this._writeMask = mask;\n    }\n    setDepthStencilFormat(format) {\n        this._webgpuDepthStencilFormat = format;\n        this._depthStencilFormat = format === undefined ? 0 : renderableTextureFormatToIndex[format];\n    }\n    setDepthTestEnabled(enabled) {\n        this._depthTestEnabled = enabled;\n    }\n    setDepthWriteEnabled(enabled) {\n        this._depthWriteEnabled = enabled;\n    }\n    setDepthCompare(func) {\n        this._depthCompare = (func ?? 519) - 0x0200;\n    }\n    setStencilEnabled(enabled) {\n        this._stencilEnabled = enabled;\n    }\n    setStencilCompare(func) {\n        this._stencilFrontCompare = (func ?? 519) - 0x0200;\n    }\n    setStencilDepthFailOp(op) {\n        this._stencilFrontDepthFailOp = op === null ? 1 /* KEEP */ : stencilOpToIndex[op];\n    }\n    setStencilPassOp(op) {\n        this._stencilFrontPassOp = op === null ? 2 /* REPLACE */ : stencilOpToIndex[op];\n    }\n    setStencilFailOp(op) {\n        this._stencilFrontFailOp = op === null ? 1 /* KEEP */ : stencilOpToIndex[op];\n    }\n    setStencilReadMask(mask) {\n        if (this._stencilReadMask !== mask) {\n            this._stencilReadMask = mask;\n            this._states[StatePosition.StencilReadMask] = mask;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.StencilReadMask);\n        }\n    }\n    setStencilWriteMask(mask) {\n        if (this._stencilWriteMask !== mask) {\n            this._stencilWriteMask = mask;\n            this._states[StatePosition.StencilWriteMask] = mask;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.StencilWriteMask);\n        }\n    }\n    resetStencilState() {\n        this.setStencilState(false, 519, 7680, 7681, 7680, 0xff, 0xff);\n    }\n    setStencilState(stencilEnabled, compare, depthFailOp, passOp, failOp, readMask, writeMask) {\n        this._stencilEnabled = stencilEnabled;\n        this._stencilFrontCompare = (compare ?? 519) - 0x0200;\n        this._stencilFrontDepthFailOp = depthFailOp === null ? 1 /* KEEP */ : stencilOpToIndex[depthFailOp];\n        this._stencilFrontPassOp = passOp === null ? 2 /* REPLACE */ : stencilOpToIndex[passOp];\n        this._stencilFrontFailOp = failOp === null ? 1 /* KEEP */ : stencilOpToIndex[failOp];\n        this.setStencilReadMask(readMask);\n        this.setStencilWriteMask(writeMask);\n    }\n    setBuffers(vertexBuffers, indexBuffer, overrideVertexBuffers) {\n        this._vertexBuffers = vertexBuffers;\n        this._overrideVertexBuffers = overrideVertexBuffers;\n        this._indexBuffer = indexBuffer;\n    }\n    static _GetTopology(fillMode) {\n        switch (fillMode) {\n            // Triangle views\n            case 0:\n                return \"triangle-list\" /* WebGPUConstants.PrimitiveTopology.TriangleList */;\n            case 2:\n                return \"point-list\" /* WebGPUConstants.PrimitiveTopology.PointList */;\n            case 1:\n                return \"line-list\" /* WebGPUConstants.PrimitiveTopology.LineList */;\n            // Draw modes\n            case 3:\n                return \"point-list\" /* WebGPUConstants.PrimitiveTopology.PointList */;\n            case 4:\n                return \"line-list\" /* WebGPUConstants.PrimitiveTopology.LineList */;\n            case 5:\n                // return this._gl.LINE_LOOP;\n                // TODO WEBGPU. Line Loop Mode Fallback at buffer load time.\n                // eslint-disable-next-line no-throw-literal\n                throw \"LineLoop is an unsupported fillmode in WebGPU\";\n            case 6:\n                return \"line-strip\" /* WebGPUConstants.PrimitiveTopology.LineStrip */;\n            case 7:\n                return \"triangle-strip\" /* WebGPUConstants.PrimitiveTopology.TriangleStrip */;\n            case 8:\n                // return this._gl.TRIANGLE_FAN;\n                // TODO WEBGPU. Triangle Fan Mode Fallback at buffer load time.\n                // eslint-disable-next-line no-throw-literal\n                throw \"TriangleFan is an unsupported fillmode in WebGPU\";\n            default:\n                return \"triangle-list\" /* WebGPUConstants.PrimitiveTopology.TriangleList */;\n        }\n    }\n    static _GetAphaBlendOperation(operation) {\n        switch (operation) {\n            case 32774:\n                return \"add\" /* WebGPUConstants.BlendOperation.Add */;\n            case 32778:\n                return \"subtract\" /* WebGPUConstants.BlendOperation.Subtract */;\n            case 32779:\n                return \"reverse-subtract\" /* WebGPUConstants.BlendOperation.ReverseSubtract */;\n            case 32775:\n                return \"min\" /* WebGPUConstants.BlendOperation.Min */;\n            case 32776:\n                return \"max\" /* WebGPUConstants.BlendOperation.Max */;\n            default:\n                return \"add\" /* WebGPUConstants.BlendOperation.Add */;\n        }\n    }\n    static _GetAphaBlendFactor(factor) {\n        switch (factor) {\n            case 0:\n                return \"zero\" /* WebGPUConstants.BlendFactor.Zero */;\n            case 1:\n                return \"one\" /* WebGPUConstants.BlendFactor.One */;\n            case 768:\n                return \"src\" /* WebGPUConstants.BlendFactor.Src */;\n            case 769:\n                return \"one-minus-src\" /* WebGPUConstants.BlendFactor.OneMinusSrc */;\n            case 770:\n                return \"src-alpha\" /* WebGPUConstants.BlendFactor.SrcAlpha */;\n            case 771:\n                return \"one-minus-src-alpha\" /* WebGPUConstants.BlendFactor.OneMinusSrcAlpha */;\n            case 772:\n                return \"dst-alpha\" /* WebGPUConstants.BlendFactor.DstAlpha */;\n            case 773:\n                return \"one-minus-dst-alpha\" /* WebGPUConstants.BlendFactor.OneMinusDstAlpha */;\n            case 774:\n                return \"dst\" /* WebGPUConstants.BlendFactor.Dst */;\n            case 775:\n                return \"one-minus-dst\" /* WebGPUConstants.BlendFactor.OneMinusDst */;\n            case 776:\n                return \"src-alpha-saturated\" /* WebGPUConstants.BlendFactor.SrcAlphaSaturated */;\n            case 32769:\n                return \"constant\" /* WebGPUConstants.BlendFactor.Constant */;\n            case 32770:\n                return \"one-minus-constant\" /* WebGPUConstants.BlendFactor.OneMinusConstant */;\n            case 32771:\n                return \"constant\" /* WebGPUConstants.BlendFactor.Constant */;\n            case 32772:\n                return \"one-minus-constant\" /* WebGPUConstants.BlendFactor.OneMinusConstant */;\n            case 35065:\n                return \"src1\" /* WebGPUConstants.BlendFactor.Src1 */;\n            case 35066:\n                return \"one-minus-src1\" /* WebGPUConstants.BlendFactor.OneMinusSrc1 */;\n            case 34185:\n                return \"src1-alpha\" /* WebGPUConstants.BlendFactor.Src1Alpha */;\n            case 35067:\n                return \"one-minus-src1-alpha\" /* WebGPUConstants.BlendFactor.OneMinusSrc1Alpha */;\n            default:\n                return \"one\" /* WebGPUConstants.BlendFactor.One */;\n        }\n    }\n    static _GetCompareFunction(compareFunction) {\n        switch (compareFunction) {\n            case 0: // NEVER\n                return \"never\" /* WebGPUConstants.CompareFunction.Never */;\n            case 1: // LESS\n                return \"less\" /* WebGPUConstants.CompareFunction.Less */;\n            case 2: // EQUAL\n                return \"equal\" /* WebGPUConstants.CompareFunction.Equal */;\n            case 3: // LEQUAL\n                return \"less-equal\" /* WebGPUConstants.CompareFunction.LessEqual */;\n            case 4: // GREATER\n                return \"greater\" /* WebGPUConstants.CompareFunction.Greater */;\n            case 5: // NOTEQUAL\n                return \"not-equal\" /* WebGPUConstants.CompareFunction.NotEqual */;\n            case 6: // GEQUAL\n                return \"greater-equal\" /* WebGPUConstants.CompareFunction.GreaterEqual */;\n            case 7: // ALWAYS\n                return \"always\" /* WebGPUConstants.CompareFunction.Always */;\n        }\n        return \"never\" /* WebGPUConstants.CompareFunction.Never */;\n    }\n    static _GetStencilOpFunction(operation) {\n        switch (operation) {\n            case 0:\n                return \"zero\" /* WebGPUConstants.StencilOperation.Zero */;\n            case 1:\n                return \"keep\" /* WebGPUConstants.StencilOperation.Keep */;\n            case 2:\n                return \"replace\" /* WebGPUConstants.StencilOperation.Replace */;\n            case 3:\n                return \"increment-clamp\" /* WebGPUConstants.StencilOperation.IncrementClamp */;\n            case 4:\n                return \"decrement-clamp\" /* WebGPUConstants.StencilOperation.DecrementClamp */;\n            case 5:\n                return \"invert\" /* WebGPUConstants.StencilOperation.Invert */;\n            case 6:\n                return \"increment-wrap\" /* WebGPUConstants.StencilOperation.IncrementWrap */;\n            case 7:\n                return \"decrement-wrap\" /* WebGPUConstants.StencilOperation.DecrementWrap */;\n        }\n        return \"keep\" /* WebGPUConstants.StencilOperation.Keep */;\n    }\n    static _GetVertexInputDescriptorFormat(vertexBuffer) {\n        const type = vertexBuffer.type;\n        const normalized = vertexBuffer.normalized;\n        const size = vertexBuffer.getSize();\n        switch (type) {\n            case VertexBuffer.BYTE:\n                switch (size) {\n                    case 1:\n                    case 2:\n                        return normalized ? \"snorm8x2\" /* WebGPUConstants.VertexFormat.Snorm8x2 */ : \"sint8x2\" /* WebGPUConstants.VertexFormat.Sint8x2 */;\n                    case 3:\n                    case 4:\n                        return normalized ? \"snorm8x4\" /* WebGPUConstants.VertexFormat.Snorm8x4 */ : \"sint8x4\" /* WebGPUConstants.VertexFormat.Sint8x4 */;\n                }\n                break;\n            case VertexBuffer.UNSIGNED_BYTE:\n                switch (size) {\n                    case 1:\n                    case 2:\n                        return normalized ? \"unorm8x2\" /* WebGPUConstants.VertexFormat.Unorm8x2 */ : \"uint8x2\" /* WebGPUConstants.VertexFormat.Uint8x2 */;\n                    case 3:\n                    case 4:\n                        return normalized ? \"unorm8x4\" /* WebGPUConstants.VertexFormat.Unorm8x4 */ : \"uint8x4\" /* WebGPUConstants.VertexFormat.Uint8x4 */;\n                }\n                break;\n            case VertexBuffer.SHORT:\n                switch (size) {\n                    case 1:\n                    case 2:\n                        return normalized ? \"snorm16x2\" /* WebGPUConstants.VertexFormat.Snorm16x2 */ : \"sint16x2\" /* WebGPUConstants.VertexFormat.Sint16x2 */;\n                    case 3:\n                    case 4:\n                        return normalized ? \"snorm16x4\" /* WebGPUConstants.VertexFormat.Snorm16x4 */ : \"sint16x4\" /* WebGPUConstants.VertexFormat.Sint16x4 */;\n                }\n                break;\n            case VertexBuffer.UNSIGNED_SHORT:\n                switch (size) {\n                    case 1:\n                    case 2:\n                        return normalized ? \"unorm16x2\" /* WebGPUConstants.VertexFormat.Unorm16x2 */ : \"uint16x2\" /* WebGPUConstants.VertexFormat.Uint16x2 */;\n                    case 3:\n                    case 4:\n                        return normalized ? \"unorm16x4\" /* WebGPUConstants.VertexFormat.Unorm16x4 */ : \"uint16x4\" /* WebGPUConstants.VertexFormat.Uint16x4 */;\n                }\n                break;\n            case VertexBuffer.INT:\n                switch (size) {\n                    case 1:\n                        return \"sint32\" /* WebGPUConstants.VertexFormat.Sint32 */;\n                    case 2:\n                        return \"sint32x2\" /* WebGPUConstants.VertexFormat.Sint32x2 */;\n                    case 3:\n                        return \"sint32x3\" /* WebGPUConstants.VertexFormat.Sint32x3 */;\n                    case 4:\n                        return \"sint32x4\" /* WebGPUConstants.VertexFormat.Sint32x4 */;\n                }\n                break;\n            case VertexBuffer.UNSIGNED_INT:\n                switch (size) {\n                    case 1:\n                        return \"uint32\" /* WebGPUConstants.VertexFormat.Uint32 */;\n                    case 2:\n                        return \"uint32x2\" /* WebGPUConstants.VertexFormat.Uint32x2 */;\n                    case 3:\n                        return \"uint32x3\" /* WebGPUConstants.VertexFormat.Uint32x3 */;\n                    case 4:\n                        return \"uint32x4\" /* WebGPUConstants.VertexFormat.Uint32x4 */;\n                }\n                break;\n            case VertexBuffer.FLOAT:\n                switch (size) {\n                    case 1:\n                        return \"float32\" /* WebGPUConstants.VertexFormat.Float32 */;\n                    case 2:\n                        return \"float32x2\" /* WebGPUConstants.VertexFormat.Float32x2 */;\n                    case 3:\n                        return \"float32x3\" /* WebGPUConstants.VertexFormat.Float32x3 */;\n                    case 4:\n                        return \"float32x4\" /* WebGPUConstants.VertexFormat.Float32x4 */;\n                }\n                break;\n        }\n        throw new Error(`Invalid Format '${vertexBuffer.getKind()}' - type=${type}, normalized=${normalized}, size=${size}`);\n    }\n    _getAphaBlendState() {\n        if (!this._alphaBlendEnabled) {\n            return null;\n        }\n        return {\n            srcFactor: WebGPUCacheRenderPipeline._GetAphaBlendFactor(this._alphaBlendFuncParams[2]),\n            dstFactor: WebGPUCacheRenderPipeline._GetAphaBlendFactor(this._alphaBlendFuncParams[3]),\n            operation: WebGPUCacheRenderPipeline._GetAphaBlendOperation(this._alphaBlendEqParams[1]),\n        };\n    }\n    _getColorBlendState() {\n        if (!this._alphaBlendEnabled) {\n            return null;\n        }\n        return {\n            srcFactor: WebGPUCacheRenderPipeline._GetAphaBlendFactor(this._alphaBlendFuncParams[0]),\n            dstFactor: WebGPUCacheRenderPipeline._GetAphaBlendFactor(this._alphaBlendFuncParams[1]),\n            operation: WebGPUCacheRenderPipeline._GetAphaBlendOperation(this._alphaBlendEqParams[0]),\n        };\n    }\n    _setShaderStage(id) {\n        if (this._shaderId !== id) {\n            this._shaderId = id;\n            this._states[StatePosition.ShaderStage] = id;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.ShaderStage);\n        }\n    }\n    _setRasterizationState(topology, sampleCount) {\n        const frontFace = this._frontFace;\n        const cullMode = this._cullEnabled ? this._cullFace : 0;\n        const clampDepth = this._clampDepth ? 1 : 0;\n        const alphaToCoverage = this._alphaToCoverageEnabled ? 1 : 0;\n        const rasterizationState = frontFace - 1 + (cullMode << 1) + (clampDepth << 3) + (alphaToCoverage << 4) + (topology << 5) + (sampleCount << 8);\n        if (this._rasterizationState !== rasterizationState) {\n            this._rasterizationState = rasterizationState;\n            this._states[StatePosition.RasterizationState] = this._rasterizationState;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.RasterizationState);\n        }\n    }\n    _setColorStates() {\n        let colorStates = ((this._writeMask ? 1 : 0) << 22) + (this._colorFormat << 23) + ((this._depthWriteEnabled ? 1 : 0) << 29); // this state has been moved from depthStencilState here because alpha and depth are related (generally when alpha is on, depth write is off and the other way around)\n        if (this._alphaBlendEnabled) {\n            colorStates +=\n                ((this._alphaBlendFuncParams[0] === null ? 2 : alphaBlendFactorToIndex[this._alphaBlendFuncParams[0]]) << 0) +\n                    ((this._alphaBlendFuncParams[1] === null ? 2 : alphaBlendFactorToIndex[this._alphaBlendFuncParams[1]]) << 4) +\n                    ((this._alphaBlendFuncParams[2] === null ? 2 : alphaBlendFactorToIndex[this._alphaBlendFuncParams[2]]) << 8) +\n                    ((this._alphaBlendFuncParams[3] === null ? 2 : alphaBlendFactorToIndex[this._alphaBlendFuncParams[3]]) << 12) +\n                    ((this._alphaBlendEqParams[0] === null ? 1 : this._alphaBlendEqParams[0] - 0x8005) << 16) +\n                    ((this._alphaBlendEqParams[1] === null ? 1 : this._alphaBlendEqParams[1] - 0x8005) << 19);\n        }\n        if (colorStates !== this._colorStates) {\n            this._colorStates = colorStates;\n            this._states[StatePosition.ColorStates] = this._colorStates;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.ColorStates);\n        }\n    }\n    _setDepthStencilState() {\n        const stencilState = !this._stencilEnabled\n            ? 7 /* ALWAYS */ + (1 /* KEEP */ << 3) + (1 /* KEEP */ << 6) + (1 /* KEEP */ << 9)\n            : this._stencilFrontCompare + (this._stencilFrontDepthFailOp << 3) + (this._stencilFrontPassOp << 6) + (this._stencilFrontFailOp << 9);\n        const depthStencilState = this._depthStencilFormat + ((this._depthTestEnabled ? this._depthCompare : 7) /* ALWAYS */ << 6) + (stencilState << 10); // stencil front - stencil back is the same\n        if (this._depthStencilState !== depthStencilState) {\n            this._depthStencilState = depthStencilState;\n            this._states[StatePosition.DepthStencilState] = this._depthStencilState;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.DepthStencilState);\n        }\n    }\n    _setVertexState(effect) {\n        const currStateLen = this._statesLength;\n        let newNumStates = StatePosition.VertexState;\n        const webgpuPipelineContext = effect._pipelineContext;\n        const attributes = webgpuPipelineContext.shaderProcessingContext.attributeNamesFromEffect;\n        const locations = webgpuPipelineContext.shaderProcessingContext.attributeLocationsFromEffect;\n        let currentGPUBuffer;\n        let numVertexBuffers = 0;\n        for (let index = 0; index < attributes.length; index++) {\n            const location = locations[index];\n            let vertexBuffer = (this._overrideVertexBuffers && this._overrideVertexBuffers[attributes[index]]) ?? this._vertexBuffers[attributes[index]];\n            if (!vertexBuffer) {\n                // In WebGL it's valid to not bind a vertex buffer to an attribute, but it's not valid in WebGPU\n                // So we must bind a dummy buffer when we are not given one for a specific attribute\n                vertexBuffer = this._emptyVertexBuffer;\n                if (WebGPUCacheRenderPipeline.LogErrorIfNoVertexBuffer) {\n                    Logger.Error(`No vertex buffer is provided for the \"${attributes[index]}\" attribute. A default empty vertex buffer will be used, but this may generate errors in some browsers.`);\n                }\n            }\n            const buffer = vertexBuffer.effectiveBuffer?.underlyingResource;\n            // We optimize usage of GPUVertexBufferLayout: we will create a single GPUVertexBufferLayout for all the attributes which follow each other and which use the same GPU buffer\n            // However, there are some constraints in the attribute.offset value range, so we must check for them before being able to reuse the same GPUVertexBufferLayout\n            // See _getVertexInputDescriptor() below\n            if (vertexBuffer._validOffsetRange === undefined) {\n                const offset = vertexBuffer.effectiveByteOffset;\n                const formatSize = vertexBuffer.getSize(true);\n                const byteStride = vertexBuffer.effectiveByteStride;\n                vertexBuffer._validOffsetRange =\n                    (offset + formatSize <= this._kMaxVertexBufferStride && byteStride === 0) || (byteStride !== 0 && offset + formatSize <= byteStride);\n            }\n            if (!(currentGPUBuffer && currentGPUBuffer === buffer && vertexBuffer._validOffsetRange)) {\n                // we can't combine the previous vertexBuffer with the current one\n                this.vertexBuffers[numVertexBuffers++] = vertexBuffer;\n                currentGPUBuffer = vertexBuffer._validOffsetRange ? buffer : null;\n            }\n            const vid = vertexBuffer.hashCode + (location << 7);\n            this._isDirty = this._isDirty || this._states[newNumStates] !== vid;\n            this._states[newNumStates++] = vid;\n        }\n        this.vertexBuffers.length = numVertexBuffers;\n        this._statesLength = newNumStates;\n        this._isDirty = this._isDirty || newNumStates !== currStateLen;\n        if (this._isDirty) {\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.VertexState);\n        }\n    }\n    _setTextureState(textureState) {\n        if (this._textureState !== textureState) {\n            this._textureState = textureState;\n            this._states[StatePosition.TextureStage] = this._textureState;\n            this._isDirty = true;\n            this._stateDirtyLowestIndex = Math.min(this._stateDirtyLowestIndex, StatePosition.TextureStage);\n        }\n    }\n    _createPipelineLayout(webgpuPipelineContext) {\n        if (this._useTextureStage) {\n            return this._createPipelineLayoutWithTextureStage(webgpuPipelineContext);\n        }\n        const bindGroupLayouts = [];\n        const bindGroupLayoutEntries = webgpuPipelineContext.shaderProcessingContext.bindGroupLayoutEntries;\n        for (let i = 0; i < bindGroupLayoutEntries.length; i++) {\n            const setDefinition = bindGroupLayoutEntries[i];\n            bindGroupLayouts[i] = this._device.createBindGroupLayout({\n                entries: setDefinition,\n            });\n        }\n        webgpuPipelineContext.bindGroupLayouts[0] = bindGroupLayouts;\n        return this._device.createPipelineLayout({ bindGroupLayouts });\n    }\n    _createPipelineLayoutWithTextureStage(webgpuPipelineContext) {\n        const shaderProcessingContext = webgpuPipelineContext.shaderProcessingContext;\n        const bindGroupLayoutEntries = shaderProcessingContext.bindGroupLayoutEntries;\n        let bitVal = 1;\n        for (let i = 0; i < bindGroupLayoutEntries.length; i++) {\n            const setDefinition = bindGroupLayoutEntries[i];\n            for (let j = 0; j < setDefinition.length; j++) {\n                const entry = bindGroupLayoutEntries[i][j];\n                if (entry.texture) {\n                    const name = shaderProcessingContext.bindGroupLayoutEntryInfo[i][entry.binding].name;\n                    const textureInfo = shaderProcessingContext.availableTextures[name];\n                    const samplerInfo = textureInfo.autoBindSampler ? shaderProcessingContext.availableSamplers[name + `Sampler`] : null;\n                    let sampleType = textureInfo.sampleType;\n                    let samplerType = samplerInfo?.type ?? \"filtering\" /* WebGPUConstants.SamplerBindingType.Filtering */;\n                    if (this._textureState & bitVal && sampleType !== \"depth\" /* WebGPUConstants.TextureSampleType.Depth */) {\n                        // The texture is a 32 bits float texture but the system does not support linear filtering for them OR the texture is a depth texture with \"float\" filtering:\n                        // we set the sampler to \"non-filtering\" and the texture sample type to \"unfilterable-float\"\n                        if (textureInfo.autoBindSampler) {\n                            samplerType = \"non-filtering\" /* WebGPUConstants.SamplerBindingType.NonFiltering */;\n                        }\n                        sampleType = \"unfilterable-float\" /* WebGPUConstants.TextureSampleType.UnfilterableFloat */;\n                    }\n                    entry.texture.sampleType = sampleType;\n                    if (samplerInfo) {\n                        const binding = shaderProcessingContext.bindGroupLayoutEntryInfo[samplerInfo.binding.groupIndex][samplerInfo.binding.bindingIndex].index;\n                        bindGroupLayoutEntries[samplerInfo.binding.groupIndex][binding].sampler.type = samplerType;\n                    }\n                    bitVal = bitVal << 1;\n                }\n            }\n        }\n        const bindGroupLayouts = [];\n        for (let i = 0; i < bindGroupLayoutEntries.length; ++i) {\n            bindGroupLayouts[i] = this._device.createBindGroupLayout({\n                entries: bindGroupLayoutEntries[i],\n            });\n        }\n        webgpuPipelineContext.bindGroupLayouts[this._textureState] = bindGroupLayouts;\n        return this._device.createPipelineLayout({ bindGroupLayouts });\n    }\n    _getVertexInputDescriptor(effect) {\n        const descriptors = [];\n        const webgpuPipelineContext = effect._pipelineContext;\n        const attributes = webgpuPipelineContext.shaderProcessingContext.attributeNamesFromEffect;\n        const locations = webgpuPipelineContext.shaderProcessingContext.attributeLocationsFromEffect;\n        let currentGPUBuffer;\n        let currentGPUAttributes;\n        for (let index = 0; index < attributes.length; index++) {\n            const location = locations[index];\n            let vertexBuffer = (this._overrideVertexBuffers && this._overrideVertexBuffers[attributes[index]]) ?? this._vertexBuffers[attributes[index]];\n            if (!vertexBuffer) {\n                // In WebGL it's valid to not bind a vertex buffer to an attribute, but it's not valid in WebGPU\n                // So we must bind a dummy buffer when we are not given one for a specific attribute\n                vertexBuffer = this._emptyVertexBuffer;\n            }\n            let buffer = vertexBuffer.effectiveBuffer?.underlyingResource;\n            // We reuse the same GPUVertexBufferLayout for all attributes that use the same underlying GPU buffer (and for attributes that follow each other in the attributes array)\n            let offset = vertexBuffer.effectiveByteOffset;\n            const invalidOffsetRange = !vertexBuffer._validOffsetRange;\n            if (!(currentGPUBuffer && currentGPUAttributes && currentGPUBuffer === buffer) || invalidOffsetRange) {\n                const vertexBufferDescriptor = {\n                    arrayStride: vertexBuffer.effectiveByteStride,\n                    stepMode: vertexBuffer.getIsInstanced() ? \"instance\" /* WebGPUConstants.VertexStepMode.Instance */ : \"vertex\" /* WebGPUConstants.VertexStepMode.Vertex */,\n                    attributes: [],\n                };\n                descriptors.push(vertexBufferDescriptor);\n                currentGPUAttributes = vertexBufferDescriptor.attributes;\n                if (invalidOffsetRange) {\n                    offset = 0; // the offset will be set directly in the setVertexBuffer call\n                    buffer = null; // buffer can't be reused\n                }\n            }\n            currentGPUAttributes.push({\n                shaderLocation: location,\n                offset,\n                format: WebGPUCacheRenderPipeline._GetVertexInputDescriptorFormat(vertexBuffer),\n            });\n            currentGPUBuffer = buffer;\n        }\n        return descriptors;\n    }\n    _createRenderPipeline(effect, topology, sampleCount) {\n        const webgpuPipelineContext = effect._pipelineContext;\n        const inputStateDescriptor = this._getVertexInputDescriptor(effect);\n        const pipelineLayout = this._createPipelineLayout(webgpuPipelineContext);\n        const colorStates = [];\n        const alphaBlend = this._getAphaBlendState();\n        const colorBlend = this._getColorBlendState();\n        if (this._vertexBuffers) {\n            checkNonFloatVertexBuffers(this._vertexBuffers, effect);\n        }\n        if (this._mrtAttachments1 > 0) {\n            for (let i = 0; i < this._mrtFormats.length; ++i) {\n                const format = this._mrtFormats[i];\n                if (format) {\n                    const descr = {\n                        format,\n                        writeMask: (this._mrtEnabledMask & (1 << i)) !== 0 ? this._writeMask : 0,\n                    };\n                    if (alphaBlend && colorBlend) {\n                        descr.blend = {\n                            alpha: alphaBlend,\n                            color: colorBlend,\n                        };\n                    }\n                    colorStates.push(descr);\n                }\n                else {\n                    colorStates.push(null);\n                }\n            }\n        }\n        else {\n            if (this._webgpuColorFormat[0]) {\n                const descr = {\n                    format: this._webgpuColorFormat[0],\n                    writeMask: this._writeMask,\n                };\n                if (alphaBlend && colorBlend) {\n                    descr.blend = {\n                        alpha: alphaBlend,\n                        color: colorBlend,\n                    };\n                }\n                colorStates.push(descr);\n            }\n            else {\n                colorStates.push(null);\n            }\n        }\n        const stencilFrontBack = {\n            compare: WebGPUCacheRenderPipeline._GetCompareFunction(this._stencilEnabled ? this._stencilFrontCompare : 7 /* ALWAYS */),\n            depthFailOp: WebGPUCacheRenderPipeline._GetStencilOpFunction(this._stencilEnabled ? this._stencilFrontDepthFailOp : 1 /* KEEP */),\n            failOp: WebGPUCacheRenderPipeline._GetStencilOpFunction(this._stencilEnabled ? this._stencilFrontFailOp : 1 /* KEEP */),\n            passOp: WebGPUCacheRenderPipeline._GetStencilOpFunction(this._stencilEnabled ? this._stencilFrontPassOp : 1 /* KEEP */),\n        };\n        const topologyIsTriangle = topology === \"triangle-list\" /* WebGPUConstants.PrimitiveTopology.TriangleList */ || topology === \"triangle-strip\" /* WebGPUConstants.PrimitiveTopology.TriangleStrip */;\n        let stripIndexFormat = undefined;\n        if (topology === \"line-strip\" /* WebGPUConstants.PrimitiveTopology.LineStrip */ || topology === \"triangle-strip\" /* WebGPUConstants.PrimitiveTopology.TriangleStrip */) {\n            stripIndexFormat = !this._indexBuffer || this._indexBuffer.is32Bits ? \"uint32\" /* WebGPUConstants.IndexFormat.Uint32 */ : \"uint16\" /* WebGPUConstants.IndexFormat.Uint16 */;\n        }\n        const depthStencilFormatHasStencil = this._webgpuDepthStencilFormat ? WebGPUTextureHelper.HasStencilAspect(this._webgpuDepthStencilFormat) : false;\n        return this._device.createRenderPipeline({\n            label: `RenderPipeline_${colorStates[0]?.format ?? \"nooutput\"}_${this._webgpuDepthStencilFormat ?? \"nodepth\"}_samples${sampleCount}_textureState${this._textureState}`,\n            layout: pipelineLayout,\n            vertex: {\n                module: webgpuPipelineContext.stages.vertexStage.module,\n                entryPoint: webgpuPipelineContext.stages.vertexStage.entryPoint,\n                buffers: inputStateDescriptor,\n            },\n            primitive: {\n                topology,\n                stripIndexFormat,\n                frontFace: this._frontFace === 1 ? \"ccw\" /* WebGPUConstants.FrontFace.CCW */ : \"cw\" /* WebGPUConstants.FrontFace.CW */,\n                cullMode: !this._cullEnabled ? \"none\" /* WebGPUConstants.CullMode.None */ : this._cullFace === 2 ? \"front\" /* WebGPUConstants.CullMode.Front */ : \"back\" /* WebGPUConstants.CullMode.Back */,\n            },\n            fragment: !webgpuPipelineContext.stages.fragmentStage\n                ? undefined\n                : {\n                    module: webgpuPipelineContext.stages.fragmentStage.module,\n                    entryPoint: webgpuPipelineContext.stages.fragmentStage.entryPoint,\n                    targets: colorStates,\n                },\n            multisample: {\n                count: sampleCount,\n                /*mask,\n                alphaToCoverageEnabled,*/\n            },\n            depthStencil: this._webgpuDepthStencilFormat === undefined\n                ? undefined\n                : {\n                    depthWriteEnabled: this._depthWriteEnabled,\n                    depthCompare: this._depthTestEnabled ? WebGPUCacheRenderPipeline._GetCompareFunction(this._depthCompare) : \"always\" /* WebGPUConstants.CompareFunction.Always */,\n                    format: this._webgpuDepthStencilFormat,\n                    stencilFront: this._stencilEnabled && depthStencilFormatHasStencil ? stencilFrontBack : undefined,\n                    stencilBack: this._stencilEnabled && depthStencilFormatHasStencil ? stencilFrontBack : undefined,\n                    stencilReadMask: this._stencilEnabled && depthStencilFormatHasStencil ? this._stencilReadMask : undefined,\n                    stencilWriteMask: this._stencilEnabled && depthStencilFormatHasStencil ? this._stencilWriteMask : undefined,\n                    depthBias: this._depthBias,\n                    depthBiasClamp: topologyIsTriangle ? this._depthBiasClamp : 0,\n                    depthBiasSlopeScale: topologyIsTriangle ? this._depthBiasSlopeScale : 0,\n                },\n        });\n    }\n}\nWebGPUCacheRenderPipeline.LogErrorIfNoVertexBuffer = false;\nWebGPUCacheRenderPipeline.NumCacheHitWithoutHash = 0;\nWebGPUCacheRenderPipeline.NumCacheHitWithHash = 0;\nWebGPUCacheRenderPipeline.NumCacheMiss = 0;\nWebGPUCacheRenderPipeline.NumPipelineCreationLastFrame = 0;\nWebGPUCacheRenderPipeline._NumPipelineCreationCurrentFrame = 0;\n//# sourceMappingURL=webgpuCacheRenderPipeline.js.map","import { WebGPUCacheRenderPipeline } from \"./webgpuCacheRenderPipeline.js\";\n/** @internal */\nclass NodeState {\n    constructor() {\n        this.values = {};\n    }\n    count() {\n        let countNode = 0, countPipeline = this.pipeline ? 1 : 0;\n        for (const value in this.values) {\n            const node = this.values[value];\n            const [childCountNodes, childCoundPipeline] = node.count();\n            countNode += childCountNodes;\n            countPipeline += childCoundPipeline;\n            countNode++;\n        }\n        return [countNode, countPipeline];\n    }\n}\n/** @internal */\nexport class WebGPUCacheRenderPipelineTree extends WebGPUCacheRenderPipeline {\n    static GetNodeCounts() {\n        const counts = WebGPUCacheRenderPipelineTree._Cache.count();\n        return { nodeCount: counts[0], pipelineCount: counts[1] };\n    }\n    static _GetPipelines(node, pipelines, curPath, curPathLen) {\n        if (node.pipeline) {\n            const path = curPath.slice();\n            path.length = curPathLen;\n            pipelines.push(path);\n        }\n        for (const value in node.values) {\n            const nnode = node.values[value];\n            curPath[curPathLen] = parseInt(value);\n            WebGPUCacheRenderPipelineTree._GetPipelines(nnode, pipelines, curPath, curPathLen + 1);\n        }\n    }\n    static GetPipelines() {\n        const pipelines = [];\n        WebGPUCacheRenderPipelineTree._GetPipelines(WebGPUCacheRenderPipelineTree._Cache, pipelines, [], 0);\n        return pipelines;\n    }\n    static ResetCache() {\n        WebGPUCacheRenderPipelineTree._Cache = new NodeState();\n    }\n    reset() {\n        this._nodeStack = [];\n        this._nodeStack[0] = WebGPUCacheRenderPipelineTree._Cache;\n        super.reset();\n    }\n    _getRenderPipeline(param) {\n        let node = this._nodeStack[this._stateDirtyLowestIndex];\n        for (let i = this._stateDirtyLowestIndex; i < this._statesLength; ++i) {\n            let nn = node.values[this._states[i]];\n            if (!nn) {\n                nn = new NodeState();\n                node.values[this._states[i]] = nn;\n            }\n            node = nn;\n            this._nodeStack[i + 1] = node;\n        }\n        param.token = node;\n        param.pipeline = node.pipeline;\n    }\n    _setRenderPipeline(param) {\n        param.token.pipeline = param.pipeline;\n    }\n}\nWebGPUCacheRenderPipelineTree._Cache = new NodeState();\n//# sourceMappingURL=webgpuCacheRenderPipelineTree.js.map","import { StencilStateComposer } from \"../../States/stencilStateComposer.js\";\n/**\n * @internal\n **/\nexport class WebGPUStencilStateComposer extends StencilStateComposer {\n    constructor(cache) {\n        super(false);\n        this._cache = cache;\n        this.reset();\n    }\n    get func() {\n        return this._func;\n    }\n    set func(value) {\n        if (this._func === value) {\n            return;\n        }\n        this._func = value;\n        this._cache.setStencilCompare(value);\n    }\n    get funcMask() {\n        return this._funcMask;\n    }\n    set funcMask(value) {\n        if (this._funcMask === value) {\n            return;\n        }\n        this._funcMask = value;\n        this._cache.setStencilReadMask(value);\n    }\n    get opStencilFail() {\n        return this._opStencilFail;\n    }\n    set opStencilFail(value) {\n        if (this._opStencilFail === value) {\n            return;\n        }\n        this._opStencilFail = value;\n        this._cache.setStencilFailOp(value);\n    }\n    get opDepthFail() {\n        return this._opDepthFail;\n    }\n    set opDepthFail(value) {\n        if (this._opDepthFail === value) {\n            return;\n        }\n        this._opDepthFail = value;\n        this._cache.setStencilDepthFailOp(value);\n    }\n    get opStencilDepthPass() {\n        return this._opStencilDepthPass;\n    }\n    set opStencilDepthPass(value) {\n        if (this._opStencilDepthPass === value) {\n            return;\n        }\n        this._opStencilDepthPass = value;\n        this._cache.setStencilPassOp(value);\n    }\n    get mask() {\n        return this._mask;\n    }\n    set mask(value) {\n        if (this._mask === value) {\n            return;\n        }\n        this._mask = value;\n        this._cache.setStencilWriteMask(value);\n    }\n    get enabled() {\n        return this._enabled;\n    }\n    set enabled(value) {\n        if (this._enabled === value) {\n            return;\n        }\n        this._enabled = value;\n        this._cache.setStencilEnabled(value);\n    }\n    reset() {\n        super.reset();\n        this._cache.resetStencilState();\n    }\n    apply() {\n        const stencilMaterialEnabled = this.stencilMaterial?.enabled;\n        this.enabled = stencilMaterialEnabled ? this.stencilMaterial.enabled : this.stencilGlobal.enabled;\n        if (!this.enabled) {\n            return;\n        }\n        this.func = stencilMaterialEnabled ? this.stencilMaterial.func : this.stencilGlobal.func;\n        this.funcRef = stencilMaterialEnabled ? this.stencilMaterial.funcRef : this.stencilGlobal.funcRef;\n        this.funcMask = stencilMaterialEnabled ? this.stencilMaterial.funcMask : this.stencilGlobal.funcMask;\n        this.opStencilFail = stencilMaterialEnabled ? this.stencilMaterial.opStencilFail : this.stencilGlobal.opStencilFail;\n        this.opDepthFail = stencilMaterialEnabled ? this.stencilMaterial.opDepthFail : this.stencilGlobal.opDepthFail;\n        this.opStencilDepthPass = stencilMaterialEnabled ? this.stencilMaterial.opStencilDepthPass : this.stencilGlobal.opStencilDepthPass;\n        this.mask = stencilMaterialEnabled ? this.stencilMaterial.mask : this.stencilGlobal.mask;\n    }\n}\n//# sourceMappingURL=webgpuStencilStateComposer.js.map","import { DepthCullingState } from \"../../States/depthCullingState.js\";\n/**\n * @internal\n **/\nexport class WebGPUDepthCullingState extends DepthCullingState {\n    /**\n     * Initializes the state.\n     * @param cache\n     */\n    constructor(cache) {\n        super(false);\n        this._cache = cache;\n        this.reset();\n    }\n    get zOffset() {\n        return this._zOffset;\n    }\n    set zOffset(value) {\n        if (this._zOffset === value) {\n            return;\n        }\n        this._zOffset = value;\n        this._isZOffsetDirty = true;\n        this._cache.setDepthBiasSlopeScale(value);\n    }\n    get zOffsetUnits() {\n        return this._zOffsetUnits;\n    }\n    set zOffsetUnits(value) {\n        if (this._zOffsetUnits === value) {\n            return;\n        }\n        this._zOffsetUnits = value;\n        this._isZOffsetDirty = true;\n        this._cache.setDepthBias(value);\n    }\n    get cullFace() {\n        return this._cullFace;\n    }\n    set cullFace(value) {\n        if (this._cullFace === value) {\n            return;\n        }\n        this._cullFace = value;\n        this._isCullFaceDirty = true;\n        this._cache.setCullFace(value ?? 1);\n    }\n    get cull() {\n        return this._cull;\n    }\n    set cull(value) {\n        if (this._cull === value) {\n            return;\n        }\n        this._cull = value;\n        this._isCullDirty = true;\n        this._cache.setCullEnabled(!!value);\n    }\n    get depthFunc() {\n        return this._depthFunc;\n    }\n    set depthFunc(value) {\n        if (this._depthFunc === value) {\n            return;\n        }\n        this._depthFunc = value;\n        this._isDepthFuncDirty = true;\n        this._cache.setDepthCompare(value);\n    }\n    get depthMask() {\n        return this._depthMask;\n    }\n    set depthMask(value) {\n        if (this._depthMask === value) {\n            return;\n        }\n        this._depthMask = value;\n        this._isDepthMaskDirty = true;\n        this._cache.setDepthWriteEnabled(value);\n    }\n    get depthTest() {\n        return this._depthTest;\n    }\n    set depthTest(value) {\n        if (this._depthTest === value) {\n            return;\n        }\n        this._depthTest = value;\n        this._isDepthTestDirty = true;\n        this._cache.setDepthTestEnabled(value);\n    }\n    get frontFace() {\n        return this._frontFace;\n    }\n    set frontFace(value) {\n        if (this._frontFace === value) {\n            return;\n        }\n        this._frontFace = value;\n        this._isFrontFaceDirty = true;\n        this._cache.setFrontFace(value ?? 2);\n    }\n    reset() {\n        super.reset();\n        this._cache.resetDepthCullingState();\n    }\n    apply() {\n        // nothing to do\n    }\n}\n//# sourceMappingURL=webgpuDepthCullingState.js.map","\nimport { InternalTexture } from \"./internalTexture.js\";\n/**\n * Class used to store an external texture (like GPUExternalTexture in WebGPU)\n */\nexport class ExternalTexture {\n    /**\n     * Checks if a texture is an external or internal texture\n     * @param texture the external or internal texture\n     * @returns true if the texture is an external texture, else false\n     */\n    static IsExternalTexture(texture) {\n        return texture.underlyingResource !== undefined;\n    }\n    /**\n     * Get the class name of the texture.\n     * @returns \"ExternalTexture\"\n     */\n    getClassName() {\n        return \"ExternalTexture\";\n    }\n    /**\n     * Gets the underlying texture object\n     */\n    get underlyingResource() {\n        return this._video;\n    }\n    /**\n     * Constructs the texture\n     * @param video The video the texture should be wrapped around\n     */\n    constructor(video) {\n        /**\n         * Gets a boolean indicating if the texture uses mipmaps\n         */\n        this.useMipMaps = false;\n        /**\n         * The type of the underlying texture is implementation dependent, so return \"UNDEFINED\" for the type\n         */\n        this.type = 16;\n        /**\n         * The format of the underlying texture is implementation dependent, so return \"UNDEFINED\" for the format\n         */\n        this.format = 4294967295;\n        this._video = video;\n        this.uniqueId = InternalTexture._Counter++;\n    }\n    /**\n     * Get if the texture is ready to be used (downloaded, converted, mip mapped...).\n     * @returns true if fully ready\n     */\n    isReady() {\n        return this._video.readyState >= this._video.HAVE_CURRENT_DATA;\n    }\n    /**\n     * Dispose the texture and release its associated resources.\n     */\n    dispose() { }\n}\n//# sourceMappingURL=externalTexture.js.map","/* eslint-disable babylonjs/available */\n/* eslint-disable jsdoc/require-jsdoc */\nimport { ExternalTexture } from \"../../Materials/Textures/externalTexture.js\";\n\nimport { WebGPUCacheSampler } from \"./webgpuCacheSampler.js\";\n/** @internal */\nexport class WebGPUMaterialContext {\n    get forceBindGroupCreation() {\n        // If there is at least one external texture to bind, we must recreate the bind groups each time\n        // because we need to retrieve a new texture each frame (by calling device.importExternalTexture)\n        return this._numExternalTextures > 0;\n    }\n    get hasFloatOrDepthTextures() {\n        return this._numFloatOrDepthTextures > 0;\n    }\n    constructor() {\n        this.uniqueId = WebGPUMaterialContext._Counter++;\n        this.updateId = 0;\n        this.textureState = 0;\n        this.reset();\n    }\n    reset() {\n        this.samplers = {};\n        this.textures = {};\n        this.isDirty = true;\n        this._numFloatOrDepthTextures = 0;\n        this._numExternalTextures = 0;\n    }\n    setSampler(name, sampler) {\n        let samplerCache = this.samplers[name];\n        let currentHashCode = -1;\n        if (!samplerCache) {\n            this.samplers[name] = samplerCache = { sampler, hashCode: 0 };\n        }\n        else {\n            currentHashCode = samplerCache.hashCode;\n        }\n        samplerCache.sampler = sampler;\n        samplerCache.hashCode = sampler ? WebGPUCacheSampler.GetSamplerHashCode(sampler) : 0;\n        const isDirty = currentHashCode !== samplerCache.hashCode;\n        if (isDirty) {\n            this.updateId++;\n        }\n        this.isDirty || (this.isDirty = isDirty);\n    }\n    setTexture(name, texture) {\n        let textureCache = this.textures[name];\n        let currentTextureId = -1;\n        if (!textureCache) {\n            this.textures[name] = textureCache = { texture, isFloatOrDepthTexture: false, isExternalTexture: false };\n        }\n        else {\n            currentTextureId = textureCache.texture?.uniqueId ?? -1;\n        }\n        if (textureCache.isExternalTexture) {\n            this._numExternalTextures--;\n        }\n        if (textureCache.isFloatOrDepthTexture) {\n            this._numFloatOrDepthTextures--;\n        }\n        if (texture) {\n            textureCache.isFloatOrDepthTexture =\n                texture.type === 1 ||\n                    (texture.format >= 13 && texture.format <= 18);\n            textureCache.isExternalTexture = ExternalTexture.IsExternalTexture(texture);\n            if (textureCache.isFloatOrDepthTexture) {\n                this._numFloatOrDepthTextures++;\n            }\n            if (textureCache.isExternalTexture) {\n                this._numExternalTextures++;\n            }\n        }\n        else {\n            textureCache.isFloatOrDepthTexture = false;\n            textureCache.isExternalTexture = false;\n        }\n        textureCache.texture = texture;\n        const isDirty = currentTextureId !== (texture?.uniqueId ?? -1);\n        if (isDirty) {\n            this.updateId++;\n        }\n        this.isDirty || (this.isDirty = isDirty);\n    }\n}\nWebGPUMaterialContext._Counter = 0;\n//# sourceMappingURL=webgpuMaterialContext.js.map","import * as WebGPUConstants from \"./webgpuConstants.js\";\n/** @internal */\nexport class WebGPUDrawContext {\n    isDirty(materialContextUpdateId) {\n        return this._isDirty || this._materialContextUpdateId !== materialContextUpdateId;\n    }\n    resetIsDirty(materialContextUpdateId) {\n        this._isDirty = false;\n        this._materialContextUpdateId = materialContextUpdateId;\n    }\n    get useInstancing() {\n        return this._useInstancing;\n    }\n    set useInstancing(use) {\n        if (this._useInstancing === use) {\n            return;\n        }\n        if (!use) {\n            if (this.indirectDrawBuffer) {\n                this._bufferManager.releaseBuffer(this.indirectDrawBuffer);\n            }\n            this.indirectDrawBuffer = undefined;\n            this._indirectDrawData = undefined;\n        }\n        else {\n            this.indirectDrawBuffer = this._bufferManager.createRawBuffer(20, WebGPUConstants.BufferUsage.CopyDst | WebGPUConstants.BufferUsage.Indirect | WebGPUConstants.BufferUsage.Storage, undefined, \"IndirectDrawBuffer\");\n            this._indirectDrawData = new Uint32Array(5);\n            this._indirectDrawData[3] = 0;\n            this._indirectDrawData[4] = 0;\n        }\n        this._useInstancing = use;\n        this._currentInstanceCount = -1;\n    }\n    constructor(bufferManager) {\n        this._bufferManager = bufferManager;\n        this.uniqueId = WebGPUDrawContext._Counter++;\n        this._useInstancing = false;\n        this._currentInstanceCount = 0;\n        this.reset();\n    }\n    reset() {\n        this.buffers = {};\n        this._isDirty = true;\n        this._materialContextUpdateId = 0;\n        this.fastBundle = undefined;\n        this.bindGroups = undefined;\n    }\n    setBuffer(name, buffer) {\n        this._isDirty || (this._isDirty = buffer?.uniqueId !== this.buffers[name]?.uniqueId);\n        this.buffers[name] = buffer;\n    }\n    setIndirectData(indexOrVertexCount, instanceCount, firstIndexOrVertex) {\n        if (instanceCount === this._currentInstanceCount || !this.indirectDrawBuffer || !this._indirectDrawData) {\n            // The current buffer is already up to date so do nothing\n            // Note that we only check for instanceCount and not indexOrVertexCount nor firstIndexOrVertex because those values\n            // are supposed to not change during the lifetime of a draw context\n            return;\n        }\n        this._currentInstanceCount = instanceCount;\n        this._indirectDrawData[0] = indexOrVertexCount;\n        this._indirectDrawData[1] = instanceCount;\n        this._indirectDrawData[2] = firstIndexOrVertex;\n        this._bufferManager.setRawData(this.indirectDrawBuffer, 0, this._indirectDrawData, 0, 20);\n    }\n    dispose() {\n        if (this.indirectDrawBuffer) {\n            this._bufferManager.releaseBuffer(this.indirectDrawBuffer);\n            this.indirectDrawBuffer = undefined;\n            this._indirectDrawData = undefined;\n        }\n        this.fastBundle = undefined;\n        this.bindGroups = undefined;\n        this.buffers = undefined;\n    }\n}\nWebGPUDrawContext._Counter = 0;\n//# sourceMappingURL=webgpuDrawContext.js.map","/* eslint-disable babylonjs/available */\n/* eslint-disable jsdoc/require-jsdoc */\nimport { Logger } from \"../../Misc/logger.js\";\n/**\n * Sampler hash codes are 19 bits long, so using a start value of 2^20 for buffer ids will ensure we can't have any collision with the sampler hash codes\n */\nconst bufferIdStart = 1 << 20;\n/**\n * textureIdStart is added to texture ids to ensure we can't have any collision with the buffer ids / sampler hash codes.\n * 2^35 for textureIdStart means we can have:\n * - 2^(35-20) = 2^15 = 32768 possible buffer ids\n * - 2^(53-35) = 2^18 = 524288 possible texture ids\n */\nconst textureIdStart = 2 ** 35;\nclass WebGPUBindGroupCacheNode {\n    constructor() {\n        this.values = {};\n    }\n}\n/** @internal */\nexport class WebGPUCacheBindGroups {\n    static get Statistics() {\n        return {\n            totalCreated: WebGPUCacheBindGroups.NumBindGroupsCreatedTotal,\n            lastFrameCreated: WebGPUCacheBindGroups.NumBindGroupsCreatedLastFrame,\n            lookupLastFrame: WebGPUCacheBindGroups.NumBindGroupsLookupLastFrame,\n            noLookupLastFrame: WebGPUCacheBindGroups.NumBindGroupsNoLookupLastFrame,\n        };\n    }\n    static ResetCache() {\n        WebGPUCacheBindGroups._Cache = new WebGPUBindGroupCacheNode();\n        WebGPUCacheBindGroups.NumBindGroupsCreatedTotal = 0;\n        WebGPUCacheBindGroups.NumBindGroupsCreatedLastFrame = 0;\n        WebGPUCacheBindGroups.NumBindGroupsLookupLastFrame = 0;\n        WebGPUCacheBindGroups.NumBindGroupsNoLookupLastFrame = 0;\n        WebGPUCacheBindGroups._NumBindGroupsCreatedCurrentFrame = 0;\n        WebGPUCacheBindGroups._NumBindGroupsLookupCurrentFrame = 0;\n        WebGPUCacheBindGroups._NumBindGroupsNoLookupCurrentFrame = 0;\n    }\n    constructor(device, cacheSampler, engine) {\n        this.disabled = false;\n        this._device = device;\n        this._cacheSampler = cacheSampler;\n        this._engine = engine;\n    }\n    endFrame() {\n        WebGPUCacheBindGroups.NumBindGroupsCreatedLastFrame = WebGPUCacheBindGroups._NumBindGroupsCreatedCurrentFrame;\n        WebGPUCacheBindGroups.NumBindGroupsLookupLastFrame = WebGPUCacheBindGroups._NumBindGroupsLookupCurrentFrame;\n        WebGPUCacheBindGroups.NumBindGroupsNoLookupLastFrame = WebGPUCacheBindGroups._NumBindGroupsNoLookupCurrentFrame;\n        WebGPUCacheBindGroups._NumBindGroupsCreatedCurrentFrame = 0;\n        WebGPUCacheBindGroups._NumBindGroupsLookupCurrentFrame = 0;\n        WebGPUCacheBindGroups._NumBindGroupsNoLookupCurrentFrame = 0;\n    }\n    /**\n     * Cache is currently based on the uniform/storage buffers, samplers and textures used by the binding groups.\n     * Note that all uniform buffers have an offset of 0 in Babylon and we don't have a use case where we would have the same buffer used with different capacity values:\n     * that means we don't need to factor in the offset/size of the buffer in the cache, only the id\n     * @param webgpuPipelineContext\n     * @param drawContext\n     * @param materialContext\n     * @returns a bind group array\n     */\n    getBindGroups(webgpuPipelineContext, drawContext, materialContext) {\n        let bindGroups = undefined;\n        let node = WebGPUCacheBindGroups._Cache;\n        const cacheIsDisabled = this.disabled || materialContext.forceBindGroupCreation;\n        if (!cacheIsDisabled) {\n            if (!drawContext.isDirty(materialContext.updateId) && !materialContext.isDirty) {\n                WebGPUCacheBindGroups._NumBindGroupsNoLookupCurrentFrame++;\n                return drawContext.bindGroups;\n            }\n            for (const bufferName of webgpuPipelineContext.shaderProcessingContext.bufferNames) {\n                const uboId = (drawContext.buffers[bufferName]?.uniqueId ?? 0) + bufferIdStart;\n                let nextNode = node.values[uboId];\n                if (!nextNode) {\n                    nextNode = new WebGPUBindGroupCacheNode();\n                    node.values[uboId] = nextNode;\n                }\n                node = nextNode;\n            }\n            for (const samplerName of webgpuPipelineContext.shaderProcessingContext.samplerNames) {\n                const samplerHashCode = materialContext.samplers[samplerName]?.hashCode ?? 0;\n                let nextNode = node.values[samplerHashCode];\n                if (!nextNode) {\n                    nextNode = new WebGPUBindGroupCacheNode();\n                    node.values[samplerHashCode] = nextNode;\n                }\n                node = nextNode;\n            }\n            for (const textureName of webgpuPipelineContext.shaderProcessingContext.textureNames) {\n                const textureId = (materialContext.textures[textureName]?.texture?.uniqueId ?? 0) + textureIdStart;\n                let nextNode = node.values[textureId];\n                if (!nextNode) {\n                    nextNode = new WebGPUBindGroupCacheNode();\n                    node.values[textureId] = nextNode;\n                }\n                node = nextNode;\n            }\n            bindGroups = node.bindGroups;\n        }\n        drawContext.resetIsDirty(materialContext.updateId);\n        materialContext.isDirty = false;\n        if (bindGroups) {\n            drawContext.bindGroups = bindGroups;\n            WebGPUCacheBindGroups._NumBindGroupsLookupCurrentFrame++;\n            return bindGroups;\n        }\n        bindGroups = [];\n        drawContext.bindGroups = bindGroups;\n        if (!cacheIsDisabled) {\n            node.bindGroups = bindGroups;\n        }\n        WebGPUCacheBindGroups.NumBindGroupsCreatedTotal++;\n        WebGPUCacheBindGroups._NumBindGroupsCreatedCurrentFrame++;\n        const bindGroupLayouts = webgpuPipelineContext.bindGroupLayouts[materialContext.textureState];\n        for (let i = 0; i < webgpuPipelineContext.shaderProcessingContext.bindGroupLayoutEntries.length; i++) {\n            const setDefinition = webgpuPipelineContext.shaderProcessingContext.bindGroupLayoutEntries[i];\n            const entries = webgpuPipelineContext.shaderProcessingContext.bindGroupEntries[i];\n            for (let j = 0; j < setDefinition.length; j++) {\n                const entry = webgpuPipelineContext.shaderProcessingContext.bindGroupLayoutEntries[i][j];\n                const entryInfo = webgpuPipelineContext.shaderProcessingContext.bindGroupLayoutEntryInfo[i][entry.binding];\n                const name = entryInfo.nameInArrayOfTexture ?? entryInfo.name;\n                if (entry.sampler) {\n                    const bindingInfo = materialContext.samplers[name];\n                    if (bindingInfo) {\n                        const sampler = bindingInfo.sampler;\n                        if (!sampler) {\n                            if (this._engine.dbgSanityChecks) {\n                                Logger.Error(`Trying to bind a null sampler! entry=${JSON.stringify(entry)}, name=${name}, bindingInfo=${JSON.stringify(bindingInfo, (key, value) => (key === \"texture\" ? \"<no dump>\" : value))}, materialContext.uniqueId=${materialContext.uniqueId}`, 50);\n                            }\n                            continue;\n                        }\n                        entries[j].resource = this._cacheSampler.getSampler(sampler, false, bindingInfo.hashCode, sampler.label);\n                    }\n                    else {\n                        Logger.Error(`Sampler \"${name}\" could not be bound. entry=${JSON.stringify(entry)}, materialContext=${JSON.stringify(materialContext, (key, value) => key === \"texture\" || key === \"sampler\" ? \"<no dump>\" : value)}`, 50);\n                    }\n                }\n                else if (entry.texture || entry.storageTexture) {\n                    const bindingInfo = materialContext.textures[name];\n                    if (bindingInfo) {\n                        if (this._engine.dbgSanityChecks && bindingInfo.texture === null) {\n                            Logger.Error(`Trying to bind a null texture! name=\"${name}\", entry=${JSON.stringify(entry)}, bindingInfo=${JSON.stringify(bindingInfo, (key, value) => (key === \"texture\" ? \"<no dump>\" : value))}, materialContext.uniqueId=${materialContext.uniqueId}`, 50);\n                            continue;\n                        }\n                        const hardwareTexture = bindingInfo.texture._hardwareTexture;\n                        if (this._engine.dbgSanityChecks &&\n                            (!hardwareTexture || (entry.texture && !hardwareTexture.view) || (entry.storageTexture && !hardwareTexture.viewForWriting))) {\n                            Logger.Error(`Trying to bind a null gpu texture or view! entry=${JSON.stringify(entry)}, name=${name}, bindingInfo=${JSON.stringify(bindingInfo, (key, value) => (key === \"texture\" ? \"<no dump>\" : value))}, isReady=${bindingInfo.texture?.isReady}, materialContext.uniqueId=${materialContext.uniqueId}`, 50);\n                            continue;\n                        }\n                        entries[j].resource = entry.storageTexture ? hardwareTexture.viewForWriting : hardwareTexture.view;\n                    }\n                    else {\n                        Logger.Error(`Texture \"${name}\" could not be bound. entry=${JSON.stringify(entry)}, materialContext=${JSON.stringify(materialContext, (key, value) => key === \"texture\" || key === \"sampler\" ? \"<no dump>\" : value)}`, 50);\n                    }\n                }\n                else if (entry.externalTexture) {\n                    const bindingInfo = materialContext.textures[name];\n                    if (bindingInfo) {\n                        if (this._engine.dbgSanityChecks && bindingInfo.texture === null) {\n                            Logger.Error(`Trying to bind a null external texture! entry=${JSON.stringify(entry)}, name=${name}, bindingInfo=${JSON.stringify(bindingInfo, (key, value) => (key === \"texture\" ? \"<no dump>\" : value))}, materialContext.uniqueId=${materialContext.uniqueId}`, 50);\n                            continue;\n                        }\n                        const externalTexture = bindingInfo.texture.underlyingResource;\n                        if (this._engine.dbgSanityChecks && !externalTexture) {\n                            Logger.Error(`Trying to bind a null gpu external texture! entry=${JSON.stringify(entry)}, name=${name}, bindingInfo=${JSON.stringify(bindingInfo, (key, value) => (key === \"texture\" ? \"<no dump>\" : value))}, isReady=${bindingInfo.texture?.isReady}, materialContext.uniqueId=${materialContext.uniqueId}`, 50);\n                            continue;\n                        }\n                        entries[j].resource = this._device.importExternalTexture({ source: externalTexture });\n                    }\n                    else {\n                        Logger.Error(`Texture \"${name}\" could not be bound. entry=${JSON.stringify(entry)}, materialContext=${JSON.stringify(materialContext, (key, value) => key === \"texture\" || key === \"sampler\" ? \"<no dump>\" : value)}`, 50);\n                    }\n                }\n                else if (entry.buffer) {\n                    const dataBuffer = drawContext.buffers[name];\n                    if (dataBuffer) {\n                        const webgpuBuffer = dataBuffer.underlyingResource;\n                        entries[j].resource.buffer = webgpuBuffer;\n                        entries[j].resource.size = dataBuffer.capacity;\n                    }\n                    else {\n                        Logger.Error(`Can't find buffer \"${name}\". entry=${JSON.stringify(entry)}, buffers=${JSON.stringify(drawContext.buffers)}, drawContext.uniqueId=${drawContext.uniqueId}`, 50);\n                    }\n                }\n            }\n            const groupLayout = bindGroupLayouts[i];\n            bindGroups[i] = this._device.createBindGroup({\n                layout: groupLayout,\n                entries,\n            });\n        }\n        return bindGroups;\n    }\n}\nWebGPUCacheBindGroups.NumBindGroupsCreatedTotal = 0;\nWebGPUCacheBindGroups.NumBindGroupsCreatedLastFrame = 0;\nWebGPUCacheBindGroups.NumBindGroupsLookupLastFrame = 0;\nWebGPUCacheBindGroups.NumBindGroupsNoLookupLastFrame = 0;\nWebGPUCacheBindGroups._Cache = new WebGPUBindGroupCacheNode();\nWebGPUCacheBindGroups._NumBindGroupsCreatedCurrentFrame = 0;\nWebGPUCacheBindGroups._NumBindGroupsLookupCurrentFrame = 0;\nWebGPUCacheBindGroups._NumBindGroupsNoLookupCurrentFrame = 0;\n//# sourceMappingURL=webgpuCacheBindGroups.js.map","// Do not edit.\nimport { ShaderStore } from \"../Engines/shaderStore.js\";\nconst name = \"clearQuadVertexShader\";\nconst shader = `uniform depthValue: f32;const pos=array(\nvec2f(-1.0,1.0),\nvec2f(1.0,1.0),\nvec2f(-1.0,-1.0),\nvec2f(1.0,-1.0)\n);\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvertexOutputs.position=vec4f(pos[input.vertexIndex],uniforms.depthValue,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}\n`;\n// Sideeffect\nif (!ShaderStore.ShadersStoreWGSL[name]) {\n    ShaderStore.ShadersStoreWGSL[name] = shader;\n}\n/** @internal */\nexport const clearQuadVertexShaderWGSL = { name, shader };\n//# sourceMappingURL=clearQuad.vertex.js.map","// Do not edit.\nimport { ShaderStore } from \"../Engines/shaderStore.js\";\nconst name = \"clearQuadPixelShader\";\nconst shader = `uniform color: vec4f;@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {fragmentOutputs.color=uniforms.color;}\n`;\n// Sideeffect\nif (!ShaderStore.ShadersStoreWGSL[name]) {\n    ShaderStore.ShadersStoreWGSL[name] = shader;\n}\n/** @internal */\nexport const clearQuadPixelShaderWGSL = { name, shader };\n//# sourceMappingURL=clearQuad.fragment.js.map","\nimport { WebGPUCacheRenderPipelineTree } from \"./webgpuCacheRenderPipelineTree.js\";\nimport { WebGPUShaderProcessingContext } from \"./webgpuShaderProcessingContext.js\";\nimport { WebGPUTextureHelper } from \"./webgpuTextureHelper.js\";\nimport { renderableTextureFormatToIndex } from \"./webgpuTextureManager.js\";\nimport \"../../ShadersWGSL/clearQuad.vertex.js\";\nimport \"../../ShadersWGSL/clearQuad.fragment.js\";\n/** @internal */\nexport class WebGPUClearQuad {\n    setDepthStencilFormat(format) {\n        this._depthTextureFormat = format;\n        this._cacheRenderPipeline.setDepthStencilFormat(format);\n    }\n    setColorFormat(format) {\n        this._cacheRenderPipeline.setColorFormat(format);\n    }\n    setMRTAttachments(attachments, textureArray, textureCount) {\n        this._cacheRenderPipeline.setMRT(textureArray, textureCount);\n        this._cacheRenderPipeline.setMRTAttachments(attachments);\n    }\n    constructor(device, engine, emptyVertexBuffer) {\n        this._bindGroups = {};\n        this._bundleCache = {};\n        this._keyTemp = [];\n        this._device = device;\n        this._engine = engine;\n        this._cacheRenderPipeline = new WebGPUCacheRenderPipelineTree(this._device, emptyVertexBuffer);\n        this._cacheRenderPipeline.setDepthTestEnabled(false);\n        this._cacheRenderPipeline.setStencilReadMask(0xff);\n        this._effect = engine.createEffect(\"clearQuad\", [], [\"color\", \"depthValue\"], undefined, undefined, undefined, undefined, undefined, undefined, 1 /* ShaderLanguage.WGSL */);\n    }\n    clear(renderPass, clearColor, clearDepth, clearStencil, sampleCount = 1) {\n        let renderPass2;\n        let bundle = null;\n        let bundleKey;\n        const isRTTPass = !!this._engine._currentRenderTarget;\n        if (renderPass) {\n            renderPass2 = renderPass;\n        }\n        else {\n            let idx = 0;\n            this._keyTemp.length = 0;\n            for (let i = 0; i < this._cacheRenderPipeline.colorFormats.length; ++i) {\n                this._keyTemp[idx++] = renderableTextureFormatToIndex[this._cacheRenderPipeline.colorFormats[i] ?? \"\"];\n            }\n            const depthStencilFormatIndex = renderableTextureFormatToIndex[this._depthTextureFormat ?? 0];\n            this._keyTemp[idx] =\n                (clearColor ? clearColor.r + clearColor.g * 256 + clearColor.b * 256 * 256 + clearColor.a * 256 * 256 * 256 : 0) +\n                    (clearDepth ? 2 ** 32 : 0) +\n                    (clearStencil ? 2 ** 33 : 0) +\n                    (this._engine.useReverseDepthBuffer ? 2 ** 34 : 0) +\n                    (isRTTPass ? 2 ** 35 : 0) +\n                    (sampleCount > 1 ? 2 ** 36 : 0) +\n                    depthStencilFormatIndex * 2 ** 37;\n            bundleKey = this._keyTemp.join(\"_\");\n            bundle = this._bundleCache[bundleKey];\n            if (bundle) {\n                return bundle;\n            }\n            renderPass2 = this._device.createRenderBundleEncoder({\n                label: \"clearQuadRenderBundle\",\n                colorFormats: this._cacheRenderPipeline.colorFormats,\n                depthStencilFormat: this._depthTextureFormat,\n                sampleCount: WebGPUTextureHelper.GetSample(sampleCount),\n            });\n        }\n        this._cacheRenderPipeline.setDepthWriteEnabled(!!clearDepth);\n        this._cacheRenderPipeline.setStencilEnabled(!!clearStencil && !!this._depthTextureFormat && WebGPUTextureHelper.HasStencilAspect(this._depthTextureFormat));\n        this._cacheRenderPipeline.setStencilWriteMask(clearStencil ? 0xff : 0);\n        this._cacheRenderPipeline.setStencilCompare(clearStencil ? 519 : 512);\n        this._cacheRenderPipeline.setStencilPassOp(clearStencil ? 7681 : 7680);\n        this._cacheRenderPipeline.setWriteMask(clearColor ? 0xf : 0);\n        const pipeline = this._cacheRenderPipeline.getRenderPipeline(7, this._effect, sampleCount);\n        const webgpuPipelineContext = this._effect._pipelineContext;\n        if (clearColor) {\n            this._effect.setDirectColor4(\"color\", clearColor);\n        }\n        this._effect.setFloat(\"depthValue\", this._engine.useReverseDepthBuffer ? this._engine._clearReverseDepthValue : this._engine._clearDepthValue);\n        webgpuPipelineContext.uniformBuffer.update();\n        const bufferInternals = isRTTPass ? this._engine._ubInvertY : this._engine._ubDontInvertY;\n        const bufferLeftOver = webgpuPipelineContext.uniformBuffer.getBuffer();\n        const key = bufferLeftOver.uniqueId + \"-\" + bufferInternals.uniqueId;\n        let bindGroups = this._bindGroups[key];\n        if (!bindGroups) {\n            const bindGroupLayouts = webgpuPipelineContext.bindGroupLayouts[0];\n            bindGroups = this._bindGroups[key] = [];\n            bindGroups.push(this._device.createBindGroup({\n                label: `clearQuadBindGroup0-${key}`,\n                layout: bindGroupLayouts[0],\n                entries: [],\n            }));\n            if (!WebGPUShaderProcessingContext._SimplifiedKnownBindings) {\n                bindGroups.push(this._device.createBindGroup({\n                    label: `clearQuadBindGroup1-${key}`,\n                    layout: bindGroupLayouts[1],\n                    entries: [],\n                }));\n            }\n            bindGroups.push(this._device.createBindGroup({\n                label: `clearQuadBindGroup${WebGPUShaderProcessingContext._SimplifiedKnownBindings ? 1 : 2}-${key}`,\n                layout: bindGroupLayouts[WebGPUShaderProcessingContext._SimplifiedKnownBindings ? 1 : 2],\n                entries: [\n                    {\n                        binding: 0,\n                        resource: {\n                            buffer: bufferInternals.underlyingResource,\n                            size: bufferInternals.capacity,\n                        },\n                    },\n                    {\n                        binding: 1,\n                        resource: {\n                            buffer: bufferLeftOver.underlyingResource,\n                            size: bufferLeftOver.capacity,\n                        },\n                    },\n                ],\n            }));\n        }\n        renderPass2.setPipeline(pipeline);\n        for (let i = 0; i < bindGroups.length; ++i) {\n            renderPass2.setBindGroup(i, bindGroups[i]);\n        }\n        renderPass2.draw(4, 1, 0, 0);\n        if (!renderPass) {\n            bundle = renderPass2.finish();\n            this._bundleCache[bundleKey] = bundle;\n        }\n        return bundle;\n    }\n}\n//# sourceMappingURL=webgpuClearQuad.js.map","import { WebGPUTextureHelper } from \"./webgpuTextureHelper.js\";\n/** @internal */\nexport class WebGPURenderItemViewport {\n    constructor(x, y, w, h) {\n        this.x = Math.floor(x);\n        this.y = Math.floor(y);\n        this.w = Math.floor(w);\n        this.h = Math.floor(h);\n    }\n    run(renderPass) {\n        renderPass.setViewport(this.x, this.y, this.w, this.h, 0, 1);\n    }\n    clone() {\n        return new WebGPURenderItemViewport(this.x, this.y, this.w, this.h);\n    }\n}\n/** @internal */\nexport class WebGPURenderItemScissor {\n    constructor(x, y, w, h) {\n        this.x = x;\n        this.y = y;\n        this.w = w;\n        this.h = h;\n    }\n    run(renderPass) {\n        renderPass.setScissorRect(this.x, this.y, this.w, this.h);\n    }\n    clone() {\n        return new WebGPURenderItemScissor(this.x, this.y, this.w, this.h);\n    }\n}\n/** @internal */\nexport class WebGPURenderItemStencilRef {\n    constructor(ref) {\n        this.ref = ref;\n    }\n    run(renderPass) {\n        renderPass.setStencilReference(this.ref);\n    }\n    clone() {\n        return new WebGPURenderItemStencilRef(this.ref);\n    }\n}\n/** @internal */\nexport class WebGPURenderItemBlendColor {\n    constructor(color) {\n        this.color = color;\n    }\n    run(renderPass) {\n        renderPass.setBlendConstant(this.color);\n    }\n    clone() {\n        return new WebGPURenderItemBlendColor(this.color);\n    }\n}\n/** @internal */\nexport class WebGPURenderItemBeginOcclusionQuery {\n    constructor(query) {\n        this.query = query;\n    }\n    run(renderPass) {\n        renderPass.beginOcclusionQuery(this.query);\n    }\n    clone() {\n        return new WebGPURenderItemBeginOcclusionQuery(this.query);\n    }\n}\n/** @internal */\nexport class WebGPURenderItemEndOcclusionQuery {\n    constructor() { }\n    run(renderPass) {\n        renderPass.endOcclusionQuery();\n    }\n    clone() {\n        return new WebGPURenderItemEndOcclusionQuery();\n    }\n}\nclass WebGPURenderItemBundles {\n    constructor() {\n        this.bundles = [];\n    }\n    run(renderPass) {\n        renderPass.executeBundles(this.bundles);\n    }\n    clone() {\n        const cloned = new WebGPURenderItemBundles();\n        cloned.bundles = this.bundles;\n        return cloned;\n    }\n}\n/** @internal */\nexport class WebGPUBundleList {\n    constructor(device) {\n        this.numDrawCalls = 0;\n        this._device = device;\n        this._list = new Array(10);\n        this._listLength = 0;\n    }\n    addBundle(bundle) {\n        if (!this._currentItemIsBundle) {\n            const item = new WebGPURenderItemBundles();\n            this._list[this._listLength++] = item;\n            this._currentBundleList = item.bundles;\n            this._currentItemIsBundle = true;\n        }\n        if (bundle) {\n            this._currentBundleList.push(bundle);\n        }\n    }\n    _finishBundle() {\n        if (this._currentItemIsBundle && this._bundleEncoder) {\n            this._currentBundleList.push(this._bundleEncoder.finish());\n            this._bundleEncoder = undefined;\n            this._currentItemIsBundle = false;\n        }\n    }\n    addItem(item) {\n        this._finishBundle();\n        this._list[this._listLength++] = item;\n        this._currentItemIsBundle = false;\n    }\n    getBundleEncoder(colorFormats, depthStencilFormat, sampleCount) {\n        if (!this._currentItemIsBundle) {\n            this.addBundle();\n            this._bundleEncoder = this._device.createRenderBundleEncoder({\n                colorFormats,\n                depthStencilFormat,\n                sampleCount: WebGPUTextureHelper.GetSample(sampleCount),\n            });\n        }\n        return this._bundleEncoder;\n    }\n    close() {\n        this._finishBundle();\n    }\n    run(renderPass) {\n        this.close();\n        for (let i = 0; i < this._listLength; ++i) {\n            this._list[i].run(renderPass);\n        }\n    }\n    reset() {\n        this._listLength = 0;\n        this._currentItemIsBundle = false;\n        this.numDrawCalls = 0;\n    }\n    clone() {\n        this.close();\n        const cloned = new WebGPUBundleList(this._device);\n        cloned._list = new Array(this._listLength);\n        cloned._listLength = this._listLength;\n        cloned.numDrawCalls = this.numDrawCalls;\n        for (let i = 0; i < this._listLength; ++i) {\n            cloned._list[i] = this._list[i].clone();\n        }\n        return cloned;\n    }\n}\n//# sourceMappingURL=webgpuBundleList.js.map","import * as WebGPUConstants from \"./webgpuConstants.js\";\n/** @internal */\nexport class WebGPUQuerySet {\n    get querySet() {\n        return this._querySet;\n    }\n    constructor(engine, count, type, device, bufferManager, canUseMultipleBuffers = true, label) {\n        this._dstBuffers = [];\n        this._engine = engine;\n        this._device = device;\n        this._bufferManager = bufferManager;\n        this._count = count;\n        this._canUseMultipleBuffers = canUseMultipleBuffers;\n        this._querySet = device.createQuerySet({\n            label: label ?? \"QuerySet\",\n            type,\n            count,\n        });\n        this._queryBuffer = bufferManager.createRawBuffer(8 * count, WebGPUConstants.BufferUsage.QueryResolve | WebGPUConstants.BufferUsage.CopySrc, undefined, \"QueryBuffer\");\n        if (!canUseMultipleBuffers) {\n            this._dstBuffers.push(this._bufferManager.createRawBuffer(8 * this._count, WebGPUConstants.BufferUsage.MapRead | WebGPUConstants.BufferUsage.CopyDst, undefined, \"QueryBufferNoMultipleBuffers\"));\n        }\n    }\n    _getBuffer(firstQuery, queryCount) {\n        if (!this._canUseMultipleBuffers && this._dstBuffers.length === 0) {\n            return null;\n        }\n        const encoderResult = this._device.createCommandEncoder();\n        let buffer;\n        if (this._dstBuffers.length === 0) {\n            buffer = this._bufferManager.createRawBuffer(8 * this._count, WebGPUConstants.BufferUsage.MapRead | WebGPUConstants.BufferUsage.CopyDst, undefined, \"QueryBufferAdditionalBuffer\");\n        }\n        else {\n            buffer = this._dstBuffers[this._dstBuffers.length - 1];\n            this._dstBuffers.length--;\n        }\n        encoderResult.resolveQuerySet(this._querySet, firstQuery, queryCount, this._queryBuffer, 0);\n        encoderResult.copyBufferToBuffer(this._queryBuffer, 0, buffer, 0, 8 * queryCount);\n        this._device.queue.submit([encoderResult.finish()]);\n        return buffer;\n    }\n    async readValues(firstQuery = 0, queryCount = 1) {\n        const buffer = this._getBuffer(firstQuery, queryCount);\n        if (buffer === null) {\n            return null;\n        }\n        const engineId = this._engine.uniqueId;\n        return buffer.mapAsync(1 /* WebGPUConstants.MapMode.Read */).then(() => {\n            const arrayBuf = new BigUint64Array(buffer.getMappedRange()).slice();\n            buffer.unmap();\n            this._dstBuffers[this._dstBuffers.length] = buffer;\n            return arrayBuf;\n        }, (err) => {\n            if (this._engine.isDisposed || this._engine.uniqueId !== engineId) {\n                // Engine disposed or context loss/restoration\n                return null;\n            }\n            throw err;\n        });\n    }\n    async readValue(firstQuery = 0) {\n        const buffer = this._getBuffer(firstQuery, 1);\n        if (buffer === null) {\n            return null;\n        }\n        const engineId = this._engine.uniqueId;\n        return buffer.mapAsync(1 /* WebGPUConstants.MapMode.Read */).then(() => {\n            const arrayBuf = new BigUint64Array(buffer.getMappedRange());\n            const value = Number(arrayBuf[0]);\n            buffer.unmap();\n            this._dstBuffers[this._dstBuffers.length] = buffer;\n            return value;\n        }, (err) => {\n            if (this._engine.isDisposed || this._engine.uniqueId !== engineId) {\n                // Engine disposed or context loss/restoration\n                return 0;\n            }\n            throw err;\n        });\n    }\n    async readTwoValuesAndSubtract(firstQuery = 0) {\n        const buffer = this._getBuffer(firstQuery, 2);\n        if (buffer === null) {\n            return null;\n        }\n        const engineId = this._engine.uniqueId;\n        return buffer.mapAsync(1 /* WebGPUConstants.MapMode.Read */).then(() => {\n            const arrayBuf = new BigUint64Array(buffer.getMappedRange());\n            const value = Number(arrayBuf[1] - arrayBuf[0]);\n            buffer.unmap();\n            this._dstBuffers[this._dstBuffers.length] = buffer;\n            return value;\n        }, (err) => {\n            if (this._engine.isDisposed || this._engine.uniqueId !== engineId) {\n                // Engine disposed or context loss/restoration\n                return 0;\n            }\n            throw err;\n        });\n    }\n    dispose() {\n        this._querySet.destroy();\n        this._bufferManager.releaseBuffer(this._queryBuffer);\n        for (let i = 0; i < this._dstBuffers.length; ++i) {\n            this._bufferManager.releaseBuffer(this._dstBuffers[i]);\n        }\n    }\n}\n//# sourceMappingURL=webgpuQuerySet.js.map","import { PerfCounter } from \"../../Misc/perfCounter.js\";\nimport { WebGPUQuerySet } from \"./webgpuQuerySet.js\";\nimport { Logger } from \"../../Misc/logger.js\";\n/** @internal */\nexport class WebGPUTimestampQuery {\n    get gpuFrameTimeCounter() {\n        return this._gpuFrameTimeCounter;\n    }\n    constructor(engine, device, bufferManager) {\n        this._enabled = false;\n        this._gpuFrameTimeCounter = new PerfCounter();\n        this._measureDurationState = 0;\n        this._engine = engine;\n        this._device = device;\n        this._bufferManager = bufferManager;\n    }\n    get enable() {\n        return this._enabled;\n    }\n    set enable(value) {\n        if (this._enabled === value) {\n            return;\n        }\n        this._enabled = value;\n        this._measureDurationState = 0;\n        if (value) {\n            try {\n                this._measureDuration = new WebGPUDurationMeasure(this._engine, this._device, this._bufferManager, 2000, \"QuerySet_TimestampQuery\");\n            }\n            catch (e) {\n                this._enabled = false;\n                Logger.Error(\"Could not create a WebGPUDurationMeasure!\\nError: \" + e.message + \"\\nMake sure timestamp query is supported and enabled in your browser.\");\n                return;\n            }\n        }\n        else {\n            this._measureDuration.dispose();\n        }\n    }\n    startFrame(commandEncoder) {\n        if (this._enabled && this._measureDurationState === 0) {\n            this._measureDuration.start(commandEncoder);\n            this._measureDurationState = 1;\n        }\n    }\n    endFrame(commandEncoder) {\n        if (this._measureDurationState === 1) {\n            this._measureDurationState = 2;\n            this._measureDuration.stop(commandEncoder).then((duration) => {\n                if (duration !== null && duration >= 0) {\n                    this._gpuFrameTimeCounter.fetchNewFrame();\n                    this._gpuFrameTimeCounter.addCount(duration, true);\n                }\n                this._measureDurationState = 0;\n            });\n        }\n    }\n    startPass(descriptor, index) {\n        if (this._enabled) {\n            this._measureDuration.startPass(descriptor, index);\n        }\n        else {\n            descriptor.timestampWrites = undefined;\n        }\n    }\n    endPass(index, gpuPerfCounter) {\n        if (!this._enabled || !gpuPerfCounter) {\n            return;\n        }\n        const currentFrameId = this._engine.frameId;\n        this._measureDuration.stopPass(index).then((duration_) => {\n            gpuPerfCounter._addDuration(currentFrameId, duration_ !== null && duration_ > 0 ? duration_ : 0);\n        });\n    }\n    dispose() {\n        this._measureDuration?.dispose();\n    }\n}\n/** @internal */\nexport class WebGPUDurationMeasure {\n    constructor(engine, device, bufferManager, count = 2, querySetLabel) {\n        this._count = count;\n        this._querySet = new WebGPUQuerySet(engine, count, \"timestamp\" /* WebGPUConstants.QueryType.Timestamp */, device, bufferManager, true, querySetLabel);\n    }\n    start(encoder) {\n        encoder.writeTimestamp?.(this._querySet.querySet, 0);\n    }\n    async stop(encoder) {\n        encoder.writeTimestamp?.(this._querySet.querySet, 1);\n        return encoder.writeTimestamp ? this._querySet.readTwoValuesAndSubtract(0) : 0;\n    }\n    startPass(descriptor, index) {\n        if (index + 3 > this._count) {\n            throw new Error(\"WebGPUDurationMeasure: index out of range (\" + index + \")\");\n        }\n        descriptor.timestampWrites = {\n            querySet: this._querySet.querySet,\n            beginningOfPassWriteIndex: index + 2,\n            endOfPassWriteIndex: index + 3,\n        };\n    }\n    async stopPass(index) {\n        return this._querySet.readTwoValuesAndSubtract(index + 2);\n    }\n    dispose() {\n        this._querySet.dispose();\n    }\n}\n//# sourceMappingURL=webgpuTimestampQuery.js.map","import { WebGPUQuerySet } from \"./webgpuQuerySet.js\";\n/** @internal */\nexport class WebGPUOcclusionQuery {\n    get querySet() {\n        return this._querySet.querySet;\n    }\n    get hasQueries() {\n        return this._currentTotalIndices !== this._availableIndices.length;\n    }\n    canBeginQuery(index) {\n        if (this._frameQuerySetIsDirty === this._engine.frameId || this._queryFrameId[index] === this._engine.frameId) {\n            return false;\n        }\n        const canBegin = this._engine._getCurrentRenderPassWrapper().renderPassDescriptor.occlusionQuerySet !== undefined;\n        if (canBegin) {\n            this._queryFrameId[index] = this._engine.frameId;\n        }\n        return canBegin;\n    }\n    constructor(engine, device, bufferManager, startCount = 50, incrementCount = 100) {\n        this._availableIndices = [];\n        this._frameQuerySetIsDirty = -1;\n        this._queryFrameId = [];\n        this._engine = engine;\n        this._device = device;\n        this._bufferManager = bufferManager;\n        this._frameLastBuffer = -1;\n        this._currentTotalIndices = 0;\n        this._countIncrement = incrementCount;\n        this._allocateNewIndices(startCount);\n    }\n    createQuery() {\n        if (this._availableIndices.length === 0) {\n            this._allocateNewIndices();\n        }\n        const index = this._availableIndices[this._availableIndices.length - 1];\n        this._availableIndices.length--;\n        return index;\n    }\n    deleteQuery(index) {\n        this._availableIndices[this._availableIndices.length] = index;\n    }\n    isQueryResultAvailable(index) {\n        this._retrieveQueryBuffer();\n        return !!this._lastBuffer && index < this._lastBuffer.length;\n    }\n    getQueryResult(index) {\n        return Number(this._lastBuffer?.[index] ?? -1);\n    }\n    _retrieveQueryBuffer() {\n        if (this._lastBuffer && this._frameLastBuffer === this._engine.frameId) {\n            return;\n        }\n        if (this._frameLastBuffer !== this._engine.frameId) {\n            this._frameLastBuffer = this._engine.frameId;\n            this._querySet.readValues(0, this._currentTotalIndices).then((arrayBuffer) => {\n                this._lastBuffer = arrayBuffer;\n            });\n        }\n    }\n    _allocateNewIndices(numIndices) {\n        numIndices = numIndices ?? this._countIncrement;\n        this._delayQuerySetDispose();\n        for (let i = 0; i < numIndices; ++i) {\n            this._availableIndices.push(this._currentTotalIndices + i);\n        }\n        this._currentTotalIndices += numIndices;\n        this._querySet = new WebGPUQuerySet(this._engine, this._currentTotalIndices, \"occlusion\" /* WebGPUConstants.QueryType.Occlusion */, this._device, this._bufferManager, false, \"QuerySet_OcclusionQuery_count_\" + this._currentTotalIndices);\n        this._frameQuerySetIsDirty = this._engine.frameId;\n    }\n    _delayQuerySetDispose() {\n        const querySet = this._querySet;\n        if (querySet) {\n            // Wait a bit before disposing of the queryset, in case some queries are still running for it\n            setTimeout(() => querySet.dispose, 1000);\n        }\n    }\n    dispose() {\n        this._querySet?.dispose();\n        this._availableIndices.length = 0;\n    }\n}\n//# sourceMappingURL=webgpuOcclusionQuery.js.map","import { Logger } from \"../../Misc/logger.js\";\nimport { EscapeRegExp, ExtractBetweenMarkers, FindBackward, IsIdentifierChar, RemoveComments, SkipWhitespaces } from \"../../Misc/codeStringParsingTools.js\";\n/**\n * Class used to inline functions in shader code\n */\nexport class ShaderCodeInliner {\n    /** Gets the code after the inlining process */\n    get code() {\n        return this._sourceCode;\n    }\n    /**\n     * Initializes the inliner\n     * @param sourceCode shader code source to inline\n     * @param numMaxIterations maximum number of iterations (used to detect recursive calls)\n     */\n    constructor(sourceCode, numMaxIterations = 20) {\n        /** Gets or sets the debug mode */\n        this.debug = false;\n        this._sourceCode = sourceCode;\n        this._numMaxIterations = numMaxIterations;\n        this._functionDescr = [];\n        this.inlineToken = \"#define inline\";\n    }\n    /**\n     * Start the processing of the shader code\n     */\n    processCode() {\n        if (this.debug) {\n            Logger.Log(`Start inlining process (code size=${this._sourceCode.length})...`);\n        }\n        this._collectFunctions();\n        this._processInlining(this._numMaxIterations);\n        if (this.debug) {\n            Logger.Log(\"End of inlining process.\");\n        }\n    }\n    _collectFunctions() {\n        let startIndex = 0;\n        while (startIndex < this._sourceCode.length) {\n            // locate the function to inline and extract its name\n            const inlineTokenIndex = this._sourceCode.indexOf(this.inlineToken, startIndex);\n            if (inlineTokenIndex < 0) {\n                break;\n            }\n            const funcParamsStartIndex = this._sourceCode.indexOf(\"(\", inlineTokenIndex + this.inlineToken.length);\n            if (funcParamsStartIndex < 0) {\n                if (this.debug) {\n                    Logger.Warn(`Could not find the opening parenthesis after the token. startIndex=${startIndex}`);\n                }\n                startIndex = inlineTokenIndex + this.inlineToken.length;\n                continue;\n            }\n            const funcNameMatch = ShaderCodeInliner._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(inlineTokenIndex + this.inlineToken.length, funcParamsStartIndex));\n            if (!funcNameMatch) {\n                if (this.debug) {\n                    Logger.Warn(`Could not extract the name/type of the function from: ${this._sourceCode.substring(inlineTokenIndex + this.inlineToken.length, funcParamsStartIndex)}`);\n                }\n                startIndex = inlineTokenIndex + this.inlineToken.length;\n                continue;\n            }\n            const [funcType, funcName] = [funcNameMatch[3], funcNameMatch[4]];\n            // extract the parameters of the function as a whole string (without the leading / trailing parenthesis)\n            const funcParamsEndIndex = ExtractBetweenMarkers(\"(\", \")\", this._sourceCode, funcParamsStartIndex);\n            if (funcParamsEndIndex < 0) {\n                if (this.debug) {\n                    Logger.Warn(`Could not extract the parameters the function '${funcName}' (type=${funcType}). funcParamsStartIndex=${funcParamsStartIndex}`);\n                }\n                startIndex = inlineTokenIndex + this.inlineToken.length;\n                continue;\n            }\n            const funcParams = this._sourceCode.substring(funcParamsStartIndex + 1, funcParamsEndIndex);\n            // extract the body of the function (with the curly brackets)\n            const funcBodyStartIndex = SkipWhitespaces(this._sourceCode, funcParamsEndIndex + 1);\n            if (funcBodyStartIndex === this._sourceCode.length) {\n                if (this.debug) {\n                    Logger.Warn(`Could not extract the body of the function '${funcName}' (type=${funcType}). funcParamsEndIndex=${funcParamsEndIndex}`);\n                }\n                startIndex = inlineTokenIndex + this.inlineToken.length;\n                continue;\n            }\n            const funcBodyEndIndex = ExtractBetweenMarkers(\"{\", \"}\", this._sourceCode, funcBodyStartIndex);\n            if (funcBodyEndIndex < 0) {\n                if (this.debug) {\n                    Logger.Warn(`Could not extract the body of the function '${funcName}' (type=${funcType}). funcBodyStartIndex=${funcBodyStartIndex}`);\n                }\n                startIndex = inlineTokenIndex + this.inlineToken.length;\n                continue;\n            }\n            const funcBody = this._sourceCode.substring(funcBodyStartIndex, funcBodyEndIndex + 1);\n            // process the parameters: extract each names\n            const params = RemoveComments(funcParams).split(\",\");\n            const paramNames = [];\n            for (let p = 0; p < params.length; ++p) {\n                const param = params[p].trim();\n                const idx = param.lastIndexOf(\" \");\n                if (idx >= 0) {\n                    paramNames.push(param.substring(idx + 1));\n                }\n            }\n            if (funcType !== \"void\") {\n                // for functions that return a value, we will replace \"return\" by \"tempvarname = \", tempvarname being a unique generated name\n                paramNames.push(\"return\");\n            }\n            // collect the function\n            this._functionDescr.push({\n                name: funcName,\n                type: funcType,\n                parameters: paramNames,\n                body: funcBody,\n                callIndex: 0,\n            });\n            startIndex = funcBodyEndIndex + 1;\n            // remove the function from the source code\n            const partBefore = inlineTokenIndex > 0 ? this._sourceCode.substring(0, inlineTokenIndex) : \"\";\n            const partAfter = funcBodyEndIndex + 1 < this._sourceCode.length - 1 ? this._sourceCode.substring(funcBodyEndIndex + 1) : \"\";\n            this._sourceCode = partBefore + partAfter;\n            startIndex -= funcBodyEndIndex + 1 - inlineTokenIndex;\n        }\n        if (this.debug) {\n            Logger.Log(`Collect functions: ${this._functionDescr.length} functions found. functionDescr=${this._functionDescr}`);\n        }\n    }\n    _processInlining(numMaxIterations = 20) {\n        while (numMaxIterations-- >= 0) {\n            if (!this._replaceFunctionCallsByCode()) {\n                break;\n            }\n        }\n        if (this.debug) {\n            Logger.Log(`numMaxIterations is ${numMaxIterations} after inlining process`);\n        }\n        return numMaxIterations >= 0;\n    }\n    _replaceFunctionCallsByCode() {\n        let doAgain = false;\n        for (const func of this._functionDescr) {\n            const { name, type, parameters, body } = func;\n            let startIndex = 0;\n            while (startIndex < this._sourceCode.length) {\n                // Look for the function name in the source code\n                const functionCallIndex = this._sourceCode.indexOf(name, startIndex);\n                if (functionCallIndex < 0) {\n                    break;\n                }\n                // Make sure \"name\" is not part of a bigger string\n                if (functionCallIndex === 0 || IsIdentifierChar(this._sourceCode.charAt(functionCallIndex - 1))) {\n                    startIndex = functionCallIndex + name.length;\n                    continue;\n                }\n                // Find the opening parenthesis\n                const callParamsStartIndex = SkipWhitespaces(this._sourceCode, functionCallIndex + name.length);\n                if (callParamsStartIndex === this._sourceCode.length || this._sourceCode.charAt(callParamsStartIndex) !== \"(\") {\n                    startIndex = functionCallIndex + name.length;\n                    continue;\n                }\n                // extract the parameters of the function call as a whole string (without the leading / trailing parenthesis)\n                const callParamsEndIndex = ExtractBetweenMarkers(\"(\", \")\", this._sourceCode, callParamsStartIndex);\n                if (callParamsEndIndex < 0) {\n                    if (this.debug) {\n                        Logger.Warn(`Could not extract the parameters of the function call. Function '${name}' (type=${type}). callParamsStartIndex=${callParamsStartIndex}`);\n                    }\n                    startIndex = functionCallIndex + name.length;\n                    continue;\n                }\n                const callParams = this._sourceCode.substring(callParamsStartIndex + 1, callParamsEndIndex);\n                // process the parameter call: extract each names\n                // this function split the parameter list used in the function call at ',' boundaries by taking care of potential parenthesis like in:\n                //      myfunc(a, vec2(1., 0.), 4.)\n                const splitParameterCall = (s) => {\n                    const parameters = [];\n                    let curIdx = 0, startParamIdx = 0;\n                    while (curIdx < s.length) {\n                        if (s.charAt(curIdx) === \"(\") {\n                            const idx2 = ExtractBetweenMarkers(\"(\", \")\", s, curIdx);\n                            if (idx2 < 0) {\n                                return null;\n                            }\n                            curIdx = idx2;\n                        }\n                        else if (s.charAt(curIdx) === \",\") {\n                            parameters.push(s.substring(startParamIdx, curIdx));\n                            startParamIdx = curIdx + 1;\n                        }\n                        curIdx++;\n                    }\n                    if (startParamIdx < curIdx) {\n                        parameters.push(s.substring(startParamIdx, curIdx));\n                    }\n                    return parameters;\n                };\n                const params = splitParameterCall(RemoveComments(callParams));\n                if (params === null) {\n                    if (this.debug) {\n                        Logger.Warn(`Invalid function call: can't extract the parameters of the function call. Function '${name}' (type=${type}). callParamsStartIndex=${callParamsStartIndex}, callParams=` +\n                            callParams);\n                    }\n                    startIndex = functionCallIndex + name.length;\n                    continue;\n                }\n                const paramNames = [];\n                for (let p = 0; p < params.length; ++p) {\n                    const param = params[p].trim();\n                    paramNames.push(param);\n                }\n                const retParamName = type !== \"void\" ? name + \"_\" + func.callIndex++ : null;\n                if (retParamName) {\n                    paramNames.push(retParamName + \" =\");\n                }\n                if (paramNames.length !== parameters.length) {\n                    if (this.debug) {\n                        Logger.Warn(`Invalid function call: not the same number of parameters for the call than the number expected by the function. Function '${name}' (type=${type}). function parameters=${parameters}, call parameters=${paramNames}`);\n                    }\n                    startIndex = functionCallIndex + name.length;\n                    continue;\n                }\n                startIndex = callParamsEndIndex + 1;\n                // replace the function call by the body function\n                const funcBody = this._replaceNames(body, parameters, paramNames);\n                let partBefore = functionCallIndex > 0 ? this._sourceCode.substring(0, functionCallIndex) : \"\";\n                const partAfter = callParamsEndIndex + 1 < this._sourceCode.length - 1 ? this._sourceCode.substring(callParamsEndIndex + 1) : \"\";\n                if (retParamName) {\n                    // case where the function returns a value. We generate:\n                    // FUNCTYPE retParamName;\n                    // {function body}\n                    // and replace the function call by retParamName\n                    const injectDeclarationIndex = FindBackward(this._sourceCode, functionCallIndex - 1, \"\\n\", \"{\");\n                    partBefore = this._sourceCode.substring(0, injectDeclarationIndex + 1);\n                    const partBetween = this._sourceCode.substring(injectDeclarationIndex + 1, functionCallIndex);\n                    this._sourceCode = partBefore + type + \" \" + retParamName + \";\\n\" + funcBody + \"\\n\" + partBetween + retParamName + partAfter;\n                    if (this.debug) {\n                        Logger.Log(`Replace function call by code. Function '${name}' (type=${type}). injectDeclarationIndex=${injectDeclarationIndex}, call parameters=${paramNames}`);\n                    }\n                }\n                else {\n                    // simple case where the return value of the function is \"void\"\n                    this._sourceCode = partBefore + funcBody + partAfter;\n                    startIndex += funcBody.length - (callParamsEndIndex + 1 - functionCallIndex);\n                    if (this.debug) {\n                        Logger.Log(`Replace function call by code. Function '${name}' (type=${type}). functionCallIndex=${functionCallIndex}, call parameters=${paramNames}`);\n                    }\n                }\n                doAgain = true;\n            }\n        }\n        return doAgain;\n    }\n    _replaceNames(code, sources, destinations) {\n        for (let i = 0; i < sources.length; ++i) {\n            const source = new RegExp(EscapeRegExp(sources[i]), \"g\"), sourceLen = sources[i].length, destination = destinations[i];\n            code = code.replace(source, (match, ...args) => {\n                const offset = args[0];\n                // Make sure \"source\" is not part of a bigger identifier (for eg, if source=view and we matched it with viewDirection)\n                if (IsIdentifierChar(code.charAt(offset - 1)) || IsIdentifierChar(code.charAt(offset + sourceLen))) {\n                    return sources[i];\n                }\n                return destination;\n            });\n        }\n        return code;\n    }\n}\nShaderCodeInliner._RegexpFindFunctionNameAndType = /((\\s+?)(\\w+)\\s+(\\w+)\\s*?)$/;\n//# sourceMappingURL=shaderCodeInliner.js.map","import { Logger } from \"../../Misc/logger.js\";\nimport { Tools } from \"../../Misc/tools.js\";\n/** @internal */\nexport class WebGPUTintWASM {\n    async initTwgsl(twgslOptions) {\n        if (WebGPUTintWASM._Twgsl) {\n            return;\n        }\n        twgslOptions = twgslOptions || {};\n        twgslOptions = {\n            ...WebGPUTintWASM._TWgslDefaultOptions,\n            ...twgslOptions,\n        };\n        if (twgslOptions.twgsl) {\n            WebGPUTintWASM._Twgsl = twgslOptions.twgsl;\n            return Promise.resolve();\n        }\n        if (twgslOptions.jsPath && twgslOptions.wasmPath) {\n            await Tools.LoadBabylonScriptAsync(twgslOptions.jsPath);\n        }\n        if (self.twgsl) {\n            WebGPUTintWASM._Twgsl = await self.twgsl(Tools.GetBabylonScriptURL(twgslOptions.wasmPath));\n            return Promise.resolve();\n        }\n        return Promise.reject(\"twgsl is not available.\");\n    }\n    convertSpirV2WGSL(code, disableUniformityAnalysis = false) {\n        const ccode = WebGPUTintWASM._Twgsl.convertSpirV2WGSL(code, WebGPUTintWASM.DisableUniformityAnalysis || disableUniformityAnalysis);\n        if (WebGPUTintWASM.ShowWGSLShaderCode) {\n            Logger.Log(ccode);\n            Logger.Log(\"***********************************************\");\n        }\n        return WebGPUTintWASM.DisableUniformityAnalysis || disableUniformityAnalysis ? \"diagnostic(off, derivative_uniformity);\\n\" + ccode : ccode;\n    }\n}\n// Default twgsl options.\nWebGPUTintWASM._TWgslDefaultOptions = {\n    jsPath: `${Tools._DefaultCdnUrl}/twgsl/twgsl.js`,\n    wasmPath: `${Tools._DefaultCdnUrl}/twgsl/twgsl.wasm`,\n};\nWebGPUTintWASM.ShowWGSLShaderCode = false;\nWebGPUTintWASM.DisableUniformityAnalysis = false;\nWebGPUTintWASM._Twgsl = null;\n//# sourceMappingURL=webgpuTintWASM.js.map","\nimport { Logger } from \"../../Misc/logger.js\";\n/** @internal */\nexport class WebGPUSnapshotRendering {\n    constructor(engine, renderingMode, bundleList) {\n        this._record = false;\n        this._play = false;\n        this._playBundleListIndex = 0;\n        this._allBundleLists = [];\n        this._enabled = false;\n        this.showDebugLogs = false;\n        this._engine = engine;\n        this._mode = renderingMode;\n        this._bundleList = bundleList;\n    }\n    get enabled() {\n        return this._enabled;\n    }\n    get play() {\n        return this._play;\n    }\n    get record() {\n        return this._record;\n    }\n    set enabled(activate) {\n        this._log(\"enabled\", `activate=${activate}, mode=${this._mode}`);\n        this._allBundleLists.length = 0;\n        this._record = this._enabled = activate;\n        this._play = false;\n        if (activate) {\n            this._modeSaved = this._mode;\n            this._mode = 0; // need to reset to standard for the recording pass to avoid some code being bypassed\n        }\n    }\n    get mode() {\n        return this._mode;\n    }\n    set mode(mode) {\n        if (this._record) {\n            this._modeSaved = mode;\n        }\n        else {\n            this._mode = mode;\n        }\n    }\n    endRenderPass(currentRenderPass) {\n        if (!this._record && !this._play) {\n            // Snapshot rendering mode is not enabled\n            return false;\n        }\n        let bundleList = null;\n        if (this._record) {\n            bundleList = this._bundleList.clone();\n            this._allBundleLists.push(bundleList);\n            this._bundleList.reset();\n            this._log(\"endRenderPass\", `bundleList recorded at position #${this._allBundleLists.length - 1}`);\n        }\n        else {\n            // We are playing the snapshot\n            if (this._playBundleListIndex >= this._allBundleLists.length) {\n                this._log(\"endRenderPass\", `empty or out-of-sync bundleList (_allBundleLists.length=${this._allBundleLists.length}, playBundleListIndex=${this._playBundleListIndex})`);\n            }\n            else {\n                this._log(\"endRenderPass\", `run bundleList #${this._playBundleListIndex}`);\n                bundleList = this._allBundleLists[this._playBundleListIndex++];\n            }\n        }\n        if (bundleList) {\n            bundleList.run(currentRenderPass);\n            if (this._mode === 1) {\n                this._engine._reportDrawCall(bundleList.numDrawCalls);\n            }\n        }\n        return true;\n    }\n    endFrame() {\n        if (this._record) {\n            // We stop recording and switch to replay mode for the next frames\n            this._record = false;\n            this._play = true;\n            this._mode = this._modeSaved;\n            this._log(\"endFrame\", \"bundles recorded, switching to play mode\");\n        }\n        this._playBundleListIndex = 0;\n    }\n    reset() {\n        this._log(\"reset\", \"called\");\n        if (this._record) {\n            this._mode = this._modeSaved;\n        }\n        this.enabled = false;\n        this.enabled = true;\n    }\n    _log(funcName, message) {\n        if (this.showDebugLogs) {\n            Logger.Log(`[Frame: ${this._engine.frameId}] WebGPUSnapshotRendering:${funcName} - ${message}`);\n        }\n    }\n}\n//# sourceMappingURL=webgpuSnapshotRendering.js.map","import { Buffer, VertexBuffer } from \"./buffer.js\";\nconst isLittleEndian = (() => {\n    const array = new Uint8Array(4);\n    const view = new Uint32Array(array.buffer);\n    return !!((view[0] = 1) & array[0]);\n})();\nObject.defineProperty(VertexBuffer.prototype, \"effectiveByteStride\", {\n    get: function () {\n        return (this._alignedBuffer && this._alignedBuffer.byteStride) || this.byteStride;\n    },\n    enumerable: true,\n    configurable: true,\n});\nObject.defineProperty(VertexBuffer.prototype, \"effectiveByteOffset\", {\n    get: function () {\n        return this._alignedBuffer ? 0 : this.byteOffset;\n    },\n    enumerable: true,\n    configurable: true,\n});\nObject.defineProperty(VertexBuffer.prototype, \"effectiveBuffer\", {\n    get: function () {\n        return (this._alignedBuffer && this._alignedBuffer.getBuffer()) || this._buffer.getBuffer();\n    },\n    enumerable: true,\n    configurable: true,\n});\nVertexBuffer.prototype._rebuild = function () {\n    this._buffer?._rebuild();\n    this._alignedBuffer?._rebuild();\n};\nVertexBuffer.prototype.dispose = function () {\n    if (this._ownsBuffer) {\n        this._buffer.dispose();\n    }\n    this._alignedBuffer?.dispose();\n    this._alignedBuffer = undefined;\n    this._isDisposed = true;\n};\nVertexBuffer.prototype.getWrapperBuffer = function () {\n    return this._alignedBuffer || this._buffer;\n};\nVertexBuffer.prototype._alignBuffer = function () {\n    const data = this._buffer.getData();\n    if (!this.engine._features.forceVertexBufferStrideAndOffsetMultiple4Bytes || (this.byteStride % 4 === 0 && this.byteOffset % 4 === 0) || !data) {\n        return;\n    }\n    const typeByteLength = VertexBuffer.GetTypeByteLength(this.type);\n    const alignedByteStride = (this.byteStride + 3) & ~3;\n    const alignedSize = alignedByteStride / typeByteLength;\n    const totalVertices = this._maxVerticesCount;\n    const totalByteLength = totalVertices * alignedByteStride;\n    const totalLength = totalByteLength / typeByteLength;\n    let sourceData;\n    if (Array.isArray(data)) {\n        const sourceDataAsFloat = new Float32Array(data);\n        sourceData = new DataView(sourceDataAsFloat.buffer, sourceDataAsFloat.byteOffset, sourceDataAsFloat.byteLength);\n    }\n    else if (data instanceof ArrayBuffer) {\n        sourceData = new DataView(data, 0, data.byteLength);\n    }\n    else {\n        sourceData = new DataView(data.buffer, data.byteOffset, data.byteLength);\n    }\n    let alignedData;\n    if (this.type === VertexBuffer.BYTE) {\n        alignedData = new Int8Array(totalLength);\n    }\n    else if (this.type === VertexBuffer.UNSIGNED_BYTE) {\n        alignedData = new Uint8Array(totalLength);\n    }\n    else if (this.type === VertexBuffer.SHORT) {\n        alignedData = new Int16Array(totalLength);\n    }\n    else if (this.type === VertexBuffer.UNSIGNED_SHORT) {\n        alignedData = new Uint16Array(totalLength);\n    }\n    else if (this.type === VertexBuffer.INT) {\n        alignedData = new Int32Array(totalLength);\n    }\n    else if (this.type === VertexBuffer.UNSIGNED_INT) {\n        alignedData = new Uint32Array(totalLength);\n    }\n    else {\n        alignedData = new Float32Array(totalLength);\n    }\n    const numComponents = this.getSize();\n    let sourceOffset = this.byteOffset;\n    for (let i = 0; i < totalVertices; ++i) {\n        for (let j = 0; j < numComponents; ++j) {\n            switch (this.type) {\n                case VertexBuffer.BYTE:\n                    alignedData[i * alignedSize + j] = sourceData.getInt8(sourceOffset + j);\n                    break;\n                case VertexBuffer.UNSIGNED_BYTE:\n                    alignedData[i * alignedSize + j] = sourceData.getUint8(sourceOffset + j);\n                    break;\n                case VertexBuffer.SHORT:\n                    alignedData[i * alignedSize + j] = sourceData.getInt16(sourceOffset + j * 2, isLittleEndian);\n                    break;\n                case VertexBuffer.UNSIGNED_SHORT:\n                    alignedData[i * alignedSize + j] = sourceData.getUint16(sourceOffset + j * 2, isLittleEndian);\n                    break;\n                case VertexBuffer.INT:\n                    alignedData[i * alignedSize + j] = sourceData.getInt32(sourceOffset + j * 4, isLittleEndian);\n                    break;\n                case VertexBuffer.UNSIGNED_INT:\n                    alignedData[i * alignedSize + j] = sourceData.getUint32(sourceOffset + j * 4, isLittleEndian);\n                    break;\n                case VertexBuffer.FLOAT:\n                    alignedData[i * alignedSize + j] = sourceData.getFloat32(sourceOffset + j * 4, isLittleEndian);\n                    break;\n            }\n        }\n        sourceOffset += this.byteStride;\n    }\n    this._alignedBuffer?.dispose();\n    this._alignedBuffer = new Buffer(this.engine, alignedData, false, alignedByteStride, false, this.getIsInstanced(), true, this.instanceDivisor, (this._label ?? \"VertexBuffer\") + \"_aligned\");\n};\n//# sourceMappingURL=buffer.align.js.map","import { ExternalTexture } from \"../../Materials/Textures/externalTexture.js\";\n/**\n * Nothing specific to WebGPU in this class, but the spec is not final yet so let's remove it later on\n * if it is not needed\n * @internal\n **/\nexport class WebGPUExternalTexture extends ExternalTexture {\n    constructor(video) {\n        super(video);\n    }\n}\n//# sourceMappingURL=webgpuExternalTexture.js.map","import { AbstractEngine } from \"../../abstractEngine.js\";\n\nimport \"../../AbstractEngine/abstractEngine.alpha.js\";\nimport { ThinWebGPUEngine } from \"../../thinWebGPUEngine.js\";\nThinWebGPUEngine.prototype.setAlphaMode = function (mode, noDepthWriteChange = false) {\n    if (this._alphaMode === mode && ((mode === 0 && !this._alphaState.alphaBlend) || (mode !== 0 && this._alphaState.alphaBlend))) {\n        if (!noDepthWriteChange) {\n            // Make sure we still have the correct depth mask according to the alpha mode (a transparent material could have forced writting to the depth buffer, for instance)\n            const depthMask = mode === 0;\n            if (this.depthCullingState.depthMask !== depthMask) {\n                this.setDepthWrite(depthMask);\n                this._cacheRenderPipeline.setDepthWriteEnabled(depthMask);\n            }\n        }\n        return;\n    }\n    switch (mode) {\n        case 0:\n            this._alphaState.alphaBlend = false;\n            break;\n        case 7:\n            this._alphaState.setAlphaBlendFunctionParameters(1, 771, 1, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 8:\n            this._alphaState.setAlphaBlendFunctionParameters(1, 771, 1, 771);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 2:\n            this._alphaState.setAlphaBlendFunctionParameters(770, 771, 1, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 6:\n            this._alphaState.setAlphaBlendFunctionParameters(1, 1, 0, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 1:\n            this._alphaState.setAlphaBlendFunctionParameters(770, 1, 0, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 3:\n            this._alphaState.setAlphaBlendFunctionParameters(0, 769, 1, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 4:\n            this._alphaState.setAlphaBlendFunctionParameters(774, 0, 1, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 5:\n            this._alphaState.setAlphaBlendFunctionParameters(770, 769, 1, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 9:\n            this._alphaState.setAlphaBlendFunctionParameters(32769, 32770, 32771, 32772);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 10:\n            this._alphaState.setAlphaBlendFunctionParameters(1, 769, 1, 771);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 11:\n            this._alphaState.setAlphaBlendFunctionParameters(1, 1, 1, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 12:\n            this._alphaState.setAlphaBlendFunctionParameters(772, 1, 0, 0);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 13:\n            this._alphaState.setAlphaBlendFunctionParameters(775, 769, 773, 771);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 14:\n            this._alphaState.setAlphaBlendFunctionParameters(1, 771, 1, 771);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 15:\n            this._alphaState.setAlphaBlendFunctionParameters(1, 1, 1, 0);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 16:\n            this._alphaState.setAlphaBlendFunctionParameters(775, 769, 0, 1);\n            this._alphaState.alphaBlend = true;\n            break;\n        case 17:\n            // Same as ALPHA_COMBINE but accumulates (1 - alpha) values in the alpha channel for a later readout in order independant transparency\n            this._alphaState.setAlphaBlendFunctionParameters(770, 771, 1, 771);\n            this._alphaState.alphaBlend = true;\n            break;\n    }\n    if (!noDepthWriteChange) {\n        this.setDepthWrite(mode === 0);\n        this._cacheRenderPipeline.setDepthWriteEnabled(mode === 0);\n    }\n    this._alphaMode = mode;\n    this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend);\n    this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters, this._alphaState._blendEquationParameters);\n};\nThinWebGPUEngine.prototype.setAlphaEquation = function (equation) {\n    AbstractEngine.prototype.setAlphaEquation.call(this, equation);\n    this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters, this._alphaState._blendEquationParameters);\n};\n//# sourceMappingURL=engine.alpha.js.map","import { InternalTexture } from \"../../../Materials/Textures/internalTexture.js\";\n\nimport { Logger } from \"../../../Misc/logger.js\";\nimport { ThinWebGPUEngine } from \"../../thinWebGPUEngine.js\";\nThinWebGPUEngine.prototype.createRawTexture = function (data, width, height, format, generateMipMaps, invertY, samplingMode, compression = null, type = 0, creationFlags = 0, useSRGBBuffer = false) {\n    const texture = new InternalTexture(this, 3 /* InternalTextureSource.Raw */);\n    texture.baseWidth = width;\n    texture.baseHeight = height;\n    texture.width = width;\n    texture.height = height;\n    texture.format = format;\n    texture.generateMipMaps = generateMipMaps;\n    texture.samplingMode = samplingMode;\n    texture.invertY = invertY;\n    texture._compression = compression;\n    texture.type = type;\n    texture._creationFlags = creationFlags;\n    texture._useSRGBBuffer = useSRGBBuffer;\n    if (!this._doNotHandleContextLost) {\n        texture._bufferView = data;\n    }\n    this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, undefined, creationFlags);\n    this.updateRawTexture(texture, data, format, invertY, compression, type, useSRGBBuffer);\n    this._internalTexturesCache.push(texture);\n    return texture;\n};\nThinWebGPUEngine.prototype.updateRawTexture = function (texture, bufferView, format, invertY, compression = null, type = 0, useSRGBBuffer = false) {\n    if (!texture) {\n        return;\n    }\n    if (!this._doNotHandleContextLost) {\n        texture._bufferView = bufferView;\n        texture.invertY = invertY;\n        texture._compression = compression;\n        texture._useSRGBBuffer = useSRGBBuffer;\n    }\n    if (bufferView) {\n        const gpuTextureWrapper = texture._hardwareTexture;\n        const needConversion = format === 4;\n        if (needConversion) {\n            bufferView = _convertRGBtoRGBATextureData(bufferView, texture.width, texture.height, type);\n        }\n        const data = new Uint8Array(bufferView.buffer, bufferView.byteOffset, bufferView.byteLength);\n        this._textureHelper.updateTexture(data, texture, texture.width, texture.height, texture.depth, gpuTextureWrapper.format, 0, 0, invertY, false, 0, 0);\n        if (texture.generateMipMaps) {\n            this._generateMipmaps(texture, this._uploadEncoder);\n        }\n    }\n    texture.isReady = true;\n};\nThinWebGPUEngine.prototype.createRawCubeTexture = function (data, size, format, type, generateMipMaps, invertY, samplingMode, compression = null) {\n    const texture = new InternalTexture(this, 8 /* InternalTextureSource.CubeRaw */);\n    if (type === 1 && !this._caps.textureFloatLinearFiltering) {\n        generateMipMaps = false;\n        samplingMode = 1;\n        Logger.Warn(\"Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.\");\n    }\n    else if (type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\n        generateMipMaps = false;\n        samplingMode = 1;\n        Logger.Warn(\"Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.\");\n    }\n    else if (type === 1 && !this._caps.textureFloatRender) {\n        generateMipMaps = false;\n        Logger.Warn(\"Render to float textures is not supported. Mipmap generation forced to false.\");\n    }\n    else if (type === 2 && !this._caps.colorBufferFloat) {\n        generateMipMaps = false;\n        Logger.Warn(\"Render to half float textures is not supported. Mipmap generation forced to false.\");\n    }\n    texture.isCube = true;\n    texture._originalFormat = format;\n    texture.format = format === 4 ? 5 : format;\n    texture.type = type;\n    texture.generateMipMaps = generateMipMaps;\n    texture.width = size;\n    texture.height = size;\n    texture.samplingMode = samplingMode;\n    if (!this._doNotHandleContextLost) {\n        texture._bufferViewArray = data;\n    }\n    texture.invertY = invertY;\n    texture._compression = compression;\n    texture._cachedWrapU = 0;\n    texture._cachedWrapV = 0;\n    this._textureHelper.createGPUTextureForInternalTexture(texture);\n    if (format === 4) {\n        const gpuTextureWrapper = texture._hardwareTexture;\n        gpuTextureWrapper._originalFormatIsRGB = true;\n    }\n    if (data) {\n        this.updateRawCubeTexture(texture, data, format, type, invertY, compression);\n    }\n    texture.isReady = true;\n    return texture;\n};\nThinWebGPUEngine.prototype.updateRawCubeTexture = function (texture, bufferView, _format, type, invertY, compression = null) {\n    texture._bufferViewArray = bufferView;\n    texture.invertY = invertY;\n    texture._compression = compression;\n    const gpuTextureWrapper = texture._hardwareTexture;\n    const needConversion = gpuTextureWrapper._originalFormatIsRGB;\n    const faces = [0, 2, 4, 1, 3, 5];\n    const data = [];\n    for (let i = 0; i < bufferView.length; ++i) {\n        let faceData = bufferView[faces[i]];\n        if (needConversion) {\n            faceData = _convertRGBtoRGBATextureData(faceData, texture.width, texture.height, type);\n        }\n        data.push(new Uint8Array(faceData.buffer, faceData.byteOffset, faceData.byteLength));\n    }\n    this._textureHelper.updateCubeTextures(data, gpuTextureWrapper.underlyingResource, texture.width, texture.height, gpuTextureWrapper.format, invertY, false, 0, 0);\n    if (texture.generateMipMaps) {\n        this._generateMipmaps(texture, this._uploadEncoder);\n    }\n    texture.isReady = true;\n};\nThinWebGPUEngine.prototype.createRawCubeTextureFromUrl = function (url, scene, size, format, type, noMipmap, callback, mipmapGenerator, onLoad = null, onError = null, samplingMode = 3, invertY = false) {\n    const texture = this.createRawCubeTexture(null, size, format, type, !noMipmap, invertY, samplingMode, null);\n    scene?.addPendingData(texture);\n    texture.url = url;\n    texture.isReady = false;\n    this._internalTexturesCache.push(texture);\n    const onerror = (request, exception) => {\n        scene?.removePendingData(texture);\n        if (onError && request) {\n            onError(request.status + \" \" + request.statusText, exception);\n        }\n    };\n    const internalCallback = (data) => {\n        const width = texture.width;\n        const faceDataArrays = callback(data);\n        if (!faceDataArrays) {\n            return;\n        }\n        if (mipmapGenerator) {\n            const needConversion = format === 4;\n            const mipData = mipmapGenerator(faceDataArrays);\n            const gpuTextureWrapper = texture._hardwareTexture;\n            const faces = [0, 1, 2, 3, 4, 5];\n            for (let level = 0; level < mipData.length; level++) {\n                const mipSize = width >> level;\n                const allFaces = [];\n                for (let faceIndex = 0; faceIndex < 6; faceIndex++) {\n                    let mipFaceData = mipData[level][faces[faceIndex]];\n                    if (needConversion) {\n                        mipFaceData = _convertRGBtoRGBATextureData(mipFaceData, mipSize, mipSize, type);\n                    }\n                    allFaces.push(new Uint8Array(mipFaceData.buffer, mipFaceData.byteOffset, mipFaceData.byteLength));\n                }\n                this._textureHelper.updateCubeTextures(allFaces, gpuTextureWrapper.underlyingResource, mipSize, mipSize, gpuTextureWrapper.format, invertY, false, 0, 0);\n            }\n        }\n        else {\n            this.updateRawCubeTexture(texture, faceDataArrays, format, type, invertY);\n        }\n        texture.isReady = true;\n        scene?.removePendingData(texture);\n        if (onLoad) {\n            onLoad();\n        }\n    };\n    this._loadFile(url, (data) => {\n        internalCallback(data);\n    }, undefined, scene?.offlineProvider, true, onerror);\n    return texture;\n};\nThinWebGPUEngine.prototype.createRawTexture3D = function (data, width, height, depth, format, generateMipMaps, invertY, samplingMode, compression = null, textureType = 0, creationFlags = 0) {\n    const source = 10 /* InternalTextureSource.Raw3D */;\n    const texture = new InternalTexture(this, source);\n    texture.baseWidth = width;\n    texture.baseHeight = height;\n    texture.baseDepth = depth;\n    texture.width = width;\n    texture.height = height;\n    texture.depth = depth;\n    texture.format = format;\n    texture.type = textureType;\n    texture.generateMipMaps = generateMipMaps;\n    texture.samplingMode = samplingMode;\n    texture.is3D = true;\n    texture._creationFlags = creationFlags;\n    if (!this._doNotHandleContextLost) {\n        texture._bufferView = data;\n    }\n    this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, undefined, creationFlags);\n    this.updateRawTexture3D(texture, data, format, invertY, compression, textureType);\n    this._internalTexturesCache.push(texture);\n    return texture;\n};\nThinWebGPUEngine.prototype.updateRawTexture3D = function (texture, bufferView, format, invertY, compression = null, textureType = 0) {\n    if (!this._doNotHandleContextLost) {\n        texture._bufferView = bufferView;\n        texture.format = format;\n        texture.invertY = invertY;\n        texture._compression = compression;\n    }\n    if (bufferView) {\n        const gpuTextureWrapper = texture._hardwareTexture;\n        const needConversion = format === 4;\n        if (needConversion) {\n            bufferView = _convertRGBtoRGBATextureData(bufferView, texture.width, texture.height, textureType);\n        }\n        const data = new Uint8Array(bufferView.buffer, bufferView.byteOffset, bufferView.byteLength);\n        this._textureHelper.updateTexture(data, texture, texture.width, texture.height, texture.depth, gpuTextureWrapper.format, 0, 0, invertY, false, 0, 0);\n        if (texture.generateMipMaps) {\n            this._generateMipmaps(texture, this._uploadEncoder);\n        }\n    }\n    texture.isReady = true;\n};\nThinWebGPUEngine.prototype.createRawTexture2DArray = function (data, width, height, depth, format, generateMipMaps, invertY, samplingMode, compression = null, textureType = 0, creationFlags = 0) {\n    const source = 11 /* InternalTextureSource.Raw2DArray */;\n    const texture = new InternalTexture(this, source);\n    texture.baseWidth = width;\n    texture.baseHeight = height;\n    texture.baseDepth = depth;\n    texture.width = width;\n    texture.height = height;\n    texture.depth = depth;\n    texture.format = format;\n    texture.type = textureType;\n    texture.generateMipMaps = generateMipMaps;\n    texture.samplingMode = samplingMode;\n    texture.is2DArray = true;\n    texture._creationFlags = creationFlags;\n    if (!this._doNotHandleContextLost) {\n        texture._bufferView = data;\n    }\n    this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, depth, creationFlags);\n    this.updateRawTexture2DArray(texture, data, format, invertY, compression, textureType);\n    this._internalTexturesCache.push(texture);\n    return texture;\n};\nThinWebGPUEngine.prototype.updateRawTexture2DArray = function (texture, bufferView, format, invertY, compression = null, textureType = 0) {\n    if (!this._doNotHandleContextLost) {\n        texture._bufferView = bufferView;\n        texture.format = format;\n        texture.invertY = invertY;\n        texture._compression = compression;\n    }\n    if (bufferView) {\n        const gpuTextureWrapper = texture._hardwareTexture;\n        const needConversion = format === 4;\n        if (needConversion) {\n            bufferView = _convertRGBtoRGBATextureData(bufferView, texture.width, texture.height, textureType);\n        }\n        const data = new Uint8Array(bufferView.buffer, bufferView.byteOffset, bufferView.byteLength);\n        this._textureHelper.updateTexture(data, texture, texture.width, texture.height, texture.depth, gpuTextureWrapper.format, 0, 0, invertY, false, 0, 0);\n        if (texture.generateMipMaps) {\n            this._generateMipmaps(texture, this._uploadEncoder);\n        }\n    }\n    texture.isReady = true;\n};\n/**\n * @internal\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction _convertRGBtoRGBATextureData(rgbData, width, height, textureType) {\n    // Create new RGBA data container.\n    let rgbaData;\n    let val1 = 1;\n    if (textureType === 1) {\n        rgbaData = new Float32Array(width * height * 4);\n    }\n    else if (textureType === 2) {\n        rgbaData = new Uint16Array(width * height * 4);\n        val1 = 15360; // 15360 is the encoding of 1 in half float\n    }\n    else if (textureType === 7) {\n        rgbaData = new Uint32Array(width * height * 4);\n    }\n    else {\n        rgbaData = new Uint8Array(width * height * 4);\n    }\n    // Convert each pixel.\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height; y++) {\n            const index = (y * width + x) * 3;\n            const newIndex = (y * width + x) * 4;\n            // Map Old Value to new value.\n            rgbaData[newIndex + 0] = rgbData[index + 0];\n            rgbaData[newIndex + 1] = rgbData[index + 1];\n            rgbaData[newIndex + 2] = rgbData[index + 2];\n            // Add fully opaque alpha channel.\n            rgbaData[newIndex + 3] = val1;\n        }\n    }\n    return rgbaData;\n}\n//# sourceMappingURL=engine.rawTexture.js.map","import { ThinWebGPUEngine } from \"../../thinWebGPUEngine.js\";\nThinWebGPUEngine.prototype._readTexturePixels = function (texture, width, height, faceIndex = -1, level = 0, buffer = null, flushRenderer = true, noDataConversion = false, x = 0, y = 0) {\n    const gpuTextureWrapper = texture._hardwareTexture;\n    if (flushRenderer) {\n        this.flushFramebuffer();\n    }\n    return this._textureHelper.readPixels(gpuTextureWrapper.underlyingResource, x, y, width, height, gpuTextureWrapper.format, faceIndex, level, buffer, noDataConversion);\n};\nThinWebGPUEngine.prototype._readTexturePixelsSync = function () {\n    // eslint-disable-next-line no-throw-literal\n    throw \"_readTexturePixelsSync is unsupported in WebGPU!\";\n};\n//# sourceMappingURL=engine.readTexture.js.map","import { InternalTexture } from \"../../../Materials/Textures/internalTexture.js\";\n\nimport { WebGPUTextureHelper } from \"../webgpuTextureHelper.js\";\nimport { ThinWebGPUEngine } from \"../../thinWebGPUEngine.js\";\nThinWebGPUEngine.prototype._createDepthStencilCubeTexture = function (size, options) {\n    const internalTexture = new InternalTexture(this, options.generateStencil ? 12 /* InternalTextureSource.DepthStencil */ : 14 /* InternalTextureSource.Depth */);\n    internalTexture.isCube = true;\n    internalTexture.label = options.label;\n    const internalOptions = {\n        bilinearFiltering: false,\n        comparisonFunction: 0,\n        generateStencil: false,\n        samples: 1,\n        depthTextureFormat: options.generateStencil ? 13 : 14,\n        ...options,\n    };\n    internalTexture.format = internalOptions.depthTextureFormat;\n    this._setupDepthStencilTexture(internalTexture, size, internalOptions.bilinearFiltering, internalOptions.comparisonFunction, internalOptions.samples);\n    this._textureHelper.createGPUTextureForInternalTexture(internalTexture);\n    // Now that the hardware texture is created, we can retrieve the GPU format and set the right type to the internal texture\n    const gpuTextureWrapper = internalTexture._hardwareTexture;\n    internalTexture.type = WebGPUTextureHelper.GetTextureTypeFromFormat(gpuTextureWrapper.format);\n    this._internalTexturesCache.push(internalTexture);\n    return internalTexture;\n};\nThinWebGPUEngine.prototype.createCubeTexture = function (rootUrl, scene, files, noMipmap, onLoad = null, onError = null, format, forcedExtension = null, createPolynomials = false, lodScale = 0, lodOffset = 0, fallback = null, loaderOptions, useSRGBBuffer = false, buffer = null) {\n    return this.createCubeTextureBase(rootUrl, scene, files, !!noMipmap, onLoad, onError, format, forcedExtension, createPolynomials, lodScale, lodOffset, fallback, null, (texture, imgs) => {\n        const imageBitmaps = imgs; // we will always get an ImageBitmap array in WebGPU\n        const width = imageBitmaps[0].width;\n        const height = width;\n        this._setCubeMapTextureParams(texture, !noMipmap);\n        texture.format = format ?? -1;\n        const gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\n        this._textureHelper.updateCubeTextures(imageBitmaps, gpuTextureWrapper.underlyingResource, width, height, gpuTextureWrapper.format, false, false, 0, 0);\n        if (!noMipmap) {\n            this._generateMipmaps(texture, this._uploadEncoder);\n        }\n        texture.isReady = true;\n        texture.onLoadedObservable.notifyObservers(texture);\n        texture.onLoadedObservable.clear();\n        if (onLoad) {\n            onLoad();\n        }\n    }, !!useSRGBBuffer, buffer);\n};\nThinWebGPUEngine.prototype._setCubeMapTextureParams = function (texture, loadMipmap, maxLevel) {\n    texture.samplingMode = loadMipmap ? 3 : 2;\n    texture._cachedWrapU = 0;\n    texture._cachedWrapV = 0;\n    if (maxLevel) {\n        texture._maxLodLevel = maxLevel;\n    }\n};\nThinWebGPUEngine.prototype.generateMipMapsForCubemap = function (texture) {\n    if (texture.generateMipMaps) {\n        const gpuTexture = texture._hardwareTexture?.underlyingResource;\n        if (!gpuTexture) {\n            this._textureHelper.createGPUTextureForInternalTexture(texture);\n        }\n        this._generateMipmaps(texture);\n    }\n};\n//# sourceMappingURL=engine.cubeTexture.js.map","import { RenderTargetWrapper } from \"../renderTargetWrapper.js\";\nimport { WebGPUPerfCounter } from \"./webgpuPerfCounter.js\";\n/**\n * Specialized class used to store a render target of a WebGPU engine\n */\nexport class WebGPURenderTargetWrapper extends RenderTargetWrapper {\n    /**\n     * Initializes the render target wrapper\n     * @param isMulti true if the wrapper is a multi render target\n     * @param isCube true if the wrapper should render to a cube texture\n     * @param size size of the render target (width/height/layers)\n     * @param engine engine used to create the render target\n     * @param label defines the label to use for the wrapper (for debugging purpose only)\n     */\n    constructor(isMulti, isCube, size, engine, label) {\n        super(isMulti, isCube, size, engine, label);\n        if (engine.enableGPUTimingMeasurements) {\n            this.gpuTimeInFrame = new WebGPUPerfCounter();\n        }\n    }\n}\n//# sourceMappingURL=webgpuRenderTargetWrapper.js.map","import { InternalTexture } from \"../../../Materials/Textures/internalTexture.js\";\n\nimport { WebGPURenderTargetWrapper } from \"../webgpuRenderTargetWrapper.js\";\nimport { GetTypeForDepthTexture, HasStencilAspect } from \"../../../Materials/Textures/textureHelper.functions.js\";\nimport \"../../AbstractEngine/abstractEngine.texture.js\";\nimport { ThinWebGPUEngine } from \"../../thinWebGPUEngine.js\";\nThinWebGPUEngine.prototype._createHardwareRenderTargetWrapper = function (isMulti, isCube, size) {\n    const rtWrapper = new WebGPURenderTargetWrapper(isMulti, isCube, size, this);\n    this._renderTargetWrapperCache.push(rtWrapper);\n    return rtWrapper;\n};\nThinWebGPUEngine.prototype.createRenderTargetTexture = function (size, options) {\n    const rtWrapper = this._createHardwareRenderTargetWrapper(false, false, size);\n    const fullOptions = {};\n    if (options !== undefined && typeof options === \"object\") {\n        fullOptions.generateMipMaps = options.generateMipMaps;\n        fullOptions.generateDepthBuffer = options.generateDepthBuffer === undefined ? true : options.generateDepthBuffer;\n        fullOptions.generateStencilBuffer = fullOptions.generateDepthBuffer && options.generateStencilBuffer;\n        fullOptions.samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\n        fullOptions.creationFlags = options.creationFlags ?? 0;\n        fullOptions.noColorAttachment = !!options.noColorAttachment;\n        fullOptions.colorAttachment = options.colorAttachment;\n        fullOptions.samples = options.samples;\n        fullOptions.label = options.label;\n        fullOptions.format = options.format;\n        fullOptions.type = options.type;\n    }\n    else {\n        fullOptions.generateMipMaps = options;\n        fullOptions.generateDepthBuffer = true;\n        fullOptions.generateStencilBuffer = false;\n        fullOptions.samplingMode = 3;\n        fullOptions.creationFlags = 0;\n        fullOptions.noColorAttachment = false;\n    }\n    const texture = fullOptions.colorAttachment || (fullOptions.noColorAttachment ? null : this._createInternalTexture(size, fullOptions, true, 5 /* InternalTextureSource.RenderTarget */));\n    rtWrapper.label = fullOptions.label ?? \"RenderTargetWrapper\";\n    rtWrapper._samples = fullOptions.colorAttachment?.samples ?? fullOptions.samples ?? 1;\n    rtWrapper._generateDepthBuffer = fullOptions.generateDepthBuffer;\n    rtWrapper._generateStencilBuffer = fullOptions.generateStencilBuffer ? true : false;\n    rtWrapper.setTextures(texture);\n    if (rtWrapper._generateDepthBuffer || rtWrapper._generateStencilBuffer) {\n        rtWrapper.createDepthStencilTexture(0, false, // force false as filtering is not supported for depth textures\n        rtWrapper._generateStencilBuffer, rtWrapper.samples, fullOptions.generateStencilBuffer ? 13 : 14, fullOptions.label ? fullOptions.label + \"-DepthStencil\" : undefined);\n    }\n    if (texture && !fullOptions.colorAttachment) {\n        if (options !== undefined && typeof options === \"object\" && options.createMipMaps && !fullOptions.generateMipMaps) {\n            texture.generateMipMaps = true;\n        }\n        this._textureHelper.createGPUTextureForInternalTexture(texture, undefined, undefined, undefined, fullOptions.creationFlags);\n        if (options !== undefined && typeof options === \"object\" && options.createMipMaps && !fullOptions.generateMipMaps) {\n            texture.generateMipMaps = false;\n        }\n    }\n    return rtWrapper;\n};\nThinWebGPUEngine.prototype._createDepthStencilTexture = function (size, options, wrapper) {\n    const internalOptions = {\n        bilinearFiltering: false,\n        comparisonFunction: 0,\n        generateStencil: false,\n        samples: 1,\n        depthTextureFormat: options.generateStencil ? 13 : 14,\n        ...options,\n    };\n    const hasStencil = HasStencilAspect(internalOptions.depthTextureFormat);\n    wrapper._depthStencilTextureWithStencil = hasStencil;\n    const internalTexture = new InternalTexture(this, hasStencil ? 12 /* InternalTextureSource.DepthStencil */ : 14 /* InternalTextureSource.Depth */);\n    internalTexture.label = options.label;\n    internalTexture.format = internalOptions.depthTextureFormat;\n    internalTexture.type = GetTypeForDepthTexture(internalTexture.format);\n    this._setupDepthStencilTexture(internalTexture, size, internalOptions.bilinearFiltering, internalOptions.comparisonFunction, internalOptions.samples);\n    this._textureHelper.createGPUTextureForInternalTexture(internalTexture);\n    this._internalTexturesCache.push(internalTexture);\n    return internalTexture;\n};\nThinWebGPUEngine.prototype._setupDepthStencilTexture = function (internalTexture, size, bilinearFiltering, comparisonFunction, samples = 1) {\n    const width = size.width ?? size;\n    const height = size.height ?? size;\n    const layers = size.layers || 0;\n    const depth = size.depth || 0;\n    internalTexture.baseWidth = width;\n    internalTexture.baseHeight = height;\n    internalTexture.width = width;\n    internalTexture.height = height;\n    internalTexture.is2DArray = layers > 0;\n    internalTexture.is3D = depth > 0;\n    internalTexture.depth = layers || depth;\n    internalTexture.isReady = true;\n    internalTexture.samples = samples;\n    internalTexture.generateMipMaps = false;\n    internalTexture.samplingMode = bilinearFiltering ? 2 : 1;\n    internalTexture.type = 1; // the right type will be set later\n    internalTexture._comparisonFunction = comparisonFunction;\n    internalTexture._cachedWrapU = 0;\n    internalTexture._cachedWrapV = 0;\n};\nThinWebGPUEngine.prototype.updateRenderTargetTextureSampleCount = function (rtWrapper, samples) {\n    if (!rtWrapper || !rtWrapper.texture || rtWrapper.samples === samples) {\n        return samples;\n    }\n    samples = Math.min(samples, this.getCaps().maxMSAASamples);\n    this._textureHelper.createMSAATexture(rtWrapper.texture, samples);\n    if (rtWrapper._depthStencilTexture) {\n        this._textureHelper.createMSAATexture(rtWrapper._depthStencilTexture, samples);\n        rtWrapper._depthStencilTexture.samples = samples;\n    }\n    rtWrapper._samples = samples;\n    rtWrapper.texture.samples = samples;\n    return samples;\n};\n//# sourceMappingURL=engine.renderTarget.js.map","import { ThinWebGPUEngine } from \"../../thinWebGPUEngine.js\";\nThinWebGPUEngine.prototype.setDepthStencilTexture = function (channel, uniform, texture, name) {\n    if (!texture || !texture.depthStencilTexture) {\n        this._setTexture(channel, null, undefined, undefined, name);\n    }\n    else {\n        this._setTexture(channel, texture, false, true, name);\n    }\n};\n//# sourceMappingURL=engine.renderTargetTexture.js.map","import { ThinWebGPUEngine } from \"../../thinWebGPUEngine.js\";\nimport { InternalTexture } from \"../../../Materials/Textures/internalTexture.js\";\n\nThinWebGPUEngine.prototype.createRenderTargetCubeTexture = function (size, options) {\n    const rtWrapper = this._createHardwareRenderTargetWrapper(false, true, size);\n    const fullOptions = {\n        generateMipMaps: true,\n        generateDepthBuffer: true,\n        generateStencilBuffer: false,\n        type: 0,\n        samplingMode: 3,\n        format: 5,\n        samples: 1,\n        ...options,\n    };\n    fullOptions.generateStencilBuffer = fullOptions.generateDepthBuffer && fullOptions.generateStencilBuffer;\n    rtWrapper.label = fullOptions.label ?? \"RenderTargetWrapper\";\n    rtWrapper._generateDepthBuffer = fullOptions.generateDepthBuffer;\n    rtWrapper._generateStencilBuffer = fullOptions.generateStencilBuffer;\n    const texture = new InternalTexture(this, 5 /* InternalTextureSource.RenderTarget */);\n    texture.width = size;\n    texture.height = size;\n    texture.depth = 0;\n    texture.isReady = true;\n    texture.isCube = true;\n    texture.samples = fullOptions.samples;\n    texture.generateMipMaps = fullOptions.generateMipMaps;\n    texture.samplingMode = fullOptions.samplingMode;\n    texture.type = fullOptions.type;\n    texture.format = fullOptions.format;\n    this._internalTexturesCache.push(texture);\n    rtWrapper.setTextures(texture);\n    if (rtWrapper._generateDepthBuffer || rtWrapper._generateStencilBuffer) {\n        rtWrapper.createDepthStencilTexture(0, fullOptions.samplingMode === undefined ||\n            fullOptions.samplingMode === 2 ||\n            fullOptions.samplingMode === 2 ||\n            fullOptions.samplingMode === 3 ||\n            fullOptions.samplingMode === 3 ||\n            fullOptions.samplingMode === 5 ||\n            fullOptions.samplingMode === 6 ||\n            fullOptions.samplingMode === 7 ||\n            fullOptions.samplingMode === 11, rtWrapper._generateStencilBuffer, rtWrapper.samples);\n    }\n    if (options && options.createMipMaps && !fullOptions.generateMipMaps) {\n        texture.generateMipMaps = true;\n    }\n    this._textureHelper.createGPUTextureForInternalTexture(texture);\n    if (options && options.createMipMaps && !fullOptions.generateMipMaps) {\n        texture.generateMipMaps = false;\n    }\n    return rtWrapper;\n};\n//# sourceMappingURL=engine.renderTargetCube.js.map","import { AbstractMesh } from \"../../Meshes/abstractMesh.js\";\nimport { AbstractEngine } from \"../abstractEngine.js\";\n/** @internal */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport class _OcclusionDataStorage {\n    constructor() {\n        /** @internal */\n        this.occlusionInternalRetryCounter = 0;\n        /** @internal */\n        this.isOcclusionQueryInProgress = false;\n        /** @internal */\n        this.isOccluded = false;\n        /** @internal */\n        this.occlusionRetryCount = -1;\n        /** @internal */\n        this.occlusionType = AbstractMesh.OCCLUSION_TYPE_NONE;\n        /** @internal */\n        this.occlusionQueryAlgorithmType = AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE;\n        /** @internal */\n        this.forceRenderingWhenOccluded = false;\n    }\n}\nAbstractEngine.prototype.createQuery = function () {\n    return null;\n};\nAbstractEngine.prototype.deleteQuery = function (query) {\n    // Do nothing. Must be implemented by child classes\n    return this;\n};\nAbstractEngine.prototype.isQueryResultAvailable = function (query) {\n    // Do nothing. Must be implemented by child classes\n    return false;\n};\nAbstractEngine.prototype.getQueryResult = function (query) {\n    // Do nothing. Must be implemented by child classes\n    return 0;\n};\nAbstractEngine.prototype.beginOcclusionQuery = function (algorithmType, query) {\n    // Do nothing. Must be implemented by child classes\n    return false;\n};\nAbstractEngine.prototype.endOcclusionQuery = function (algorithmType) {\n    // Do nothing. Must be implemented by child classes\n    return this;\n};\nObject.defineProperty(AbstractMesh.prototype, \"isOcclusionQueryInProgress\", {\n    get: function () {\n        return this._occlusionDataStorage.isOcclusionQueryInProgress;\n    },\n    set: function (value) {\n        this._occlusionDataStorage.isOcclusionQueryInProgress = value;\n    },\n    enumerable: false,\n    configurable: true,\n});\nObject.defineProperty(AbstractMesh.prototype, \"_occlusionDataStorage\", {\n    get: function () {\n        if (!this.__occlusionDataStorage) {\n            this.__occlusionDataStorage = new _OcclusionDataStorage();\n        }\n        return this.__occlusionDataStorage;\n    },\n    enumerable: false,\n    configurable: true,\n});\nObject.defineProperty(AbstractMesh.prototype, \"isOccluded\", {\n    get: function () {\n        return this._occlusionDataStorage.isOccluded;\n    },\n    set: function (value) {\n        this._occlusionDataStorage.isOccluded = value;\n    },\n    enumerable: true,\n    configurable: true,\n});\nObject.defineProperty(AbstractMesh.prototype, \"occlusionQueryAlgorithmType\", {\n    get: function () {\n        return this._occlusionDataStorage.occlusionQueryAlgorithmType;\n    },\n    set: function (value) {\n        this._occlusionDataStorage.occlusionQueryAlgorithmType = value;\n    },\n    enumerable: true,\n    configurable: true,\n});\nObject.defineProperty(AbstractMesh.prototype, \"occlusionType\", {\n    get: function () {\n        return this._occlusionDataStorage.occlusionType;\n    },\n    set: function (value) {\n        this._occlusionDataStorage.occlusionType = value;\n    },\n    enumerable: true,\n    configurable: true,\n});\nObject.defineProperty(AbstractMesh.prototype, \"occlusionRetryCount\", {\n    get: function () {\n        return this._occlusionDataStorage.occlusionRetryCount;\n    },\n    set: function (value) {\n        this._occlusionDataStorage.occlusionRetryCount = value;\n    },\n    enumerable: true,\n    configurable: true,\n});\nObject.defineProperty(AbstractMesh.prototype, \"forceRenderingWhenOccluded\", {\n    get: function () {\n        return this._occlusionDataStorage.forceRenderingWhenOccluded;\n    },\n    set: function (value) {\n        this._occlusionDataStorage.forceRenderingWhenOccluded = value;\n    },\n    enumerable: true,\n    configurable: true,\n});\n// We also need to update AbstractMesh as there is a portion of the code there\nAbstractMesh.prototype._checkOcclusionQuery = function () {\n    const dataStorage = this._occlusionDataStorage;\n    if (dataStorage.occlusionType === AbstractMesh.OCCLUSION_TYPE_NONE) {\n        dataStorage.isOccluded = false;\n        return false;\n    }\n    const engine = this.getEngine();\n    if (!engine.getCaps().supportOcclusionQuery) {\n        dataStorage.isOccluded = false;\n        return false;\n    }\n    if (!engine.isQueryResultAvailable) {\n        // Occlusion query where not referenced\n        dataStorage.isOccluded = false;\n        return false;\n    }\n    if (this.isOcclusionQueryInProgress && this._occlusionQuery !== null && this._occlusionQuery !== undefined) {\n        const isOcclusionQueryAvailable = engine.isQueryResultAvailable(this._occlusionQuery);\n        if (isOcclusionQueryAvailable) {\n            const occlusionQueryResult = engine.getQueryResult(this._occlusionQuery);\n            dataStorage.isOcclusionQueryInProgress = false;\n            dataStorage.occlusionInternalRetryCounter = 0;\n            dataStorage.isOccluded = occlusionQueryResult > 0 ? false : true;\n        }\n        else {\n            dataStorage.occlusionInternalRetryCounter++;\n            if (dataStorage.occlusionRetryCount !== -1 && dataStorage.occlusionInternalRetryCounter > dataStorage.occlusionRetryCount) {\n                dataStorage.isOcclusionQueryInProgress = false;\n                dataStorage.occlusionInternalRetryCounter = 0;\n                // if optimistic set isOccluded to false regardless of the status of isOccluded. (Render in the current render loop)\n                // if strict continue the last state of the object.\n                dataStorage.isOccluded = dataStorage.occlusionType === AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC ? false : dataStorage.isOccluded;\n            }\n            else {\n                return dataStorage.occlusionType === AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC ? false : dataStorage.isOccluded;\n            }\n        }\n    }\n    const scene = this.getScene();\n    if (scene.getBoundingBoxRenderer) {\n        const occlusionBoundingBoxRenderer = scene.getBoundingBoxRenderer();\n        if (this._occlusionQuery === null) {\n            this._occlusionQuery = engine.createQuery();\n        }\n        if (this._occlusionQuery && engine.beginOcclusionQuery(dataStorage.occlusionQueryAlgorithmType, this._occlusionQuery)) {\n            occlusionBoundingBoxRenderer.renderOcclusionBoundingBox(this);\n            engine.endOcclusionQuery(dataStorage.occlusionQueryAlgorithmType);\n            this._occlusionDataStorage.isOcclusionQueryInProgress = true;\n        }\n    }\n    return dataStorage.isOccluded;\n};\n//# sourceMappingURL=abstractEngine.query.js.map","import { ThinWebGPUEngine } from \"../../thinWebGPUEngine.js\";\nimport { WebGPURenderItemBeginOcclusionQuery, WebGPURenderItemEndOcclusionQuery } from \"../webgpuBundleList.js\";\nimport \"../../../Engines/AbstractEngine/abstractEngine.query.js\";\nThinWebGPUEngine.prototype.getGPUFrameTimeCounter = function () {\n    return this._timestampQuery.gpuFrameTimeCounter;\n};\nThinWebGPUEngine.prototype.captureGPUFrameTime = function (value) {\n    this._timestampQuery.enable = value && !!this._caps.timerQuery;\n};\nThinWebGPUEngine.prototype.createQuery = function () {\n    return this._occlusionQuery.createQuery();\n};\nThinWebGPUEngine.prototype.deleteQuery = function (query) {\n    this._occlusionQuery.deleteQuery(query);\n    return this;\n};\nThinWebGPUEngine.prototype.isQueryResultAvailable = function (query) {\n    return this._occlusionQuery.isQueryResultAvailable(query);\n};\nThinWebGPUEngine.prototype.getQueryResult = function (query) {\n    return this._occlusionQuery.getQueryResult(query);\n};\nThinWebGPUEngine.prototype.beginOcclusionQuery = function (algorithmType, query) {\n    if (this.compatibilityMode) {\n        if (this._occlusionQuery.canBeginQuery(query)) {\n            this._currentRenderPass?.beginOcclusionQuery(query);\n            return true;\n        }\n    }\n    else {\n        this._bundleList.addItem(new WebGPURenderItemBeginOcclusionQuery(query));\n        return true;\n    }\n    return false;\n};\nThinWebGPUEngine.prototype.endOcclusionQuery = function () {\n    if (this.compatibilityMode) {\n        this._currentRenderPass?.endOcclusionQuery();\n    }\n    else {\n        this._bundleList.addItem(new WebGPURenderItemEndOcclusionQuery());\n    }\n    return this;\n};\n//# sourceMappingURL=engine.query.js.map","/* eslint-disable babylonjs/available */\nimport { Logger } from \"../Misc/logger.js\";\nimport { ThinWebGPUEngine } from \"./thinWebGPUEngine.js\";\nimport { Color4 } from \"../Maths/math.js\";\nimport { InternalTexture } from \"../Materials/Textures/internalTexture.js\";\nimport { Effect } from \"../Materials/effect.js\";\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nimport * as WebGPUConstants from \"./WebGPU/webgpuConstants.js\";\nimport { VertexBuffer } from \"../Buffers/buffer.js\";\nimport { WebGPUPipelineContext } from \"./WebGPU/webgpuPipelineContext.js\";\nimport { WebGPUShaderProcessorGLSL } from \"./WebGPU/webgpuShaderProcessorsGLSL.js\";\nimport { WebGPUShaderProcessorWGSL } from \"./WebGPU/webgpuShaderProcessorsWGSL.js\";\nimport { WebGPUShaderProcessingContext } from \"./WebGPU/webgpuShaderProcessingContext.js\";\nimport { Tools } from \"../Misc/tools.js\";\nimport { WebGPUTextureHelper } from \"./WebGPU/webgpuTextureHelper.js\";\nimport { WebGPUTextureManager } from \"./WebGPU/webgpuTextureManager.js\";\nimport { AbstractEngine } from \"./abstractEngine.js\";\nimport { WebGPUBufferManager } from \"./WebGPU/webgpuBufferManager.js\";\nimport { WebGPUHardwareTexture } from \"./WebGPU/webgpuHardwareTexture.js\";\nimport { UniformBuffer } from \"../Materials/uniformBuffer.js\";\nimport { WebGPUCacheSampler } from \"./WebGPU/webgpuCacheSampler.js\";\nimport { WebGPUCacheRenderPipelineTree } from \"./WebGPU/webgpuCacheRenderPipelineTree.js\";\nimport { WebGPUStencilStateComposer } from \"./WebGPU/webgpuStencilStateComposer.js\";\nimport { WebGPUDepthCullingState } from \"./WebGPU/webgpuDepthCullingState.js\";\nimport { WebGPUMaterialContext } from \"./WebGPU/webgpuMaterialContext.js\";\nimport { WebGPUDrawContext } from \"./WebGPU/webgpuDrawContext.js\";\nimport { WebGPUCacheBindGroups } from \"./WebGPU/webgpuCacheBindGroups.js\";\nimport { WebGPUClearQuad } from \"./WebGPU/webgpuClearQuad.js\";\nimport { WebGPURenderItemBlendColor, WebGPURenderItemScissor, WebGPURenderItemStencilRef, WebGPURenderItemViewport, WebGPUBundleList } from \"./WebGPU/webgpuBundleList.js\";\nimport { WebGPUTimestampQuery } from \"./WebGPU/webgpuTimestampQuery.js\";\nimport { WebGPUOcclusionQuery } from \"./WebGPU/webgpuOcclusionQuery.js\";\nimport { ShaderCodeInliner } from \"./Processors/shaderCodeInliner.js\";\nimport { WebGPUTintWASM } from \"./WebGPU/webgpuTintWASM.js\";\nimport { WebGPUShaderProcessor } from \"./WebGPU/webgpuShaderProcessor.js\";\nimport { WebGPUSnapshotRendering } from \"./WebGPU/webgpuSnapshotRendering.js\";\nimport \"../Buffers/buffer.align.js\";\nimport { SphericalPolynomial } from \"../Maths/sphericalPolynomial.js\";\nimport { PerformanceMonitor } from \"../Misc/performanceMonitor.js\";\nimport { CreateImageBitmapFromSource, ExitFullscreen, ExitPointerlock, GetFontOffset, RequestFullscreen, RequestPointerlock, ResizeImageBitmap, _CommonDispose, _CommonInit, } from \"./engine.common.js\";\nimport { IsWrapper } from \"../Materials/drawWrapper.functions.js\";\nimport { PerfCounter } from \"../Misc/perfCounter.js\";\nimport \"./AbstractEngine/abstractEngine.loadingScreen.js\";\nimport \"./AbstractEngine/abstractEngine.dom.js\";\nimport \"./AbstractEngine/abstractEngine.states.js\";\nimport \"./AbstractEngine/abstractEngine.renderPass.js\";\nimport \"../Audio/audioEngine.js\";\nimport { resetCachedPipeline } from \"../Materials/effect.functions.js\";\nimport { WebGPUExternalTexture } from \"./WebGPU/webgpuExternalTexture.js\";\nimport \"./WebGPU/Extensions/engine.alpha.js\";\nimport \"./WebGPU/Extensions/engine.rawTexture.js\";\nimport \"./WebGPU/Extensions/engine.readTexture.js\";\nimport \"./WebGPU/Extensions/engine.cubeTexture.js\";\nimport \"./WebGPU/Extensions/engine.renderTarget.js\";\nimport \"./WebGPU/Extensions/engine.renderTargetTexture.js\";\nimport \"./WebGPU/Extensions/engine.renderTargetCube.js\";\nimport \"./WebGPU/Extensions/engine.query.js\";\nconst viewDescriptorSwapChainAntialiasing = {\n    label: `TextureView_SwapChain_ResolveTarget`,\n    dimension: \"2d\" /* WebGPUConstants.TextureDimension.E2d */,\n    format: undefined, // will be updated with the right value\n    mipLevelCount: 1,\n    arrayLayerCount: 1,\n};\nconst viewDescriptorSwapChain = {\n    label: `TextureView_SwapChain`,\n    dimension: \"2d\" /* WebGPUConstants.TextureDimension.E2d */,\n    format: undefined, // will be updated with the right value\n    mipLevelCount: 1,\n    arrayLayerCount: 1,\n};\nconst tempColor4 = new Color4();\n/**\n * The web GPU engine class provides support for WebGPU version of babylon.js.\n * @since 5.0.0\n */\nexport class WebGPUEngine extends ThinWebGPUEngine {\n    /**\n     * Gets or sets the snapshot rendering mode\n     */\n    get snapshotRenderingMode() {\n        return this._snapshotRendering.mode;\n    }\n    set snapshotRenderingMode(mode) {\n        this._snapshotRendering.mode = mode;\n    }\n    /**\n     * Creates a new snapshot at the next frame using the current snapshotRenderingMode\n     */\n    snapshotRenderingReset() {\n        this._snapshotRendering.reset();\n    }\n    /**\n     * Enables or disables the snapshot rendering mode\n     * Note that the WebGL engine does not support snapshot rendering so setting the value won't have any effect for this engine\n     */\n    get snapshotRendering() {\n        return this._snapshotRendering.enabled;\n    }\n    set snapshotRendering(activate) {\n        this._snapshotRendering.enabled = activate;\n    }\n    /**\n     * Sets this to true to disable the cache for the samplers. You should do it only for testing purpose!\n     */\n    get disableCacheSamplers() {\n        return this._cacheSampler ? this._cacheSampler.disabled : false;\n    }\n    set disableCacheSamplers(disable) {\n        if (this._cacheSampler) {\n            this._cacheSampler.disabled = disable;\n        }\n    }\n    /**\n     * Sets this to true to disable the cache for the render pipelines. You should do it only for testing purpose!\n     */\n    get disableCacheRenderPipelines() {\n        return this._cacheRenderPipeline ? this._cacheRenderPipeline.disabled : false;\n    }\n    set disableCacheRenderPipelines(disable) {\n        if (this._cacheRenderPipeline) {\n            this._cacheRenderPipeline.disabled = disable;\n        }\n    }\n    /**\n     * Sets this to true to disable the cache for the bind groups. You should do it only for testing purpose!\n     */\n    get disableCacheBindGroups() {\n        return this._cacheBindGroups ? this._cacheBindGroups.disabled : false;\n    }\n    set disableCacheBindGroups(disable) {\n        if (this._cacheBindGroups) {\n            this._cacheBindGroups.disabled = disable;\n        }\n    }\n    /**\n     * Gets a boolean indicating if all created effects are ready\n     * @returns true if all effects are ready\n     */\n    areAllEffectsReady() {\n        return true;\n    }\n    /**\n     * Get Font size information\n     * @param font font name\n     * @returns an object containing ascent, height and descent\n     */\n    getFontOffset(font) {\n        return GetFontOffset(font);\n    }\n    /**\n     * Gets a Promise<boolean> indicating if the engine can be instantiated (ie. if a WebGPU context can be found)\n     */\n    static get IsSupportedAsync() {\n        return !navigator.gpu\n            ? Promise.resolve(false)\n            : navigator.gpu\n                .requestAdapter()\n                .then((adapter) => !!adapter, () => false)\n                .catch(() => false);\n    }\n    /**\n     * Not supported by WebGPU, you should call IsSupportedAsync instead!\n     */\n    static get IsSupported() {\n        Logger.Warn(\"You must call IsSupportedAsync for WebGPU!\");\n        return false;\n    }\n    /**\n     * Gets a boolean indicating that the engine supports uniform buffers\n     */\n    get supportsUniformBuffers() {\n        return true;\n    }\n    /** Gets the supported extensions by the WebGPU adapter */\n    get supportedExtensions() {\n        return this._adapterSupportedExtensions;\n    }\n    /** Gets the currently enabled extensions on the WebGPU device */\n    get enabledExtensions() {\n        return this._deviceEnabledExtensions;\n    }\n    /** Gets the supported limits by the WebGPU adapter */\n    get supportedLimits() {\n        return this._adapterSupportedLimits;\n    }\n    /** Gets the current limits of the WebGPU device */\n    get currentLimits() {\n        return this._deviceLimits;\n    }\n    /**\n     * Returns a string describing the current engine\n     */\n    get description() {\n        const description = this.name + this.version;\n        return description;\n    }\n    /**\n     * Returns the version of the engine\n     */\n    get version() {\n        return 1;\n    }\n    /**\n     * Gets an object containing information about the current engine context\n     * @returns an object containing the vendor, the renderer and the version of the current engine context\n     */\n    getInfo() {\n        return {\n            vendor: this._adapterInfo.vendor || \"unknown vendor\",\n            renderer: this._adapterInfo.architecture || \"unknown renderer\",\n            version: this._adapterInfo.description || \"unknown version\",\n        };\n    }\n    /**\n     * (WebGPU only) True (default) to be in compatibility mode, meaning rendering all existing scenes without artifacts (same rendering than WebGL).\n     * Setting the property to false will improve performances but may not work in some scenes if some precautions are not taken.\n     * See https://doc.babylonjs.com/setup/support/webGPU/webGPUOptimization/webGPUNonCompatibilityMode for more details\n     */\n    get compatibilityMode() {\n        return this._compatibilityMode;\n    }\n    set compatibilityMode(mode) {\n        this._compatibilityMode = mode;\n    }\n    /** @internal */\n    get currentSampleCount() {\n        return this._currentRenderTarget ? this._currentRenderTarget.samples : this._mainPassSampleCount;\n    }\n    /**\n     * Create a new instance of the gpu engine asynchronously\n     * @param canvas Defines the canvas to use to display the result\n     * @param options Defines the options passed to the engine to create the GPU context dependencies\n     * @returns a promise that resolves with the created engine\n     */\n    static CreateAsync(canvas, options = {}) {\n        const engine = new WebGPUEngine(canvas, options);\n        return new Promise((resolve) => {\n            engine.initAsync(options.glslangOptions, options.twgslOptions).then(() => resolve(engine));\n        });\n    }\n    /**\n     * Create a new instance of the gpu engine.\n     * @param canvas Defines the canvas to use to display the result\n     * @param options Defines the options passed to the engine to create the GPU context dependencies\n     */\n    constructor(canvas, options = {}) {\n        super(options.antialias ?? true, options);\n        /** A unique id to identify this instance */\n        this.uniqueId = -1;\n        // Page Life cycle and constants\n        this._uploadEncoderDescriptor = { label: \"upload\" };\n        this._renderEncoderDescriptor = { label: \"render\" };\n        /** @internal */\n        this._clearDepthValue = 1;\n        /** @internal */\n        this._clearReverseDepthValue = 0;\n        /** @internal */\n        this._clearStencilValue = 0;\n        this._defaultSampleCount = 4; // Only supported value for now.\n        this._glslang = null;\n        this._tintWASM = null;\n        this._glslangAndTintAreFullyLoaded = false;\n        this._adapterInfo = {\n            vendor: \"\",\n            architecture: \"\",\n            device: \"\",\n            description: \"\",\n        };\n        /** @internal */\n        this._compiledComputeEffects = {};\n        /** @internal */\n        this._counters = {\n            numEnableEffects: 0,\n            numEnableDrawWrapper: 0,\n            numBundleCreationNonCompatMode: 0,\n            numBundleReuseNonCompatMode: 0,\n        };\n        /**\n         * Counters from last frame\n         */\n        this.countersLastFrame = {\n            numEnableEffects: 0,\n            numEnableDrawWrapper: 0,\n            numBundleCreationNonCompatMode: 0,\n            numBundleReuseNonCompatMode: 0,\n        };\n        /**\n         * Max number of uncaptured error messages to log\n         */\n        this.numMaxUncapturedErrors = 20;\n        /**\n         * Gets the list of created scenes\n         */\n        this.scenes = [];\n        /** @internal */\n        this._virtualScenes = new Array();\n        this._commandBuffers = [null, null];\n        // Frame Buffer Life Cycle (recreated for each render target pass)\n        this._mainRenderPassWrapper = {\n            renderPassDescriptor: null,\n            colorAttachmentViewDescriptor: null,\n            depthAttachmentViewDescriptor: null,\n            colorAttachmentGPUTextures: [],\n            depthTextureFormat: undefined,\n        };\n        this._rttRenderPassWrapper = {\n            renderPassDescriptor: null,\n            colorAttachmentViewDescriptor: null,\n            depthAttachmentViewDescriptor: null,\n            colorAttachmentGPUTextures: [],\n            depthTextureFormat: undefined,\n        };\n        /** @internal */\n        this._pendingDebugCommands = [];\n        this._currentOverrideVertexBuffers = null;\n        this._currentIndexBuffer = null;\n        this._colorWriteLocal = true;\n        this._forceEnableEffect = false;\n        /**\n         * Indicates if the z range in NDC space is 0..1 (value: true) or -1..1 (value: false)\n         */\n        this.isNDCHalfZRange = true;\n        /**\n         * Indicates that the origin of the texture/framebuffer space is the bottom left corner. If false, the origin is top left\n         */\n        this.hasOriginBottomLeft = false;\n        //------------------------------------------------------------------------------\n        //                              Initialization\n        //------------------------------------------------------------------------------\n        this._workingGlslangAndTintPromise = null;\n        //------------------------------------------------------------------------------\n        //                              Dynamic WebGPU States\n        //------------------------------------------------------------------------------\n        // index 0 is for main render pass, 1 for RTT render pass\n        this._viewportsCurrent = { x: 0, y: 0, w: 0, h: 0 };\n        this._scissorsCurrent = { x: 0, y: 0, w: 0, h: 0 };\n        this._scissorCached = { x: 0, y: 0, z: 0, w: 0 };\n        this._stencilRefsCurrent = -1;\n        this._blendColorsCurrent = [null, null, null, null];\n        this._performanceMonitor = new PerformanceMonitor();\n        this._name = \"WebGPU\";\n        this._drawCalls = new PerfCounter();\n        options.deviceDescriptor = options.deviceDescriptor || {};\n        options.enableGPUDebugMarkers = options.enableGPUDebugMarkers ?? false;\n        Logger.Log(`Babylon.js v${AbstractEngine.Version} - ${this.description} engine`);\n        if (!navigator.gpu) {\n            Logger.Error(\"WebGPU is not supported by your browser.\");\n            return;\n        }\n        options.swapChainFormat = options.swapChainFormat || navigator.gpu.getPreferredCanvasFormat();\n        this._isWebGPU = true;\n        this._shaderPlatformName = \"WEBGPU\";\n        this._renderingCanvas = canvas;\n        this._options = options;\n        this._mainPassSampleCount = options.antialias ? this._defaultSampleCount : 1;\n        if (navigator && navigator.userAgent) {\n            this._setupMobileChecks();\n        }\n        this._sharedInit(this._renderingCanvas);\n        this._shaderProcessor = new WebGPUShaderProcessorGLSL();\n        this._shaderProcessorWGSL = new WebGPUShaderProcessorWGSL();\n    }\n    /**\n     * Load the glslang and tintWASM libraries and prepare them for use.\n     * @returns a promise that resolves when the engine is ready to use the glslang and tintWASM\n     */\n    prepareGlslangAndTintAsync() {\n        if (!this._workingGlslangAndTintPromise) {\n            this._workingGlslangAndTintPromise = new Promise((resolve) => {\n                this._initGlslang(this._glslangOptions ?? this._options?.glslangOptions).then((glslang) => {\n                    this._glslang = glslang;\n                    this._tintWASM = new WebGPUTintWASM();\n                    this._tintWASM.initTwgsl(this._twgslOptions ?? this._options?.twgslOptions).then(() => {\n                        this._glslangAndTintAreFullyLoaded = true;\n                        resolve();\n                    });\n                });\n            });\n        }\n        return this._workingGlslangAndTintPromise;\n    }\n    /**\n     * Initializes the WebGPU context and dependencies.\n     * @param glslangOptions Defines the GLSLang compiler options if necessary\n     * @param twgslOptions Defines the Twgsl compiler options if necessary\n     * @returns a promise notifying the readiness of the engine.\n     */\n    initAsync(glslangOptions, twgslOptions) {\n        this.uniqueId = WebGPUEngine._InstanceId++;\n        this._glslangOptions = glslangOptions;\n        this._twgslOptions = twgslOptions;\n        return navigator\n            .gpu.requestAdapter(this._options)\n            .then((adapter) => {\n            if (!adapter) {\n                // eslint-disable-next-line no-throw-literal\n                throw \"Could not retrieve a WebGPU adapter (adapter is null).\";\n            }\n            else {\n                this._adapter = adapter;\n                this._adapterSupportedExtensions = [];\n                this._adapter.features?.forEach((feature) => this._adapterSupportedExtensions.push(feature));\n                this._adapterSupportedLimits = this._adapter.limits;\n                this._adapterInfo = this._adapter.info;\n                const deviceDescriptor = this._options.deviceDescriptor ?? {};\n                const requiredFeatures = deviceDescriptor?.requiredFeatures ?? (this._options.enableAllFeatures ? this._adapterSupportedExtensions : undefined);\n                if (requiredFeatures) {\n                    const requestedExtensions = requiredFeatures;\n                    const validExtensions = [];\n                    for (const extension of requestedExtensions) {\n                        if (this._adapterSupportedExtensions.indexOf(extension) !== -1) {\n                            validExtensions.push(extension);\n                        }\n                    }\n                    deviceDescriptor.requiredFeatures = validExtensions;\n                }\n                if (this._options.setMaximumLimits && !deviceDescriptor.requiredLimits) {\n                    deviceDescriptor.requiredLimits = {};\n                    for (const name in this._adapterSupportedLimits) {\n                        if (name === \"minSubgroupSize\" || name === \"maxSubgroupSize\") {\n                            // Chrome exposes these limits in \"webgpu developer\" mode, but these can't be set on the device.\n                            continue;\n                        }\n                        deviceDescriptor.requiredLimits[name] = this._adapterSupportedLimits[name];\n                    }\n                }\n                deviceDescriptor.label = `BabylonWebGPUDevice${this.uniqueId}`;\n                return this._adapter.requestDevice(deviceDescriptor);\n            }\n        })\n            .then((device) => {\n            this._device = device;\n            this._deviceEnabledExtensions = [];\n            this._device.features?.forEach((feature) => this._deviceEnabledExtensions.push(feature));\n            this._deviceLimits = device.limits;\n            let numUncapturedErrors = -1;\n            this._device.addEventListener(\"uncapturederror\", (event) => {\n                if (++numUncapturedErrors < this.numMaxUncapturedErrors) {\n                    Logger.Warn(`WebGPU uncaptured error (${numUncapturedErrors + 1}): ${event.error} - ${event.error.message}`);\n                }\n                else if (numUncapturedErrors++ === this.numMaxUncapturedErrors) {\n                    Logger.Warn(`WebGPU uncaptured error: too many warnings (${this.numMaxUncapturedErrors}), no more warnings will be reported to the console for this engine.`);\n                }\n            });\n            if (!this._doNotHandleContextLost) {\n                this._device.lost?.then((info) => {\n                    if (this._isDisposed) {\n                        return;\n                    }\n                    this._contextWasLost = true;\n                    Logger.Warn(\"WebGPU context lost. \" + info);\n                    this.onContextLostObservable.notifyObservers(this);\n                    this._restoreEngineAfterContextLost(async () => {\n                        const snapshotRenderingMode = this.snapshotRenderingMode;\n                        const snapshotRendering = this.snapshotRendering;\n                        const disableCacheSamplers = this.disableCacheSamplers;\n                        const disableCacheRenderPipelines = this.disableCacheRenderPipelines;\n                        const disableCacheBindGroups = this.disableCacheBindGroups;\n                        const enableGPUTimingMeasurements = this.enableGPUTimingMeasurements;\n                        await this.initAsync(this._glslangOptions ?? this._options?.glslangOptions, this._twgslOptions ?? this._options?.twgslOptions);\n                        this.snapshotRenderingMode = snapshotRenderingMode;\n                        this.snapshotRendering = snapshotRendering;\n                        this.disableCacheSamplers = disableCacheSamplers;\n                        this.disableCacheRenderPipelines = disableCacheRenderPipelines;\n                        this.disableCacheBindGroups = disableCacheBindGroups;\n                        this.enableGPUTimingMeasurements = enableGPUTimingMeasurements;\n                        this._currentRenderPass = null;\n                    });\n                });\n            }\n        })\n            .then(() => {\n            this._initializeLimits();\n            this._bufferManager = new WebGPUBufferManager(this, this._device);\n            this._textureHelper = new WebGPUTextureManager(this, this._device, this._bufferManager, this._deviceEnabledExtensions);\n            this._cacheSampler = new WebGPUCacheSampler(this._device);\n            this._cacheBindGroups = new WebGPUCacheBindGroups(this._device, this._cacheSampler, this);\n            this._timestampQuery = new WebGPUTimestampQuery(this, this._device, this._bufferManager);\n            this._occlusionQuery = this._device.createQuerySet ? new WebGPUOcclusionQuery(this, this._device, this._bufferManager) : undefined;\n            this._bundleList = new WebGPUBundleList(this._device);\n            this._snapshotRendering = new WebGPUSnapshotRendering(this, this._snapshotRenderingMode, this._bundleList);\n            this._ubInvertY = this._bufferManager.createBuffer(new Float32Array([-1, 0]), WebGPUConstants.BufferUsage.Uniform | WebGPUConstants.BufferUsage.CopyDst, \"UBInvertY\");\n            this._ubDontInvertY = this._bufferManager.createBuffer(new Float32Array([1, 0]), WebGPUConstants.BufferUsage.Uniform | WebGPUConstants.BufferUsage.CopyDst, \"UBDontInvertY\");\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if (this._count === undefined) {\n                    this._count = 0;\n                    Logger.Log([\"%c frame #\" + this._count + \" - begin\", \"background: #ffff00\"]);\n                }\n            }\n            this._uploadEncoder = this._device.createCommandEncoder(this._uploadEncoderDescriptor);\n            this._renderEncoder = this._device.createCommandEncoder(this._renderEncoderDescriptor);\n            this._emptyVertexBuffer = new VertexBuffer(this, [0], \"\", {\n                stride: 1,\n                offset: 0,\n                size: 1,\n                label: \"EmptyVertexBuffer\",\n            });\n            this._cacheRenderPipeline = new WebGPUCacheRenderPipelineTree(this._device, this._emptyVertexBuffer);\n            this._depthCullingState = new WebGPUDepthCullingState(this._cacheRenderPipeline);\n            this._stencilStateComposer = new WebGPUStencilStateComposer(this._cacheRenderPipeline);\n            this._stencilStateComposer.stencilGlobal = this._stencilState;\n            this._depthCullingState.depthTest = true;\n            this._depthCullingState.depthFunc = 515;\n            this._depthCullingState.depthMask = true;\n            this._textureHelper.setCommandEncoder(this._uploadEncoder);\n            this._clearQuad = new WebGPUClearQuad(this._device, this, this._emptyVertexBuffer);\n            this._defaultDrawContext = this.createDrawContext();\n            this._currentDrawContext = this._defaultDrawContext;\n            this._defaultMaterialContext = this.createMaterialContext();\n            this._currentMaterialContext = this._defaultMaterialContext;\n            this._initializeContextAndSwapChain();\n            this._initializeMainAttachments();\n            this.resize();\n        })\n            .catch((e) => {\n            Logger.Error(\"A fatal error occurred during WebGPU creation/initialization.\");\n            throw e;\n        });\n    }\n    _initGlslang(glslangOptions) {\n        glslangOptions = glslangOptions || {};\n        glslangOptions = {\n            ...WebGPUEngine._GlslangDefaultOptions,\n            ...glslangOptions,\n        };\n        if (glslangOptions.glslang) {\n            return Promise.resolve(glslangOptions.glslang);\n        }\n        if (self.glslang) {\n            return self.glslang(glslangOptions.wasmPath);\n        }\n        if (glslangOptions.jsPath && glslangOptions.wasmPath) {\n            return Tools.LoadBabylonScriptAsync(glslangOptions.jsPath).then(() => {\n                return self.glslang(Tools.GetBabylonScriptURL(glslangOptions.wasmPath));\n            });\n        }\n        return Promise.reject(\"gslang is not available.\");\n    }\n    _initializeLimits() {\n        // Init caps\n        // TODO WEBGPU Real Capability check once limits will be working.\n        this._caps = {\n            maxTexturesImageUnits: this._deviceLimits.maxSampledTexturesPerShaderStage,\n            maxVertexTextureImageUnits: this._deviceLimits.maxSampledTexturesPerShaderStage,\n            maxCombinedTexturesImageUnits: this._deviceLimits.maxSampledTexturesPerShaderStage * 2,\n            maxTextureSize: this._deviceLimits.maxTextureDimension2D,\n            maxCubemapTextureSize: this._deviceLimits.maxTextureDimension2D,\n            maxRenderTextureSize: this._deviceLimits.maxTextureDimension2D,\n            maxVertexAttribs: this._deviceLimits.maxVertexAttributes,\n            maxDrawBuffers: 8,\n            maxVaryingVectors: this._deviceLimits.maxInterStageShaderVariables,\n            maxFragmentUniformVectors: Math.floor(this._deviceLimits.maxUniformBufferBindingSize / 4),\n            maxVertexUniformVectors: Math.floor(this._deviceLimits.maxUniformBufferBindingSize / 4),\n            standardDerivatives: true,\n            astc: (this._deviceEnabledExtensions.indexOf(\"texture-compression-astc\" /* WebGPUConstants.FeatureName.TextureCompressionASTC */) >= 0 ? true : undefined),\n            s3tc: (this._deviceEnabledExtensions.indexOf(\"texture-compression-bc\" /* WebGPUConstants.FeatureName.TextureCompressionBC */) >= 0 ? true : undefined),\n            pvrtc: null,\n            etc1: null,\n            etc2: (this._deviceEnabledExtensions.indexOf(\"texture-compression-etc2\" /* WebGPUConstants.FeatureName.TextureCompressionETC2 */) >= 0 ? true : undefined),\n            bptc: this._deviceEnabledExtensions.indexOf(\"texture-compression-bc\" /* WebGPUConstants.FeatureName.TextureCompressionBC */) >= 0 ? true : undefined,\n            maxAnisotropy: 16, // Most implementations support maxAnisotropy values in range between 1 and 16, inclusive. The used value of maxAnisotropy will be clamped to the maximum value that the platform supports.\n            uintIndices: true,\n            fragmentDepthSupported: true,\n            highPrecisionShaderSupported: true,\n            colorBufferFloat: true,\n            supportFloatTexturesResolve: false, // See https://github.com/gpuweb/gpuweb/issues/3844\n            rg11b10ufColorRenderable: this._deviceEnabledExtensions.indexOf(\"rg11b10ufloat-renderable\" /* WebGPUConstants.FeatureName.RG11B10UFloatRenderable */) >= 0,\n            textureFloat: true,\n            textureFloatLinearFiltering: this._deviceEnabledExtensions.indexOf(\"float32-filterable\" /* WebGPUConstants.FeatureName.Float32Filterable */) >= 0,\n            textureFloatRender: true,\n            textureHalfFloat: true,\n            textureHalfFloatLinearFiltering: true,\n            textureHalfFloatRender: true,\n            textureLOD: true,\n            texelFetch: true,\n            drawBuffersExtension: true,\n            depthTextureExtension: true,\n            vertexArrayObject: false,\n            instancedArrays: true,\n            timerQuery: typeof BigUint64Array !== \"undefined\" && this._deviceEnabledExtensions.indexOf(\"timestamp-query\" /* WebGPUConstants.FeatureName.TimestampQuery */) !== -1 ? true : undefined,\n            supportOcclusionQuery: typeof BigUint64Array !== \"undefined\",\n            canUseTimestampForTimerQuery: true,\n            multiview: false,\n            oculusMultiview: false,\n            parallelShaderCompile: undefined,\n            blendMinMax: true,\n            maxMSAASamples: 4, // the spec only supports values of 1 and 4\n            canUseGLInstanceID: true,\n            canUseGLVertexID: true,\n            supportComputeShaders: true,\n            supportSRGBBuffers: true,\n            supportTransformFeedbacks: false,\n            textureMaxLevel: true,\n            texture2DArrayMaxLayerCount: this._deviceLimits.maxTextureArrayLayers,\n            disableMorphTargetTexture: false,\n            textureNorm16: false, // in the works: https://github.com/gpuweb/gpuweb/issues/3001\n        };\n        this._features = {\n            forceBitmapOverHTMLImageElement: true,\n            supportRenderAndCopyToLodForFloatTextures: true,\n            supportDepthStencilTexture: true,\n            supportShadowSamplers: true,\n            uniformBufferHardCheckMatrix: false,\n            allowTexturePrefiltering: true,\n            trackUbosInFrame: true,\n            checkUbosContentBeforeUpload: true,\n            supportCSM: true,\n            basisNeedsPOT: false,\n            support3DTextures: true,\n            needTypeSuffixInShaderConstants: true,\n            supportMSAA: true,\n            supportSSAO2: true,\n            supportIBLShadows: true,\n            supportExtendedTextureFormats: true,\n            supportSwitchCaseInShader: true,\n            supportSyncTextureRead: false,\n            needsInvertingBitmap: false,\n            useUBOBindingCache: false,\n            needShaderCodeInlining: true,\n            needToAlwaysBindUniformBuffers: true,\n            supportRenderPasses: true,\n            supportSpriteInstancing: true,\n            forceVertexBufferStrideAndOffsetMultiple4Bytes: true,\n            _checkNonFloatVertexBuffersDontRecreatePipelineContext: true,\n            _collectUbosUpdatedInFrame: false,\n        };\n    }\n    _initializeContextAndSwapChain() {\n        if (!this._renderingCanvas) {\n            // eslint-disable-next-line no-throw-literal\n            throw \"The rendering canvas has not been set!\";\n        }\n        this._context = this._renderingCanvas.getContext(\"webgpu\");\n        this._configureContext();\n        this._colorFormat = this._options.swapChainFormat;\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures = [new WebGPUHardwareTexture(this)];\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format = this._colorFormat;\n        this._setColorFormat(this._mainRenderPassWrapper);\n    }\n    // Set default values as WebGL with depth and stencil attachment for the broadest Compat.\n    _initializeMainAttachments() {\n        if (!this._bufferManager) {\n            return;\n        }\n        this.flushFramebuffer();\n        this._mainTextureExtends = {\n            width: this.getRenderWidth(true),\n            height: this.getRenderHeight(true),\n            depthOrArrayLayers: 1,\n        };\n        const bufferDataUpdate = new Float32Array([this.getRenderHeight(true)]);\n        this._bufferManager.setSubData(this._ubInvertY, 4, bufferDataUpdate);\n        this._bufferManager.setSubData(this._ubDontInvertY, 4, bufferDataUpdate);\n        let mainColorAttachments;\n        if (this._options.antialias) {\n            const mainTextureDescriptor = {\n                label: `Texture_MainColor_${this._mainTextureExtends.width}x${this._mainTextureExtends.height}_antialiasing`,\n                size: this._mainTextureExtends,\n                mipLevelCount: 1,\n                sampleCount: this._mainPassSampleCount,\n                dimension: \"2d\" /* WebGPUConstants.TextureDimension.E2d */,\n                format: this._options.swapChainFormat,\n                usage: 16 /* WebGPUConstants.TextureUsage.RenderAttachment */,\n            };\n            if (this._mainTexture) {\n                this._textureHelper.releaseTexture(this._mainTexture);\n            }\n            this._mainTexture = this._device.createTexture(mainTextureDescriptor);\n            mainColorAttachments = [\n                {\n                    view: this._mainTexture.createView({\n                        label: \"TextureView_MainColor_antialiasing\",\n                        dimension: \"2d\" /* WebGPUConstants.TextureDimension.E2d */,\n                        format: this._options.swapChainFormat,\n                        mipLevelCount: 1,\n                        arrayLayerCount: 1,\n                    }),\n                    clearValue: new Color4(0, 0, 0, 1),\n                    loadOp: \"clear\" /* WebGPUConstants.LoadOp.Clear */,\n                    storeOp: \"store\" /* WebGPUConstants.StoreOp.Store */, // don't use StoreOp.Discard, else using several cameras with different viewports or using scissors will fail because we call beginRenderPass / endPass several times for the same color attachment!\n                },\n            ];\n        }\n        else {\n            mainColorAttachments = [\n                {\n                    view: undefined,\n                    clearValue: new Color4(0, 0, 0, 1),\n                    loadOp: \"clear\" /* WebGPUConstants.LoadOp.Clear */,\n                    storeOp: \"store\" /* WebGPUConstants.StoreOp.Store */,\n                },\n            ];\n        }\n        this._mainRenderPassWrapper.depthTextureFormat = this.isStencilEnable ? \"depth24plus-stencil8\" /* WebGPUConstants.TextureFormat.Depth24PlusStencil8 */ : \"depth32float\" /* WebGPUConstants.TextureFormat.Depth32Float */;\n        this._setDepthTextureFormat(this._mainRenderPassWrapper);\n        this._setColorFormat(this._mainRenderPassWrapper);\n        const depthTextureDescriptor = {\n            label: `Texture_MainDepthStencil_${this._mainTextureExtends.width}x${this._mainTextureExtends.height}`,\n            size: this._mainTextureExtends,\n            mipLevelCount: 1,\n            sampleCount: this._mainPassSampleCount,\n            dimension: \"2d\" /* WebGPUConstants.TextureDimension.E2d */,\n            format: this._mainRenderPassWrapper.depthTextureFormat,\n            usage: 16 /* WebGPUConstants.TextureUsage.RenderAttachment */,\n        };\n        if (this._depthTexture) {\n            this._textureHelper.releaseTexture(this._depthTexture);\n        }\n        this._depthTexture = this._device.createTexture(depthTextureDescriptor);\n        const mainDepthAttachment = {\n            view: this._depthTexture.createView({\n                label: `TextureView_MainDepthStencil_${this._mainTextureExtends.width}x${this._mainTextureExtends.height}`,\n                dimension: \"2d\" /* WebGPUConstants.TextureDimension.E2d */,\n                format: this._depthTexture.format,\n                mipLevelCount: 1,\n                arrayLayerCount: 1,\n            }),\n            depthClearValue: this._clearDepthValue,\n            depthLoadOp: \"clear\" /* WebGPUConstants.LoadOp.Clear */,\n            depthStoreOp: \"store\" /* WebGPUConstants.StoreOp.Store */,\n            stencilClearValue: this._clearStencilValue,\n            stencilLoadOp: !this.isStencilEnable ? undefined : \"clear\" /* WebGPUConstants.LoadOp.Clear */,\n            stencilStoreOp: !this.isStencilEnable ? undefined : \"store\" /* WebGPUConstants.StoreOp.Store */,\n        };\n        this._mainRenderPassWrapper.renderPassDescriptor = {\n            label: \"MainRenderPass\",\n            colorAttachments: mainColorAttachments,\n            depthStencilAttachment: mainDepthAttachment,\n        };\n    }\n    /**\n     * Shared initialization across engines types.\n     * @param canvas The canvas associated with this instance of the engine.\n     */\n    _sharedInit(canvas) {\n        super._sharedInit(canvas);\n        _CommonInit(this, canvas, this._creationOptions);\n    }\n    _configureContext() {\n        this._context.configure({\n            device: this._device,\n            format: this._options.swapChainFormat,\n            usage: 16 /* WebGPUConstants.TextureUsage.RenderAttachment */ | 1 /* WebGPUConstants.TextureUsage.CopySrc */,\n            alphaMode: this.premultipliedAlpha ? \"premultiplied\" /* WebGPUConstants.CanvasAlphaMode.Premultiplied */ : \"opaque\" /* WebGPUConstants.CanvasAlphaMode.Opaque */,\n        });\n    }\n    /**\n     * Resize an image and returns the image data as an uint8array\n     * @param image image to resize\n     * @param bufferWidth destination buffer width\n     * @param bufferHeight destination buffer height\n     * @returns an uint8array containing RGBA values of bufferWidth * bufferHeight size\n     */\n    resizeImageBitmap(image, bufferWidth, bufferHeight) {\n        return ResizeImageBitmap(this, image, bufferWidth, bufferHeight);\n    }\n    /**\n     * Engine abstraction for loading and creating an image bitmap from a given source string.\n     * @param imageSource source to load the image from.\n     * @param options An object that sets options for the image's extraction.\n     * @returns ImageBitmap\n     */\n    _createImageBitmapFromSource(imageSource, options) {\n        return CreateImageBitmapFromSource(this, imageSource, options);\n    }\n    /**\n     * Toggle full screen mode\n     * @param requestPointerLock defines if a pointer lock should be requested from the user\n     */\n    switchFullscreen(requestPointerLock) {\n        if (this.isFullscreen) {\n            this.exitFullscreen();\n        }\n        else {\n            this.enterFullscreen(requestPointerLock);\n        }\n    }\n    /**\n     * Enters full screen mode\n     * @param requestPointerLock defines if a pointer lock should be requested from the user\n     */\n    enterFullscreen(requestPointerLock) {\n        if (!this.isFullscreen) {\n            this._pointerLockRequested = requestPointerLock;\n            if (this._renderingCanvas) {\n                RequestFullscreen(this._renderingCanvas);\n            }\n        }\n    }\n    /**\n     * Exits full screen mode\n     */\n    exitFullscreen() {\n        if (this.isFullscreen) {\n            ExitFullscreen();\n        }\n    }\n    /**\n     * Enters Pointerlock mode\n     */\n    enterPointerlock() {\n        if (this._renderingCanvas) {\n            RequestPointerlock(this._renderingCanvas);\n        }\n    }\n    /**\n     * Exits Pointerlock mode\n     */\n    exitPointerlock() {\n        ExitPointerlock();\n    }\n    _rebuildBuffers() {\n        super._rebuildBuffers();\n        for (const storageBuffer of this._storageBuffers) {\n            // The buffer can already be rebuilt by the call to _rebuildGeometries(), which recreates the storage buffers for the ComputeShaderParticleSystem\n            if (storageBuffer.getBuffer().engineId !== this.uniqueId) {\n                storageBuffer._rebuild();\n            }\n        }\n    }\n    _restoreEngineAfterContextLost(initEngine) {\n        WebGPUCacheRenderPipelineTree.ResetCache();\n        WebGPUCacheBindGroups.ResetCache();\n        // Clear the draw wrappers and material contexts\n        const cleanScenes = (scenes) => {\n            for (const scene of scenes) {\n                for (const mesh of scene.meshes) {\n                    const subMeshes = mesh.subMeshes;\n                    if (!subMeshes) {\n                        continue;\n                    }\n                    for (const subMesh of subMeshes) {\n                        subMesh._drawWrappers = [];\n                    }\n                }\n                for (const material of scene.materials) {\n                    material._materialContext?.reset();\n                }\n            }\n        };\n        cleanScenes(this.scenes);\n        cleanScenes(this._virtualScenes);\n        // The leftOver uniform buffers are removed from the list because they will be recreated when we rebuild the effects\n        const uboList = [];\n        for (const uniformBuffer of this._uniformBuffers) {\n            if (uniformBuffer.name.indexOf(\"leftOver\") < 0) {\n                uboList.push(uniformBuffer);\n            }\n        }\n        this._uniformBuffers = uboList;\n        super._restoreEngineAfterContextLost(initEngine);\n    }\n    /**\n     * Force a specific size of the canvas\n     * @param width defines the new canvas' width\n     * @param height defines the new canvas' height\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\n     * @returns true if the size was changed\n     */\n    setSize(width, height, forceSetSize = false) {\n        if (!super.setSize(width, height, forceSetSize)) {\n            return false;\n        }\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log([\"frame #\" + this._count + \" - setSize -\", width, height]);\n            }\n        }\n        this._initializeMainAttachments();\n        if (this.snapshotRendering) {\n            // reset snapshot rendering so that the next frame will record a new list of bundles\n            this.snapshotRenderingReset();\n        }\n        return true;\n    }\n    /**\n     * @internal\n     */\n    _getShaderProcessor(shaderLanguage) {\n        if (shaderLanguage === 1 /* ShaderLanguage.WGSL */) {\n            return this._shaderProcessorWGSL;\n        }\n        return this._shaderProcessor;\n    }\n    /**\n     * @internal\n     */\n    _getShaderProcessingContext(shaderLanguage, pureMode) {\n        return new WebGPUShaderProcessingContext(shaderLanguage, pureMode);\n    }\n    _getCurrentRenderPass() {\n        if (this._currentRenderTarget && !this._currentRenderPass) {\n            // delayed creation of the render target pass, but we now need to create it as we are requested the render pass\n            this._startRenderTargetRenderPass(this._currentRenderTarget, false, null, false, false);\n        }\n        else if (!this._currentRenderPass) {\n            this._startMainRenderPass(false);\n        }\n        return this._currentRenderPass;\n    }\n    /** @internal */\n    _getCurrentRenderPassWrapper() {\n        return this._currentRenderTarget ? this._rttRenderPassWrapper : this._mainRenderPassWrapper;\n    }\n    //------------------------------------------------------------------------------\n    //                          Static Pipeline WebGPU States\n    //------------------------------------------------------------------------------\n    /** @internal */\n    applyStates() {\n        this._stencilStateComposer.apply();\n        this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend);\n    }\n    /**\n     * Force the entire cache to be cleared\n     * You should not have to use this function unless your engine needs to share the WebGPU context with another engine\n     * @param bruteForce defines a boolean to force clearing ALL caches (including stencil, detoh and alpha states)\n     */\n    wipeCaches(bruteForce) {\n        if (this.preventCacheWipeBetweenFrames && !bruteForce) {\n            return;\n        }\n        //this._currentEffect = null; // can't reset _currentEffect, else some crashes can occur (for eg in ProceduralTexture which calls bindFrameBuffer (which calls wipeCaches) after having called enableEffect and before drawing into the texture)\n        // _forceEnableEffect = true assumes the role of _currentEffect = null\n        this._forceEnableEffect = true;\n        this._currentIndexBuffer = null;\n        this._currentOverrideVertexBuffers = null;\n        this._cacheRenderPipeline.setBuffers(null, null, null);\n        if (bruteForce) {\n            this._stencilStateComposer.reset();\n            this._depthCullingState.reset();\n            this._depthCullingState.depthFunc = 515;\n            this._alphaState.reset();\n            this._alphaMode = 1;\n            this._alphaEquation = 0;\n            this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters, this._alphaState._blendEquationParameters);\n            this._cacheRenderPipeline.setAlphaBlendEnabled(false);\n            this.setColorWrite(true);\n        }\n        this._cachedVertexBuffers = null;\n        this._cachedIndexBuffer = null;\n        this._cachedEffectForVertexBuffers = null;\n    }\n    /**\n     * Enable or disable color writing\n     * @param enable defines the state to set\n     */\n    setColorWrite(enable) {\n        this._colorWriteLocal = enable;\n        this._cacheRenderPipeline.setWriteMask(enable ? 0xf : 0);\n    }\n    /**\n     * Gets a boolean indicating if color writing is enabled\n     * @returns the current color writing state\n     */\n    getColorWrite() {\n        return this._colorWriteLocal;\n    }\n    _mustUpdateViewport() {\n        const x = this._viewportCached.x, y = this._viewportCached.y, w = this._viewportCached.z, h = this._viewportCached.w;\n        const update = this._viewportsCurrent.x !== x || this._viewportsCurrent.y !== y || this._viewportsCurrent.w !== w || this._viewportsCurrent.h !== h;\n        if (update) {\n            this._viewportsCurrent.x = this._viewportCached.x;\n            this._viewportsCurrent.y = this._viewportCached.y;\n            this._viewportsCurrent.w = this._viewportCached.z;\n            this._viewportsCurrent.h = this._viewportCached.w;\n        }\n        return update;\n    }\n    _applyViewport(bundleList) {\n        const x = Math.floor(this._viewportCached.x);\n        const w = Math.floor(this._viewportCached.z);\n        const h = Math.floor(this._viewportCached.w);\n        let y = Math.floor(this._viewportCached.y);\n        if (!this._currentRenderTarget) {\n            y = this.getRenderHeight(true) - y - h;\n        }\n        if (bundleList) {\n            bundleList.addItem(new WebGPURenderItemViewport(x, y, w, h));\n        }\n        else {\n            this._getCurrentRenderPass().setViewport(x, y, w, h, 0, 1);\n        }\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log([\n                    \"frame #\" + this._count + \" - viewport applied - (\",\n                    this._viewportCached.x,\n                    this._viewportCached.y,\n                    this._viewportCached.z,\n                    this._viewportCached.w,\n                    \") current pass is main pass=\" + this._currentPassIsMainPass(),\n                ]);\n            }\n        }\n    }\n    /**\n     * @internal\n     */\n    _viewport(x, y, width, height) {\n        this._viewportCached.x = x;\n        this._viewportCached.y = y;\n        this._viewportCached.z = width;\n        this._viewportCached.w = height;\n    }\n    _mustUpdateScissor() {\n        const x = this._scissorCached.x, y = this._scissorCached.y, w = this._scissorCached.z, h = this._scissorCached.w;\n        const update = this._scissorsCurrent.x !== x || this._scissorsCurrent.y !== y || this._scissorsCurrent.w !== w || this._scissorsCurrent.h !== h;\n        if (update) {\n            this._scissorsCurrent.x = this._scissorCached.x;\n            this._scissorsCurrent.y = this._scissorCached.y;\n            this._scissorsCurrent.w = this._scissorCached.z;\n            this._scissorsCurrent.h = this._scissorCached.w;\n        }\n        return update;\n    }\n    _applyScissor(bundleList) {\n        const y = this._currentRenderTarget ? this._scissorCached.y : this.getRenderHeight() - this._scissorCached.w - this._scissorCached.y;\n        if (bundleList) {\n            bundleList.addItem(new WebGPURenderItemScissor(this._scissorCached.x, y, this._scissorCached.z, this._scissorCached.w));\n        }\n        else {\n            this._getCurrentRenderPass().setScissorRect(this._scissorCached.x, y, this._scissorCached.z, this._scissorCached.w);\n        }\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log([\n                    \"frame #\" + this._count + \" - scissor applied - (\",\n                    this._scissorCached.x,\n                    this._scissorCached.y,\n                    this._scissorCached.z,\n                    this._scissorCached.w,\n                    \") current pass is main pass=\" + this._currentPassIsMainPass(),\n                ]);\n            }\n        }\n    }\n    _scissorIsActive() {\n        return this._scissorCached.x !== 0 || this._scissorCached.y !== 0 || this._scissorCached.z !== 0 || this._scissorCached.w !== 0;\n    }\n    enableScissor(x, y, width, height) {\n        this._scissorCached.x = x;\n        this._scissorCached.y = y;\n        this._scissorCached.z = width;\n        this._scissorCached.w = height;\n    }\n    disableScissor() {\n        this._scissorCached.x = this._scissorCached.y = this._scissorCached.z = this._scissorCached.w = 0;\n        this._scissorsCurrent.x = this._scissorsCurrent.y = this._scissorsCurrent.w = this._scissorsCurrent.h = 0;\n    }\n    _mustUpdateStencilRef() {\n        const update = this._stencilStateComposer.funcRef !== this._stencilRefsCurrent;\n        if (update) {\n            this._stencilRefsCurrent = this._stencilStateComposer.funcRef;\n        }\n        return update;\n    }\n    _applyStencilRef(bundleList) {\n        if (bundleList) {\n            bundleList.addItem(new WebGPURenderItemStencilRef(this._stencilStateComposer.funcRef ?? 0));\n        }\n        else {\n            this._getCurrentRenderPass().setStencilReference(this._stencilStateComposer.funcRef ?? 0);\n        }\n    }\n    _mustUpdateBlendColor() {\n        const colorBlend = this._alphaState._blendConstants;\n        const update = colorBlend[0] !== this._blendColorsCurrent[0] ||\n            colorBlend[1] !== this._blendColorsCurrent[1] ||\n            colorBlend[2] !== this._blendColorsCurrent[2] ||\n            colorBlend[3] !== this._blendColorsCurrent[3];\n        if (update) {\n            this._blendColorsCurrent[0] = colorBlend[0];\n            this._blendColorsCurrent[1] = colorBlend[1];\n            this._blendColorsCurrent[2] = colorBlend[2];\n            this._blendColorsCurrent[3] = colorBlend[3];\n        }\n        return update;\n    }\n    _applyBlendColor(bundleList) {\n        if (bundleList) {\n            bundleList.addItem(new WebGPURenderItemBlendColor(this._alphaState._blendConstants.slice()));\n        }\n        else {\n            this._getCurrentRenderPass().setBlendConstant(this._alphaState._blendConstants);\n        }\n    }\n    _resetRenderPassStates() {\n        this._viewportsCurrent.x = this._viewportsCurrent.y = this._viewportsCurrent.w = this._viewportsCurrent.h = 0;\n        this._scissorsCurrent.x = this._scissorsCurrent.y = this._scissorsCurrent.w = this._scissorsCurrent.h = 0;\n        this._stencilRefsCurrent = -1;\n        this._blendColorsCurrent[0] = this._blendColorsCurrent[1] = this._blendColorsCurrent[2] = this._blendColorsCurrent[3] = null;\n    }\n    /**\n     * Clear the current render buffer or the current render target (if any is set up)\n     * @param color defines the color to use\n     * @param backBuffer defines if the back buffer must be cleared\n     * @param depth defines if the depth buffer must be cleared\n     * @param stencil defines if the stencil buffer must be cleared\n     */\n    clear(color, backBuffer, depth, stencil = false) {\n        // Some PGs are using color3...\n        if (color && color.a === undefined) {\n            color.a = 1;\n        }\n        const hasScissor = this._scissorIsActive();\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log([\"frame #\" + this._count + \" - clear - backBuffer=\", backBuffer, \" depth=\", depth, \" stencil=\", stencil, \" scissor is active=\", hasScissor]);\n            }\n        }\n        // We need to recreate the render pass so that the new parameters for clear color / depth / stencil are taken into account\n        if (this._currentRenderTarget) {\n            if (hasScissor) {\n                if (!this._currentRenderPass) {\n                    this._startRenderTargetRenderPass(this._currentRenderTarget, false, backBuffer ? color : null, depth, stencil);\n                }\n                this._applyScissor(!this.compatibilityMode ? this._bundleList : null);\n                this._clearFullQuad(backBuffer ? color : null, depth, stencil);\n            }\n            else {\n                if (this._currentRenderPass) {\n                    this._endCurrentRenderPass();\n                }\n                this._startRenderTargetRenderPass(this._currentRenderTarget, true, backBuffer ? color : null, depth, stencil);\n            }\n        }\n        else {\n            if (!this._currentRenderPass || !hasScissor) {\n                this._startMainRenderPass(!hasScissor, backBuffer ? color : null, depth, stencil);\n            }\n            if (hasScissor) {\n                this._applyScissor(!this.compatibilityMode ? this._bundleList : null);\n                this._clearFullQuad(backBuffer ? color : null, depth, stencil);\n            }\n        }\n    }\n    _clearFullQuad(clearColor, clearDepth, clearStencil) {\n        const renderPass = !this.compatibilityMode ? null : this._getCurrentRenderPass();\n        this._clearQuad.setColorFormat(this._colorFormat);\n        this._clearQuad.setDepthStencilFormat(this._depthTextureFormat);\n        this._clearQuad.setMRTAttachments(this._cacheRenderPipeline.mrtAttachments ?? [], this._cacheRenderPipeline.mrtTextureArray ?? [], this._cacheRenderPipeline.mrtTextureCount);\n        if (!this.compatibilityMode) {\n            this._bundleList.addItem(new WebGPURenderItemStencilRef(this._clearStencilValue));\n        }\n        else {\n            renderPass.setStencilReference(this._clearStencilValue);\n        }\n        const bundle = this._clearQuad.clear(renderPass, clearColor, clearDepth, clearStencil, this.currentSampleCount);\n        if (!this.compatibilityMode) {\n            this._bundleList.addBundle(bundle);\n            this._applyStencilRef(this._bundleList);\n            this._reportDrawCall();\n        }\n        else {\n            this._applyStencilRef(null);\n        }\n    }\n    //------------------------------------------------------------------------------\n    //                              Vertex/Index/Storage Buffers\n    //------------------------------------------------------------------------------\n    /**\n     * Creates a vertex buffer\n     * @param data the data or the size for the vertex buffer\n     * @param _updatable whether the buffer should be created as updatable\n     * @param label defines the label of the buffer (for debug purpose)\n     * @returns the new buffer\n     */\n    createVertexBuffer(data, _updatable, label) {\n        let view;\n        if (data instanceof Array) {\n            view = new Float32Array(data);\n        }\n        else if (data instanceof ArrayBuffer) {\n            view = new Uint8Array(data);\n        }\n        else {\n            view = data;\n        }\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Vertex | WebGPUConstants.BufferUsage.CopyDst, label);\n        return dataBuffer;\n    }\n    /**\n     * Creates a vertex buffer\n     * @param data the data for the dynamic vertex buffer\n     * @param label defines the label of the buffer (for debug purpose)\n     * @returns the new buffer\n     */\n    createDynamicVertexBuffer(data, label) {\n        return this.createVertexBuffer(data, undefined, label);\n    }\n    /**\n     * Creates a new index buffer\n     * @param indices defines the content of the index buffer\n     * @param _updatable defines if the index buffer must be updatable\n     * @param label defines the label of the buffer (for debug purpose)\n     * @returns a new buffer\n     */\n    createIndexBuffer(indices, _updatable, label) {\n        let is32Bits = true;\n        let view;\n        if (indices instanceof Uint32Array || indices instanceof Int32Array) {\n            view = indices;\n        }\n        else if (indices instanceof Uint16Array) {\n            view = indices;\n            is32Bits = false;\n        }\n        else {\n            for (let index = 0; index < indices.length; index++) {\n                if (indices[index] > 65535) {\n                    view = new Uint32Array(indices);\n                    break;\n                }\n            }\n            if (!view) {\n                view = new Uint16Array(indices);\n                is32Bits = false;\n            }\n        }\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Index | WebGPUConstants.BufferUsage.CopyDst, label);\n        dataBuffer.is32Bits = is32Bits;\n        return dataBuffer;\n    }\n    /**\n     * Update a dynamic index buffer\n     * @param indexBuffer defines the target index buffer\n     * @param indices defines the data to update\n     * @param offset defines the offset in the target index buffer where update should start\n     */\n    updateDynamicIndexBuffer(indexBuffer, indices, offset = 0) {\n        const gpuBuffer = indexBuffer;\n        let view;\n        if (indexBuffer.is32Bits) {\n            view = indices instanceof Uint32Array ? indices : new Uint32Array(indices);\n        }\n        else {\n            view = indices instanceof Uint16Array ? indices : new Uint16Array(indices);\n        }\n        this._bufferManager.setSubData(gpuBuffer, offset, view);\n    }\n    /**\n     * Updates a dynamic vertex buffer.\n     * @param vertexBuffer the vertex buffer to update\n     * @param data the data used to update the vertex buffer\n     * @param byteOffset the byte offset of the data\n     * @param byteLength the byte length of the data\n     */\n    updateDynamicVertexBuffer(vertexBuffer, data, byteOffset, byteLength) {\n        const dataBuffer = vertexBuffer;\n        if (byteOffset === undefined) {\n            byteOffset = 0;\n        }\n        let view;\n        if (byteLength === undefined) {\n            if (data instanceof Array) {\n                view = new Float32Array(data);\n            }\n            else if (data instanceof ArrayBuffer) {\n                view = new Uint8Array(data);\n            }\n            else {\n                view = data;\n            }\n            byteLength = view.byteLength;\n        }\n        else {\n            if (data instanceof Array) {\n                view = new Float32Array(data);\n            }\n            else if (data instanceof ArrayBuffer) {\n                view = new Uint8Array(data);\n            }\n            else {\n                view = data;\n            }\n        }\n        this._bufferManager.setSubData(dataBuffer, byteOffset, view, 0, byteLength);\n    }\n    /**\n     * @internal\n     */\n    _createBuffer(data, creationFlags, label) {\n        let view;\n        if (data instanceof Array) {\n            view = new Float32Array(data);\n        }\n        else if (data instanceof ArrayBuffer) {\n            view = new Uint8Array(data);\n        }\n        else {\n            view = data;\n        }\n        let flags = 0;\n        if (creationFlags & 1) {\n            flags |= WebGPUConstants.BufferUsage.CopySrc;\n        }\n        if (creationFlags & 2) {\n            flags |= WebGPUConstants.BufferUsage.CopyDst;\n        }\n        if (creationFlags & 4) {\n            flags |= WebGPUConstants.BufferUsage.Uniform;\n        }\n        if (creationFlags & 8) {\n            flags |= WebGPUConstants.BufferUsage.Vertex;\n        }\n        if (creationFlags & 16) {\n            flags |= WebGPUConstants.BufferUsage.Index;\n        }\n        if (creationFlags & 32) {\n            flags |= WebGPUConstants.BufferUsage.Storage;\n        }\n        if (creationFlags & 64) {\n            flags |= WebGPUConstants.BufferUsage.Indirect;\n        }\n        return this._bufferManager.createBuffer(view, flags, label);\n    }\n    /**\n     * @internal\n     */\n    bindBuffersDirectly() {\n        // eslint-disable-next-line no-throw-literal\n        throw \"Not implemented on WebGPU\";\n    }\n    /**\n     * @internal\n     */\n    updateAndBindInstancesBuffer() {\n        // eslint-disable-next-line no-throw-literal\n        throw \"Not implemented on WebGPU\";\n    }\n    /**\n     * Unbind all instance attributes\n     */\n    unbindInstanceAttributes() {\n        // Does nothing\n    }\n    /**\n     * Bind a list of vertex buffers with the engine\n     * @param vertexBuffers defines the list of vertex buffers to bind\n     * @param indexBuffer defines the index buffer to bind\n     * @param effect defines the effect associated with the vertex buffers\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\n     */\n    bindBuffers(vertexBuffers, indexBuffer, effect, overrideVertexBuffers) {\n        this._currentIndexBuffer = indexBuffer;\n        this._currentOverrideVertexBuffers = overrideVertexBuffers ?? null;\n        this._cacheRenderPipeline.setBuffers(vertexBuffers, indexBuffer, this._currentOverrideVertexBuffers);\n    }\n    /**\n     * @internal\n     */\n    _releaseBuffer(buffer) {\n        return this._bufferManager.releaseBuffer(buffer);\n    }\n    //------------------------------------------------------------------------------\n    //                              Uniform Buffers\n    //------------------------------------------------------------------------------\n    /**\n     * Create an uniform buffer\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\n     * @param elements defines the content of the uniform buffer\n     * @param label defines a name for the buffer (for debugging purpose)\n     * @returns the webGL uniform buffer\n     */\n    createUniformBuffer(elements, label) {\n        let view;\n        if (elements instanceof Array) {\n            view = new Float32Array(elements);\n        }\n        else {\n            view = elements;\n        }\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Uniform | WebGPUConstants.BufferUsage.CopyDst, label);\n        return dataBuffer;\n    }\n    /**\n     * Create a dynamic uniform buffer (no different from a non dynamic uniform buffer in WebGPU)\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\n     * @param elements defines the content of the uniform buffer\n     * @param label defines a name for the buffer (for debugging purpose)\n     * @returns the webGL uniform buffer\n     */\n    createDynamicUniformBuffer(elements, label) {\n        return this.createUniformBuffer(elements, label);\n    }\n    /**\n     * Update an existing uniform buffer\n     * @see https://doc.babylonjs.com/setup/support/webGL2#uniform-buffer-objets\n     * @param uniformBuffer defines the target uniform buffer\n     * @param elements defines the content to update\n     * @param offset defines the offset in the uniform buffer where update should start\n     * @param count defines the size of the data to update\n     */\n    updateUniformBuffer(uniformBuffer, elements, offset, count) {\n        if (offset === undefined) {\n            offset = 0;\n        }\n        const dataBuffer = uniformBuffer;\n        let view;\n        if (count === undefined) {\n            if (elements instanceof Float32Array) {\n                view = elements;\n            }\n            else {\n                view = new Float32Array(elements);\n            }\n            count = view.byteLength;\n        }\n        else {\n            if (elements instanceof Float32Array) {\n                view = elements;\n            }\n            else {\n                view = new Float32Array(elements);\n            }\n        }\n        this._bufferManager.setSubData(dataBuffer, offset, view, 0, count);\n    }\n    /**\n     * Bind a buffer to the current draw context\n     * @param buffer defines the buffer to bind\n     * @param _location not used in WebGPU\n     * @param name Name of the uniform variable to bind\n     */\n    bindUniformBufferBase(buffer, _location, name) {\n        this._currentDrawContext.setBuffer(name, buffer);\n    }\n    /**\n     * Unused in WebGPU\n     */\n    bindUniformBlock() { }\n    //------------------------------------------------------------------------------\n    //                              Effects\n    //------------------------------------------------------------------------------\n    /**\n     * Create a new effect (used to store vertex/fragment shaders)\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\n     * @param attributesNamesOrOptions defines either a list of attribute names or an IEffectCreationOptions object\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\n     * @param samplers defines an array of string used to represent textures\n     * @param defines defines the string containing the defines to use to compile the shaders\n     * @param fallbacks defines the list of potential fallbacks to use if shader compilation fails\n     * @param onCompiled defines a function to call when the effect creation is successful\n     * @param onError defines a function to call when the effect creation has failed\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\n     * @param extraInitializationsAsync additional async code to run before preparing the effect\n     * @returns the new Effect\n     */\n    createEffect(baseName, attributesNamesOrOptions, uniformsNamesOrEngine, samplers, defines, fallbacks, onCompiled, onError, indexParameters, shaderLanguage = 0 /* ShaderLanguage.GLSL */, extraInitializationsAsync) {\n        const vertex = typeof baseName === \"string\" ? baseName : baseName.vertexToken || baseName.vertexSource || baseName.vertexElement || baseName.vertex;\n        const fragment = typeof baseName === \"string\" ? baseName : baseName.fragmentToken || baseName.fragmentSource || baseName.fragmentElement || baseName.fragment;\n        const globalDefines = this._getGlobalDefines();\n        const isOptions = attributesNamesOrOptions.attributes !== undefined;\n        let fullDefines = defines ?? attributesNamesOrOptions.defines ?? \"\";\n        if (globalDefines) {\n            fullDefines += \"\\n\" + globalDefines;\n        }\n        const name = vertex + \"+\" + fragment + \"@\" + fullDefines;\n        if (this._compiledEffects[name]) {\n            const compiledEffect = this._compiledEffects[name];\n            if (onCompiled && compiledEffect.isReady()) {\n                onCompiled(compiledEffect);\n            }\n            compiledEffect._refCount++;\n            return compiledEffect;\n        }\n        const effect = new Effect(baseName, attributesNamesOrOptions, isOptions ? this : uniformsNamesOrEngine, samplers, this, defines, fallbacks, onCompiled, onError, indexParameters, name, attributesNamesOrOptions.shaderLanguage ?? shaderLanguage, attributesNamesOrOptions.extraInitializationsAsync ?? extraInitializationsAsync);\n        this._compiledEffects[name] = effect;\n        return effect;\n    }\n    _compileRawShaderToSpirV(source, type) {\n        return this._glslang.compileGLSL(source, type);\n    }\n    _compileShaderToSpirV(source, type, defines, shaderVersion) {\n        return this._compileRawShaderToSpirV(shaderVersion + (defines ? defines + \"\\n\" : \"\") + source, type);\n    }\n    _getWGSLShader(source, type, defines) {\n        if (defines) {\n            defines = \"//\" + defines.split(\"\\n\").join(\"\\n//\") + \"\\n\";\n        }\n        else {\n            defines = \"\";\n        }\n        return defines + source;\n    }\n    _createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage, disableUniformityAnalysisInVertex, disableUniformityAnalysisInFragment) {\n        if (this._tintWASM && shaderLanguage === 0 /* ShaderLanguage.GLSL */) {\n            vertexShader = this._tintWASM.convertSpirV2WGSL(vertexShader, disableUniformityAnalysisInVertex);\n            fragmentShader = this._tintWASM.convertSpirV2WGSL(fragmentShader, disableUniformityAnalysisInFragment);\n        }\n        return {\n            vertexStage: {\n                module: this._device.createShaderModule({\n                    label: \"vertex\",\n                    code: vertexShader,\n                }),\n                entryPoint: \"main\",\n            },\n            fragmentStage: {\n                module: this._device.createShaderModule({\n                    label: \"fragment\",\n                    code: fragmentShader,\n                }),\n                entryPoint: \"main\",\n            },\n        };\n    }\n    _compileRawPipelineStageDescriptor(vertexCode, fragmentCode, shaderLanguage) {\n        const disableUniformityAnalysisInVertex = vertexCode.indexOf(`#define DISABLE_UNIFORMITY_ANALYSIS`) >= 0;\n        const disableUniformityAnalysisInFragment = fragmentCode.indexOf(`#define DISABLE_UNIFORMITY_ANALYSIS`) >= 0;\n        const vertexShader = shaderLanguage === 0 /* ShaderLanguage.GLSL */ ? this._compileRawShaderToSpirV(vertexCode, \"vertex\") : vertexCode;\n        const fragmentShader = shaderLanguage === 0 /* ShaderLanguage.GLSL */ ? this._compileRawShaderToSpirV(fragmentCode, \"fragment\") : fragmentCode;\n        return this._createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage, disableUniformityAnalysisInVertex, disableUniformityAnalysisInFragment);\n    }\n    _compilePipelineStageDescriptor(vertexCode, fragmentCode, defines, shaderLanguage) {\n        this.onBeforeShaderCompilationObservable.notifyObservers(this);\n        const disableUniformityAnalysisInVertex = vertexCode.indexOf(`#define DISABLE_UNIFORMITY_ANALYSIS`) >= 0;\n        const disableUniformityAnalysisInFragment = fragmentCode.indexOf(`#define DISABLE_UNIFORMITY_ANALYSIS`) >= 0;\n        const shaderVersion = \"#version 450\\n\";\n        const vertexShader = shaderLanguage === 0 /* ShaderLanguage.GLSL */ ? this._compileShaderToSpirV(vertexCode, \"vertex\", defines, shaderVersion) : this._getWGSLShader(vertexCode, \"vertex\", defines);\n        const fragmentShader = shaderLanguage === 0 /* ShaderLanguage.GLSL */\n            ? this._compileShaderToSpirV(fragmentCode, \"fragment\", defines, shaderVersion)\n            : this._getWGSLShader(fragmentCode, \"fragment\", defines);\n        const program = this._createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage, disableUniformityAnalysisInVertex, disableUniformityAnalysisInFragment);\n        this.onAfterShaderCompilationObservable.notifyObservers(this);\n        return program;\n    }\n    /**\n     * @internal\n     */\n    createRawShaderProgram() {\n        // eslint-disable-next-line no-throw-literal\n        throw \"Not available on WebGPU\";\n    }\n    /**\n     * @internal\n     */\n    createShaderProgram() {\n        // eslint-disable-next-line no-throw-literal\n        throw \"Not available on WebGPU\";\n    }\n    /**\n     * Inline functions in shader code that are marked to be inlined\n     * @param code code to inline\n     * @returns inlined code\n     */\n    inlineShaderCode(code) {\n        const sci = new ShaderCodeInliner(code);\n        sci.debug = false;\n        sci.processCode();\n        return sci.code;\n    }\n    /**\n     * Creates a new pipeline context\n     * @param shaderProcessingContext defines the shader processing context used during the processing if available\n     * @returns the new pipeline\n     */\n    createPipelineContext(shaderProcessingContext) {\n        return new WebGPUPipelineContext(shaderProcessingContext, this);\n    }\n    /**\n     * Creates a new material context\n     * @returns the new context\n     */\n    createMaterialContext() {\n        return new WebGPUMaterialContext();\n    }\n    /**\n     * Creates a new draw context\n     * @returns the new context\n     */\n    createDrawContext() {\n        return new WebGPUDrawContext(this._bufferManager);\n    }\n    /**\n     * @internal\n     */\n    async _preparePipelineContext(pipelineContext, vertexSourceCode, fragmentSourceCode, createAsRaw, rawVertexSourceCode, rawFragmentSourceCode, _rebuildRebind, defines, _transformFeedbackVaryings, _key, onReady) {\n        const webGpuContext = pipelineContext;\n        const shaderLanguage = webGpuContext.shaderProcessingContext.shaderLanguage;\n        if (shaderLanguage === 0 /* ShaderLanguage.GLSL */ && !this._glslangAndTintAreFullyLoaded) {\n            await this.prepareGlslangAndTintAsync();\n        }\n        if (this.dbgShowShaderCode) {\n            Logger.Log([\"defines\", defines]);\n            Logger.Log(vertexSourceCode);\n            Logger.Log(fragmentSourceCode);\n            Logger.Log(\"***********************************************\");\n        }\n        webGpuContext.sources = {\n            fragment: fragmentSourceCode,\n            vertex: vertexSourceCode,\n            rawVertex: rawVertexSourceCode,\n            rawFragment: rawFragmentSourceCode,\n        };\n        if (createAsRaw) {\n            webGpuContext.stages = this._compileRawPipelineStageDescriptor(vertexSourceCode, fragmentSourceCode, shaderLanguage);\n        }\n        else {\n            webGpuContext.stages = this._compilePipelineStageDescriptor(vertexSourceCode, fragmentSourceCode, defines, shaderLanguage);\n        }\n        onReady();\n    }\n    /**\n     * Gets the list of active attributes for a given WebGPU program\n     * @param pipelineContext defines the pipeline context to use\n     * @param attributesNames defines the list of attribute names to get\n     * @returns an array of indices indicating the offset of each attribute\n     */\n    getAttributes(pipelineContext, attributesNames) {\n        const results = new Array(attributesNames.length);\n        const gpuPipelineContext = pipelineContext;\n        for (let i = 0; i < attributesNames.length; i++) {\n            const attributeName = attributesNames[i];\n            const attributeLocation = gpuPipelineContext.shaderProcessingContext.availableAttributes[attributeName];\n            if (attributeLocation === undefined) {\n                continue;\n            }\n            results[i] = attributeLocation;\n        }\n        return results;\n    }\n    /**\n     * Activates an effect, making it the current one (ie. the one used for rendering)\n     * @param effect defines the effect to activate\n     */\n    enableEffect(effect) {\n        if (!effect) {\n            return;\n        }\n        if (!IsWrapper(effect)) {\n            this._currentEffect = effect;\n            this._currentMaterialContext = this._defaultMaterialContext;\n            this._currentDrawContext = this._defaultDrawContext;\n            this._counters.numEnableEffects++;\n            if (this.dbgLogIfNotDrawWrapper) {\n                Logger.Warn(`enableEffect has been called with an Effect and not a Wrapper! effect.uniqueId=${effect.uniqueId}, effect.name=${effect.name}, effect.name.vertex=${typeof effect.name === \"string\" ? \"\" : effect.name.vertex}, effect.name.fragment=${typeof effect.name === \"string\" ? \"\" : effect.name.fragment}`, 10);\n            }\n        }\n        else if (!effect.effect ||\n            (effect.effect === this._currentEffect &&\n                effect.materialContext === this._currentMaterialContext &&\n                effect.drawContext === this._currentDrawContext &&\n                !this._forceEnableEffect)) {\n            if (!effect.effect && this.dbgShowEmptyEnableEffectCalls) {\n                Logger.Log([\"drawWrapper=\", effect]);\n                // eslint-disable-next-line no-throw-literal\n                throw \"Invalid call to enableEffect: the effect property is empty!\";\n            }\n            return;\n        }\n        else {\n            this._currentEffect = effect.effect;\n            this._currentMaterialContext = effect.materialContext;\n            this._currentDrawContext = effect.drawContext;\n            this._counters.numEnableDrawWrapper++;\n            if (!this._currentMaterialContext) {\n                Logger.Log([\"drawWrapper=\", effect]);\n                // eslint-disable-next-line no-throw-literal\n                throw `Invalid call to enableEffect: the materialContext property is empty!`;\n            }\n        }\n        this._stencilStateComposer.stencilMaterial = undefined;\n        this._forceEnableEffect = false;\n        if (this._currentEffect.onBind) {\n            this._currentEffect.onBind(this._currentEffect);\n        }\n        if (this._currentEffect._onBindObservable) {\n            this._currentEffect._onBindObservable.notifyObservers(this._currentEffect);\n        }\n    }\n    /**\n     * @internal\n     */\n    _releaseEffect(effect) {\n        if (this._compiledEffects[effect._key]) {\n            delete this._compiledEffects[effect._key];\n            this._deletePipelineContext(effect.getPipelineContext());\n        }\n    }\n    /**\n     * Force the engine to release all cached effects. This means that next effect compilation will have to be done completely even if a similar effect was already compiled\n     */\n    releaseEffects() {\n        for (const name in this._compiledEffects) {\n            const webGPUPipelineContext = this._compiledEffects[name].getPipelineContext();\n            this._deletePipelineContext(webGPUPipelineContext);\n        }\n        this._compiledEffects = {};\n        this.onReleaseEffectsObservable.notifyObservers(this);\n    }\n    _deletePipelineContext(pipelineContext) {\n        const webgpuPipelineContext = pipelineContext;\n        if (webgpuPipelineContext) {\n            resetCachedPipeline(webgpuPipelineContext);\n        }\n    }\n    //------------------------------------------------------------------------------\n    //                              Textures\n    //------------------------------------------------------------------------------\n    /**\n     * Gets a boolean indicating that only power of 2 textures are supported\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\n     */\n    get needPOTTextures() {\n        return false;\n    }\n    /** @internal */\n    _createHardwareTexture() {\n        return new WebGPUHardwareTexture(this);\n    }\n    /**\n     * @internal\n     */\n    _releaseTexture(texture) {\n        const index = this._internalTexturesCache.indexOf(texture);\n        if (index !== -1) {\n            this._internalTexturesCache.splice(index, 1);\n        }\n        this._textureHelper.releaseTexture(texture);\n    }\n    /**\n     * @internal\n     */\n    _getRGBABufferInternalSizedFormat() {\n        return 5;\n    }\n    updateTextureComparisonFunction(texture, comparisonFunction) {\n        texture._comparisonFunction = comparisonFunction;\n    }\n    /**\n     * Creates an internal texture without binding it to a framebuffer\n     * @internal\n     * @param size defines the size of the texture\n     * @param options defines the options used to create the texture\n     * @param delayGPUTextureCreation true to delay the texture creation the first time it is really needed. false to create it right away\n     * @param source source type of the texture\n     * @returns a new internal texture\n     */\n    _createInternalTexture(size, options, delayGPUTextureCreation = true, source = 0 /* InternalTextureSource.Unknown */) {\n        const fullOptions = {};\n        if (options !== undefined && typeof options === \"object\") {\n            fullOptions.generateMipMaps = options.generateMipMaps;\n            fullOptions.createMipMaps = options.createMipMaps;\n            fullOptions.type = options.type === undefined ? 0 : options.type;\n            fullOptions.samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\n            fullOptions.format = options.format === undefined ? 5 : options.format;\n            fullOptions.samples = options.samples ?? 1;\n            fullOptions.creationFlags = options.creationFlags ?? 0;\n            fullOptions.useSRGBBuffer = options.useSRGBBuffer ?? false;\n            fullOptions.label = options.label;\n        }\n        else {\n            fullOptions.generateMipMaps = options;\n            fullOptions.type = 0;\n            fullOptions.samplingMode = 3;\n            fullOptions.format = 5;\n            fullOptions.samples = 1;\n            fullOptions.creationFlags = 0;\n            fullOptions.useSRGBBuffer = false;\n        }\n        if (fullOptions.type === 1 && !this._caps.textureFloatLinearFiltering) {\n            fullOptions.samplingMode = 1;\n        }\n        else if (fullOptions.type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\n            fullOptions.samplingMode = 1;\n        }\n        if (fullOptions.type === 1 && !this._caps.textureFloat) {\n            fullOptions.type = 0;\n            Logger.Warn(\"Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE\");\n        }\n        const texture = new InternalTexture(this, source);\n        const width = size.width ?? size;\n        const height = size.height ?? size;\n        const depth = size.depth ?? 0;\n        const layers = size.layers ?? 0;\n        texture.baseWidth = width;\n        texture.baseHeight = height;\n        texture.width = width;\n        texture.height = height;\n        texture.depth = depth || layers;\n        texture.isReady = true;\n        texture.samples = fullOptions.samples;\n        texture.generateMipMaps = !!fullOptions.generateMipMaps;\n        texture.samplingMode = fullOptions.samplingMode;\n        texture.type = fullOptions.type;\n        texture.format = fullOptions.format;\n        texture.is2DArray = layers > 0;\n        texture.is3D = depth > 0;\n        texture._cachedWrapU = 0;\n        texture._cachedWrapV = 0;\n        texture._useSRGBBuffer = fullOptions.useSRGBBuffer;\n        texture.label = fullOptions.label;\n        this._internalTexturesCache.push(texture);\n        if (!delayGPUTextureCreation) {\n            const createMipMapsOnly = !fullOptions.generateMipMaps && fullOptions.createMipMaps;\n            if (createMipMapsOnly) {\n                // So that the call to createGPUTextureForInternalTexture creates the mipmaps\n                texture.generateMipMaps = true;\n            }\n            this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, layers || 1, fullOptions.creationFlags);\n            if (createMipMapsOnly) {\n                // So that we don't automatically generate mipmaps when the render target is unbound\n                texture.generateMipMaps = false;\n            }\n        }\n        return texture;\n    }\n    /**\n     * Usually called from Texture.ts.\n     * Passed information to create a hardware texture\n     * @param url defines a value which contains one of the following:\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\n     * @param scene needed for loading to the correct scene\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\n     * @param onLoad optional callback to be called upon successful completion\n     * @param onError optional callback to be called upon failure\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\n     * @param forcedExtension defines the extension to use to pick the right loader\n     * @param mimeType defines an optional mime type\n     * @param loaderOptions options to be passed to the loader\n     * @param creationFlags specific flags to use when creating the texture (1 for storage textures, for eg)\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\n     */\n    createTexture(url, noMipmap, invertY, scene, samplingMode = 3, onLoad = null, onError = null, buffer = null, fallback = null, format = null, forcedExtension = null, mimeType, loaderOptions, creationFlags, useSRGBBuffer) {\n        return this._createTextureBase(url, noMipmap, invertY, scene, samplingMode, onLoad, onError, (texture, extension, scene, img, invertY, noMipmap, isCompressed, processFunction) => {\n            const imageBitmap = img; // we will never get an HTMLImageElement in WebGPU\n            texture.baseWidth = imageBitmap.width;\n            texture.baseHeight = imageBitmap.height;\n            texture.width = imageBitmap.width;\n            texture.height = imageBitmap.height;\n            texture.format = texture.format !== -1 ? texture.format : (format ?? 5);\n            texture.type = texture.type !== -1 ? texture.type : 0;\n            texture._creationFlags = creationFlags ?? 0;\n            processFunction(texture.width, texture.height, imageBitmap, extension, texture, () => { });\n            if (!texture._hardwareTexture?.underlyingResource) {\n                // the texture could have been created before reaching this point so don't recreate it if already existing\n                const gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, imageBitmap.width, imageBitmap.height, undefined, creationFlags);\n                if (WebGPUTextureHelper.IsImageBitmap(imageBitmap)) {\n                    this._textureHelper.updateTexture(imageBitmap, texture, imageBitmap.width, imageBitmap.height, texture.depth, gpuTextureWrapper.format, 0, 0, invertY, false, 0, 0);\n                    if (!noMipmap && !isCompressed) {\n                        this._generateMipmaps(texture, this._uploadEncoder);\n                    }\n                }\n            }\n            else if (!noMipmap && !isCompressed) {\n                this._generateMipmaps(texture, this._uploadEncoder);\n            }\n            if (scene) {\n                scene.removePendingData(texture);\n            }\n            texture.isReady = true;\n            texture.onLoadedObservable.notifyObservers(texture);\n            texture.onLoadedObservable.clear();\n        }, () => false, buffer, fallback, format, forcedExtension, mimeType, loaderOptions, useSRGBBuffer);\n    }\n    /**\n     * Wraps an external web gpu texture in a Babylon texture.\n     * @param texture defines the external texture\n     * @returns the babylon internal texture\n     */\n    wrapWebGPUTexture(texture) {\n        const hardwareTexture = new WebGPUHardwareTexture(this, texture);\n        const internalTexture = new InternalTexture(this, 0 /* InternalTextureSource.Unknown */, true);\n        internalTexture._hardwareTexture = hardwareTexture;\n        internalTexture.isReady = true;\n        return internalTexture;\n    }\n    // eslint-disable-next-line jsdoc/require-returns-check\n    /**\n     * Wraps an external web gl texture in a Babylon texture.\n     * @returns the babylon internal texture\n     */\n    wrapWebGLTexture() {\n        throw new Error(\"wrapWebGLTexture is not supported, use wrapWebGPUTexture instead.\");\n    }\n    /**\n     * @internal\n     */\n    _getUseSRGBBuffer(useSRGBBuffer, _noMipmap) {\n        return useSRGBBuffer && this._caps.supportSRGBBuffers;\n    }\n    /**\n     * @internal\n     */\n    _unpackFlipY(_value) { }\n    /**\n     * Update the sampling mode of a given texture\n     * @param samplingMode defines the required sampling mode\n     * @param texture defines the texture to update\n     * @param generateMipMaps defines whether to generate mipmaps for the texture\n     */\n    updateTextureSamplingMode(samplingMode, texture, generateMipMaps = false) {\n        if (generateMipMaps) {\n            texture.generateMipMaps = true;\n            this._generateMipmaps(texture);\n        }\n        texture.samplingMode = samplingMode;\n    }\n    /**\n     * Update the sampling mode of a given texture\n     * @param texture defines the texture to update\n     * @param wrapU defines the texture wrap mode of the u coordinates\n     * @param wrapV defines the texture wrap mode of the v coordinates\n     * @param wrapR defines the texture wrap mode of the r coordinates\n     */\n    updateTextureWrappingMode(texture, wrapU, wrapV = null, wrapR = null) {\n        if (wrapU !== null) {\n            texture._cachedWrapU = wrapU;\n        }\n        if (wrapV !== null) {\n            texture._cachedWrapV = wrapV;\n        }\n        if ((texture.is2DArray || texture.is3D) && wrapR !== null) {\n            texture._cachedWrapR = wrapR;\n        }\n    }\n    /**\n     * Update the dimensions of a texture\n     * @param texture texture to update\n     * @param width new width of the texture\n     * @param height new height of the texture\n     * @param depth new depth of the texture\n     */\n    updateTextureDimensions(texture, width, height, depth = 1) {\n        if (!texture._hardwareTexture) {\n            // the gpu texture is not created yet, so when it is it will be created with the right dimensions\n            return;\n        }\n        if (texture.width === width && texture.height === height && texture.depth === depth) {\n            return;\n        }\n        const additionalUsages = texture._hardwareTexture.textureAdditionalUsages;\n        texture._hardwareTexture.release(); // don't defer the releasing! Else we will release at the end of this frame the gpu texture we are about to create in the next line...\n        this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, depth, additionalUsages);\n    }\n    /**\n     * @internal\n     */\n    _setInternalTexture(name, texture, baseName) {\n        baseName = baseName ?? name;\n        if (this._currentEffect) {\n            const webgpuPipelineContext = this._currentEffect._pipelineContext;\n            const availableTexture = webgpuPipelineContext.shaderProcessingContext.availableTextures[baseName];\n            this._currentMaterialContext.setTexture(name, texture);\n            if (availableTexture && availableTexture.autoBindSampler) {\n                const samplerName = baseName + `Sampler`;\n                this._currentMaterialContext.setSampler(samplerName, texture); // we can safely cast to InternalTexture because ExternalTexture always has autoBindSampler = false\n            }\n        }\n    }\n    /**\n     * Create a cube texture from prefiltered data (ie. the mipmaps contain ready to use data for PBR reflection)\n     * @param rootUrl defines the url where the file to load is located\n     * @param scene defines the current scene\n     * @param lodScale defines scale to apply to the mip map selection\n     * @param lodOffset defines offset to apply to the mip map selection\n     * @param onLoad defines an optional callback raised when the texture is loaded\n     * @param onError defines an optional callback raised if there is an issue to load the texture\n     * @param format defines the format of the data\n     * @param forcedExtension defines the extension to use to pick the right loader\n     * @param createPolynomials defines wheter or not to create polynomails harmonics for the texture\n     * @returns the cube texture as an InternalTexture\n     */\n    createPrefilteredCubeTexture(rootUrl, scene, lodScale, lodOffset, onLoad = null, onError = null, format, forcedExtension = null, createPolynomials = true) {\n        const callback = (loadData) => {\n            if (!loadData) {\n                if (onLoad) {\n                    onLoad(null);\n                }\n                return;\n            }\n            const texture = loadData.texture;\n            if (!createPolynomials) {\n                texture._sphericalPolynomial = new SphericalPolynomial();\n            }\n            else if (loadData.info.sphericalPolynomial) {\n                texture._sphericalPolynomial = loadData.info.sphericalPolynomial;\n            }\n            texture._source = 9 /* InternalTextureSource.CubePrefiltered */;\n            if (onLoad) {\n                onLoad(texture);\n            }\n        };\n        return this.createCubeTexture(rootUrl, scene, null, false, callback, onError, format, forcedExtension, createPolynomials, lodScale, lodOffset);\n    }\n    /**\n     * Sets a texture to the according uniform.\n     * @param channel The texture channel\n     * @param unused unused parameter\n     * @param texture The texture to apply\n     * @param name The name of the uniform in the effect\n     */\n    setTexture(channel, unused, texture, name) {\n        this._setTexture(channel, texture, false, false, name, name);\n    }\n    /**\n     * Sets an array of texture to the WebGPU context\n     * @param channel defines the channel where the texture array must be set\n     * @param unused unused parameter\n     * @param textures defines the array of textures to bind\n     * @param name name of the channel\n     */\n    setTextureArray(channel, unused, textures, name) {\n        for (let index = 0; index < textures.length; index++) {\n            this._setTexture(-1, textures[index], true, false, name + index.toString(), name);\n        }\n    }\n    /**\n     * @internal\n     */\n    _setTexture(channel, texture, \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    isPartOfTextureArray = false, depthStencilTexture = false, name = \"\", baseName) {\n        // name == baseName for a texture that is not part of a texture array\n        // Else, name is something like 'myTexture0' / 'myTexture1' / ... and baseName is 'myTexture'\n        // baseName is used to look up the texture in the shaderProcessingContext.availableTextures map\n        // name is used to look up the texture in the _currentMaterialContext.textures map\n        baseName = baseName ?? name;\n        if (this._currentEffect) {\n            if (!texture) {\n                this._currentMaterialContext.setTexture(name, null);\n                return false;\n            }\n            // Video\n            if (texture.video) {\n                texture.update();\n            }\n            else if (texture.delayLoadState === 4) {\n                // Delay loading\n                texture.delayLoad();\n                return false;\n            }\n            let internalTexture = null;\n            if (depthStencilTexture) {\n                internalTexture = texture.depthStencilTexture;\n            }\n            else if (texture.isReady()) {\n                internalTexture = texture.getInternalTexture();\n            }\n            else if (texture.isCube) {\n                internalTexture = this.emptyCubeTexture;\n            }\n            else if (texture.is3D) {\n                internalTexture = this.emptyTexture3D;\n            }\n            else if (texture.is2DArray) {\n                internalTexture = this.emptyTexture2DArray;\n            }\n            else {\n                internalTexture = this.emptyTexture;\n            }\n            if (internalTexture && !internalTexture.isMultiview) {\n                // CUBIC_MODE and SKYBOX_MODE both require CLAMP_TO_EDGE.  All other modes use REPEAT.\n                if (internalTexture.isCube && internalTexture._cachedCoordinatesMode !== texture.coordinatesMode) {\n                    internalTexture._cachedCoordinatesMode = texture.coordinatesMode;\n                    const textureWrapMode = texture.coordinatesMode !== 3 && texture.coordinatesMode !== 5\n                        ? 1\n                        : 0;\n                    texture.wrapU = textureWrapMode;\n                    texture.wrapV = textureWrapMode;\n                }\n                internalTexture._cachedWrapU = texture.wrapU;\n                internalTexture._cachedWrapV = texture.wrapV;\n                if (internalTexture.is3D) {\n                    internalTexture._cachedWrapR = texture.wrapR;\n                }\n                this._setAnisotropicLevel(0, internalTexture, texture.anisotropicFilteringLevel);\n            }\n            this._setInternalTexture(name, internalTexture, baseName);\n        }\n        else {\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if (this._count === undefined) {\n                    this._count = 0;\n                }\n                if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                    Logger.Log([\"frame #\" + this._count + \" - _setTexture called with a null _currentEffect! texture=\", texture]);\n                }\n            }\n        }\n        return true;\n    }\n    /**\n     * @internal\n     */\n    _setAnisotropicLevel(target, internalTexture, anisotropicFilteringLevel) {\n        if (internalTexture._cachedAnisotropicFilteringLevel !== anisotropicFilteringLevel) {\n            internalTexture._cachedAnisotropicFilteringLevel = Math.min(anisotropicFilteringLevel, this._caps.maxAnisotropy);\n        }\n    }\n    /**\n     * @internal\n     */\n    _bindTexture(channel, texture, name) {\n        if (channel === undefined) {\n            return;\n        }\n        this._setInternalTexture(name, texture);\n    }\n    /**\n     * Generates the mipmaps for a texture\n     * @param texture texture to generate the mipmaps for\n     */\n    generateMipmaps(texture) {\n        this._generateMipmaps(texture);\n    }\n    /**\n     * Update a portion of an internal texture\n     * @param texture defines the texture to update\n     * @param imageData defines the data to store into the texture\n     * @param xOffset defines the x coordinates of the update rectangle\n     * @param yOffset defines the y coordinates of the update rectangle\n     * @param width defines the width of the update rectangle\n     * @param height defines the height of the update rectangle\n     * @param faceIndex defines the face index if texture is a cube (0 by default)\n     * @param lod defines the lod level to update (0 by default)\n     * @param generateMipMaps defines whether to generate mipmaps or not\n     */\n    updateTextureData(texture, imageData, xOffset, yOffset, width, height, faceIndex = 0, lod = 0, generateMipMaps = false) {\n        let gpuTextureWrapper = texture._hardwareTexture;\n        if (!texture._hardwareTexture?.underlyingResource) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture);\n        }\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, xOffset, yOffset);\n        if (generateMipMaps) {\n            this._generateMipmaps(texture);\n        }\n    }\n    /**\n     * @internal\n     */\n    _uploadCompressedDataToTextureDirectly(texture, internalFormat, width, height, imageData, faceIndex = 0, lod = 0) {\n        let gpuTextureWrapper = texture._hardwareTexture;\n        if (!texture._hardwareTexture?.underlyingResource) {\n            texture.format = internalFormat;\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\n        }\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, false, false, 0, 0);\n    }\n    /**\n     * @internal\n     */\n    _uploadDataToTextureDirectly(texture, imageData, faceIndex = 0, lod = 0, babylonInternalFormat, useTextureWidthAndHeight = false) {\n        const lodMaxWidth = Math.round(Math.log(texture.width) * Math.LOG2E);\n        const lodMaxHeight = Math.round(Math.log(texture.height) * Math.LOG2E);\n        const width = useTextureWidthAndHeight ? texture.width : Math.pow(2, Math.max(lodMaxWidth - lod, 0));\n        const height = useTextureWidthAndHeight ? texture.height : Math.pow(2, Math.max(lodMaxHeight - lod, 0));\n        let gpuTextureWrapper = texture._hardwareTexture;\n        if (!texture._hardwareTexture?.underlyingResource) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\n        }\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, 0, 0);\n    }\n    /**\n     * @internal\n     */\n    _uploadArrayBufferViewToTexture(texture, imageData, faceIndex = 0, lod = 0) {\n        this._uploadDataToTextureDirectly(texture, imageData, faceIndex, lod);\n    }\n    /**\n     * @internal\n     */\n    _uploadImageToTexture(texture, image, faceIndex = 0, lod = 0) {\n        let gpuTextureWrapper = texture._hardwareTexture;\n        if (!texture._hardwareTexture?.underlyingResource) {\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture);\n        }\n        if (image instanceof HTMLImageElement) {\n            // eslint-disable-next-line no-throw-literal\n            throw \"WebGPU engine: HTMLImageElement not supported in _uploadImageToTexture!\";\n        }\n        const bitmap = image; // in WebGPU we will always get an ImageBitmap, not an HTMLImageElement\n        const width = Math.ceil(texture.width / (1 << lod));\n        const height = Math.ceil(texture.height / (1 << lod));\n        this._textureHelper.updateTexture(bitmap, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, 0, 0);\n    }\n    /**\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\n     * @param x defines the x coordinate of the rectangle where pixels must be read\n     * @param y defines the y coordinate of the rectangle where pixels must be read\n     * @param width defines the width of the rectangle where pixels must be read\n     * @param height defines the height of the rectangle where pixels must be read\n     * @param hasAlpha defines whether the output should have alpha or not (defaults to true)\n     * @param flushRenderer true to flush the renderer from the pending commands before reading the pixels\n     * @param data defines the data to fill with the read pixels (if not provided, a new one will be created)\n     * @returns a ArrayBufferView promise (Uint8Array) containing RGBA colors\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    readPixels(x, y, width, height, hasAlpha = true, flushRenderer = true, data = null) {\n        const renderPassWrapper = this._getCurrentRenderPassWrapper();\n        const hardwareTexture = renderPassWrapper.colorAttachmentGPUTextures[0];\n        if (!hardwareTexture) {\n            // we are calling readPixels for a render pass with no color texture bound\n            return Promise.resolve(new Uint8Array(0));\n        }\n        const gpuTexture = hardwareTexture.underlyingResource;\n        const gpuTextureFormat = hardwareTexture.format;\n        if (!gpuTexture) {\n            // we are calling readPixels before startMainRenderPass has been called and no RTT is bound, so swapChainTexture is not setup yet!\n            return Promise.resolve(new Uint8Array(0));\n        }\n        if (flushRenderer) {\n            this.flushFramebuffer();\n        }\n        return this._textureHelper.readPixels(gpuTexture, x, y, width, height, gpuTextureFormat, undefined, undefined, data);\n    }\n    //------------------------------------------------------------------------------\n    //                              Frame management\n    //------------------------------------------------------------------------------\n    _measureFps() {\n        this._performanceMonitor.sampleFrame();\n        this._fps = this._performanceMonitor.averageFPS;\n        this._deltaTime = this._performanceMonitor.instantaneousFrameTime || 0;\n    }\n    /**\n     * Gets the performance monitor attached to this engine\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/scene/optimize_your_scene#engineinstrumentation\n     */\n    get performanceMonitor() {\n        return this._performanceMonitor;\n    }\n    /**\n     * Begin a new frame\n     */\n    beginFrame() {\n        this._measureFps();\n        super.beginFrame();\n    }\n    /**\n     * End the current frame\n     */\n    endFrame() {\n        this._endCurrentRenderPass();\n        this._snapshotRendering.endFrame();\n        this._timestampQuery.endFrame(this._renderEncoder);\n        this._timestampIndex = 0;\n        this.flushFramebuffer();\n        this._textureHelper.destroyDeferredTextures();\n        this._bufferManager.destroyDeferredBuffers();\n        if (this._features._collectUbosUpdatedInFrame) {\n            if (this.dbgVerboseLogsForFirstFrames) {\n                if (this._count === undefined) {\n                    this._count = 0;\n                }\n                if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                    const list = [];\n                    for (const name in UniformBuffer._UpdatedUbosInFrame) {\n                        list.push(name + \":\" + UniformBuffer._UpdatedUbosInFrame[name]);\n                    }\n                    Logger.Log([\"frame #\" + this._count + \" - updated ubos -\", list.join(\", \")]);\n                }\n            }\n            UniformBuffer._UpdatedUbosInFrame = {};\n        }\n        this.countersLastFrame.numEnableEffects = this._counters.numEnableEffects;\n        this.countersLastFrame.numEnableDrawWrapper = this._counters.numEnableDrawWrapper;\n        this.countersLastFrame.numBundleCreationNonCompatMode = this._counters.numBundleCreationNonCompatMode;\n        this.countersLastFrame.numBundleReuseNonCompatMode = this._counters.numBundleReuseNonCompatMode;\n        this._counters.numEnableEffects = 0;\n        this._counters.numEnableDrawWrapper = 0;\n        this._counters.numBundleCreationNonCompatMode = 0;\n        this._counters.numBundleReuseNonCompatMode = 0;\n        this._cacheRenderPipeline.endFrame();\n        this._cacheBindGroups.endFrame();\n        this._pendingDebugCommands.length = 0;\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log([\"%c frame #\" + this._count + \" - end\", \"background: #ffff00\"]);\n            }\n            if (this._count < this.dbgVerboseLogsNumFrames) {\n                this._count++;\n                if (this._count !== this.dbgVerboseLogsNumFrames) {\n                    Logger.Log([\"%c frame #\" + this._count + \" - begin\", \"background: #ffff00\"]);\n                }\n            }\n        }\n        super.endFrame();\n    }\n    /**Gets driver info if available */\n    extractDriverInfo() {\n        return \"\";\n    }\n    /**\n     * Force a WebGPU flush (ie. a flush of all waiting commands)\n     */\n    flushFramebuffer() {\n        // we need to end the current render pass (main or rtt) if any as we are not allowed to submit the command buffers when being in a pass\n        this._endCurrentRenderPass();\n        this._commandBuffers[0] = this._uploadEncoder.finish();\n        this._commandBuffers[1] = this._renderEncoder.finish();\n        this._device.queue.submit(this._commandBuffers);\n        this._uploadEncoder = this._device.createCommandEncoder(this._uploadEncoderDescriptor);\n        this._renderEncoder = this._device.createCommandEncoder(this._renderEncoderDescriptor);\n        this._timestampQuery.startFrame(this._uploadEncoder);\n        this._textureHelper.setCommandEncoder(this._uploadEncoder);\n        this._bundleList.reset();\n    }\n    /** @internal */\n    _currentFrameBufferIsDefaultFrameBuffer() {\n        return this._currentPassIsMainPass();\n    }\n    //------------------------------------------------------------------------------\n    //                              Render Pass\n    //------------------------------------------------------------------------------\n    _startRenderTargetRenderPass(renderTargetWrapper, setClearStates, clearColor, clearDepth, clearStencil) {\n        this._endCurrentRenderPass();\n        const rtWrapper = renderTargetWrapper;\n        const depthStencilTexture = rtWrapper._depthStencilTexture;\n        const gpuDepthStencilWrapper = depthStencilTexture?._hardwareTexture;\n        const gpuDepthStencilTexture = gpuDepthStencilWrapper?.underlyingResource;\n        const gpuDepthStencilMSAATexture = gpuDepthStencilWrapper?.getMSAATexture(0);\n        const depthTextureView = gpuDepthStencilTexture?.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor);\n        const depthMSAATextureView = gpuDepthStencilMSAATexture?.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor);\n        const depthTextureHasStencil = gpuDepthStencilWrapper ? WebGPUTextureHelper.HasStencilAspect(gpuDepthStencilWrapper.format) : false;\n        const colorAttachments = [];\n        if (this.useReverseDepthBuffer) {\n            this.setDepthFunctionToGreaterOrEqual();\n        }\n        const clearColorForIntegerRT = tempColor4;\n        if (clearColor) {\n            clearColorForIntegerRT.r = clearColor.r * 255;\n            clearColorForIntegerRT.g = clearColor.g * 255;\n            clearColorForIntegerRT.b = clearColor.b * 255;\n            clearColorForIntegerRT.a = clearColor.a * 255;\n        }\n        const mustClearColor = setClearStates && clearColor;\n        const mustClearDepth = setClearStates && clearDepth;\n        const mustClearStencil = setClearStates && clearStencil;\n        if (rtWrapper._attachments && rtWrapper.isMulti) {\n            // multi render targets\n            if (!this._mrtAttachments || this._mrtAttachments.length === 0) {\n                this._mrtAttachments = rtWrapper._defaultAttachments;\n            }\n            for (let i = 0; i < this._mrtAttachments.length; ++i) {\n                const index = this._mrtAttachments[i]; // if index == 0 it means the texture should not be written to => at render pass creation time, it means we should not clear it\n                const mrtTexture = rtWrapper.textures[i];\n                const gpuMRTWrapper = mrtTexture?._hardwareTexture;\n                const gpuMRTTexture = gpuMRTWrapper?.underlyingResource;\n                if (gpuMRTWrapper && gpuMRTTexture) {\n                    const baseArrayLayer = rtWrapper.getBaseArrayLayer(i);\n                    const gpuMSAATexture = gpuMRTWrapper.getMSAATexture(baseArrayLayer);\n                    const viewDescriptor = {\n                        ...this._rttRenderPassWrapper.colorAttachmentViewDescriptor,\n                        dimension: mrtTexture.is3D ? \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */ : \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n                        format: gpuMRTWrapper.format,\n                        baseArrayLayer,\n                    };\n                    const msaaViewDescriptor = {\n                        ...this._rttRenderPassWrapper.colorAttachmentViewDescriptor,\n                        dimension: mrtTexture.is3D ? \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */ : \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n                        format: gpuMRTWrapper.format,\n                        baseArrayLayer: 0,\n                    };\n                    const isRTInteger = mrtTexture.type === 7 || mrtTexture.type === 5;\n                    const colorTextureView = gpuMRTTexture.createView(viewDescriptor);\n                    const colorMSAATextureView = gpuMSAATexture?.createView(msaaViewDescriptor);\n                    colorAttachments.push({\n                        view: colorMSAATextureView ? colorMSAATextureView : colorTextureView,\n                        resolveTarget: gpuMSAATexture ? colorTextureView : undefined,\n                        depthSlice: mrtTexture.is3D ? (rtWrapper.layerIndices?.[i] ?? 0) : undefined,\n                        clearValue: index !== 0 && mustClearColor ? (isRTInteger ? clearColorForIntegerRT : clearColor) : undefined,\n                        loadOp: index !== 0 && mustClearColor ? \"clear\" /* WebGPUConstants.LoadOp.Clear */ : \"load\" /* WebGPUConstants.LoadOp.Load */,\n                        storeOp: \"store\" /* WebGPUConstants.StoreOp.Store */,\n                    });\n                }\n            }\n            this._cacheRenderPipeline.setMRT(rtWrapper.textures, this._mrtAttachments.length);\n            this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments);\n        }\n        else {\n            // single render target\n            const internalTexture = rtWrapper.texture;\n            if (internalTexture) {\n                const gpuWrapper = internalTexture._hardwareTexture;\n                const gpuTexture = gpuWrapper.underlyingResource;\n                let depthSlice = undefined;\n                if (rtWrapper.is3D) {\n                    depthSlice = this._rttRenderPassWrapper.colorAttachmentViewDescriptor.baseArrayLayer;\n                    this._rttRenderPassWrapper.colorAttachmentViewDescriptor.baseArrayLayer = 0;\n                }\n                const gpuMSAATexture = gpuWrapper.getMSAATexture(0);\n                const colorTextureView = gpuTexture.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor);\n                const colorMSAATextureView = gpuMSAATexture?.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor);\n                const isRTInteger = internalTexture.type === 7 || internalTexture.type === 5;\n                colorAttachments.push({\n                    view: colorMSAATextureView ? colorMSAATextureView : colorTextureView,\n                    resolveTarget: gpuMSAATexture ? colorTextureView : undefined,\n                    depthSlice,\n                    clearValue: mustClearColor ? (isRTInteger ? clearColorForIntegerRT : clearColor) : undefined,\n                    loadOp: mustClearColor ? \"clear\" /* WebGPUConstants.LoadOp.Clear */ : \"load\" /* WebGPUConstants.LoadOp.Load */,\n                    storeOp: \"store\" /* WebGPUConstants.StoreOp.Store */,\n                });\n            }\n            else {\n                colorAttachments.push(null);\n            }\n        }\n        this._debugPushGroup?.(\"render target pass\" + (renderTargetWrapper.label ? \" (\" + renderTargetWrapper.label + \")\" : \"\"), 0);\n        this._rttRenderPassWrapper.renderPassDescriptor = {\n            label: (renderTargetWrapper.label ?? \"RTT\") + \" - RenderPass\",\n            colorAttachments,\n            depthStencilAttachment: depthStencilTexture && gpuDepthStencilTexture\n                ? {\n                    view: depthMSAATextureView ? depthMSAATextureView : depthTextureView,\n                    depthClearValue: mustClearDepth ? (this.useReverseDepthBuffer ? this._clearReverseDepthValue : this._clearDepthValue) : undefined,\n                    depthLoadOp: mustClearDepth ? \"clear\" /* WebGPUConstants.LoadOp.Clear */ : \"load\" /* WebGPUConstants.LoadOp.Load */,\n                    depthStoreOp: \"store\" /* WebGPUConstants.StoreOp.Store */,\n                    stencilClearValue: rtWrapper._depthStencilTextureWithStencil && mustClearStencil ? this._clearStencilValue : undefined,\n                    stencilLoadOp: !depthTextureHasStencil\n                        ? undefined\n                        : rtWrapper._depthStencilTextureWithStencil && mustClearStencil\n                            ? \"clear\" /* WebGPUConstants.LoadOp.Clear */\n                            : \"load\" /* WebGPUConstants.LoadOp.Load */,\n                    stencilStoreOp: !depthTextureHasStencil ? undefined : \"store\" /* WebGPUConstants.StoreOp.Store */,\n                }\n                : undefined,\n            occlusionQuerySet: this._occlusionQuery?.hasQueries ? this._occlusionQuery.querySet : undefined,\n        };\n        this._timestampQuery.startPass(this._rttRenderPassWrapper.renderPassDescriptor, this._timestampIndex);\n        this._currentRenderPass = this._renderEncoder.beginRenderPass(this._rttRenderPassWrapper.renderPassDescriptor);\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                const internalTexture = rtWrapper.texture;\n                Logger.Log([\n                    \"frame #\" +\n                        this._count +\n                        \" - render target begin pass - rtt name=\" +\n                        renderTargetWrapper.label +\n                        \", internalTexture.uniqueId=\" +\n                        internalTexture.uniqueId +\n                        \", width=\" +\n                        internalTexture.width +\n                        \", height=\" +\n                        internalTexture.height +\n                        \", setClearStates=\" +\n                        setClearStates,\n                    \"renderPassDescriptor=\",\n                    this._rttRenderPassWrapper.renderPassDescriptor,\n                ]);\n            }\n        }\n        this._debugFlushPendingCommands?.();\n        this._resetRenderPassStates();\n        if (!gpuDepthStencilWrapper || !WebGPUTextureHelper.HasStencilAspect(gpuDepthStencilWrapper.format)) {\n            this._stencilStateComposer.enabled = false;\n        }\n    }\n    _startMainRenderPass(setClearStates, clearColor, clearDepth, clearStencil) {\n        this._endCurrentRenderPass();\n        if (this.useReverseDepthBuffer) {\n            this.setDepthFunctionToGreaterOrEqual();\n        }\n        const mustClearColor = setClearStates && clearColor;\n        const mustClearDepth = setClearStates && clearDepth;\n        const mustClearStencil = setClearStates && clearStencil;\n        this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].clearValue = mustClearColor ? clearColor : undefined;\n        this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].loadOp = mustClearColor ? \"clear\" /* WebGPUConstants.LoadOp.Clear */ : \"load\" /* WebGPUConstants.LoadOp.Load */;\n        this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthClearValue = mustClearDepth\n            ? this.useReverseDepthBuffer\n                ? this._clearReverseDepthValue\n                : this._clearDepthValue\n            : undefined;\n        this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthLoadOp = mustClearDepth ? \"clear\" /* WebGPUConstants.LoadOp.Clear */ : \"load\" /* WebGPUConstants.LoadOp.Load */;\n        this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilClearValue = mustClearStencil ? this._clearStencilValue : undefined;\n        this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilLoadOp = !this.isStencilEnable\n            ? undefined\n            : mustClearStencil\n                ? \"clear\" /* WebGPUConstants.LoadOp.Clear */\n                : \"load\" /* WebGPUConstants.LoadOp.Load */;\n        this._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet = this._occlusionQuery?.hasQueries ? this._occlusionQuery.querySet : undefined;\n        const swapChainTexture = this._context.getCurrentTexture();\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].set(swapChainTexture);\n        // Resolve in case of MSAA\n        if (this._options.antialias) {\n            viewDescriptorSwapChainAntialiasing.format = swapChainTexture.format;\n            this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].resolveTarget = swapChainTexture.createView(viewDescriptorSwapChainAntialiasing);\n        }\n        else {\n            viewDescriptorSwapChain.format = swapChainTexture.format;\n            this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].view = swapChainTexture.createView(viewDescriptorSwapChain);\n        }\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log([\n                    \"frame #\" + this._count + \" - main begin pass - texture width=\" + this._mainTextureExtends.width,\n                    \" height=\" + this._mainTextureExtends.height + \", setClearStates=\" + setClearStates,\n                    \"renderPassDescriptor=\",\n                    this._mainRenderPassWrapper.renderPassDescriptor,\n                ]);\n            }\n        }\n        this._debugPushGroup?.(\"main pass\", 0);\n        this._timestampQuery.startPass(this._mainRenderPassWrapper.renderPassDescriptor, this._timestampIndex);\n        this._currentRenderPass = this._renderEncoder.beginRenderPass(this._mainRenderPassWrapper.renderPassDescriptor);\n        this._setDepthTextureFormat(this._mainRenderPassWrapper);\n        this._setColorFormat(this._mainRenderPassWrapper);\n        this._debugFlushPendingCommands?.();\n        this._resetRenderPassStates();\n        if (!this._isStencilEnable) {\n            this._stencilStateComposer.enabled = false;\n        }\n    }\n    /**\n     * Binds the frame buffer to the specified texture.\n     * @param texture The render target wrapper to render to\n     * @param faceIndex The face of the texture to render to in case of cube texture\n     * @param requiredWidth The width of the target to render to\n     * @param requiredHeight The height of the target to render to\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\n     * @param lodLevel defines the lod level to bind to the frame buffer\n     * @param layer defines the 2d array index to bind to frame buffer to\n     */\n    bindFramebuffer(texture, faceIndex = 0, requiredWidth, requiredHeight, forceFullscreenViewport, lodLevel = 0, layer = 0) {\n        const hardwareTexture = texture.texture?._hardwareTexture;\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        }\n        else {\n            this._endCurrentRenderPass();\n        }\n        this._currentRenderTarget = texture;\n        const depthStencilTexture = this._currentRenderTarget._depthStencilTexture;\n        this._rttRenderPassWrapper.colorAttachmentGPUTextures[0] = hardwareTexture;\n        this._rttRenderPassWrapper.depthTextureFormat = depthStencilTexture ? WebGPUTextureHelper.GetWebGPUTextureFormat(-1, depthStencilTexture.format) : undefined;\n        this._setDepthTextureFormat(this._rttRenderPassWrapper);\n        this._setColorFormat(this._rttRenderPassWrapper);\n        this._rttRenderPassWrapper.colorAttachmentViewDescriptor = {\n            format: this._colorFormat,\n            dimension: texture.is3D ? \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */ : \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n            mipLevelCount: 1,\n            baseArrayLayer: texture.isCube ? layer * 6 + faceIndex : layer,\n            baseMipLevel: lodLevel,\n            arrayLayerCount: 1,\n            aspect: \"all\" /* WebGPUConstants.TextureAspect.All */,\n        };\n        this._rttRenderPassWrapper.depthAttachmentViewDescriptor = {\n            format: this._depthTextureFormat,\n            dimension: depthStencilTexture && depthStencilTexture.is3D ? \"3d\" /* WebGPUConstants.TextureViewDimension.E3d */ : \"2d\" /* WebGPUConstants.TextureViewDimension.E2d */,\n            mipLevelCount: 1,\n            baseArrayLayer: depthStencilTexture ? (depthStencilTexture.isCube ? layer * 6 + faceIndex : layer) : 0,\n            baseMipLevel: 0,\n            arrayLayerCount: 1,\n            aspect: \"all\" /* WebGPUConstants.TextureAspect.All */,\n        };\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log([\n                    \"frame #\" +\n                        this._count +\n                        \" - bindFramebuffer - rtt name=\" +\n                        texture.label +\n                        \", internalTexture.uniqueId=\" +\n                        texture.texture?.uniqueId +\n                        \", face=\" +\n                        faceIndex +\n                        \", lodLevel=\" +\n                        lodLevel +\n                        \", layer=\" +\n                        layer,\n                    \"colorAttachmentViewDescriptor=\",\n                    this._rttRenderPassWrapper.colorAttachmentViewDescriptor,\n                    \"depthAttachmentViewDescriptor=\",\n                    this._rttRenderPassWrapper.depthAttachmentViewDescriptor,\n                ]);\n            }\n        }\n        // We don't create the render pass just now, we do a lazy creation of the render pass, hoping the render pass will be created by a call to clear()...\n        if (this._cachedViewport && !forceFullscreenViewport) {\n            this.setViewport(this._cachedViewport, requiredWidth, requiredHeight);\n        }\n        else {\n            if (!requiredWidth) {\n                requiredWidth = texture.width;\n                if (lodLevel) {\n                    requiredWidth = requiredWidth / Math.pow(2, lodLevel);\n                }\n            }\n            if (!requiredHeight) {\n                requiredHeight = texture.height;\n                if (lodLevel) {\n                    requiredHeight = requiredHeight / Math.pow(2, lodLevel);\n                }\n            }\n            this._viewport(0, 0, requiredWidth, requiredHeight);\n        }\n        this.wipeCaches();\n    }\n    /**\n     * Unbind the current render target texture from the WebGPU context\n     * @param texture defines the render target wrapper to unbind\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\n     */\n    unBindFramebuffer(texture, disableGenerateMipMaps = false, onBeforeUnbind) {\n        const saveCRT = this._currentRenderTarget;\n        this._currentRenderTarget = null; // to be iso with abstractEngine, this._currentRenderTarget must be null when onBeforeUnbind is called\n        if (onBeforeUnbind) {\n            onBeforeUnbind();\n        }\n        this._currentRenderTarget = saveCRT;\n        this._endCurrentRenderPass();\n        if (!disableGenerateMipMaps) {\n            if (texture.isMulti) {\n                this.generateMipMapsMultiFramebuffer(texture);\n            }\n            else {\n                this.generateMipMapsFramebuffer(texture);\n            }\n        }\n        this._currentRenderTarget = null;\n        if (this.dbgVerboseLogsForFirstFrames) {\n            if (this._count === undefined) {\n                this._count = 0;\n            }\n            if (!this._count || this._count < this.dbgVerboseLogsNumFrames) {\n                Logger.Log(\"frame #\" + this._count + \" - unBindFramebuffer - rtt name=\" + texture.label + \", internalTexture.uniqueId=\", texture.texture?.uniqueId);\n            }\n        }\n        this._mrtAttachments = [];\n        this._cacheRenderPipeline.setMRT([]);\n        this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments);\n    }\n    /**\n     * Generates mipmaps for the texture of the (single) render target\n     * @param texture The render target containing the texture to generate the mipmaps for\n     */\n    generateMipMapsFramebuffer(texture) {\n        if (!texture.isMulti && texture.texture?.generateMipMaps && !texture.isCube) {\n            this._generateMipmaps(texture.texture);\n        }\n    }\n    /**\n     * Resolves the MSAA texture of the (single) render target into its non-MSAA version.\n     * Note that if \"texture\" is not a MSAA render target, no resolve is performed.\n     * @param _texture The render target texture containing the MSAA texture to resolve\n     */\n    resolveFramebuffer(_texture) {\n        throw new Error(\"resolveFramebuffer is not yet implemented in WebGPU!\");\n    }\n    /**\n     * Unbind the current render target and bind the default framebuffer\n     */\n    restoreDefaultFramebuffer() {\n        if (this._currentRenderTarget) {\n            this.unBindFramebuffer(this._currentRenderTarget);\n        }\n        else if (!this._currentRenderPass) {\n            this._startMainRenderPass(false);\n        }\n        if (this._cachedViewport) {\n            this.setViewport(this._cachedViewport);\n        }\n        this.wipeCaches();\n    }\n    //------------------------------------------------------------------------------\n    //                              Render\n    //------------------------------------------------------------------------------\n    /**\n     * @internal\n     */\n    _setColorFormat(wrapper) {\n        const format = wrapper.colorAttachmentGPUTextures[0]?.format ?? null;\n        this._cacheRenderPipeline.setColorFormat(format);\n        if (this._colorFormat === format) {\n            return;\n        }\n        this._colorFormat = format;\n    }\n    /**\n     * @internal\n     */\n    _setDepthTextureFormat(wrapper) {\n        this._cacheRenderPipeline.setDepthStencilFormat(wrapper.depthTextureFormat);\n        if (this._depthTextureFormat === wrapper.depthTextureFormat) {\n            return;\n        }\n        this._depthTextureFormat = wrapper.depthTextureFormat;\n    }\n    setDitheringState() {\n        // Does not exist in WebGPU\n    }\n    setRasterizerState() {\n        // Does not exist in WebGPU\n    }\n    /**\n     * @internal\n     */\n    _executeWhenRenderingStateIsCompiled(pipelineContext, action) {\n        // No parallel shader compilation.\n        // No Async, so direct launch\n        action();\n    }\n    /**\n     * @internal\n     */\n    bindSamplers() { }\n    /** @internal */\n    _getUnpackAlignement() {\n        return 1;\n    }\n    /**\n     * @internal\n     */\n    _bindTextureDirectly() {\n        return false;\n    }\n    setStateCullFaceType(cullBackFaces, force = false) {\n        const cullFace = (this.cullBackFaces ?? cullBackFaces ?? true) ? 1 : 2;\n        if (this._depthCullingState.cullFace !== cullFace || force) {\n            this._depthCullingState.cullFace = cullFace;\n        }\n    }\n    /**\n     * Set various states to the webGL context\n     * @param culling defines culling state: true to enable culling, false to disable it\n     * @param zOffset defines the value to apply to zOffset (0 by default)\n     * @param force defines if states must be applied even if cache is up to date\n     * @param reverseSide defines if culling must be reversed (CCW if false, CW if true)\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\n     * @param stencil stencil states to set\n     * @param zOffsetUnits defines the value to apply to zOffsetUnits (0 by default)\n     */\n    setState(culling, zOffset = 0, force, reverseSide = false, cullBackFaces, stencil, zOffsetUnits = 0) {\n        // Culling\n        if (this._depthCullingState.cull !== culling || force) {\n            this._depthCullingState.cull = culling;\n        }\n        // Cull face\n        this.setStateCullFaceType(cullBackFaces, force);\n        // Z offset\n        this.setZOffset(zOffset);\n        this.setZOffsetUnits(zOffsetUnits);\n        // Front face\n        const frontFace = reverseSide ? (this._currentRenderTarget ? 1 : 2) : this._currentRenderTarget ? 2 : 1;\n        if (this._depthCullingState.frontFace !== frontFace || force) {\n            this._depthCullingState.frontFace = frontFace;\n        }\n        this._stencilStateComposer.stencilMaterial = stencil;\n    }\n    _applyRenderPassChanges(bundleList) {\n        const mustUpdateStencilRef = !this._stencilStateComposer.enabled ? false : this._mustUpdateStencilRef();\n        const mustUpdateBlendColor = !this._alphaState.alphaBlend ? false : this._mustUpdateBlendColor();\n        if (this._mustUpdateViewport()) {\n            this._applyViewport(bundleList);\n        }\n        if (this._mustUpdateScissor()) {\n            this._applyScissor(bundleList);\n        }\n        if (mustUpdateStencilRef) {\n            this._applyStencilRef(bundleList);\n        }\n        if (mustUpdateBlendColor) {\n            this._applyBlendColor(bundleList);\n        }\n    }\n    _draw(drawType, fillMode, start, count, instancesCount) {\n        const renderPass = this._getCurrentRenderPass();\n        const bundleList = this._bundleList;\n        this.applyStates();\n        const webgpuPipelineContext = this._currentEffect._pipelineContext;\n        this.bindUniformBufferBase(this._currentRenderTarget ? this._ubInvertY : this._ubDontInvertY, 0, WebGPUShaderProcessor.InternalsUBOName);\n        if (webgpuPipelineContext.uniformBuffer) {\n            webgpuPipelineContext.uniformBuffer.update();\n            this.bindUniformBufferBase(webgpuPipelineContext.uniformBuffer.getBuffer(), 0, WebGPUShaderProcessor.LeftOvertUBOName);\n        }\n        if (this._snapshotRendering.play) {\n            this._reportDrawCall();\n            return;\n        }\n        if (!this.compatibilityMode &&\n            (this._currentDrawContext.isDirty(this._currentMaterialContext.updateId) || this._currentMaterialContext.isDirty || this._currentMaterialContext.forceBindGroupCreation)) {\n            this._currentDrawContext.fastBundle = undefined;\n        }\n        const useFastPath = !this.compatibilityMode && this._currentDrawContext.fastBundle;\n        let renderPass2 = renderPass;\n        if (useFastPath || this._snapshotRendering.record) {\n            this._applyRenderPassChanges(bundleList);\n            if (!this._snapshotRendering.record) {\n                this._counters.numBundleReuseNonCompatMode++;\n                if (this._currentDrawContext.indirectDrawBuffer) {\n                    this._currentDrawContext.setIndirectData(count, instancesCount || 1, start);\n                }\n                bundleList.addBundle(this._currentDrawContext.fastBundle);\n                this._reportDrawCall();\n                return;\n            }\n            renderPass2 = bundleList.getBundleEncoder(this._cacheRenderPipeline.colorFormats, this._depthTextureFormat, this.currentSampleCount); // for snapshot recording mode\n            bundleList.numDrawCalls++;\n        }\n        let textureState = 0;\n        if (this._currentMaterialContext.hasFloatOrDepthTextures) {\n            let bitVal = 1;\n            for (let i = 0; i < webgpuPipelineContext.shaderProcessingContext.textureNames.length; ++i) {\n                const textureName = webgpuPipelineContext.shaderProcessingContext.textureNames[i];\n                const texture = this._currentMaterialContext.textures[textureName]?.texture;\n                const textureIsDepth = texture && texture.format >= 13 && texture.format <= 18;\n                if ((texture?.type === 1 && !this._caps.textureFloatLinearFiltering) || textureIsDepth) {\n                    textureState |= bitVal;\n                }\n                bitVal = bitVal << 1;\n            }\n        }\n        this._currentMaterialContext.textureState = textureState;\n        const pipeline = this._cacheRenderPipeline.getRenderPipeline(fillMode, this._currentEffect, this.currentSampleCount, textureState);\n        const bindGroups = this._cacheBindGroups.getBindGroups(webgpuPipelineContext, this._currentDrawContext, this._currentMaterialContext);\n        if (!this._snapshotRendering.record) {\n            this._applyRenderPassChanges(!this.compatibilityMode ? bundleList : null);\n            if (!this.compatibilityMode) {\n                this._counters.numBundleCreationNonCompatMode++;\n                renderPass2 = this._device.createRenderBundleEncoder({\n                    colorFormats: this._cacheRenderPipeline.colorFormats,\n                    depthStencilFormat: this._depthTextureFormat,\n                    sampleCount: WebGPUTextureHelper.GetSample(this.currentSampleCount),\n                });\n            }\n        }\n        // bind pipeline\n        renderPass2.setPipeline(pipeline);\n        // bind index/vertex buffers\n        if (this._currentIndexBuffer) {\n            renderPass2.setIndexBuffer(this._currentIndexBuffer.underlyingResource, this._currentIndexBuffer.is32Bits ? \"uint32\" /* WebGPUConstants.IndexFormat.Uint32 */ : \"uint16\" /* WebGPUConstants.IndexFormat.Uint16 */, 0);\n        }\n        const vertexBuffers = this._cacheRenderPipeline.vertexBuffers;\n        for (let index = 0; index < vertexBuffers.length; index++) {\n            const vertexBuffer = vertexBuffers[index];\n            const buffer = vertexBuffer.effectiveBuffer;\n            if (buffer) {\n                renderPass2.setVertexBuffer(index, buffer.underlyingResource, vertexBuffer._validOffsetRange ? 0 : vertexBuffer.byteOffset);\n            }\n        }\n        // bind bind groups\n        for (let i = 0; i < bindGroups.length; i++) {\n            renderPass2.setBindGroup(i, bindGroups[i]);\n        }\n        // draw\n        const nonCompatMode = !this.compatibilityMode && !this._snapshotRendering.record;\n        if (nonCompatMode && this._currentDrawContext.indirectDrawBuffer) {\n            this._currentDrawContext.setIndirectData(count, instancesCount || 1, start);\n            if (drawType === 0) {\n                renderPass2.drawIndexedIndirect(this._currentDrawContext.indirectDrawBuffer, 0);\n            }\n            else {\n                renderPass2.drawIndirect(this._currentDrawContext.indirectDrawBuffer, 0);\n            }\n        }\n        else if (drawType === 0) {\n            renderPass2.drawIndexed(count, instancesCount || 1, start, 0, 0);\n        }\n        else {\n            renderPass2.draw(count, instancesCount || 1, start, 0);\n        }\n        if (nonCompatMode) {\n            this._currentDrawContext.fastBundle = renderPass2.finish();\n            bundleList.addBundle(this._currentDrawContext.fastBundle);\n        }\n        this._reportDrawCall();\n    }\n    /**\n     * Draw a list of indexed primitives\n     * @param fillMode defines the primitive to use\n     * @param indexStart defines the starting index\n     * @param indexCount defines the number of index to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawElementsType(fillMode, indexStart, indexCount, instancesCount = 1) {\n        this._draw(0, fillMode, indexStart, indexCount, instancesCount);\n    }\n    /**\n     * Draw a list of unindexed primitives\n     * @param fillMode defines the primitive to use\n     * @param verticesStart defines the index of first vertex to draw\n     * @param verticesCount defines the count of vertices to draw\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\n     */\n    drawArraysType(fillMode, verticesStart, verticesCount, instancesCount = 1) {\n        this._currentIndexBuffer = null;\n        this._draw(1, fillMode, verticesStart, verticesCount, instancesCount);\n    }\n    //------------------------------------------------------------------------------\n    //                              Dispose\n    //------------------------------------------------------------------------------\n    /**\n     * Dispose and release all associated resources\n     */\n    dispose() {\n        this._isDisposed = true;\n        this.hideLoadingUI();\n        this._timestampQuery.dispose();\n        this._mainTexture?.destroy();\n        this._depthTexture?.destroy();\n        this._textureHelper.destroyDeferredTextures();\n        this._bufferManager.destroyDeferredBuffers();\n        this._device.destroy();\n        _CommonDispose(this, this._renderingCanvas);\n        super.dispose();\n    }\n    //------------------------------------------------------------------------------\n    //                              Misc\n    //------------------------------------------------------------------------------\n    /**\n     * Gets the current render width\n     * @param useScreen defines if screen size must be used (or the current render target if any)\n     * @returns a number defining the current render width\n     */\n    getRenderWidth(useScreen = false) {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.width;\n        }\n        return this._renderingCanvas?.width ?? 0;\n    }\n    /**\n     * Gets the current render height\n     * @param useScreen defines if screen size must be used (or the current render target if any)\n     * @returns a number defining the current render height\n     */\n    getRenderHeight(useScreen = false) {\n        if (!useScreen && this._currentRenderTarget) {\n            return this._currentRenderTarget.height;\n        }\n        return this._renderingCanvas?.height ?? 0;\n    }\n    //------------------------------------------------------------------------------\n    //                              Errors\n    //------------------------------------------------------------------------------\n    /**\n     * Get the current error code of the WebGPU context\n     * @returns the error code\n     */\n    getError() {\n        // TODO WEBGPU. from the webgpu errors.\n        return 0;\n    }\n    //------------------------------------------------------------------------------\n    //                              External Textures\n    //------------------------------------------------------------------------------\n    /**\n     * Creates an external texture\n     * @param video video element\n     * @returns the external texture, or null if external textures are not supported by the engine\n     */\n    createExternalTexture(video) {\n        const texture = new WebGPUExternalTexture(video);\n        return texture;\n    }\n    /**\n     * Sets an internal texture to the according uniform.\n     * @param name The name of the uniform in the effect\n     * @param texture The texture to apply\n     */\n    setExternalTexture(name, texture) {\n        if (!texture) {\n            this._currentMaterialContext.setTexture(name, null);\n            return;\n        }\n        this._setInternalTexture(name, texture);\n    }\n    //------------------------------------------------------------------------------\n    //                              Samplers\n    //------------------------------------------------------------------------------\n    /**\n     * Sets a texture sampler to the according uniform.\n     * @param name The name of the uniform in the effect\n     * @param sampler The sampler to apply\n     */\n    setTextureSampler(name, sampler) {\n        this._currentMaterialContext?.setSampler(name, sampler);\n    }\n    //------------------------------------------------------------------------------\n    //                              Storage Buffers\n    //------------------------------------------------------------------------------\n    /**\n     * Creates a storage buffer\n     * @param data the data for the storage buffer or the size of the buffer\n     * @param creationFlags flags to use when creating the buffer (see undefined). The BUFFER_CREATIONFLAG_STORAGE flag will be automatically added\n     * @param label defines the label of the buffer (for debug purpose)\n     * @returns the new buffer\n     */\n    createStorageBuffer(data, creationFlags, label) {\n        return this._createBuffer(data, creationFlags | 32, label);\n    }\n    /**\n     * Updates a storage buffer\n     * @param buffer the storage buffer to update\n     * @param data the data used to update the storage buffer\n     * @param byteOffset the byte offset of the data\n     * @param byteLength the byte length of the data\n     */\n    updateStorageBuffer(buffer, data, byteOffset, byteLength) {\n        const dataBuffer = buffer;\n        if (byteOffset === undefined) {\n            byteOffset = 0;\n        }\n        let view;\n        if (byteLength === undefined) {\n            if (data instanceof Array) {\n                view = new Float32Array(data);\n            }\n            else if (data instanceof ArrayBuffer) {\n                view = new Uint8Array(data);\n            }\n            else {\n                view = data;\n            }\n            byteLength = view.byteLength;\n        }\n        else {\n            if (data instanceof Array) {\n                view = new Float32Array(data);\n            }\n            else if (data instanceof ArrayBuffer) {\n                view = new Uint8Array(data);\n            }\n            else {\n                view = data;\n            }\n        }\n        this._bufferManager.setSubData(dataBuffer, byteOffset, view, 0, byteLength);\n    }\n    _readFromGPUBuffer(gpuBuffer, size, buffer, noDelay) {\n        return new Promise((resolve, reject) => {\n            const readFromBuffer = () => {\n                gpuBuffer.mapAsync(1 /* WebGPUConstants.MapMode.Read */, 0, size).then(() => {\n                    const copyArrayBuffer = gpuBuffer.getMappedRange(0, size);\n                    let data = buffer;\n                    if (data === undefined) {\n                        data = new Uint8Array(size);\n                        data.set(new Uint8Array(copyArrayBuffer));\n                    }\n                    else {\n                        const ctor = data.constructor; // we want to create result data with the same type as buffer (Uint8Array, Float32Array, ...)\n                        data = new ctor(data.buffer);\n                        data.set(new ctor(copyArrayBuffer));\n                    }\n                    gpuBuffer.unmap();\n                    this._bufferManager.releaseBuffer(gpuBuffer);\n                    resolve(data);\n                }, (reason) => {\n                    if (this.isDisposed) {\n                        resolve(new Uint8Array());\n                    }\n                    else {\n                        reject(reason);\n                    }\n                });\n            };\n            if (noDelay) {\n                this.flushFramebuffer();\n                readFromBuffer();\n            }\n            else {\n                // we are using onEndFrameObservable because we need to map the gpuBuffer AFTER the command buffers\n                // have been submitted, else we get the error: \"Buffer used in a submit while mapped\"\n                this.onEndFrameObservable.addOnce(() => {\n                    readFromBuffer();\n                });\n            }\n        });\n    }\n    /**\n     * Read data from a storage buffer\n     * @param storageBuffer The storage buffer to read from\n     * @param offset The offset in the storage buffer to start reading from (default: 0)\n     * @param size  The number of bytes to read from the storage buffer (default: capacity of the buffer)\n     * @param buffer The buffer to write the data we have read from the storage buffer to (optional)\n     * @param noDelay If true, a call to flushFramebuffer will be issued so that the data can be read back immediately and not in engine.onEndFrameObservable. This can speed up data retrieval, at the cost of a small perf penalty (default: false).\n     * @returns If not undefined, returns the (promise) buffer (as provided by the 4th parameter) filled with the data, else it returns a (promise) Uint8Array with the data read from the storage buffer\n     */\n    readFromStorageBuffer(storageBuffer, offset, size, buffer, noDelay) {\n        size = size || storageBuffer.capacity;\n        const gpuBuffer = this._bufferManager.createRawBuffer(size, WebGPUConstants.BufferUsage.MapRead | WebGPUConstants.BufferUsage.CopyDst, undefined, \"TempReadFromStorageBuffer\");\n        this._renderEncoder.copyBufferToBuffer(storageBuffer.underlyingResource, offset ?? 0, gpuBuffer, 0, size);\n        return this._readFromGPUBuffer(gpuBuffer, size, buffer, noDelay);\n    }\n    /**\n     * Read data from multiple storage buffers\n     * @param storageBuffers The list of storage buffers to read from\n     * @param offset The offset in the storage buffer to start reading from (default: 0). This is the same offset for all storage buffers!\n     * @param size  The number of bytes to read from each storage buffer (default: capacity of the first buffer)\n     * @param buffer The buffer to write the data we have read from the storage buffers to (optional). If provided, the buffer should be large enough to hold the data from all storage buffers!\n     * @param noDelay If true, a call to flushFramebuffer will be issued so that the data can be read back immediately and not in engine.onEndFrameObservable. This can speed up data retrieval, at the cost of a small perf penalty (default: false).\n     * @returns If not undefined, returns the (promise) buffer (as provided by the 4th parameter) filled with the data, else it returns a (promise) Uint8Array with the data read from the storage buffer\n     */\n    readFromMultipleStorageBuffers(storageBuffers, offset, size, buffer, noDelay) {\n        size = size || storageBuffers[0].capacity;\n        const gpuBuffer = this._bufferManager.createRawBuffer(size * storageBuffers.length, WebGPUConstants.BufferUsage.MapRead | WebGPUConstants.BufferUsage.CopyDst, undefined, \"TempReadFromMultipleStorageBuffers\");\n        for (let i = 0; i < storageBuffers.length; i++) {\n            this._renderEncoder.copyBufferToBuffer(storageBuffers[i].underlyingResource, offset ?? 0, gpuBuffer, i * size, size);\n        }\n        return this._readFromGPUBuffer(gpuBuffer, size * storageBuffers.length, buffer, noDelay);\n    }\n    /**\n     * Sets a storage buffer in the shader\n     * @param name Defines the name of the storage buffer as defined in the shader\n     * @param buffer Defines the value to give to the uniform\n     */\n    setStorageBuffer(name, buffer) {\n        this._currentDrawContext?.setBuffer(name, buffer?.getBuffer() ?? null);\n    }\n}\n// Default glslang options.\nWebGPUEngine._GlslangDefaultOptions = {\n    jsPath: `${Tools._DefaultCdnUrl}/glslang/glslang.js`,\n    wasmPath: `${Tools._DefaultCdnUrl}/glslang/glslang.wasm`,\n};\nWebGPUEngine._InstanceId = 0;\n//# sourceMappingURL=webgpuEngine.js.map"],"names":["WebGPUTextureHelper","width","height","ILog2","format","texture","imageBitmap","type","useSRGBBuffer","sampleCount","WebGPUPerfCounter","PerfCounter","currentFrameId","duration","ThinWebGPUEngine","AbstractEngine","enable","i","currentPassIndex","Logger","commandEncoder","gpuHardwareTexture","mipmapCount","PowerPreference","FeatureName","BufferMapState","BufferUsage","MapMode","TextureDimension","TextureUsage","TextureViewDimension","TextureAspect","TextureFormat","AddressMode","FilterMode","MipmapFilterMode","CompareFunction","ShaderStage","BufferBindingType","SamplerBindingType","TextureSampleType","StorageTextureAccess","CompilationMessageType","PipelineErrorReason","AutoLayoutMode","PrimitiveTopology","FrontFace","CullMode","ColorWrite","BlendFactor","BlendOperation","StencilOperation","IndexFormat","VertexFormat","VertexStepMode","ComputePassTimestampLocation","RenderPassTimestampLocation","LoadOp","StoreOp","QueryType","CanvasAlphaMode","CanvasToneMappingMode","DeviceLostReason","ErrorFilter","WebGPUShaderProcessor","name","uniformType","preProcessors","length","availableUBO","setDefinition","j","entry","nameInArrayOfTexture","bindGroupEntries","entries","textureInfo","textureIndex","dimension","isVertex","groupIndex","bindingIndex","len","textureName","samplerInfo","uniformBufferInfo","bufferType","WebGPUPipelineContext","shaderProcessingContext","engine","effect","uniformBuffersNames","uniformsNames","uniforms","samplerList","samplers","attributesNames","attributes","foundSamplers","index","sampler","attr","attributeNamesFromEffect","attributeLocationsFromEffect","location","UniformBuffer","leftOverUniform","size","uniformName","value","x","y","z","w","array","matrices","matrix","vector2","vector3","vector4","quaternion","color3","alpha","color4","_maxGroups","_maxBindingsPerGroup","_typeToLocationSize","WebGPUShaderProcessingContext","shaderLanguage","pureMode","knownUBOs","groups","binding","dataType","arrayLength","bindingCount","returnValue","ExtractBetweenMarkers","markerOpen","markerClose","block","startIndex","currPos","openMarkers","waitForChar","currChar","nextChar","SkipWhitespaces","c","IsIdentifierChar","v","RemoveComments","inComments","s","FindBackward","c2","EscapeRegExp","InjectStartingAndEndingCode","code","mainFuncDecl","startingCode","endingCode","idx","part1","part2","lastClosingCurly","WebGPUShaderProcessorGLSL","startArray","endArray","lengthInString","processingContext","isFragment","ubDeclaration","alreadyInjected","varying","outRegex","inRegex","varyingRegex","match","interpolationQualifier","varyingType","attribute","attribRegex","attributeType","numComponents","newType","newName","uniform","arraySize","samplerType","isComparisonSampler","samplerBindingType","samplerName","componentType","sampleType","isTextureArray","samplerGroupIndex","samplerBindingIndex","samplerFunction","textureType","textureDimension","layouts","textureSetIndex","textureBindingIndex","uniformBuffer","knownUBO","defines","_processingContext","_parameters","hasDrawBuffersExtension","regex","hasFragCoord","fragCoordCode","injectCode","hasOutput","iindex","uniformBufferDescription","ubo","vertexCode","fragmentCode","decl","leftOverUBO","builtInName_frag_depth","leftOverVarName","internalsVarName","gpuTextureViewDimensionByWebGPUTextureFunction","WebGPUShaderProcessorWGSL","key","interpolationType","interpolationSampling","interpolation","isArrayOfTexture","textureFunc","isStorageTexture","storageTextureFormat","isDepthTexture","definePattern","vertexInputs","vertexOutputs","vertexMainStartingCode","vertexMainEndingCode","needDiagnosticOff","fragmentInputs","fragmentOutputs","regexRoot","indexLocation","hasFragDepth","saveIndex","fragmentStartingCode","fragmentEndingCode","stridedArrays","stridedArrayType","samplerRegexp","suffixLessLength","insertPart","instantiateBufferRegexp","decoration","structName","bufferInfo","uniformArrayName","WebGPUHardwareTexture","_engine","existingTexture","hardwareTexture","_textureSource","generateMipMaps","is2DArray","isCube","is3D","depth","viewDimension","arrayLayerCount","aspect","descriptor","createViewForWriting","saveNumMipMaps","mipmapVertexSource","mipmapFragmentSource","invertYPreMultiplyAlphaVertexSource","invertYPreMultiplyAlphaFragmentSource","invertYPreMultiplyAlphaWithOfstVertexSource","invertYPreMultiplyAlphaWithOfstFragmentSource","clearVertexSource","clearFragmentSource","copyVideoToTextureVertexSource","copyVideoToTextureFragmentSource","copyVideoToTextureInvertYFragmentSource","PipelineType","VideoPipelineType","shadersForPipelineType","renderableTextureFormatToIndex","WebGPUTextureManager","device","bufferManager","enabledExtensions","keys","WebGPUConstants.BufferUsage","params","pipelineAndBGL","modules","processorOptions","Initialize","Process","migratedVertexCode","migratedFragmentCode","final","Finalize","vertexModule","fragmentModule","pipeline","encoder","video","invertY","useOwnCommandEncoder","bindGroupLayout","webgpuHardwareTexture","renderPassDescriptor","passEncoder","bindGroup","gpuOrHdwTexture","premultiplyAlpha","faceIndex","mipLevel","layers","ofstX","ofstY","rectWidth","rectHeight","allowGPUOptimization","useRect","gpuTexture","outputTexture","hasMipmaps","generateMipmaps","usage","additionalUsages","label","layerCount","textureSize","renderAttachmentFlag","isCompressedFormat","mipLevelCount","usages","imageBitmaps","f","creationFlags","dontCreateMSAATexture","gpuTextureWrapper","hasMipMaps","samples","releaseExisting","gpuMSAATexture","offsetX","offsetY","faces","blockInformation","textureCopyView","textureExtent","bytesPerRow","buffer","arrayBuffer","dontUseRect","noDataConversion","bytesPerRowAligned","gpuBuffer","irradianceTexture","WebGPUDataBuffer","DataBuffer","resource","capacity","WebGPUBufferManager","flags","suffix","result","viewOrSize","mappedAtCreation","alignedLength","verticesBufferDescriptor","isView","dataBuffer","labelId","dstByteOffset","src","srcByteOffset","byteLength","startPre","originalByteLength","tmpBuffer","dataLength","destArray","srcData","FromHalfFloat","offset","destroyBuffer","floatFormat","engineId","resolve","reject","copyArrayBuffer","data","allocateAndCopyTypedBuffer","data2","offset2","reason","filterToBits","comparisonFunctionToBits","filterNoMipToBits","WebGPUCacheSampler","anisotropy","magFilter","minFilter","mipmapFilter","lodMinClamp","lodMaxClamp","useMipMaps","mode","filterDescriptor","compareFunction","bypassCache","hash","gpuSampler","vertexBufferKindForNonFloatProcessing","VertexBuffer","isSignedType","checkNonFloatVertexBuffers","vertexBuffers","pipelineContext","kind","currentVertexBuffer","currentVertexBufferType","vertexBufferType","parallelShaderCompile","StatePosition","alphaBlendFactorToIndex","stencilOpToIndex","WebGPUCacheRenderPipeline","emptyVertexBuffer","fillMode","textureState","topology","enabled","frontFace","cullFace","clampDepth","cullEnabled","zOffset","zOffsetUnits","depthTestEnabled","depthWriteEnabled","depthCompare","depthBias","depthBiasSlopeScale","attachments","mask","textureArray","textureCount","bits","indexBits","numRT","gpuWrapper","factors","operations","func","op","stencilEnabled","compare","depthFailOp","passOp","failOp","readMask","writeMask","indexBuffer","overrideVertexBuffers","operation","factor","vertexBuffer","normalized","id","cullMode","alphaToCoverage","rasterizationState","colorStates","stencilState","depthStencilState","currStateLen","newNumStates","webgpuPipelineContext","locations","currentGPUBuffer","numVertexBuffers","formatSize","byteStride","vid","bindGroupLayouts","bindGroupLayoutEntries","bitVal","descriptors","currentGPUAttributes","invalidOffsetRange","vertexBufferDescriptor","inputStateDescriptor","pipelineLayout","alphaBlend","colorBlend","descr","stencilFrontBack","topologyIsTriangle","stripIndexFormat","depthStencilFormatHasStencil","NodeState","countNode","countPipeline","node","childCountNodes","childCoundPipeline","WebGPUCacheRenderPipelineTree","counts","pipelines","curPath","curPathLen","path","nnode","param","nn","WebGPUStencilStateComposer","StencilStateComposer","cache","stencilMaterialEnabled","WebGPUDepthCullingState","DepthCullingState","ExternalTexture","InternalTexture","WebGPUMaterialContext","samplerCache","currentHashCode","isDirty","textureCache","currentTextureId","WebGPUDrawContext","materialContextUpdateId","use","indexOrVertexCount","instanceCount","firstIndexOrVertex","bufferIdStart","textureIdStart","WebGPUBindGroupCacheNode","WebGPUCacheBindGroups","cacheSampler","drawContext","materialContext","bindGroups","cacheIsDisabled","bufferName","uboId","nextNode","samplerHashCode","textureId","entryInfo","bindingInfo","externalTexture","webgpuBuffer","groupLayout","shader","ShaderStore","WebGPUClearQuad","renderPass","clearColor","clearDepth","clearStencil","renderPass2","bundle","bundleKey","isRTTPass","depthStencilFormatIndex","bufferInternals","bufferLeftOver","WebGPURenderItemViewport","h","WebGPURenderItemScissor","WebGPURenderItemStencilRef","ref","WebGPURenderItemBlendColor","color","WebGPURenderItemBeginOcclusionQuery","query","WebGPURenderItemEndOcclusionQuery","WebGPURenderItemBundles","cloned","WebGPUBundleList","item","colorFormats","depthStencilFormat","WebGPUQuerySet","count","canUseMultipleBuffers","firstQuery","queryCount","encoderResult","arrayBuf","err","WebGPUTimestampQuery","WebGPUDurationMeasure","e","gpuPerfCounter","duration_","querySetLabel","WebGPUOcclusionQuery","canBegin","startCount","incrementCount","numIndices","querySet","ShaderCodeInliner","sourceCode","numMaxIterations","inlineTokenIndex","funcParamsStartIndex","funcNameMatch","funcType","funcName","funcParamsEndIndex","funcParams","funcBodyStartIndex","funcBodyEndIndex","funcBody","paramNames","partBefore","partAfter","doAgain","parameters","body","functionCallIndex","callParamsStartIndex","callParamsEndIndex","callParams","curIdx","startParamIdx","idx2","p","retParamName","injectDeclarationIndex","partBetween","sources","destinations","source","sourceLen","destination","args","WebGPUTintWASM","twgslOptions","Tools","disableUniformityAnalysis","ccode","WebGPUSnapshotRendering","renderingMode","bundleList","activate","currentRenderPass","message","isLittleEndian","view","typeByteLength","alignedByteStride","alignedSize","totalVertices","totalLength","sourceData","sourceDataAsFloat","alignedData","sourceOffset","Buffer","WebGPUExternalTexture","noDepthWriteChange","depthMask","equation","samplingMode","compression","bufferView","_convertRGBtoRGBATextureData","_format","needConversion","faceData","url","scene","noMipmap","callback","mipmapGenerator","onLoad","onError","onerror","request","exception","internalCallback","faceDataArrays","mipData","level","mipSize","allFaces","mipFaceData","rgbData","rgbaData","val1","newIndex","flushRenderer","options","internalTexture","internalOptions","rootUrl","files","forcedExtension","createPolynomials","lodScale","lodOffset","fallback","loaderOptions","imgs","loadMipmap","maxLevel","WebGPURenderTargetWrapper","RenderTargetWrapper","isMulti","rtWrapper","fullOptions","wrapper","hasStencil","HasStencilAspect","GetTypeForDepthTexture","bilinearFiltering","comparisonFunction","channel","_OcclusionDataStorage","AbstractMesh","algorithmType","dataStorage","occlusionQueryResult","occlusionBoundingBoxRenderer","viewDescriptorSwapChainAntialiasing","viewDescriptorSwapChain","tempColor4","Color4","WebGPUEngine","disable","font","GetFontOffset","adapter","canvas","PerformanceMonitor","glslang","glslangOptions","feature","deviceDescriptor","requiredFeatures","requestedExtensions","validExtensions","extension","numUncapturedErrors","event","info","snapshotRenderingMode","snapshotRendering","disableCacheSamplers","disableCacheRenderPipelines","disableCacheBindGroups","enableGPUTimingMeasurements","bufferDataUpdate","mainColorAttachments","mainTextureDescriptor","depthTextureDescriptor","mainDepthAttachment","_CommonInit","image","bufferWidth","bufferHeight","ResizeImageBitmap","imageSource","CreateImageBitmapFromSource","requestPointerLock","RequestFullscreen","ExitFullscreen","RequestPointerlock","ExitPointerlock","storageBuffer","initEngine","cleanScenes","scenes","mesh","subMeshes","subMesh","material","uboList","forceSetSize","bruteForce","update","backBuffer","stencil","hasScissor","_updatable","indices","is32Bits","byteOffset","elements","_location","baseName","attributesNamesOrOptions","uniformsNamesOrEngine","fallbacks","onCompiled","indexParameters","extraInitializationsAsync","vertex","fragment","globalDefines","isOptions","fullDefines","compiledEffect","Effect","shaderVersion","vertexShader","fragmentShader","disableUniformityAnalysisInVertex","disableUniformityAnalysisInFragment","program","sci","vertexSourceCode","fragmentSourceCode","createAsRaw","rawVertexSourceCode","rawFragmentSourceCode","_rebuildRebind","_transformFeedbackVaryings","_key","onReady","webGpuContext","results","gpuPipelineContext","attributeName","attributeLocation","IsWrapper","webGPUPipelineContext","resetCachedPipeline","delayGPUTextureCreation","createMipMapsOnly","mimeType","img","isCompressed","processFunction","_noMipmap","_value","wrapU","wrapV","wrapR","availableTexture","loadData","SphericalPolynomial","unused","textures","isPartOfTextureArray","depthStencilTexture","textureWrapMode","target","anisotropicFilteringLevel","imageData","xOffset","yOffset","lod","internalFormat","babylonInternalFormat","useTextureWidthAndHeight","lodMaxWidth","lodMaxHeight","bitmap","hasAlpha","gpuTextureFormat","list","renderTargetWrapper","setClearStates","gpuDepthStencilWrapper","gpuDepthStencilTexture","gpuDepthStencilMSAATexture","depthTextureView","depthMSAATextureView","depthTextureHasStencil","colorAttachments","clearColorForIntegerRT","mustClearColor","mustClearDepth","mustClearStencil","mrtTexture","gpuMRTWrapper","gpuMRTTexture","baseArrayLayer","viewDescriptor","msaaViewDescriptor","isRTInteger","colorTextureView","colorMSAATextureView","depthSlice","swapChainTexture","requiredWidth","requiredHeight","forceFullscreenViewport","lodLevel","layer","disableGenerateMipMaps","onBeforeUnbind","saveCRT","_texture","action","cullBackFaces","force","culling","reverseSide","mustUpdateStencilRef","mustUpdateBlendColor","drawType","start","instancesCount","useFastPath","textureIsDepth","nonCompatMode","indexStart","indexCount","verticesStart","verticesCount","_CommonDispose","useScreen","noDelay","readFromBuffer","ctor","storageBuffers"],"mappings":"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B,sBAA6E,iBACxG,IAAK,OACD,OAAOA,EAAgB,sBAA6E,iBACxG,IAAK,OACL,IAAK,OACD,OAAOA,EAAgB,sBAA8E,iBACzG,IAAK,OACD,OAAOA,EAAgB,uBAAgF,iBAC9G,CACD,OAAQD,EAAI,CACR,IAAK,GACD,OAAQH,EAAM,CACV,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,WACX,IAAK,GAED,KAAM,qCACV,IAAK,GACD,MAAO,SACX,IAAK,GACD,MAAO,UACX,IAAK,IAED,KAAM,6CACV,IAAK,IACD,MAAO,YACX,QACI,MAAO,YACd,CACL,IAAK,GACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,WACX,IAAK,GAED,KAAM,mDACV,IAAK,GACD,OAAOI,EAAgB,kBAAuE,aAClG,IAAK,IACD,OAAOA,EAAgB,kBAAuE,aAClG,IAAK,GACD,MAAO,SACX,IAAK,GACD,MAAO,UACX,IAAK,IAED,KAAM,6CACV,IAAK,IACD,MAAO,YACX,IAAK,GAED,KAAM,qDACV,IAAK,GAED,KAAM,yDACV,IAAK,GAED,KAAM,+DACV,QACI,MAAO,YACd,CACL,IAAK,GACD,OAAQJ,EAAM,CACV,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,WACX,IAAK,IAED,KAAM,2DACV,IAAK,IACD,MAAO,aACX,QACI,MAAO,YACd,CACL,IAAK,GACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,WACX,IAAK,IAED,KAAM,2DACV,IAAK,IACD,MAAO,aACX,QACI,MAAO,YACd,CACL,IAAK,GACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,WACX,IAAK,IAED,KAAM,2DACV,IAAK,IACD,MAAO,aACX,QACI,MAAO,YACd,CACL,IAAK,GACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,WACX,IAAK,IAED,KAAM,2DACV,IAAK,IACD,MAAO,aACX,QACI,MAAO,YACd,CACL,IAAK,GACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,WACX,IAAK,GACD,MAAO,YACX,IAAK,GAED,KAAM,mDACV,IAAK,GACD,MAAO,cACX,QACI,MAAO,aACd,CACL,IAAK,GACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,WACX,IAAK,GACD,MAAO,YACX,IAAK,GAED,KAAM,mDACV,IAAK,GACD,MAAO,cACX,QACI,MAAO,aACd,CACL,IAAK,IAED,KAAM,kEACV,IAAK,IACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,gBACX,IAAK,IAED,KAAM,kHACV,QACI,MAAO,eACd,CACL,IAAK,IACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,eACX,IAAK,IAED,KAAM,8GACV,QACI,MAAO,cACd,CACL,IAAK,GAED,KAAM,oEACV,IAAK,GAED,KAAM,oEACV,IAAK,IACD,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,eACX,IAAK,IACD,MAAO,cACX,QACI,MAAO,cACd,CACR,CACD,OAAOI,EAAgB,kBAAuE,YACjG,CACD,OAAO,sCAAsCJ,EAAQ,CACjD,OAAQA,EAAM,CACV,IAAK,UACL,IAAK,UACL,IAAK,SACL,IAAK,SACL,IAAK,cACL,IAAK,cACL,IAAK,UACL,IAAK,UACL,IAAK,eACL,IAAK,WACL,IAAK,WACL,IAAK,WACL,IAAK,UACL,IAAK,UACL,IAAK,WACL,IAAK,eACL,IAAK,WACL,IAAK,cACL,IAAK,eACL,IAAK,eACD,MAAO,GACX,IAAK,WACL,IAAK,WACL,IAAK,UACL,IAAK,UACL,IAAK,wBACL,IAAK,eACL,IAAK,eACL,IAAK,WACL,IAAK,WACL,IAAK,YACL,IAAK,YACL,IAAK,YACL,IAAK,WACL,IAAK,WACL,IAAK,YACL,IAAK,uBACL,IAAK,gBACL,IAAK,gBACD,MAAO,GACX,IAAK,eACL,IAAK,gBACL,IAAK,kBACL,IAAK,iBACL,IAAK,iBACL,IAAK,sBACD,MAAO,GACX,IAAK,aACL,IAAK,kBACL,IAAK,aACL,IAAK,YACL,IAAK,YACL,IAAK,aACL,IAAK,kBACL,IAAK,cACL,IAAK,cACL,IAAK,cACL,IAAK,eACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,aACL,IAAK,aACL,IAAK,cACL,IAAK,aACL,IAAK,aACL,IAAK,cACL,IAAK,mBACL,IAAK,wBACL,IAAK,kBACL,IAAK,uBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,iBACL,IAAK,sBACL,IAAK,kBACL,IAAK,uBACL,IAAK,kBACL,IAAK,uBACL,IAAK,kBACL,IAAK,uBACL,IAAK,mBACL,IAAK,wBACL,IAAK,mBACL,IAAK,wBACL,IAAK,mBACL,IAAK,wBACD,MAAO,EACd,CAED,KAAM,kBAAkBA,CAAM,GACjC,CACD,OAAO,iBAAiBA,EAAQ,CAC5B,OAAQA,EAAM,CACV,IAAK,WACL,IAAK,wBACL,IAAK,uBACD,MAAO,EACd,CACD,MAAO,EACV,CACD,OAAO,0BAA0BA,EAAQ,CACrC,OAAQA,EAAM,CACV,IAAK,wBACL,IAAK,uBACD,MAAO,EACd,CACD,MAAO,EACV,CACD,OAAO,mBAAmBA,EAAQ,CAC9B,OAAQA,EAAM,CACV,IAAK,eACD,MAAO,eACX,IAAK,cACD,MAAO,cACX,IAAK,uBACD,MAAO,cACX,IAAK,eACD,MAAO,eACX,IAAK,wBACD,MAAO,cACd,CACD,OAAOA,CACV,CACD,OAAO,UAAUK,EAAa,CAE1B,OAAOA,EAAc,EAAI,EAAI,CAChC,CACL,CClsBO,MAAMC,EAAkB,CAC3B,aAAc,CACV,KAAK,kBAAoB,GAIzB,KAAK,QAAU,IAAIC,EACtB,CAID,aAAaC,EAAgBC,EAAU,CAC/BD,EAAiB,KAAK,oBAGtB,KAAK,oBAAsBA,GAC3B,KAAK,QAAQ,eACb,KAAK,QAAQ,gBACb,KAAK,QAAQ,SAASC,EAAU,EAAK,EACrC,KAAK,kBAAoBD,GAGzB,KAAK,QAAQ,SAASC,EAAU,EAAK,EAE5C,CACL,CCrBO,MAAMC,UAAyBC,CAAe,CACjD,aAAc,CACV,MAAM,GAAG,SAAS,EAGlB,KAAK,kBAAoB,GAEzB,KAAK,gBAAkB,GAEvB,KAAK,wBAA0B,GAE/B,KAAK,uBAAyB,GAE9B,KAAK,8BAAgC,GAErC,KAAK,6BAA+B,GAEpC,KAAK,mBAAqB,KAC1B,KAAK,uBAAyB,EAE9B,KAAK,gBAAkB,EAEvB,KAAK,sBAAwB,EAChC,CAKD,IAAI,6BAA8B,CAC9B,OAAO,KAAK,gBAAgB,MAC/B,CACD,IAAI,4BAA4BC,EAAQ,CAChC,KAAK,gBAAgB,SAAWA,IAGpC,KAAK,0BAA4BA,EAAS,IAAIN,GAAsB,OACpE,KAAK,gBAAgB,OAASM,EACjC,CACD,wBAAyB,CACrB,OAAO,KAAK,uBAAyB,IACxC,CAED,uBAAwB,CACpB,GAAI,CAAC,KAAK,mBACN,MAAO,GAEX,GAAI,KAAK,sBAAsB,SAAW,EACtC,QAASC,EAAI,EAAGA,EAAI,KAAK,sBAAsB,OAAQ,EAAEA,EACrD,KAAK,mBAAmB,gBAGhC,MAAMC,EAAmB,KAAK,uBAAsB,EAAK,EAAI,EAC7D,MAAI,CAAC,KAAK,mBAAmB,cAAc,KAAK,kBAAkB,GAAK,CAAC,KAAK,oBACzE,KAAK,YAAY,IAAI,KAAK,kBAAkB,EAC5C,KAAK,YAAY,SAErB,KAAK,mBAAmB,MACxB,KAAK,gBAAgB,QAAQ,KAAK,gBAAkB,KAAK,sBAAwB,KAAK,qBAAqB,eACrG,KAAK,qBAAqB,eAC1B,KAAK,yBAAyB,EACpC,KAAK,iBAAmB,EACpB,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnCC,EAAO,IAAI,UACP,KAAK,OACL,OACCD,IAAqB,EAAI,OAAS,iBACnC,aACCA,IAAqB,EAAI,+BAAiC,KAAK,sBAAsB,SAAS,SAAW,GAAG,GAGzH,KAAK,iBAAiB,CAAC,EACvB,KAAK,mBAAqB,KACnBA,CACV,CAID,iBAAiBb,EAASe,EAAgB,CACtCA,EAAiBA,GAAkB,KAAK,eACxC,MAAMC,EAAqBhB,EAAQ,iBACnC,GAAI,CAACgB,EACD,OAEAD,IAAmB,KAAK,gBAExB,KAAK,sBAAqB,EAE9B,MAAMhB,EAASC,EAAQ,iBAAiB,OAClCiB,EAActB,EAAoB,uBAAuBK,EAAQ,MAAOA,EAAQ,MAAM,EACxF,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnCc,EAAO,IAAI,UACP,KAAK,OACL,+BACAd,EAAQ,MACR,YACAA,EAAQ,OACR,YACAA,EAAQ,OACR,sBACCe,IAAmB,KAAK,eAAiB,SAAW,OAAO,GAGpEf,EAAQ,OACR,KAAK,eAAe,oBAAoBgB,EAAoBjB,EAAQkB,EAAaF,CAAc,EAG/F,KAAK,eAAe,gBAAgBC,EAAoBjB,EAAQkB,EAAa,EAAGjB,EAAQ,KAAMe,CAAc,CAEnH,CACL,CC3HO,IAAIG,IACV,SAAUA,EAAiB,CACxBA,EAAgB,SAAc,YAC9BA,EAAgB,gBAAqB,kBACzC,GAAGA,KAAoBA,GAAkB,CAAE,EAAC,EAErC,IAAIC,IACV,SAAUA,EAAa,CACpBA,EAAY,iBAAsB,qBAClCA,EAAY,qBAA0B,wBACtCA,EAAY,qBAA0B,yBACtCA,EAAY,6BAAkC,mCAC9CA,EAAY,uBAA4B,2BACxCA,EAAY,uBAA4B,2BACxCA,EAAY,+BAAoC,qCAChDA,EAAY,eAAoB,kBAChCA,EAAY,sBAA2B,0BACvCA,EAAY,UAAe,aAC3BA,EAAY,wBAA6B,2BACzCA,EAAY,kBAAuB,qBACnCA,EAAY,kBAAuB,qBACnCA,EAAY,iBAAsB,oBAClCA,EAAY,cAAmB,iBAC/BA,EAAY,mBAAwB,sBACxC,GAAGA,KAAgBA,GAAc,CAAE,EAAC,EAE7B,IAAIC,IACV,SAAUA,EAAgB,CACvBA,EAAe,SAAc,WAC7BA,EAAe,QAAa,UAC5BA,EAAe,OAAY,QAC/B,GAAGA,KAAmBA,GAAiB,CAAE,EAAC,EAEnC,IAAIC,GACV,SAAUA,EAAa,CACpBA,EAAYA,EAAY,QAAa,CAAC,EAAI,UAC1CA,EAAYA,EAAY,SAAc,CAAC,EAAI,WAC3CA,EAAYA,EAAY,QAAa,CAAC,EAAI,UAC1CA,EAAYA,EAAY,QAAa,CAAC,EAAI,UAC1CA,EAAYA,EAAY,MAAW,EAAE,EAAI,QACzCA,EAAYA,EAAY,OAAY,EAAE,EAAI,SAC1CA,EAAYA,EAAY,QAAa,EAAE,EAAI,UAC3CA,EAAYA,EAAY,QAAa,GAAG,EAAI,UAC5CA,EAAYA,EAAY,SAAc,GAAG,EAAI,WAC7CA,EAAYA,EAAY,aAAkB,GAAG,EAAI,cACrD,GAAGA,IAAgBA,EAAc,CAAE,EAAC,EAE7B,IAAIC,IACV,SAAUA,EAAS,CAChBA,EAAQA,EAAQ,KAAU,CAAC,EAAI,OAC/BA,EAAQA,EAAQ,MAAW,CAAC,EAAI,OACpC,GAAGA,KAAYA,GAAU,CAAE,EAAC,EAErB,IAAIC,IACV,SAAUA,EAAkB,CACzBA,EAAiB,IAAS,KAC1BA,EAAiB,IAAS,KAC1BA,EAAiB,IAAS,IAC9B,GAAGA,KAAqBA,GAAmB,CAAE,EAAC,EAEvC,IAAIC,IACV,SAAUA,EAAc,CACrBA,EAAaA,EAAa,QAAa,CAAC,EAAI,UAC5CA,EAAaA,EAAa,QAAa,CAAC,EAAI,UAC5CA,EAAaA,EAAa,eAAoB,CAAC,EAAI,iBACnDA,EAAaA,EAAa,eAAoB,CAAC,EAAI,iBACnDA,EAAaA,EAAa,iBAAsB,EAAE,EAAI,kBAC1D,GAAGA,KAAiBA,GAAe,CAAE,EAAC,EAE/B,IAAIC,IACV,SAAUA,EAAsB,CAC7BA,EAAqB,IAAS,KAC9BA,EAAqB,IAAS,KAC9BA,EAAqB,SAAc,WACnCA,EAAqB,KAAU,OAC/BA,EAAqB,UAAe,aACpCA,EAAqB,IAAS,IAClC,GAAGA,KAAyBA,GAAuB,CAAE,EAAC,EAE/C,IAAIC,IACV,SAAUA,EAAe,CACtBA,EAAc,IAAS,MACvBA,EAAc,YAAiB,eAC/BA,EAAc,UAAe,YACjC,GAAGA,KAAkBA,GAAgB,CAAE,EAAC,EAKjC,IAAIC,IACV,SAAUA,EAAe,CAEtBA,EAAc,QAAa,UAC3BA,EAAc,QAAa,UAC3BA,EAAc,OAAY,SAC1BA,EAAc,OAAY,SAE1BA,EAAc,QAAa,UAC3BA,EAAc,QAAa,UAC3BA,EAAc,SAAc,WAC5BA,EAAc,SAAc,WAC5BA,EAAc,SAAc,WAC5BA,EAAc,QAAa,UAC3BA,EAAc,QAAa,UAC3BA,EAAc,SAAc,WAC5BA,EAAc,SAAc,WAC5BA,EAAc,UAAe,YAC7BA,EAAc,UAAe,YAC7BA,EAAc,YAAiB,cAC/BA,EAAc,YAAiB,cAE/BA,EAAc,QAAa,UAC3BA,EAAc,QAAa,UAC3BA,EAAc,SAAc,WAC5BA,EAAc,SAAc,WAC5BA,EAAc,SAAc,WAC5BA,EAAc,UAAe,YAC7BA,EAAc,WAAgB,aAC9BA,EAAc,eAAoB,kBAClCA,EAAc,WAAgB,aAC9BA,EAAc,UAAe,YAC7BA,EAAc,UAAe,YAC7BA,EAAc,WAAgB,aAC9BA,EAAc,eAAoB,kBAElCA,EAAc,aAAkB,eAChCA,EAAc,YAAiB,cAC/BA,EAAc,aAAkB,eAChCA,EAAc,cAAmB,gBAEjCA,EAAc,SAAc,WAC5BA,EAAc,SAAc,WAC5BA,EAAc,UAAe,YAC7BA,EAAc,WAAgB,aAC9BA,EAAc,WAAgB,aAC9BA,EAAc,YAAiB,cAE/BA,EAAc,WAAgB,aAC9BA,EAAc,WAAgB,aAC9BA,EAAc,YAAiB,cAE/BA,EAAc,SAAc,WAC5BA,EAAc,aAAkB,eAChCA,EAAc,YAAiB,cAC/BA,EAAc,oBAAyB,uBACvCA,EAAc,aAAkB,eAGhCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,UAAe,cAC7BA,EAAc,UAAe,cAC7BA,EAAc,WAAgB,eAC9BA,EAAc,WAAgB,eAC9BA,EAAc,cAAmB,kBACjCA,EAAc,aAAkB,iBAChCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBAGpCA,EAAc,cAAmB,iBACjCA,EAAc,kBAAuB,sBACrCA,EAAc,gBAAqB,mBACnCA,EAAc,oBAAyB,wBACvCA,EAAc,eAAoB,kBAClCA,EAAc,mBAAwB,uBACtCA,EAAc,YAAiB,eAC/BA,EAAc,YAAiB,eAC/BA,EAAc,aAAkB,gBAChCA,EAAc,aAAkB,gBAGhCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,aAAkB,iBAChCA,EAAc,iBAAsB,sBACpCA,EAAc,cAAmB,kBACjCA,EAAc,kBAAuB,uBACrCA,EAAc,cAAmB,kBACjCA,EAAc,kBAAuB,uBACrCA,EAAc,cAAmB,kBACjCA,EAAc,kBAAuB,uBACrCA,EAAc,eAAoB,mBAClCA,EAAc,mBAAwB,wBACtCA,EAAc,eAAoB,mBAClCA,EAAc,mBAAwB,wBACtCA,EAAc,eAAoB,mBAClCA,EAAc,mBAAwB,wBAEtCA,EAAc,qBAA0B,uBAC5C,GAAGA,KAAkBA,GAAgB,CAAE,EAAC,EAEjC,IAAIC,IACV,SAAUA,EAAa,CACpBA,EAAY,YAAiB,gBAC7BA,EAAY,OAAY,SACxBA,EAAY,aAAkB,eAClC,GAAGA,KAAgBA,GAAc,CAAE,EAAC,EAE7B,IAAIC,IACV,SAAUA,EAAY,CACnBA,EAAW,QAAa,UACxBA,EAAW,OAAY,QAC3B,GAAGA,KAAeA,GAAa,CAAE,EAAC,EAE3B,IAAIC,IACV,SAAUA,EAAkB,CACzBA,EAAiB,QAAa,UAC9BA,EAAiB,OAAY,QACjC,GAAGA,KAAqBA,GAAmB,CAAE,EAAC,EAEvC,IAAIC,IACV,SAAUA,EAAiB,CACxBA,EAAgB,MAAW,QAC3BA,EAAgB,KAAU,OAC1BA,EAAgB,MAAW,QAC3BA,EAAgB,UAAe,aAC/BA,EAAgB,QAAa,UAC7BA,EAAgB,SAAc,YAC9BA,EAAgB,aAAkB,gBAClCA,EAAgB,OAAY,QAChC,GAAGA,KAAoBA,GAAkB,CAAE,EAAC,EAErC,IAAIC,IACV,SAAUA,EAAa,CACpBA,EAAYA,EAAY,OAAY,CAAC,EAAI,SACzCA,EAAYA,EAAY,SAAc,CAAC,EAAI,WAC3CA,EAAYA,EAAY,QAAa,CAAC,EAAI,SAC9C,GAAGA,KAAgBA,GAAc,CAAE,EAAC,EAE7B,IAAIC,IACV,SAAUA,EAAmB,CAC1BA,EAAkB,QAAa,UAC/BA,EAAkB,QAAa,UAC/BA,EAAkB,gBAAqB,mBAC3C,GAAGA,KAAsBA,GAAoB,CAAE,EAAC,EAEzC,IAAIC,IACV,SAAUA,EAAoB,CAC3BA,EAAmB,UAAe,YAClCA,EAAmB,aAAkB,gBACrCA,EAAmB,WAAgB,YACvC,GAAGA,KAAuBA,GAAqB,CAAE,EAAC,EAE3C,IAAIC,IACV,SAAUA,EAAmB,CAC1BA,EAAkB,MAAW,QAC7BA,EAAkB,kBAAuB,qBACzCA,EAAkB,MAAW,QAC7BA,EAAkB,KAAU,OAC5BA,EAAkB,KAAU,MAChC,GAAGA,KAAsBA,GAAoB,CAAE,EAAC,EAEzC,IAAIC,IACV,SAAUA,EAAsB,CAC7BA,EAAqB,UAAe,aACpCA,EAAqB,SAAc,YACnCA,EAAqB,UAAe,YACxC,GAAGA,KAAyBA,GAAuB,CAAE,EAAC,EAE/C,IAAIC,IACV,SAAUA,EAAwB,CAC/BA,EAAuB,MAAW,QAClCA,EAAuB,QAAa,UACpCA,EAAuB,KAAU,MACrC,GAAGA,KAA2BA,GAAyB,CAAE,EAAC,EAEnD,IAAIC,IACV,SAAUA,EAAqB,CAC5BA,EAAoB,WAAgB,aACpCA,EAAoB,SAAc,UACtC,GAAGA,KAAwBA,GAAsB,CAAE,EAAC,EAE7C,IAAIC,IACV,SAAUA,EAAgB,CACvBA,EAAe,KAAU,MAC7B,GAAGA,KAAmBA,GAAiB,CAAE,EAAC,EAEnC,IAAIC,IACV,SAAUA,EAAmB,CAC1BA,EAAkB,UAAe,aACjCA,EAAkB,SAAc,YAChCA,EAAkB,UAAe,aACjCA,EAAkB,aAAkB,gBACpCA,EAAkB,cAAmB,gBACzC,GAAGA,KAAsBA,GAAoB,CAAE,EAAC,EAEzC,IAAIC,IACV,SAAUA,EAAW,CAClBA,EAAU,IAAS,MACnBA,EAAU,GAAQ,IACtB,GAAGA,KAAcA,GAAY,CAAE,EAAC,EAEzB,IAAIC,IACV,SAAUA,EAAU,CACjBA,EAAS,KAAU,OACnBA,EAAS,MAAW,QACpBA,EAAS,KAAU,MACvB,GAAGA,KAAaA,GAAW,CAAE,EAAC,EAEvB,IAAIC,IACV,SAAUA,EAAY,CACnBA,EAAWA,EAAW,IAAS,CAAC,EAAI,MACpCA,EAAWA,EAAW,MAAW,CAAC,EAAI,QACtCA,EAAWA,EAAW,KAAU,CAAC,EAAI,OACrCA,EAAWA,EAAW,MAAW,CAAC,EAAI,QACtCA,EAAWA,EAAW,IAAS,EAAE,EAAI,KACzC,GAAGA,KAAeA,GAAa,CAAE,EAAC,EAE3B,IAAIC,IACV,SAAUA,EAAa,CACpBA,EAAY,KAAU,OACtBA,EAAY,IAAS,MACrBA,EAAY,IAAS,MACrBA,EAAY,YAAiB,gBAC7BA,EAAY,SAAc,YAC1BA,EAAY,iBAAsB,sBAClCA,EAAY,IAAS,MACrBA,EAAY,YAAiB,gBAC7BA,EAAY,SAAc,YAC1BA,EAAY,iBAAsB,sBAClCA,EAAY,kBAAuB,sBACnCA,EAAY,SAAc,WAC1BA,EAAY,iBAAsB,qBAClCA,EAAY,KAAU,OACtBA,EAAY,aAAkB,iBAC9BA,EAAY,UAAe,aAC3BA,EAAY,kBAAuB,sBACvC,GAAGA,KAAgBA,GAAc,CAAE,EAAC,EAE7B,IAAIC,IACV,SAAUA,EAAgB,CACvBA,EAAe,IAAS,MACxBA,EAAe,SAAc,WAC7BA,EAAe,gBAAqB,mBACpCA,EAAe,IAAS,MACxBA,EAAe,IAAS,KAC5B,GAAGA,KAAmBA,GAAiB,CAAE,EAAC,EAEnC,IAAIC,IACV,SAAUA,EAAkB,CACzBA,EAAiB,KAAU,OAC3BA,EAAiB,KAAU,OAC3BA,EAAiB,QAAa,UAC9BA,EAAiB,OAAY,SAC7BA,EAAiB,eAAoB,kBACrCA,EAAiB,eAAoB,kBACrCA,EAAiB,cAAmB,iBACpCA,EAAiB,cAAmB,gBACxC,GAAGA,KAAqBA,GAAmB,CAAE,EAAC,EAEvC,IAAIC,IACV,SAAUA,EAAa,CACpBA,EAAY,OAAY,SACxBA,EAAY,OAAY,QAC5B,GAAGA,KAAgBA,GAAc,CAAE,EAAC,EAE7B,IAAIC,IACV,SAAUA,EAAc,CACrBA,EAAa,QAAa,UAC1BA,EAAa,QAAa,UAC1BA,EAAa,QAAa,UAC1BA,EAAa,QAAa,UAC1BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,UAAe,YAC5BA,EAAa,UAAe,YAC5BA,EAAa,UAAe,YAC5BA,EAAa,UAAe,YAC5BA,EAAa,UAAe,YAC5BA,EAAa,UAAe,YAC5BA,EAAa,QAAa,UAC1BA,EAAa,UAAe,YAC5BA,EAAa,UAAe,YAC5BA,EAAa,UAAe,YAC5BA,EAAa,OAAY,SACzBA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,OAAY,SACzBA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,SAAc,WAC3BA,EAAa,gBAAqB,iBACtC,GAAGA,KAAiBA,GAAe,CAAE,EAAC,EAE/B,IAAIC,IACV,SAAUA,EAAgB,CACvBA,EAAe,OAAY,SAC3BA,EAAe,SAAc,UACjC,GAAGA,KAAmBA,GAAiB,CAAE,EAAC,EAEnC,IAAIC,IACV,SAAUA,EAA8B,CACrCA,EAA6B,UAAe,YAC5CA,EAA6B,IAAS,KAC1C,GAAGA,KAAiCA,GAA+B,CAAE,EAAC,EAE/D,IAAIC,IACV,SAAUA,EAA6B,CACpCA,EAA4B,UAAe,YAC3CA,EAA4B,IAAS,KACzC,GAAGA,KAAgCA,GAA8B,CAAE,EAAC,EAE7D,IAAIC,IACV,SAAUA,EAAQ,CACfA,EAAO,KAAU,OACjBA,EAAO,MAAW,OACtB,GAAGA,KAAWA,GAAS,CAAE,EAAC,EAEnB,IAAIC,IACV,SAAUA,EAAS,CAChBA,EAAQ,MAAW,QACnBA,EAAQ,QAAa,SACzB,GAAGA,KAAYA,GAAU,CAAE,EAAC,EAErB,IAAIC,IACV,SAAUA,EAAW,CAClBA,EAAU,UAAe,YACzBA,EAAU,UAAe,WAC7B,GAAGA,KAAcA,GAAY,CAAE,EAAC,EAEzB,IAAIC,IACV,SAAUA,EAAiB,CACxBA,EAAgB,OAAY,SAC5BA,EAAgB,cAAmB,eACvC,GAAGA,KAAoBA,GAAkB,CAAE,EAAC,EAErC,IAAIC,IACV,SAAUA,EAAuB,CAC9BA,EAAsB,SAAc,WACpCA,EAAsB,SAAc,UACxC,GAAGA,KAA0BA,GAAwB,CAAE,EAAC,EAEjD,IAAIC,IACV,SAAUA,EAAkB,CACzBA,EAAiB,QAAa,UAC9BA,EAAiB,UAAe,WACpC,GAAGA,KAAqBA,GAAmB,CAAE,EAAC,EAEvC,IAAIC,IACV,SAAUA,EAAa,CACpBA,EAAY,WAAgB,aAC5BA,EAAY,YAAiB,gBAC7BA,EAAY,SAAc,UAC9B,GAAGA,KAAgBA,GAAc,CAAA,EAAG,ECpd7B,MAAMC,CAAsB,CAC/B,aAAc,CACV,KAAK,eAAiB,CACzB,CACD,yBAAyBC,EAAMC,EAAaC,EAAe,CACvD,IAAIC,EAAS,EACb,CAACH,EAAMC,EAAaE,CAAM,EAAI,KAAK,cAAcH,EAAMC,EAAaC,CAAa,EACjF,QAAS,EAAI,EAAG,EAAI,KAAK,yBAAyB,iBAAiB,OAAQ,IACvE,GAAI,KAAK,yBAAyB,iBAAiB,CAAC,EAAE,OAASF,EAC3D,OAGR,KAAK,yBAAyB,iBAAiB,KAAK,CAChD,KAAAA,EACA,KAAMC,EACN,OAAAE,CACZ,CAAS,CACJ,CACD,mBAAoB,CAChB,GAAI,CAAC,KAAK,yBAAyB,iBAAiB,OAChD,MAAO,GAEX,MAAMH,EAAOD,EAAsB,iBACnC,IAAIK,EAAe,KAAK,yBAAyB,iBAAiBJ,CAAI,EACtE,OAAKI,IACDA,EAAe,CACX,QAAS,KAAK,yBAAyB,sBAAuB,CAC9E,EACY,KAAK,yBAAyB,iBAAiBJ,CAAI,EAAII,EACvD,KAAK,6BAA6BJ,EAAMI,EAAc,UAA2D,EAAI,EACrH,KAAK,6BAA6BJ,EAAMI,EAAc,UAA2D,EAAK,GAEnH,KAAK,yBAAyBJ,EAAMI,CAAY,CAC1D,CACD,sBAAuB,CAEnB,QAASpD,EAAI,EAAGA,EAAI,KAAK,yBAAyB,uBAAuB,OAAQA,IAAK,CAClF,MAAMqD,EAAgB,KAAK,yBAAyB,uBAAuBrD,CAAC,EAC5E,GAAIqD,IAAkB,OAAW,CAC7B,KAAK,yBAAyB,uBAAuBrD,CAAC,EAAI,CAAA,EAC1D,QACH,CACD,QAASsD,EAAI,EAAGA,EAAID,EAAc,OAAQC,IAAK,CAC3C,MAAMC,EAAQ,KAAK,yBAAyB,uBAAuBvD,CAAC,EAAEsD,CAAC,EACjEN,EAAO,KAAK,yBAAyB,yBAAyBhD,CAAC,EAAEuD,EAAM,OAAO,EAAE,KAChFC,EAAuB,KAAK,yBAAyB,yBAAyBxD,CAAC,EAAEuD,EAAM,OAAO,EAAE,qBAClGA,IACIA,EAAM,SAAWA,EAAM,iBAAmBA,EAAM,eAChD,KAAK,yBAAyB,aAAa,KAAKC,CAAoB,EAE/DD,EAAM,QACX,KAAK,yBAAyB,aAAa,KAAKP,CAAI,EAE/CO,EAAM,QACX,KAAK,yBAAyB,YAAY,KAAKP,CAAI,EAG9D,CACJ,CACJ,CACD,4BAA6B,CACzB,MAAMS,EAAmB,KAAK,yBAAyB,iBACvD,QAASzD,EAAI,EAAGA,EAAI,KAAK,yBAAyB,uBAAuB,OAAQA,IAAK,CAClF,MAAMqD,EAAgB,KAAK,yBAAyB,uBAAuBrD,CAAC,EACtE0D,EAAU,CAAA,EAChB,QAASJ,EAAI,EAAGA,EAAID,EAAc,OAAQC,IAAK,CAC3C,MAAMC,EAAQ,KAAK,yBAAyB,uBAAuBvD,CAAC,EAAEsD,CAAC,EACnEC,EAAM,SAAWA,EAAM,SAAWA,EAAM,gBAAkBA,EAAM,gBAChEG,EAAQ,KAAK,CACT,QAASH,EAAM,QACf,SAAU,MAClC,CAAqB,EAEIA,EAAM,QACXG,EAAQ,KAAK,CACT,QAASH,EAAM,QACf,SAAU,CACN,OAAQ,OACR,OAAQ,EACR,KAAM,CACT,CACzB,CAAqB,CAER,CACDE,EAAiBzD,CAAC,EAAI0D,CACzB,CACJ,CACD,8BAA8BV,EAAMW,EAAaC,EAAcC,EAAW1E,EAAQ2E,EAAU,CAExF,GAAI,CAAE,WAAAC,EAAY,aAAAC,CAAY,EAAKL,EAAY,SAASC,CAAY,EAKpE,GAJK,KAAK,yBAAyB,uBAAuBG,CAAU,IAChE,KAAK,yBAAyB,uBAAuBA,CAAU,EAAI,CAAA,EACnE,KAAK,yBAAyB,yBAAyBA,CAAU,EAAI,CAAA,GAErE,CAAC,KAAK,yBAAyB,yBAAyBA,CAAU,EAAEC,CAAY,EAAG,CACnF,IAAIC,EACAJ,IAAc,KACdI,EAAM,KAAK,yBAAyB,uBAAuBF,CAAU,EAAE,KAAK,CACxE,QAASC,EACT,WAAY,EACZ,gBAAiB,CAAE,CACvC,CAAiB,EAEI7E,EACL8E,EAAM,KAAK,yBAAyB,uBAAuBF,CAAU,EAAE,KAAK,CACxE,QAASC,EACT,WAAY,EACZ,eAAgB,CACZ,OAAQ,aACR,OAAA7E,EACA,cAAe0E,CAClB,CACrB,CAAiB,EAGDI,EAAM,KAAK,yBAAyB,uBAAuBF,CAAU,EAAE,KAAK,CACxE,QAASC,EACT,WAAY,EACZ,QAAS,CACL,WAAYL,EAAY,WACxB,cAAeE,EACf,aAAc,EACjB,CACrB,CAAiB,EAEL,MAAMK,EAAcP,EAAY,eAAiBX,EAAOY,EAAeZ,EACvE,KAAK,yBAAyB,yBAAyBe,CAAU,EAAEC,CAAY,EAAI,CAAE,KAAAhB,EAAM,MAAOiB,EAAM,EAAG,qBAAsBC,CAAW,CAC/I,CACDF,EAAe,KAAK,yBAAyB,yBAAyBD,CAAU,EAAEC,CAAY,EAAE,MAC5FF,EACA,KAAK,yBAAyB,uBAAuBC,CAAU,EAAEC,CAAY,EAAE,YAAc,EAG7F,KAAK,yBAAyB,uBAAuBD,CAAU,EAAEC,CAAY,EAAE,YAAc,CAEpG,CACD,8BAA8BhB,EAAMmB,EAAaL,EAAU,CAEvD,GAAI,CAAE,WAAAC,EAAY,aAAAC,GAAiBG,EAAY,QAK/C,GAJK,KAAK,yBAAyB,uBAAuBJ,CAAU,IAChE,KAAK,yBAAyB,uBAAuBA,CAAU,EAAI,CAAA,EACnE,KAAK,yBAAyB,yBAAyBA,CAAU,EAAI,CAAA,GAErE,CAAC,KAAK,yBAAyB,yBAAyBA,CAAU,EAAEC,CAAY,EAAG,CACnF,MAAMC,EAAM,KAAK,yBAAyB,uBAAuBF,CAAU,EAAE,KAAK,CAC9E,QAASC,EACT,WAAY,EACZ,QAAS,CACL,KAAMG,EAAY,IACrB,CACjB,CAAa,EACD,KAAK,yBAAyB,yBAAyBJ,CAAU,EAAEC,CAAY,EAAI,CAAE,KAAAhB,EAAM,MAAOiB,EAAM,CAAC,CAC5G,CACDD,EAAe,KAAK,yBAAyB,yBAAyBD,CAAU,EAAEC,CAAY,EAAE,MAC5FF,EACA,KAAK,yBAAyB,uBAAuBC,CAAU,EAAEC,CAAY,EAAE,YAAc,EAG7F,KAAK,yBAAyB,uBAAuBD,CAAU,EAAEC,CAAY,EAAE,YAAc,CAEpG,CACD,6BAA6BhB,EAAMoB,EAAmBC,EAAYP,EAAU,CAExE,GAAI,CAAE,WAAAC,EAAY,aAAAC,GAAiBI,EAAkB,QAKrD,GAJK,KAAK,yBAAyB,uBAAuBL,CAAU,IAChE,KAAK,yBAAyB,uBAAuBA,CAAU,EAAI,CAAA,EACnE,KAAK,yBAAyB,yBAAyBA,CAAU,EAAI,CAAA,GAErE,CAAC,KAAK,yBAAyB,yBAAyBA,CAAU,EAAEC,CAAY,EAAG,CACnF,MAAMC,EAAM,KAAK,yBAAyB,uBAAuBF,CAAU,EAAE,KAAK,CAC9E,QAASC,EACT,WAAY,EACZ,OAAQ,CACJ,KAAMK,CACT,CACjB,CAAa,EACD,KAAK,yBAAyB,yBAAyBN,CAAU,EAAEC,CAAY,EAAI,CAAE,KAAAhB,EAAM,MAAOiB,EAAM,CAAC,CAC5G,CACDD,EAAe,KAAK,yBAAyB,yBAAyBD,CAAU,EAAEC,CAAY,EAAE,MAC5FF,EACA,KAAK,yBAAyB,uBAAuBC,CAAU,EAAEC,CAAY,EAAE,YAAc,EAG7F,KAAK,yBAAyB,uBAAuBD,CAAU,EAAEC,CAAY,EAAE,YAAc,CAEpG,CACL,CACAjB,EAAsB,iBAAmB,WACzCA,EAAsB,iBAAmB,YACzCA,EAAsB,aAAe,CAEjC,KAAM,EACN,IAAK,EACL,MAAO,EACP,KAAM,EACN,MAAO,EACP,MAAO,EACP,KAAM,EACN,MAAO,EACP,MAAO,EACP,KAAM,EACN,MAAO,EACP,MAAO,EACP,KAAM,EACN,KAAM,GACN,KAAM,GAEN,IAAK,EACL,IAAK,EACL,IAAK,EACL,OAAQ,EACR,OAAQ,GACR,OAAQ,GACR,QAAS,EACT,QAAS,GACT,QAAS,GACT,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,EACP,MAAO,CACX,EAEAA,EAAsB,mCAAqC,CACvD,UAAW,YACX,eAAgB,iBAChB,gBAAiB,kBACjB,qBAAsB,uBACtB,YAAa,cACb,UAAW,WACf,EAEAA,EAAsB,+BAAiC,CACnD,UAAW,YACX,eAAgB,iBAChB,gBAAiB,YACjB,qBAAsB,iBACtB,YAAa,cACb,iBAAkB,mBAClB,UAAW,WACf,EAEAA,EAAsB,4CAA8C,CAChE,YAAa,OACb,iBAAkB,aAClB,UAAW,KACX,eAAgB,WAChB,UAAW,IACf,EAGAA,EAAsB,+BAAiC,CACnD,gBAAiB,gBACjB,qBAAsB,eAC1B,EAEAA,EAAsB,wCAA0C,CAC5D,cAAe,GACf,mBAAoB,GACpB,QAAS,EACb,ECzQO,MAAMuB,EAAsB,CAC/B,IAAI,SAAU,CACV,MAAO,EACV,CACD,IAAI,SAAU,CACV,MAAI,OAAK,MAIZ,CACD,YAAYC,EAAyBC,EAAQ,CAEzC,KAAK,iBAAmB,GACxB,KAAK,MAAQ,UACb,KAAK,wBAA0BD,EAC/B,KAAK,wBAA0B,GAC/B,KAAK,OAASC,EACd,KAAK,uBAAyB,EACjC,CACD,gCAAiC,CAEhC,CACD,uBAAuBC,EAAQC,EAAqBC,EAAeC,EAAUC,EAAaC,EAAUC,EAAiBC,EAAY,CAC7H,MAAMR,EAAS,KAAK,OAChBA,EAAO,0BACPC,EAAO,oBAAsB,GAC7BA,EAAO,kBAAoB,IAE/B,MAAMQ,EAAgB,KAAK,wBAAwB,kBACnD,IAAIC,EACJ,IAAKA,EAAQ,EAAGA,EAAQL,EAAY,OAAQK,IAAS,CACjD,MAAMlC,EAAO6B,EAAYK,CAAK,EACxBC,EAAUF,EAAcJ,EAAYK,CAAK,CAAC,EAC5CC,GAAW,MAAQA,GAAW,MAC9BN,EAAY,OAAOK,EAAO,CAAC,EAC3BA,KAGAJ,EAAS9B,CAAI,EAAIkC,CAExB,CACD,UAAWE,KAAQZ,EAAO,cAAc,KAAMO,CAAe,EACzDC,EAAW,KAAKI,CAAI,EAGxB,KAAK,mBAAkB,EACvB,MAAMC,EAA2B,CAAA,EAC3BC,EAA+B,CAAA,EACrC,IAAKJ,EAAQ,EAAGA,EAAQH,EAAgB,OAAQG,IAAS,CACrD,MAAMK,EAAWP,EAAWE,CAAK,EAC7BK,GAAY,IACZF,EAAyB,KAAKN,EAAgBG,CAAK,CAAC,EACpDI,EAA6B,KAAKC,CAAQ,EAEjD,CACD,KAAK,wBAAwB,yBAA2BF,EACxD,KAAK,wBAAwB,6BAA+BC,CAC/D,CAKD,oBAAqB,CACjB,GAAK,KAAK,wBAAwB,iBAAiB,OAGnD,MAAK,eAAe,UACpB,KAAK,cAAgB,IAAIE,GAAc,KAAK,OAAQ,OAAW,OAAW,YAAc,KAAK,KAAK,EAClG,UAAWC,KAAmB,KAAK,wBAAwB,iBAAkB,CACzE,MAAMnG,EAAOmG,EAAgB,KAAK,QAAQ,iBAAkB,IAAI,EAC1DC,EAAO3C,EAAsB,aAAazD,CAAI,EACpD,KAAK,cAAc,WAAWmG,EAAgB,KAAMC,EAAMD,EAAgB,MAAM,EAChF,KAAK,wBAAwBA,EAAgB,IAAI,EAAIA,EAAgB,IACxE,CACD,KAAK,cAAc,SACtB,CACD,UAAUjB,EAAQ,CACd,KAAK,OAASA,CACjB,CAID,SAAU,CACF,KAAK,eACL,KAAK,cAAc,SAE1B,CAMD,OAAOmB,EAAaC,EAAO,CACnB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBD,CAAW,GAGpE,KAAK,cAAc,UAAUA,EAAaC,CAAK,CAClD,CAOD,QAAQD,EAAaE,EAAGC,EAAG,CACnB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBH,CAAW,GAGpE,KAAK,cAAc,WAAWA,EAAaE,EAAGC,CAAC,CAClD,CAQD,QAAQH,EAAaE,EAAGC,EAAGC,EAAG,CACtB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBJ,CAAW,GAGpE,KAAK,cAAc,WAAWA,EAAaE,EAAGC,EAAGC,CAAC,CACrD,CASD,QAAQJ,EAAaE,EAAGC,EAAGC,EAAGC,EAAG,CACzB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBL,CAAW,GAGpE,KAAK,cAAc,WAAWA,EAAaE,EAAGC,EAAGC,EAAGC,CAAC,CACxD,CAMD,YAAYL,EAAaM,EAAO,CACxB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBN,CAAW,GAGpE,KAAK,cAAc,eAAeA,EAAaM,CAAK,CACvD,CAMD,aAAaN,EAAaM,EAAO,CAC7B,KAAK,YAAYN,EAAaM,CAAK,CACtC,CAMD,aAAaN,EAAaM,EAAO,CAC7B,KAAK,YAAYN,EAAaM,CAAK,CACtC,CAMD,aAAaN,EAAaM,EAAO,CAC7B,KAAK,YAAYN,EAAaM,CAAK,CACtC,CAMD,QAAQN,EAAaC,EAAO,CACpB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBD,CAAW,GAGpE,KAAK,cAAc,WAAWA,EAAaC,CAAK,CACnD,CAOD,SAASD,EAAaE,EAAGC,EAAG,CACpB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBH,CAAW,GAGpE,KAAK,cAAc,YAAYA,EAAaE,EAAGC,CAAC,CACnD,CAQD,SAASH,EAAaE,EAAGC,EAAGC,EAAG,CACvB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBJ,CAAW,GAGpE,KAAK,cAAc,YAAYA,EAAaE,EAAGC,EAAGC,CAAC,CACtD,CASD,SAASJ,EAAaE,EAAGC,EAAGC,EAAGC,EAAG,CAC1B,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBL,CAAW,GAGpE,KAAK,cAAc,YAAYA,EAAaE,EAAGC,EAAGC,EAAGC,CAAC,CACzD,CAMD,aAAaL,EAAaM,EAAO,CACzB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBN,CAAW,GAGpE,KAAK,cAAc,gBAAgBA,EAAaM,CAAK,CACxD,CAMD,cAAcN,EAAaM,EAAO,CAC9B,KAAK,aAAaN,EAAaM,CAAK,CACvC,CAMD,cAAcN,EAAaM,EAAO,CAC9B,KAAK,aAAaN,EAAaM,CAAK,CACvC,CAMD,cAAcN,EAAaM,EAAO,CAC9B,KAAK,aAAaN,EAAaM,CAAK,CACvC,CAMD,SAASN,EAAaM,EAAO,CACrB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBN,CAAW,GAGpE,KAAK,cAAc,YAAYA,EAAaM,CAAK,CACpD,CAMD,UAAUN,EAAaM,EAAO,CAC1B,KAAK,SAASN,EAAaM,CAAK,CACnC,CAMD,UAAUN,EAAaM,EAAO,CAC1B,KAAK,SAASN,EAAaM,CAAK,CACnC,CAMD,UAAUN,EAAaM,EAAO,CAC1B,KAAK,SAASN,EAAaM,CAAK,CACnC,CAMD,YAAYN,EAAaO,EAAU,CAC3B,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBP,CAAW,GAGpE,KAAK,cAAc,eAAeA,EAAaO,CAAQ,CAC1D,CAMD,UAAUP,EAAaQ,EAAQ,CACvB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBR,CAAW,GAGpE,KAAK,cAAc,aAAaA,EAAaQ,CAAM,CACtD,CAMD,aAAaR,EAAaQ,EAAQ,CAC1B,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBR,CAAW,GAGpE,KAAK,cAAc,gBAAgBA,EAAaQ,CAAM,CACzD,CAMD,aAAaR,EAAaQ,EAAQ,CAC1B,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBR,CAAW,GAGpE,KAAK,cAAc,gBAAgBA,EAAaQ,CAAM,CACzD,CAMD,SAASR,EAAaC,EAAO,CACrB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBD,CAAW,GAGpE,KAAK,cAAc,YAAYA,EAAaC,CAAK,CACpD,CAMD,WAAWD,EAAaS,EAAS,CAC7B,KAAK,UAAUT,EAAaS,EAAQ,EAAGA,EAAQ,CAAC,CACnD,CAOD,UAAUT,EAAaE,EAAGC,EAAG,CACrB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBH,CAAW,GAGpE,KAAK,cAAc,aAAaA,EAAaE,EAAGC,CAAC,CACpD,CAMD,WAAWH,EAAaU,EAAS,CAC7B,KAAK,UAAUV,EAAaU,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,CAAC,CAC9D,CAQD,UAAUV,EAAaE,EAAGC,EAAGC,EAAG,CACxB,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBJ,CAAW,GAGpE,KAAK,cAAc,aAAaA,EAAaE,EAAGC,EAAGC,CAAC,CACvD,CAMD,WAAWJ,EAAaW,EAAS,CAC7B,KAAK,UAAUX,EAAaW,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,EAAGA,EAAQ,CAAC,CACzE,CAMD,cAAcX,EAAaY,EAAY,CACnC,KAAK,UAAUZ,EAAaY,EAAW,EAAGA,EAAW,EAAGA,EAAW,EAAGA,EAAW,CAAC,CACrF,CASD,UAAUZ,EAAaE,EAAGC,EAAGC,EAAGC,EAAG,CAC3B,CAAC,KAAK,eAAiB,CAAC,KAAK,wBAAwBL,CAAW,GAGpE,KAAK,cAAc,aAAaA,EAAaE,EAAGC,EAAGC,EAAGC,CAAC,CAC1D,CAMD,UAAUL,EAAaa,EAAQ,CAC3B,KAAK,UAAUb,EAAaa,EAAO,EAAGA,EAAO,EAAGA,EAAO,CAAC,CAC3D,CAOD,UAAUb,EAAaa,EAAQC,EAAO,CAClC,KAAK,UAAUd,EAAaa,EAAO,EAAGA,EAAO,EAAGA,EAAO,EAAGC,CAAK,CAClE,CAMD,gBAAgBd,EAAae,EAAQ,CACjC,KAAK,UAAUf,EAAae,EAAO,EAAGA,EAAO,EAAGA,EAAO,EAAGA,EAAO,CAAC,CACrE,CACD,sBAAuB,CACnB,OAAO,KAAK,SAAS,MACxB,CACD,wBAAyB,CACrB,OAAO,KAAK,SAAS,QACxB,CACL,CCpcA,MAAMC,GAAa,EACbC,GAAuB,MAEvBC,GAAsB,CAExB,KAAM,EACN,KAAM,EACN,KAAM,EAEN,OAAQ,EACR,OAAQ,EACR,OAAQ,CACZ,EAIO,MAAMC,CAA8B,CACvC,WAAW,WAAY,CACnB,OAAOA,EAA8B,yBAA2BA,EAA8B,qBAAuBA,EAA8B,UACtJ,CACD,YAAYC,EAAgBC,EAAW,GAAO,CAC1C,KAAK,qCAAuC,GAC5C,KAAK,eAAiBD,EACtB,KAAK,uBAAyB,EAC9B,KAAK,qBAAuB,EAC5B,KAAK,eAAiB,EACtB,KAAK,iBAAmB,EACxB,KAAK,kBAAoB,GACzB,KAAK,oBAAsB,GAC3B,KAAK,iBAAmB,GACxB,KAAK,kBAAoB,GACzB,KAAK,kBAAoB,GACzB,KAAK,kBAAoB,GACzB,KAAK,uBAAyB,GAC9B,KAAK,yBAA2B,GAChC,KAAK,iBAAmB,GACxB,KAAK,YAAc,GACnB,KAAK,aAAe,GACpB,KAAK,aAAe,GACpB,KAAK,iBAAmB,GACnBC,GACD,KAAK,0BAAyB,CAErC,CACD,2BAA4B,CACxB,MAAMC,EAAYH,EAA8B,UAC1CI,EAAS,CAAA,EACf,UAAWlE,KAAQiE,EAAW,CAC1B,MAAME,EAAUF,EAAUjE,CAAI,EAAE,QAC5BmE,EAAQ,aAAe,KAGvBD,EAAOC,EAAQ,UAAU,IAAM,OAC/BD,EAAOC,EAAQ,UAAU,EAAIA,EAAQ,aAGrCD,EAAOC,EAAQ,UAAU,EAAI,KAAK,IAAID,EAAOC,EAAQ,UAAU,EAAGA,EAAQ,YAAY,EAE7F,CACD,KAAK,eAAiBD,EAAO,OAAS,EAClC,KAAK,iBAAmB,GACxB,KAAK,iBACL,KAAK,iBAAmB,GAGxB,KAAK,iBAAmBA,EAAOA,EAAO,OAAS,CAAC,EAAI,CAE3D,CACD,yBAAyBE,EAAUC,EAAc,EAAG,CAChD,MAAMnC,EAAQ,KAAK,uBACnB,YAAK,yBAA2B2B,GAAoBO,CAAQ,GAAK,IAAMC,GAAe,GAC/EnC,CACV,CACD,uBAAuBkC,EAAUC,EAAc,EAAG,CAC9C,MAAMnC,EAAQ,KAAK,qBACnB,YAAK,uBAAyB2B,GAAoBO,CAAQ,GAAK,IAAMC,GAAe,GAC7EnC,CACV,CACD,uBAAwB,CACpB,OAAO,KAAK,oBAAoB,CAAC,CACpC,CACD,oBAAoBoC,EAAc,CAK9B,GAJI,KAAK,iBAAmBV,GAAuBU,IAC/C,KAAK,iBACL,KAAK,iBAAmB,GAExB,KAAK,iBAAmBX,GAExB,KAAM,kFAEV,MAAMY,EAAc,CAChB,WAAY,KAAK,eACjB,aAAc,KAAK,gBAC/B,EACQ,YAAK,kBAAoBD,EAClBC,CACV,CACL,CAEAT,EAA8B,yBAA2B,GAEzDA,EAA8B,qBAAuB,CACjD,MAAO,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACtD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,OAAQ,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,QAAS,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC1D,SAAU,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EAC3D,KAAM,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,EACvD,UAAW,CAAE,QAAS,CAAE,WAAY,GAAI,aAAc,GAAM,CAChE,EACAA,EAA8B,WAAa,CACvC,MAAO,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACtD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,OAAQ,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACvD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,QAAS,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,GAAM,EACzD,SAAU,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACzD,KAAM,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,EACrD,UAAW,CAAE,QAAS,CAAE,WAAY,EAAG,aAAc,EAAK,CAC9D,ECxKO,SAASU,EAAsBC,EAAYC,EAAaC,EAAOC,EAAY,CAC9E,IAAIC,EAAUD,EAAYE,EAAc,EAAGC,EAAc,GACzD,KAAOF,EAAUF,EAAM,QAAQ,CAC3B,MAAMK,EAAWL,EAAM,OAAOE,CAAO,EACrC,GAAKE,EA2BGC,IAAaD,EACTA,IAAgB,KAAOA,IAAgB,IACvCJ,EAAM,OAAOE,EAAU,CAAC,IAAM,OAASE,EAAc,IAGrDA,EAAc,GAGbA,IAAgB,MAAQC,IAAa,KAAOH,EAAU,EAAIF,EAAM,SACrEA,EAAM,OAAOE,EAAU,CAAC,IAAM,MAAQE,EAAc,IAChDA,IAAgB,IAChBF,SArCR,QAAQG,EAAQ,CACZ,KAAKP,EACDK,IACA,MACJ,KAAKJ,EACDI,IACA,MACJ,IAAK,IACL,IAAK,IACL,IAAK,IACDC,EAAcC,EACd,MACJ,IAAK,IACD,GAAIH,EAAU,EAAIF,EAAM,OAAQ,CAC5B,MAAMM,EAAWN,EAAM,OAAOE,EAAU,CAAC,EACrCI,IAAa,IACbF,EAAc;AAAA,EAETE,IAAa,MAClBF,EAAc,KAErB,CACD,KACP,CAmBL,GADAF,IACIC,IAAgB,EAChB,KAEP,CACD,OAAOA,IAAgB,EAAID,EAAU,EAAI,EAC7C,CAOO,SAASK,GAAgB,EAAGhD,EAAO,CACtC,KAAOA,EAAQ,EAAE,QAAQ,CACrB,MAAMiD,EAAI,EAAEjD,CAAK,EACjB,GAAIiD,IAAM,KAAOA,IAAM;AAAA,GAAQA,IAAM,MAAQA,IAAM,KAAQA,IAAM;AAAA,GAAYA,IAAM,IAC/E,MAEJjD,GACH,CACD,OAAOA,CACX,CAMO,SAASkD,GAAiBD,EAAG,CAChC,MAAME,EAAIF,EAAE,WAAW,CAAC,EACxB,OAASE,GAAK,IAAMA,GAAK,IACpBA,GAAK,IAAMA,GAAK,IAChBA,GAAK,IAAMA,GAAK,KACjBA,GAAK,EACb,CAMO,SAASC,GAAeX,EAAO,CAClC,IAAIE,EAAU,EAAGE,EAAc,GAAIQ,EAAa,GAChD,MAAMC,EAAI,CAAA,EACV,KAAOX,EAAUF,EAAM,QAAQ,CAC3B,MAAMK,EAAWL,EAAM,OAAOE,CAAO,EACrC,GAAKE,EA0BGC,IAAaD,EACTA,IAAgB,KAAOA,IAAgB,KACvCJ,EAAM,OAAOE,EAAU,CAAC,IAAM,OAASE,EAAc,IACrDS,EAAE,KAAKR,CAAQ,IAGfD,EAAc,GACdQ,EAAa,IAGZR,IAAgB,MAAQC,IAAa,KAAOH,EAAU,EAAIF,EAAM,QACrEA,EAAM,OAAOE,EAAU,CAAC,IAAM,MAAQE,EAAc,IAChDA,IAAgB,KAChBQ,EAAa,GACbV,MAICU,GACDC,EAAE,KAAKR,CAAQ,MA7CT,CACd,OAAQA,EAAQ,CACZ,IAAK,IACL,IAAK,IACL,IAAK,IACDD,EAAcC,EACd,MACJ,IAAK,IACD,GAAIH,EAAU,EAAIF,EAAM,OAAQ,CAC5B,MAAMM,EAAWN,EAAM,OAAOE,EAAU,CAAC,EACrCI,IAAa,KACbF,EAAc;AAAA,EACdQ,EAAa,IAERN,IAAa,MAClBF,EAAc,KACdQ,EAAa,GAEpB,CACD,KACP,CACIA,GACDC,EAAE,KAAKR,CAAQ,CAEtB,CAyBDH,GACH,CACD,OAAOW,EAAE,KAAK,EAAE,CACpB,CASO,SAASC,GAAa,EAAGvD,EAAOiD,EAAGO,EAAI,CAC1C,KAAOxD,GAAS,GAAK,EAAE,OAAOA,CAAK,IAAMiD,GAAa,EAAE,OAAOjD,CAAK,IAAMwD,GACtExD,IAEJ,OAAOA,CACX,CAMO,SAASyD,GAAa,EAAG,CAC5B,OAAO,EAAE,QAAQ,sBAAuB,MAAM,CAClD,CAWO,SAASC,GAA4BC,EAAMC,EAAcC,EAAcC,EAAY,CACtF,IAAIC,EAAMJ,EAAK,QAAQC,CAAY,EACnC,GAAIG,EAAM,EACN,OAAOJ,EAEX,GAAIE,EAAc,CAEd,KAAOE,IAAQJ,EAAK,QAAUA,EAAK,OAAOI,CAAG,GAAK,KAAK,CACvD,GAAIA,EAAMJ,EAAK,OAAQ,CACnB,MAAMK,EAAQL,EAAK,UAAU,EAAGI,EAAM,CAAC,EACjCE,EAAQN,EAAK,UAAUI,EAAM,CAAC,EACpCJ,EAAOK,EAAQH,EAAeI,CACjC,CACJ,CACD,GAAIH,EAAY,CACZ,MAAMI,EAAmBP,EAAK,YAAY,GAAG,EAC7CA,EAAOA,EAAK,UAAU,EAAGO,CAAgB,EACzCP,GAAQG,EAAa;AAAA,EACxB,CACD,OAAOH,CACX,CCtMO,MAAMQ,WAAkCtG,CAAsB,CACjE,aAAc,CACV,MAAM,GAAG,SAAS,EAClB,KAAK,iBAAmB,GACxB,KAAK,wBAA0B,GAC/B,KAAK,eAAiB,GACtB,KAAK,iBAAmB,GACxB,KAAK,eAAiB,EACtB,KAAK,WAAa,EACrB,CACD,cAAcC,EAAM1D,EAAM4D,EAAe,CACrC,IAAIC,EAAS,EACb,MAAMmG,EAAatG,EAAK,QAAQ,GAAG,EAC7BuG,EAAWvG,EAAK,QAAQ,GAAG,EACjC,GAAIsG,EAAa,GAAKC,EAAW,EAAG,CAChC,MAAMC,EAAiBxG,EAAK,UAAUsG,EAAa,EAAGC,CAAQ,EAC9DpG,EAAS,CAACqG,EACN,MAAMrG,CAAM,IACZA,EAAS,CAACD,EAAcsG,EAAe,KAAM,CAAA,GAEjDxG,EAAOA,EAAK,UAAU,EAAGsG,CAAU,CACtC,CACD,MAAO,CAACtG,EAAM1D,EAAM6D,CAAM,CAC7B,CACD,kBAAkBsG,EAAmB,CACjC,KAAK,yBAA2BA,EAChC,KAAK,iBAAiB,OAAS,EAC/B,KAAK,wBAAwB,OAAS,EACtC,KAAK,qBAAuB,OAC5B,KAAK,yBAA2B,OAChC,KAAK,2BAA6B,MACrC,CACD,qBAAqBZ,EAAMa,EAAY,CACnC,MAAMC,EAAgB;AAAA,UAA6B5G,EAAsB,gBAAgB;AAAA;AAAA;AAAA;AAAA,EACnF6G,EAAkBf,EAAK,QAAQ,kBAAkB,IAAM,GAC7D,OAAIa,GACA,KAAK,iBAAmBb,EAAK,QAAQ,YAAY,IAAM,GACnD,KAAK,mBACL,KAAK,2BAA6B,MAE/Be,EAAkBf,EAAOc,EAAgB;AAAA,EAAqBd,IAEzE,KAAK,eAAiBA,EAAK,QAAQ,YAAY,IAAM,GACjD,KAAK,iBACL,KAAK,qBAAuB,KAC5B,KAAK,yBAA2B,OAE7Be,EAAkBf,EAAOc,EAAgBd,EACnD,CACD,aAAagB,EAASH,EAAY,CAC9B,MAAMI,EAAW,sBACXC,EAAU,qBACVC,EAAe,0BAErB,OADcN,GAAc,KAAK,iBAAmBK,EAAU,CAACL,GAAc,KAAK,eAAiBI,EAAWE,GACjG,KAAKH,CAAO,CAC5B,CACD,iBAAiBA,EAASH,EAAYxG,EAAe,CACjD,KAAK,eAAiBA,EACtB,MAAM4G,EAAW,oEACXC,EAAU,mEACVC,EAAe,wEAEfC,GADQP,GAAc,KAAK,iBAAmBK,EAAU,CAACL,GAAc,KAAK,eAAiBI,EAAWE,GAC1F,KAAKH,CAAO,EAChC,GAAII,IAAU,KAAM,CAChB,MAAMC,EAAyBD,EAAM,CAAC,GAAK,GACrCE,EAAcF,EAAM,CAAC,EACrBjH,EAAOiH,EAAM,CAAC,EACpB,IAAI1E,EACAmE,GACAnE,EAAW,KAAK,yBAAyB,kBAAkBvC,CAAI,EAC/D,KAAK,iBAAiBuC,CAAQ,EAAI,GAC9BA,IAAa,QACbrF,EAAO,KAAK,+CAA+C8C,CAAI,2EAA2E,IAI9IuC,EAAW,KAAK,yBAAyB,uBAAuB4E,EAAa,KAAK,cAAcnH,EAAMmH,EAAajH,CAAa,EAAE,CAAC,CAAC,EACpI,KAAK,yBAAyB,kBAAkBF,CAAI,EAAIuC,EACxD,KAAK,iBAAiBA,CAAQ,EAAI,qBAAqBA,CAAQ,KAAK2E,CAAsB,OAAOC,CAAW,IAAInH,CAAI,KAExH6G,EAAUA,EAAQ,QAAQI,EAAM,CAAC,EAAG1E,IAAa,OAAY,GAAK,qBAAqBA,CAAQ,KAAK2E,CAAsB,IAAIR,EAAa,KAAO,KAAK,IAAIS,CAAW,IAAInH,CAAI,GAAG,CACpL,CACD,OAAO6G,CACV,CACD,mBAAmBO,EAAWlH,EAAe,CACzC,KAAK,eAAiBA,EACtB,MAAM6G,EAAU,8BACVM,EAAc,qCAEdJ,GADQ,KAAK,eAAiBF,EAAUM,GAC1B,KAAKD,CAAS,EAClC,GAAIH,IAAU,KAAM,CAChB,MAAMK,EAAgBL,EAAM,CAAC,EACvBjH,EAAOiH,EAAM,CAAC,EACd1E,EAAW,KAAK,yBAAyB,yBAAyB+E,EAAe,KAAK,cAActH,EAAMsH,EAAepH,CAAa,EAAE,CAAC,CAAC,EAChJ,KAAK,yBAAyB,oBAAoBF,CAAI,EAAIuC,EAC1D,KAAK,yBAAyB,kBAAkBA,CAAQ,EAAIvC,EAC5D,MAAMuH,EAAgB,KAAK,yBAAyB,qCAAqCvH,CAAI,EAC7F,GAAIuH,IAAkB,OAAW,CAE7B,MAAMC,EAAUD,EAAgB,EAAKA,IAAkB,GAAK,MAAQ,OAAS,CAACA,EAAiBA,IAAkB,EAAI,OAAS,OAASA,EACjIE,EAAU,QAAQzH,CAAI,IAC5BoH,EAAYA,EAAU,QAAQH,EAAM,CAAC,EAAG,qBAAqB1E,CAAQ,QAAQiF,CAAO,IAAIC,CAAO,KAAKH,CAAa,IAAItH,CAAI,MAAMsH,CAAa,IAAIG,CAAO,IAAI,CAC9J,MAEGL,EAAYA,EAAU,QAAQH,EAAM,CAAC,EAAG,qBAAqB1E,CAAQ,QAAQ+E,CAAa,IAAItH,CAAI,GAAG,CAE5G,CACD,OAAOoH,CACV,CACD,iBAAiBM,EAAShB,EAAYxG,EAAe,CACjD,KAAK,eAAiBA,EAEtB,MAAM+G,EADe,8DACM,KAAKS,CAAO,EACvC,GAAIT,IAAU,KAAM,CAChB,IAAIhH,EAAcgH,EAAM,CAAC,EACrBjH,EAAOiH,EAAM,CAAC,EAClB,GAAIhH,EAAY,QAAQ,SAAS,IAAM,GAAKA,EAAY,QAAQ,SAAS,IAAM,EAAG,CAC9E,IAAI0H,EAAY,EAChB,CAAC3H,EAAMC,EAAa0H,CAAS,EAAI,KAAK,cAAc3H,EAAMC,EAAaC,CAAa,EACpF,IAAIS,EAAc,KAAK,yBAAyB,kBAAkBX,CAAI,EACtE,GAAI,CAACW,EAAa,CACdA,EAAc,CACV,gBAAiB,GACjB,eAAgBgH,EAAY,EAC5B,iBAAkB,GAClB,SAAU,CAAE,EACZ,WAAY,OACpC,EACoB,QAAS3K,EAAI,EAAGA,GAAK2K,GAAa,GAAI,EAAE3K,EACpC2D,EAAY,SAAS,KAAK,KAAK,yBAAyB,sBAAqB,CAAE,CAEtF,CACD,MAAMiH,EAAc7H,EAAsB,+BAA+BE,CAAW,GAAK,UACnF4H,EAAsB,CAAC,CAAC9H,EAAsB,wCAAwC6H,CAAW,EACjGE,EAAqBD,EAAsB,aAAmE,YAC9GE,EAAc/H,EAAO,UAC3B,IAAImB,EAAc,KAAK,yBAAyB,kBAAkB4G,CAAW,EACxE5G,IACDA,EAAc,CACV,QAAS,KAAK,yBAAyB,sBAAuB,EAC9D,KAAM2G,CAC9B,GAEgB,MAAME,EAAgB/H,EAAY,OAAO,CAAC,IAAM,IAAM,IAAMA,EAAY,OAAO,CAAC,IAAM,IAAM,IAAM,GAC9F+H,IACA/H,EAAcA,EAAY,UAAU,CAAC,GAEzC,MAAMgI,EAAaJ,EACb,QACAG,IAAkB,IACd,OACAA,IAAkB,IACd,OACA,QACdrH,EAAY,WAAasH,EACzB,MAAMC,EAAiBP,EAAY,EAC7BQ,EAAoBhH,EAAY,QAAQ,WACxCiH,EAAsBjH,EAAY,QAAQ,aAC1CkH,EAAkBtI,EAAsB,mCAAmCE,CAAW,EACtFqI,EAAcvI,EAAsB,+BAA+BE,CAAW,EAC9EsI,EAAmBxI,EAAsB,4CAA4CuI,CAAW,EAEtG,GAAI,CAACJ,EACDP,EAAY,EACZD,EAAU,gBAAgBS,CAAiB,eAAeC,CAAmB,aAAaR,CAAW,IAAIG,CAAW;AAAA,uCACjGpH,EAAY,SAAS,CAAC,EAAE,UAAU,eAAeA,EAAY,SAAS,CAAC,EAAE,YAAY,aAAaqH,CAAa,GAAGM,CAAW,IAAItI,CAAI;AAAA,kCAC1IA,CAAI,IAAIgI,CAAa,GAAGK,CAAe,IAAIrI,CAAI,YAAY+H,CAAW,QAEnF,CACD,MAAMS,EAAU,CAAA,EAChBA,EAAQ,KAAK,gBAAgBL,CAAiB,eAAeC,CAAmB,aAAaJ,CAAa,GAAGJ,CAAW,IAAIG,CAAW,GAAG,EAC1IL,EAAU;AAAA,EACV,QAAS1K,EAAI,EAAGA,EAAI2K,EAAW,EAAE3K,EAAG,CAChC,MAAMyL,EAAkB9H,EAAY,SAAS3D,CAAC,EAAE,WAC1C0L,EAAsB/H,EAAY,SAAS3D,CAAC,EAAE,aACpDwL,EAAQ,KAAK,gBAAgBC,CAAe,eAAeC,CAAmB,aAAaJ,CAAW,IAAItI,CAAI,UAAUhD,CAAC,GAAG,EAC5H0K,GAAW,GAAG1K,EAAI,EAAI;AAAA,EAAO,EAAE,WAAWgD,CAAI,GAAGhD,CAAC,IAAIgL,CAAa,GAAGK,CAAe,IAAIrI,CAAI,UAAUhD,CAAC,KAAK+K,CAAW,GAC3H,CACDL,EAAUc,EAAQ,KAAK;AAAA,CAAI,EAAId,EAC/B,KAAK,wBAAwB,KAAK1H,CAAI,CACzC,CACD,KAAK,yBAAyB,kBAAkBA,CAAI,EAAIW,EACxD,KAAK,yBAAyB,kBAAkBoH,CAAW,EAAI5G,EAC/D,KAAK,8BAA8B4G,EAAa5G,EAAa,CAACuF,CAAU,EACxE,QAAS1J,EAAI,EAAGA,EAAI2K,EAAW,EAAE3K,EAC7B,KAAK,8BAA8BgD,EAAMW,EAAa3D,EAAGuL,EAAkB,KAAM,CAAC7B,CAAU,CAEnG,MAEG,KAAK,yBAAyB1G,EAAMC,EAAaC,CAAa,EAC9DwH,EAAU,EAEjB,CACD,OAAOA,CACV,CACD,uBAAuBiB,EAAejC,EAAY,CAE9C,MAAMO,EADW,oBACM,KAAK0B,CAAa,EACzC,GAAI1B,IAAU,KAAM,CAChB,MAAMjH,EAAOiH,EAAM,CAAC,EACpB,IAAI7F,EAAoB,KAAK,yBAAyB,iBAAiBpB,CAAI,EAC3E,GAAI,CAACoB,EAAmB,CACpB,MAAMwH,EAAW9E,EAA8B,UAAU9D,CAAI,EAC7D,IAAImE,EACAyE,GAAYA,EAAS,QAAQ,aAAe,GAC5CzE,EAAUyE,EAAS,QAGnBzE,EAAU,KAAK,yBAAyB,wBAE5C/C,EAAoB,CAAE,QAAA+C,GACtB,KAAK,yBAAyB,iBAAiBnE,CAAI,EAAIoB,CAC1D,CACD,KAAK,6BAA6BpB,EAAMoB,EAAmB,UAA2D,CAACsF,CAAU,EACjIiC,EAAgBA,EAAc,QAAQ,UAAW,gBAAgBvH,EAAkB,QAAQ,UAAU,eAAeA,EAAkB,QAAQ,YAAY,WAAW,CACxK,CACD,OAAOuH,CACV,CACD,cAAc9C,EAAMgD,EAASnC,EAAYoC,EAAoBC,EAAa,CACtE,MAAMC,EAA0BnD,EAAK,OAAO,0CAA0C,IAAM,GAEtFoD,EAAQ,iJAId,GAHApD,EAAOA,EAAK,QAAQoD,EAAO,EAAE,EAE7BpD,EAAOA,EAAK,QAAQ,kBAAmB,UAAU,EAC7Ca,EAAY,CACZ,MAAMwC,EAAerD,EAAK,QAAQ,cAAc,GAAK,EAC/CsD,EAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,cAMhBC,EAAaF,EAAe;AAAA,EAAyB,GACrDG,EAAYxD,EAAK,OAAO,kCAAkC,IAAM,GAQtE,GAPAA,EAAOA,EAAK,QAAQ,wBAAyB,aAAa,EAC1DA,EAAOA,EAAK,QAAQ,0BAA2B,aAAa,EAC5DA,EAAOA,EAAK,QAAQ,oBAAqB,UAAU,EACnDA,EAAOA,EAAK,QAAQ,mBAAoB,cAAc,EACtDA,EAAOA,EAAK,QAAQ,gBAAiB,aAAa,EAClDA,EAAOA,EAAK,QAAQ,eAAgB,YAAY,EAChDA,EAAOA,EAAK,QAAQ,gBAAiB,cAAc,EAC/C,CAAC,KAAK,iBACNA,EAAOA,EAAK,QAAQ,sBAAuBmD,GAA2BK,EAAY,GAAK;AAAA,GAAkD,YAAY,MAEpJ,CACD,MAAMpC,EAAQ,4BAA4B,KAAKpB,CAAI,EAC/CoB,IAAU,OACVpB,EAAOA,EAAK,UAAU,EAAGoB,EAAM,KAAK,EAAI,wBAA0BpB,EAAK,UAAUoB,EAAM,KAAK,EAEnG,CACDpB,EAAOA,EAAK,QAAQ,QAAS,kBAAkB,EAC/CA,EAAOA,EAAK,QAAQ,iBAAkBuD,CAAU,EAC5CF,IACArD,EAAOD,GAA4BC,EAAM,YAAasD,CAAa,EAE1E,SAEGtD,EAAOA,EAAK,QAAQ,iBAAkB,kBAAkB,EACxDA,EAAOA,EAAK,QAAQ,eAAgB,gBAAgB,EACtBgD,EAAQ,QAAQ,mBAAmB,IAAM,GAEnE,MAAO;AAAA;AAAA,EAAyEhD,EAIxF,GAAI,CAACa,EAAY,CACb,MAAMN,EAAmBP,EAAK,YAAY,GAAG,EAC7CA,EAAOA,EAAK,UAAU,EAAGO,CAAgB,EACzCP,GAAQ;AAAA,EAERA,GAAQ,GACX,CACD,OAAOA,CACV,CACD,6BAA6BA,EAAM7F,EAAM,CAErC,MAAMiJ,EAAQ,IAAI,OAAOjJ,EAAO,kBAAmB,IAAI,EACvD,IAAIiH,EAAQgC,EAAM,KAAKpD,CAAI,EAC3B,KAAOoB,IAAU,MAAM,CACnB,MAAM/E,EAAQ+E,EAAM,CAAC,EACrB,IAAIqC,EAAS,CAACpH,EACV,KAAK,gBAAkB,MAAMoH,CAAM,IACnCA,EAAS,CAAC,KAAK,eAAepH,EAAM,KAAM,CAAA,GAE9C2D,EAAOA,EAAK,QAAQoB,EAAM,CAAC,EAAGjH,EAAOsJ,CAAM,EAC3CrC,EAAQgC,EAAM,KAAKpD,CAAI,CAC1B,CACD,OAAOA,CACV,CACD,yBAAyB7F,EAAMuJ,EAA0B,CACrD,IAAIC,EAAM,gBAAgBD,EAAyB,QAAQ,UAAU,eAAeA,EAAyB,QAAQ,YAAY,aAAavJ,CAAI;AAAA,MAClJ,UAAWyC,KAAmB,KAAK,yBAAyB,iBACpDA,EAAgB,OAAS,EACzB+G,GAAO,OAAO/G,EAAgB,IAAI,IAAIA,EAAgB,IAAI,IAAIA,EAAgB,MAAM;AAAA,EAGpF+G,GAAO,OAAO/G,EAAgB,IAAI,IAAIA,EAAgB,IAAI;AAAA,EAGlE,OAAA+G,GAAO;AAAA;AAAA,EACAA,CACV,CACD,gBAAgBC,EAAYC,EAAc,CAEtC,QAAS1M,EAAI,EAAGA,EAAI,KAAK,wBAAwB,OAAQ,EAAEA,EAAG,CAC1D,MAAMgD,EAAO,KAAK,wBAAwBhD,CAAC,EAC3CyM,EAAa,KAAK,6BAA6BA,EAAYzJ,CAAI,EAC/D0J,EAAe,KAAK,6BAA6BA,EAAc1J,CAAI,CACtE,CAED,QAAShD,EAAI,EAAGA,EAAI,KAAK,iBAAiB,OAAQ,EAAEA,EAAG,CACnD,MAAM2M,EAAO,KAAK,iBAAiB3M,CAAC,EAChC2M,GAAQA,EAAK,OAAS,IACtBD,EAAeC,EAAO;AAAA,EAAOD,EAEpC,CAED,MAAME,EAAc,KAAK,oBACzB,OAAAH,EAAaG,EAAcH,EAC3BC,EAAeE,EAAcF,EAC7B,KAAK,qBAAoB,EACzB,KAAK,2BAA0B,EAC/B,KAAK,eAAiB,KACtB,KAAK,yBAAyB,qCAAuC,GAC9D,CAAE,WAAAD,EAAY,aAAAC,EACxB,CACL,CC/TA,MAAMG,GAAyB,4BACzBC,GAAkB,WAClBC,GAAmB,YACnBC,GAAiD,CACnD,WAAY,KACZ,WAAY,KACZ,iBAAkB,WAClB,WAAY,KACZ,aAAc,OACd,mBAAoB,aACpB,wBAAyB,KACzB,iBAAkB,KAClB,uBAAwB,WACxB,mBAAoB,OACpB,yBAA0B,aAC1B,8BAA+B,KAC/B,mBAAoB,KACpB,mBAAoB,KACpB,yBAA0B,WAC1B,mBAAoB,KACpB,iBAAkB,IACtB,EAEO,MAAMC,WAAkClK,CAAsB,CACjE,aAAc,CACV,MAAM,GAAG,SAAS,EAClB,KAAK,eAAiB,EACtB,KAAK,cAAgB,iCACrB,KAAK,cAAgB,uFACrB,KAAK,YAAc,GACnB,KAAK,SAAW,EACnB,CACD,aAAa8F,EAAMgD,EAAS3I,EAAewG,EAAYD,EAAmB,CAEtE,UAAWyD,KAAOhK,EAAe,CAC7B,GAAIgK,IAAQ,cACR,SAEJ,MAAMtH,EAAQ1C,EAAcgK,CAAG,GAC3B,CAAC,MAAM,SAAStH,CAAK,CAAC,GAAK,CAAC,MAAM,WAAWA,CAAK,CAAC,KACnDiD,EAAO,SAASqE,CAAG,MAAMtH,CAAK;AAAA,EAAQiD,EAE7C,CACD,OAAOA,CACV,CACD,cAAc7F,EAAMC,EAAaC,EAAe,CAC5C,IAAIC,EAAS,EACb,MAAMoG,EAAWtG,EAAY,YAAY,GAAG,EAC5C,GAAIA,EAAY,QAAQ,OAAO,GAAK,GAAKsG,EAAW,EAAG,CACnD,IAAID,EAAaC,EACjB,KAAOD,EAAa,GAAKrG,EAAY,OAAOqG,CAAU,IAAM,KAAOrG,EAAY,OAAOqG,CAAU,IAAM,KAClGA,IAEJ,MAAME,EAAiBvG,EAAY,UAAUqG,EAAa,EAAGC,CAAQ,EAKrE,IAJApG,EAAS,CAACqG,EACN,MAAMrG,CAAM,IACZA,EAAS,CAACD,EAAcsG,EAAe,KAAM,CAAA,GAE1CF,EAAa,IAAMrG,EAAY,OAAOqG,CAAU,IAAM,KAAOrG,EAAY,OAAOqG,CAAU,IAAM,MACnGA,IAEJrG,EAAcA,EAAY,UAAUA,EAAY,QAAQ,GAAG,EAAI,EAAGqG,EAAa,CAAC,CACnF,CACD,MAAO,CAACtG,EAAMC,EAAaE,CAAM,CACpC,CACD,kBAAkBsG,EAAmB,CACjC,KAAK,yBAA2BA,EAChC,KAAK,qBAAuB,GAC5B,KAAK,gBAAkB,GACvB,KAAK,8BAAgC,GACrC,KAAK,sBAAwB,GAC7B,KAAK,cAAgB,GACrB,KAAK,kBAAoB,GACzB,KAAK,sBAAwB,EAChC,CACD,qBAAqBZ,EAAM,CAEvB,MAAMc,EAAgB,KAAK,SACrB,GACA,UAAU5G,EAAsB,gBAAgB;AAAA;AAAA;AAAA;AAAA,eAAwEgK,EAAgB,MAAMhK,EAAsB,gBAAgB;AAAA,EAE1L,OADwB8F,EAAK,QAAQc,CAAa,IAAM,GAC/Bd,EAAOc,EAAgBrB,GAAeO,CAAI,CACtE,CACD,aAAagB,EAAS,CAElB,MADc,uEACD,KAAKA,CAAO,CAC5B,CACD,iBAAiBA,EAASH,EAAYxG,EAAe,CAEjD,MAAM+G,EADe,0HACM,KAAKJ,CAAO,EACvC,GAAII,IAAU,KAAM,CAChB,MAAMkD,EAAoBlD,EAAM,CAAC,GAAK,cAChCmD,EAAwBnD,EAAM,CAAC,GAAK,SACpCE,EAAcF,EAAM,CAAC,EACrBjH,EAAOiH,EAAM,CAAC,EACdoD,EAAgBF,IAAsB,OAAS,gBAAgBA,CAAiB,IAAM,gBAAgBA,CAAiB,KAAKC,CAAqB,IACvJ,IAAI7H,EACAmE,GACAnE,EAAW,KAAK,yBAAyB,kBAAkBvC,CAAI,EAC3DuC,IAAa,QACbrF,EAAO,KAAK,+CAA+C8C,CAAI,2EAA2E,IAI9IuC,EAAW,KAAK,yBAAyB,uBAAuB4E,EAAa,KAAK,cAAcnH,EAAMmH,EAAajH,CAAa,EAAE,CAAC,CAAC,EACpI,KAAK,yBAAyB,kBAAkBF,CAAI,EAAIuC,EACxD,KAAK,cAAc,KAAK,eAAeA,CAAQ,KAAK8H,CAAa,IAAIrK,CAAI,MAAMmH,CAAW,GAAG,EAC7F,KAAK,kBAAkB,KAAKnH,CAAI,GAEpC6G,EAAU,EACb,CACD,OAAOA,CACV,CACD,mBAAmBO,EAAWlH,EAAe,CAEzC,MAAM+G,EADc,wCACM,KAAKG,CAAS,EACxC,GAAIH,IAAU,KAAM,CAChB,MAAMK,EAAgBL,EAAM,CAAC,EACvBjH,EAAOiH,EAAM,CAAC,EACd1E,EAAW,KAAK,yBAAyB,yBAAyB+E,EAAe,KAAK,cAActH,EAAMsH,EAAepH,CAAa,EAAE,CAAC,CAAC,EAChJ,KAAK,yBAAyB,oBAAoBF,CAAI,EAAIuC,EAC1D,KAAK,yBAAyB,kBAAkBA,CAAQ,EAAIvC,EAC5D,MAAMuH,EAAgB,KAAK,yBAAyB,qCAAqCvH,CAAI,EAC7F,GAAIuH,IAAkB,OAAW,CAE7B,MAAMC,EAAUD,EAAgB,EAAKA,IAAkB,GAAK,MAAQ,MAAQ,CAACA,EAAgB,QAAWA,IAAkB,EAAI,MAAQ,MAAQA,EAAgB,QACxJE,EAAU,QAAQzH,CAAI,IAC5B,KAAK,qBAAqB,KAAK,aAAauC,CAAQ,KAAKkF,CAAO,MAAMD,CAAO,GAAG,EAChF,KAAK,gBAAgB,KAAK,GAAGxH,CAAI,MAAMsH,CAAa,GAAG,EACvD,KAAK,8BAA8B,KAAK,gBAAgBtH,CAAI,MAAMsH,CAAa,kBAAkBG,CAAO,IAAI,EAC5G,KAAK,sBAAwB,EAChC,MAEG,KAAK,qBAAqB,KAAK,aAAalF,CAAQ,KAAKvC,CAAI,MAAMsH,CAAa,GAAG,EACnF,KAAK,gBAAgB,KAAK,GAAGtH,CAAI,MAAMsH,CAAa,GAAG,EACvD,KAAK,8BAA8B,KAAK,gBAAgBtH,CAAI,oBAAoBA,CAAI,GAAG,EAE3FoH,EAAY,EACf,CACD,OAAOA,CACV,CACD,iBAAiBM,EAAShB,EAAYxG,EAAe,CACjD,MAAM+G,EAAQ,KAAK,cAAc,KAAKS,CAAO,EAC7C,GAAIT,IAAU,KAAM,CAChB,MAAMhH,EAAcgH,EAAM,CAAC,EACrBjH,EAAOiH,EAAM,CAAC,EACpB,KAAK,yBAAyBjH,EAAMC,EAAaC,CAAa,EAC9DwH,EAAU,EACb,CACD,OAAOA,CACV,CACD,iBAAiBtL,EAASsK,EAAYxG,EAAe,CACjD,MAAM+G,EAAQ,KAAK,cAAc,KAAK7K,CAAO,EAC7C,GAAI6K,IAAU,KAAM,CAChB,MAAMjH,EAAOiH,EAAM,CAAC,EACd3K,EAAO2K,EAAM,CAAC,EACdqD,EAAmB,CAAC,CAACrD,EAAM,CAAC,EAC5BsD,EAActD,EAAM,CAAC,EACrBuD,EAAmBD,EAAY,QAAQ,SAAS,EAAI,EACpDvC,EAAgBf,EAAM,CAAC,EACvBwD,EAAuBD,EAAmBxC,EAAc,UAAU,EAAGA,EAAc,QAAQ,GAAG,CAAC,EAAE,KAAI,EAAK,KAChH,IAAIL,EAAY2C,EAAmB,KAAK,cAActK,EAAM1D,EAAM4D,CAAa,EAAE,CAAC,EAAI,EAClFS,EAAc,KAAK,yBAAyB,kBAAkBX,CAAI,EACtE,GAAKW,EAaDgH,EAAYhH,EAAY,SAAS,WAbnB,CACdA,EAAc,CACV,eAAgBgH,EAAY,EAC5B,iBAAA6C,EACA,SAAU,CAAE,EACZ,WAAY,OAChC,EACgB7C,EAAYA,GAAa,EACzB,QAAS3K,EAAI,EAAGA,EAAI2K,EAAW,EAAE3K,EAC7B2D,EAAY,SAAS,KAAK,KAAK,yBAAyB,sBAAqB,CAAE,CAEtF,CAID,KAAK,yBAAyB,kBAAkBX,CAAI,EAAIW,EACxD,MAAM+J,EAAiBH,EAAY,QAAQ,OAAO,EAAI,EAChDhC,EAAmByB,GAA+CO,CAAW,EAC7EtC,EAAayC,EACb,QACA1C,IAAkB,MACd,OACAA,IAAkB,MACd,OACA,QAEd,GADArH,EAAY,WAAasH,EACrBM,IAAqB,OAErB,KAAM,0EAA0EgC,CAAW,KAE/F,QAASvN,EAAI,EAAGA,EAAI2K,EAAW,EAAE3K,EAAG,CAChC,KAAM,CAAE,WAAA+D,EAAY,aAAAC,CAAY,EAAKL,EAAY,SAAS3D,CAAC,EACvDA,IAAM,IACNZ,EAAU,UAAU2E,CAAU,cAAcC,CAAY,KAAK5E,CAAO,IAExE,KAAK,8BAA8B4D,EAAMW,EAAa3D,EAAGuL,EAAkBkC,EAAsB,CAAC/D,CAAU,CAC/G,CACJ,CACD,OAAOtK,CACV,CAED,cAAcyJ,EAAM,CAChB,MAAM8E,EAAgB,yBACtB,IAAI1D,EACJ,MAAQA,EAAQ0D,EAAc,KAAK9E,CAAI,KAAO,MAC1CA,EAAOA,EAAK,QAAQ,IAAI,OAAOoB,EAAM,CAAC,EAAG,GAAG,EAAGA,EAAM,CAAC,CAAC,EAE3D,OAAOpB,CACV,CACD,gBAAgB4D,EAAYC,EAAc,CACtC,MAAMP,EAAgBO,EAAa,QAAQ,yBAAyB,GAAK,GAAK,CAAC,KAAK,SAC9E;AAAA;AAAA;AAAA;AAAA,UAKA,GAEND,EAAa,KAAK,iBAAiBA,EAAY,EAAI,EACnDC,EAAe,KAAK,iBAAiBA,EAAc,EAAK,EAExDD,EAAa,KAAK,sBAAsBA,EAAY,EAAI,EACxDC,EAAe,KAAK,sBAAsBA,EAAc,EAAK,EAE7D,MAAME,EAAc,KAAK,oBACzBH,EAAaG,EAAcH,EAC3BC,EAAeE,EAAcF,EAE7BD,EAAaA,EAAW,QAAQ,+BAAgC,gBAAgB,EAChFA,EAAaA,EAAW,QAAQ,YAAa,YAAY,EACzDA,EAAa,KAAK,6BAA6BA,CAAU,EACzD,IAAImB,EAAe;AAAA;AAAA;AAAA,EACf,KAAK,qBAAqB,OAAS,IACnCA,GAAgB,KAAK,qBAAqB,KAAK;AAAA,CAAI,GAEvDA,GAAgB;AAAA;AAAA,4BAAqC,KAAK,sBAAwB,IAAM,IAAM;AAAA,EAC1F,KAAK,wBACLA,GAAgB;AAAA;AAAA,EAChBA,GAAgB,KAAK,gBAAgB,KAAK;AAAA,CAAI,EAC9CA,GAAgB;AAAA;AAAA;AAAA,GAEpB,IAAIC,EAAgB;AAAA;AAAA,EAChB,KAAK,cAAc,OAAS,IAC5BA,GAAiB,KAAK,cAAc,KAAK;AAAA,CAAI,GAEjDA,GAAiB;AAAA;AAAA;AAAA,EACjBpB,EAAamB,EAAeC,EAAgBpB,EAC5C,IAAIqB,EAAyB;AAAA,gBAAmB,KAAK,sBAAwB,IAAM,EAAE;AAAA,EACjF,KAAK,wBACLA,GAA0B;AAAA;AAAA,EAC1BA,GAA0B,KAAK,8BAA8B,KAAK;AAAA,CAAI,EACtEA,GAA0B;AAAA,GAE9B,MAAMC,EAAuB,KAAK,SAC5B,0BACA;AAAA,yBACN,IAAIC,EAAoBvB,EAAW,QAAQ,qCAAqC,IAAM,GACtFA,GACKuB,EAAoB;AAAA,EAA8C,IAC/D;AAAA,EACApF,GAA4B6D,EAAY,UAAWqB,EAAwBC,CAAoB,EAEvGrB,EAAeA,EAAa,QAAQ,+BAAgC,gBAAgB,EACpFA,EAAeA,EAAa,QAAQ,YAAa,YAAY,EAC7DA,EAAe,KAAK,6BAA6BA,CAAY,EACxD,KAAK,WACNA,EAAeA,EAAa,QAAQ,QAAS,4BAA4B,GAE7E,IAAIuB,EAAiB;AAAA;AAAA;AAAA,EACjB,KAAK,cAAc,OAAS,IAC5BA,GAAkB,KAAK,cAAc,KAAK;AAAA,CAAI,GAElDA,GAAkB;AAAA;AAAA;AAAA,EAClB,IAAIC,EAAkB;AAAA,EAEtB,MAAMC,EAAY,6BAClB,IAAIlE,EAAQyC,EAAa,MAAM,IAAI,OAAOyB,EAAY,IAAK,GAAG,CAAC,EAC3DC,EAAgB,EACpB,GAAInE,EAAO,CACPiE,GAAmB,cAAcE,CAAa;AAAA,EAC9CA,IACA,QAASlJ,EAAQ,EAAGA,EAAQ,EAAGA,IAC3B+E,EAAQyC,EAAa,MAAM,IAAI,OAAOyB,EAAYjJ,EAAO,GAAG,CAAC,EACzD+E,IACAiE,GAAmB,cAAcE,CAAa,aAAaA,CAAa;AAAA,EACxEA,KAGJ1B,EAAa,QAAQ,eAAe,IAAM,KAC1CwB,GAAmB,eAAeE,CAAa;AAAA,EAC/CA,IAEP,CAED,MAAMnC,EAAQ,kBACdhC,EAAQyC,EAAa,MAAMT,CAAK,EAC5BhC,IACAiE,GAAmB,cAAcE,GAAe;AAAA,EAChDF,GAAmB,cAAcE,GAAe;AAAA,EAChDF,GAAmB,cAAcE,GAAe;AAAA,GAEhDA,IAAkB,IAClBF,GAAmB;AAAA,EACnBE,KAGJ,IAAIC,EAAe,GACfpF,EAAM,EACV,KAAO,CAACoF,IACJpF,EAAMyD,EAAa,QAAQG,GAAwB5D,CAAG,EAClD,EAAAA,EAAM,KAFQ,CAKlB,MAAMqF,EAAYrF,EAElB,IADAoF,EAAe,GACRpF,EAAM,GAAKyD,EAAa,OAAOzD,CAAG,IAAM;AAAA,GAAM,CACjD,GAAIyD,EAAa,OAAOzD,CAAG,IAAM,KAAOyD,EAAa,OAAOzD,EAAM,CAAC,IAAM,IAAK,CAC1EoF,EAAe,GACf,KACH,CACDpF,GACH,CACDA,EAAMqF,EAAYzB,GAAuB,MAC5C,CACGwB,IACAH,GAAmB;AAAA,GAEvBA,GAAmB;AAAA;AAAA,EACnBxB,EAAeuB,EAAiBC,EAAkBxB,EAClD,MAAM6B,EAAuB;AAAA,IAAkCpC,EACzDqC,EAAqB,4BAC3B,OAAAR,EAAoBtB,EAAa,QAAQ,qCAAqC,IAAM,GACpFA,GACKsB,EAAoB;AAAA,EAA8C,IAC/D;AAAA,EACApF,GAA4B8D,EAAc,UAAW6B,EAAsBC,CAAkB,EACrG,KAAK,qBAAoB,EACzB,KAAK,2BAA0B,EAC/B,KAAK,yBAAyB,qCAAuC,GAC9D,CAAE,WAAA/B,EAAY,aAAAC,EACxB,CACD,yBAAyB1J,EAAMuJ,EAA0B,CACrD,IAAIkC,EAAgB,GAChBjC,EAAM,UAAUxJ,CAAI;AAAA,EACxB,UAAWyC,KAAmB,KAAK,yBAAyB,iBAAkB,CAC1E,MAAMnG,EAAOmG,EAAgB,KAAK,QAAQ,iBAAkB,IAAI,EAC1DC,EAAO3C,EAAsB,aAAazD,CAAI,EACpD,GAAImG,EAAgB,OAAS,EACzB,GAAIC,GAAQ,EAAG,CACX,MAAMgJ,EAAmB,GAAG1L,CAAI,IAAI,KAAK,sBAAsB,MAAM,eACrEyL,GAAiB,UAAUC,CAAgB;AAAA;AAAA,8BAEjCpP,CAAI;AAAA,uBAEd,KAAK,sBAAsB,KAAKmG,EAAgB,IAAI,EACpD+G,GAAO,eAAe/G,EAAgB,IAAI,YAAYiJ,CAAgB,KAAKjJ,EAAgB,MAAM;AAAA,CACpG,MAEG+G,GAAO,IAAI/G,EAAgB,IAAI,YAAYA,EAAgB,IAAI,KAAKA,EAAgB,MAAM;AAAA,OAI9F+G,GAAO,KAAK/G,EAAgB,IAAI,MAAMA,EAAgB,IAAI;AAAA,CAEjE,CACD,OAAA+G,GAAO;AAAA,EACPA,EAAM,GAAGiC,CAAa;AAAA,EAAKjC,CAAG,GAC9BA,GAAO,UAAUD,EAAyB,QAAQ,UAAU,cAAcA,EAAyB,QAAQ,YAAY,kBAAkBO,EAAe,MAAM9J,CAAI;AAAA,EAC3JwJ,CACV,CACD,iBAAiB3D,EAAM/E,EAAU,CAC7B,MAAM6K,EAAgB,8DAEtB,OAAa,CACT,MAAM1E,EAAQ0E,EAAc,KAAK9F,CAAI,EACrC,GAAIoB,IAAU,KACV,MAEJ,MAAMjH,EAAOiH,EAAM,CAAC,EACdW,EAAcX,EAAM,CAAC,EACrB2E,EAAmB5L,EAAK,OAAS,EACjCkB,EAAclB,EAAK,YAAY,SAAS,IAAM4L,EAAmB5L,EAAK,UAAU,EAAG4L,CAAgB,EAAI,KACvG9D,EAAqBF,IAAgB,qBAAuB,aAAmE,YACrI,GAAI1G,EAAa,CACb,MAAMP,EAAc,KAAK,yBAAyB,kBAAkBO,CAAW,EAC3EP,IACAA,EAAY,gBAAkB,GAErC,CACD,IAAIQ,EAAc,KAAK,yBAAyB,kBAAkBnB,CAAI,EACjEmB,IACDA,EAAc,CACV,QAAS,KAAK,yBAAyB,sBAAuB,EAC9D,KAAM2G,CAC1B,EACgB,KAAK,yBAAyB,kBAAkB9H,CAAI,EAAImB,GAE5D,KAAK,8BAA8BnB,EAAMmB,EAAaL,CAAQ,EAC9D,MAAMoF,EAAQL,EAAK,UAAU,EAAGoB,EAAM,KAAK,EACrC4E,EAAa,UAAU1K,EAAY,QAAQ,UAAU,cAAcA,EAAY,QAAQ,YAAY,KACnGgF,EAAQN,EAAK,UAAUoB,EAAM,KAAK,EACxCpB,EAAOK,EAAQ2F,EAAa1F,EAC5BwF,EAAc,WAAaE,EAAW,MACzC,CACD,OAAOhG,CACV,CACD,sBAAsBA,EAAM/E,EAAU,CAClC,MAAMgL,EAA0B,oFAEhC,OAAa,CACT,MAAM7E,EAAQ6E,EAAwB,KAAKjG,CAAI,EAC/C,GAAIoB,IAAU,KACV,MAEJ,MAAM3K,EAAO2K,EAAM,CAAC,EACd8E,EAAa9E,EAAM,CAAC,EAC1B,IAAIjH,EAAOiH,EAAM,CAAC,EAClB,MAAM+E,EAAa/E,EAAM,CAAC,EAC1B,IAAIgF,EAAa,KAAK,yBAAyB,iBAAiBjM,CAAI,EACpE,GAAI,CAACiM,EAAY,CACb,MAAMrD,EAAWtM,IAAS,UAAYwH,EAA8B,UAAUkI,CAAU,EAAI,KAC5F,IAAI7H,EACAyE,GACA5I,EAAOgM,EACP7H,EAAUyE,EAAS,QACfzE,EAAQ,aAAe,KACvBA,EAAU,KAAK,yBAAyB,iBAAiBnE,CAAI,GAAG,QAC3DmE,IACDA,EAAU,KAAK,yBAAyB,2BAKhDA,EAAU,KAAK,yBAAyB,wBAE5C8H,EAAa,CAAE,QAAA9H,GACf,KAAK,yBAAyB,iBAAiBnE,CAAI,EAAIiM,CAC1D,CACD,KAAK,6BAA6BjM,EAAM,KAAK,yBAAyB,iBAAiBA,CAAI,EAAG+L,IAAe,aACvG,UACAzP,IAAS,UACL,oBACA,UAA2DwE,CAAQ,EAC7E,MAAMC,EAAakL,EAAW,QAAQ,WAChCjL,EAAeiL,EAAW,QAAQ,aAClC/F,EAAQL,EAAK,UAAU,EAAGoB,EAAM,KAAK,EACrC4E,EAAa,UAAU9K,CAAU,cAAcC,CAAY,KAC3DmF,EAAQN,EAAK,UAAUoB,EAAM,KAAK,EACxCpB,EAAOK,EAAQ2F,EAAa1F,EAC5B2F,EAAwB,WAAaD,EAAW,MACnD,CACD,OAAOhG,CACV,CACD,6BAA6BA,EAAM,CAC/B,UAAWqG,KAAoB,KAAK,sBAChCrG,EAAOA,EAAK,QAAQ,IAAI,OAAO,GAAGqG,CAAgB,kBAAmB,GAAG,EAAG,GAAGA,CAAgB,SAAS,EAE3G,OAAOrG,CACV,CACL,CCzdO,MAAMsG,EAAsB,CAC/B,IAAI,oBAAqB,CACrB,OAAO,KAAK,cACf,CACD,eAAejK,EAAO,CAClB,OAAO,KAAK,qBAAqBA,CAAK,GAAK,IAC9C,CACD,eAAe9F,EAAS8F,EAAO,CACtB,KAAK,qBACN,KAAK,mBAAqB,IAE9B,KAAK,mBAAmBA,CAAK,EAAI9F,CACpC,CACD,mBAAmB8F,EAAO,CACtB,GAAI,KAAK,mBACL,GAAIA,IAAU,OACV,KAAK,QAAQ,eAAe,eAAe,KAAK,mBAAmBA,CAAK,CAAC,EACzE,OAAO,KAAK,mBAAmBA,CAAK,MAEnC,CACD,UAAW9F,KAAW,KAAK,mBACvB,KAAK,QAAQ,eAAe,eAAeA,CAAO,EAEtD,KAAK,mBAAqB,IAC7B,CAER,CACD,YAAYgQ,EAASC,EAAkB,KAAM,CACzC,KAAK,QAAUD,EAEf,KAAK,qBAAuB,GAC5B,KAAK,OAAS,aACd,KAAK,cAAgB,EACrB,KAAK,wBAA0B,EAC/B,KAAK,eAAiBC,EACtB,KAAK,mBAAqB,KAC1B,KAAK,KAAO,KACZ,KAAK,eAAiB,IACzB,CACD,IAAIC,EAAiB,CACjB,KAAK,eAAiBA,CACzB,CACD,SAASC,EAAgBC,EAAiBC,EAAWC,EAAQC,EAAM3Q,EAAOC,EAAQ2Q,EAAO,CACrF,IAAIC,EAAgB,KAChBC,EAAkB,EAClBJ,GACAG,EAAgBJ,EAAY,aAAoE,OAChGK,EAAkB,GAAKF,GAAS,IAE3BD,GACLE,EAAgB,KAChBC,EAAkB,GAEbL,IACLI,EAAgB,WAChBC,EAAkBF,GAEtB,MAAMzQ,EAASJ,EAAoB,mBAAmB,KAAK,MAAM,EAC3DgR,EAAShR,EAAoB,0BAA0B,KAAK,MAAM,EAAI,aAA6D,MACzI,KAAK,WAAW,CACZ,MAAO,cAAc4Q,EAAO,KAAOD,EAAS,OAAS,IAAI,GAAGD,EAAY,SAAWK,EAAkB,EAAE,IAAI9Q,CAAK,IAAIC,CAAM,IAAIuQ,EAAkB,QAAU,QAAQ,IAAI,KAAK,MAAM,IAAIK,CAAa,GAClM,OAAA1Q,EACA,UAAW0Q,EACX,cAAeL,EAAkBtQ,GAAM,KAAK,IAAIF,EAAOC,CAAM,CAAC,EAAI,EAAI,EACtE,eAAgB,EAChB,aAAc,EACd,gBAAA6Q,EACA,OAAAC,CACZ,CAAS,CACJ,CACD,WAAWC,EAAYC,EAAuB,GAAO,CAEjD,GADA,KAAK,KAAO,KAAK,eAAe,WAAWD,CAAU,EACjDC,GAAwBD,EAAY,CACpC,MAAME,EAAiBF,EAAW,cAClCA,EAAW,cAAgB,EAC3B,KAAK,eAAiB,KAAK,eAAe,WAAWA,CAAU,EAC/DA,EAAW,cAAgBE,CAC9B,CACJ,CACD,OAAQ,CACJ,KAAK,eAAiB,KACtB,KAAK,mBAAqB,KAC1B,KAAK,KAAO,KACZ,KAAK,eAAiB,IACzB,CACD,SAAU,CACN,KAAK,gBAAgB,UACrB,KAAK,mBAAkB,EACvB,KAAK,yBAAyB,UAC9B,KAAK,MAAK,CACb,CACL,CClEA,MAAMC,GAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAYrBC,GAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWvBC,GAAsC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAkBtCC,GAAwC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAoBxCC,GAA8CF,GAC9CG,GAAgD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA8BhDC,GAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQpBC,GAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAStBC,GAAiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA+BjCC,GAAmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWnCC,GAA0C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWhD,IAAIC,GACH,SAAUA,EAAc,CACrBA,EAAaA,EAAa,OAAY,CAAC,EAAI,SAC3CA,EAAaA,EAAa,wBAA6B,CAAC,EAAI,0BAC5DA,EAAaA,EAAa,MAAW,CAAC,EAAI,QAC1CA,EAAaA,EAAa,gCAAqC,CAAC,EAAI,iCACxE,GAAGA,IAAiBA,EAAe,CAAE,EAAC,EACtC,IAAIC,GACH,SAAUA,EAAmB,CAC1BA,EAAkBA,EAAkB,YAAiB,CAAC,EAAI,cAC1DA,EAAkBA,EAAkB,QAAa,CAAC,EAAI,SAC1D,GAAGA,IAAsBA,EAAoB,CAAE,EAAC,EAChD,MAAMC,GAAyB,CAC3B,CAAE,OAAQb,GAAoB,SAAUC,EAAsB,EAC9D,CAAE,OAAQC,GAAqC,SAAUC,EAAuC,EAChG,CAAE,OAAQG,GAAmB,SAAUC,EAAqB,EAC5D,CAAE,OAAQH,GAA6C,SAAUC,EAA+C,CACpH,EAKaS,EAAiC,CAC1C,GAAI,EACJ,QAAS,EACT,OAAQ,EACR,OAAQ,EACR,QAAS,EACT,QAAS,EACT,SAAU,EACV,SAAU,EACV,QAAS,EACT,QAAS,EACT,QAAS,GACT,QAAS,GACT,SAAU,GACV,SAAU,GACV,SAAU,GACV,UAAW,GACX,WAAY,GACZ,kBAAmB,GACnB,UAAW,GACX,UAAW,GACX,WAAY,GACZ,kBAAmB,GACnB,YAAa,GACb,aAAc,GAEd,SAAU,GACV,SAAU,GACV,UAAW,GACX,WAAY,GACZ,WAAY,GACZ,YAAa,GACb,WAAY,GACZ,WAAY,GACZ,YAAa,GACb,SAAU,GACV,aAAc,GACd,YAAa,GACb,uBAAwB,GACxB,aAAc,GACd,wBAAyB,GACzB,SAAU,GACV,UAAW,GACX,YAAa,GACb,SAAU,GACV,UAAW,GACX,YAAa,EACjB,EAEO,MAAMC,EAAqB,CAI9B,YAAY1M,EAAQ2M,EAAQC,EAAeC,EAAmB,CAS1D,GARA,KAAK,WAAa,GAClB,KAAK,iBAAmB,GACxB,KAAK,gBAAkB,GACvB,KAAK,sBAAwB,GAC7B,KAAK,yBAA2B,GAChC,KAAK,QAAU7M,EACf,KAAK,QAAU2M,EACf,KAAK,eAAiBC,EAClBC,EAAkB,QAAQ,0BAAqF,IAAK,GAAI,CACxH,MAAMC,EAAO,OAAO,KAAKL,CAA8B,EACvDA,EAA+B,cAAqEA,EAA+BK,EAAKA,EAAK,OAAS,CAAC,CAAC,EAAI,CAC/J,CACD,KAAK,eAAiBH,EAAO,cAAc,CAAE,UAAW,QAAQ,CAA0C,EAC1G,KAAK,cAAgBA,EAAO,cAAc,CAAE,UAAW,QAAQ,CAA0C,EACzG,KAAK,gBAAkB,KAAK,eAAe,aAAa,EAAI,EAAGI,EAA4B,QAAUA,EAA4B,QAAS,kBAAkB,EAAE,mBAC9J,KAAK,aAAa,cAClB,KAAK,kBAAkB,aAC1B,CACD,aAAapS,EAAQG,EAAOwR,EAAa,OAAQU,EAAQ,CACrD,MAAMtM,EAAQ5F,IAASwR,EAAa,OAC9B,EACAxR,IAASwR,EAAa,0BAChBU,EAAO,QAAU,EAAI,IAAM,KAAOA,EAAO,iBAAmB,EAAI,IAAM,GACxElS,IAASwR,EAAa,MAClB,EACAxR,IAASwR,EAAa,kCAChBU,EAAO,QAAU,EAAI,IAAM,KAAOA,EAAO,iBAAmB,EAAI,IAAM,GACxE,EACb,KAAK,WAAWrS,CAAM,IACvB,KAAK,WAAWA,CAAM,EAAI,IAE9B,IAAIsS,EAAiB,KAAK,WAAWtS,CAAM,EAAE+F,CAAK,EAClD,GAAI,CAACuM,EAAgB,CACjB,IAAI5F,EAAU,IACVvM,IAASwR,EAAa,yBAA2BxR,IAASwR,EAAa,mCACnEU,EAAO,UACP3F,GAAW;AAAA,GAEX2F,EAAO,mBACP3F,GAAW;AAAA,IAGnB,IAAI6F,EAAU,KAAK,iBAAiBxM,CAAK,EACzC,GAAI,CAACwM,EAAS,CACV,IAAIjF,EAAauE,GAAuB1R,CAAI,EAAE,OAC1CoN,EAAesE,GAAuB1R,CAAI,EAAE,SAChD,MAAMqS,EAAmB,CACrB,QAAS9F,EAAQ,MAAM;AAAA,CAAI,EAC3B,gBAAiB,KACjB,WAAY,GACZ,6BAA8B,GAC9B,UAAW,KAAK,QAAQ,oBAAoB,CAA4B,EACxE,uBAAwB,GACxB,kBAAmB,GACnB,qBAAsB,CAAE,EACxB,SAAU,KAAK,QAAQ,QAAU,KAAK,SAAU,EAChD,aAAc,KAAK,QAAQ,mBAC3B,kBAAmB,KAAK,QAAQ,4BAA4B,EAA6B,EAAI,EAC7F,gBAAiB,KAAK,QAAQ,gBAC9B,sBAAuB,KAAK,QAAQ,qBACxD,EACgB+F,GAAWD,CAAgB,EAE3BA,EAAiB,UAAU,SAAW,GACtCE,GAAQpF,EAAYkF,EAAmBG,GAAuB,CAC1DrF,EAAaqF,CACjC,EAAmB,KAAK,OAAO,EACfH,EAAiB,WAAa,GAC9BE,GAAQnF,EAAciF,EAAmBI,GAAyB,CAC9DrF,EAAeqF,CACnC,EAAmB,KAAK,OAAO,EACf,MAAMC,EAAQC,GAASxF,EAAYC,EAAciF,CAAgB,EAEjEA,EAAiB,UAAU,SAAW,GACtC,MAAMO,EAAe,KAAK,QAAQ,mBAAmB,CACjD,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,yBAAyBhN,CAAK,GAChF,KAAM8M,EAAM,UAChC,CAAiB,EACKG,EAAiB,KAAK,QAAQ,mBAAmB,CACnD,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,2BAA2BjN,CAAK,GAClF,KAAM8M,EAAM,YAChC,CAAiB,EACDN,EAAU,KAAK,iBAAiBxM,CAAK,EAAI,CAACgN,EAAcC,CAAc,CACzE,CACD,MAAMC,EAAW,KAAK,QAAQ,qBAAqB,CAC/C,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,qBAAqBjT,CAAM,IAAI+F,CAAK,GACtF,OAAQ,OACR,OAAQ,CACJ,OAAQwM,EAAQ,CAAC,EACjB,WAAY,MACf,EACD,SAAU,CACN,OAAQA,EAAQ,CAAC,EACjB,WAAY,OACZ,QAAS,CACL,CACI,OAAAvS,CACH,CACJ,CACJ,EACD,UAAW,CACP,SAAU,iBACV,iBAAkB,QACrB,CACjB,CAAa,EACDsS,EAAiB,KAAK,WAAWtS,CAAM,EAAE+F,CAAK,EAAI,CAACkN,EAAUA,EAAS,mBAAmB,CAAC,CAAC,CAC9F,CACD,OAAOX,CACV,CACD,kBAAkBtS,EAAQG,EAAOyR,EAAkB,YAAa,CAC5D,MAAM7L,EAAQ5F,IAASyR,EAAkB,QAAU,EAAS,EACvD,KAAK,gBAAgB5R,CAAM,IAC5B,KAAK,gBAAgBA,CAAM,EAAI,IAEnC,IAAIsS,EAAiB,KAAK,gBAAgBtS,CAAM,EAAE+F,CAAK,EACvD,GAAI,CAACuM,EAAgB,CACjB,IAAIC,EAAU,KAAK,sBAAsBxM,CAAK,EAC9C,GAAI,CAACwM,EAAS,CACV,MAAMQ,EAAe,KAAK,QAAQ,mBAAmB,CACjD,KAAMvB,GACN,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,kCACtE,CAAiB,EACKwB,EAAiB,KAAK,QAAQ,mBAAmB,CACnD,KAAMjN,IAAU,EAAI0L,GAAmCC,GACvD,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,sCAAsC3L,IAAU,EAAI,cAAgB,SAAS,EACnJ,CAAiB,EACDwM,EAAU,KAAK,sBAAsBxM,CAAK,EAAI,CAACgN,EAAcC,CAAc,CAC9E,CACD,MAAMC,EAAW,KAAK,QAAQ,qBAAqB,CAC/C,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,0BAA0BjT,CAAM,IAAI+F,IAAU,EAAI,cAAgB,SAAS,GAC7H,OAAQ,OACR,OAAQ,CACJ,OAAQwM,EAAQ,CAAC,EACjB,WAAY,MACf,EACD,SAAU,CACN,OAAQA,EAAQ,CAAC,EACjB,WAAY,OACZ,QAAS,CACL,CACI,OAAAvS,CACH,CACJ,CACJ,EACD,UAAW,CACP,SAAU,iBACV,iBAAkB,QACrB,CACjB,CAAa,EACDsS,EAAiB,KAAK,gBAAgBtS,CAAM,EAAE+F,CAAK,EAAI,CAACkN,EAAUA,EAAS,mBAAmB,CAAC,CAAC,CACnG,CACD,OAAOX,CACV,CACD,kBAAkBY,EAAS,CACvB,KAAK,2BAA6BA,CACrC,CACD,mBAAmBC,EAAOlT,EAASD,EAAQoT,EAAU,GAAOpS,EAAgB,CACxE,MAAMqS,EAAuBrS,IAAmB,OAC1C,CAACiS,EAAUK,CAAe,EAAI,KAAK,kBAAkBtT,EAAQoT,EAAUxB,EAAkB,QAAUA,EAAkB,WAAW,EAClIyB,IACArS,EAAiB,KAAK,QAAQ,qBAAqB,CAAE,CAAA,GAEzDA,EAAe,iBAAiB,mCAAmCoS,CAAO,EAAE,EAC5E,MAAMG,EAAwBtT,EAAQ,iBAChCuT,EAAuB,CACzB,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,uBAAuBxT,CAAM,IAAIoT,EAAU,UAAY,aAAa,GAAGnT,EAAQ,MAAQ,IAAMA,EAAQ,MAAQ,EAAE,GACjK,iBAAkB,CACd,CACI,KAAMsT,EAAsB,mBAAmB,WAAW,CACtD,OAAAvT,EACA,UAAW,KACX,cAAe,EACf,eAAgB,EAChB,aAAc,EACd,gBAAiB,EACjB,OAAQ,KAChC,CAAqB,EACD,OAAQ,OACR,QAAS,OACZ,CACJ,CACb,EACcyT,EAAczS,EAAe,gBAAgBwS,CAAoB,EACjE3C,EAAa,CACf,OAAQyC,EACR,QAAS,CACL,CACI,QAAS,EACT,SAAU,KAAK,aAClB,EACD,CACI,QAAS,EACT,SAAU,KAAK,QAAQ,sBAAsB,CACzC,OAAQH,EAAM,kBACtC,CAAqB,CACJ,CACJ,CACb,EACcO,EAAY,KAAK,QAAQ,gBAAgB7C,CAAU,EACzD4C,EAAY,YAAYR,CAAQ,EAChCQ,EAAY,aAAa,EAAGC,CAAS,EACrCD,EAAY,KAAK,EAAG,EAAG,EAAG,CAAC,EAC3BA,EAAY,IAAG,EACfzS,EAAe,gBAAa,EACxBqS,IACA,KAAK,QAAQ,MAAM,OAAO,CAACrS,EAAe,OAAQ,CAAA,CAAC,EACnDA,EAAiB,KAExB,CACD,wBAAwB2S,EAAiB9T,EAAOC,EAAQE,EAAQoT,EAAU,GAAOQ,EAAmB,GAAOC,EAAY,EAAGC,EAAW,EAAGC,EAAS,EAAGC,EAAQ,EAAGC,EAAQ,EAAGC,EAAY,EAAGC,EAAa,EAAGnT,EAEzMoT,EAAsB,CAClB,MAAMC,EAAUH,IAAc,EACxBb,EAAuBrS,IAAmB,OAC1C,CAACiS,EAAUK,CAAe,EAAI,KAAK,aAAatT,EAAQqU,EAAU1C,EAAa,gCAAkCA,EAAa,wBAAyB,CACzJ,QAAAyB,EACA,iBAAAQ,CACZ,CAAS,EACDC,EAAY,KAAK,IAAIA,EAAW,CAAC,EAC7BR,IACArS,EAAiB,KAAK,QAAQ,qBAAqB,CAAE,CAAA,GAEzDA,EAAe,iBAAiB,sCAAsCoS,CAAO,qBAAqBQ,CAAgB,EAAE,EACpH,IAAIU,EAYJ,GAXI1U,EAAoB,kBAAkB+T,CAAe,GACrDW,EAAaX,EAAgB,mBACvBP,GAAW,CAACQ,GAAoBG,IAAW,GAAKF,IAAc,IAEhEF,EAAkB,UAItBW,EAAaX,EACbA,EAAkB,QAElB,CAACW,EACD,OAEAD,GACA,KAAK,eAAe,WAAW,KAAK,gBAAiB,EAAG,IAAI,aAAa,CAACL,EAAOC,EAAOC,EAAWC,CAAU,CAAC,EAAG,EAAG,EAAI,CAAC,EAE7H,MAAMZ,EAAwBI,EACxBY,EAAgBhB,GAAuB,yBACzC,KAAK,cAAc,CAAE,MAAA1T,EAAO,OAAAC,EAAQ,OAAQ,CAAG,EAAE,GAAO,GAAO,GAAO,GAAO,GAAOE,EAAQ,EAAGgB,EAAgB,GAA6J,OAAW,+BAA+B,EACpTwS,EAAuBD,GAAuB,6BAA+B,CAC/E,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,4BAA4BvT,CAAM,IAAIoT,EAAU,UAAY,aAAa,IAAIQ,EAAmB,mBAAqB,sBAAsB,GAC7L,iBAAkB,CACd,CACI,KAAMW,EAAc,WAAW,CAC3B,OAAAvU,EACA,UAAW,KACX,aAAc,EACd,cAAe,EACf,gBAAiB,EACjB,eAAgB,CACxC,CAAqB,EACD,OAAQ,OACR,QAAS,OACZ,CACJ,CACb,EACcyT,EAAczS,EAAe,gBAAgBwS,CAAoB,EACvE,IAAIE,EAAYW,EAAUd,GAAuB,8BAAgCA,GAAuB,sBACxG,GAAI,CAACG,EAAW,CACZ,MAAM7C,EAAa,CACf,OAAQyC,EACR,QAAS,CACL,CACI,QAAS,EACT,SAAUgB,EAAW,WAAW,CAC5B,OAAAtU,EACA,UAAW,KACX,aAAc8T,EACd,cAAe,EACf,gBAAiBC,EACjB,eAAgBF,CAC5C,CAAyB,CACJ,CACJ,CACjB,EACgBQ,GACAxD,EAAW,QAAQ,KAAK,CACpB,QAAS,EACT,SAAU,CACN,OAAQ,KAAK,eAChB,CACrB,CAAiB,EAEL6C,EAAY,KAAK,QAAQ,gBAAgB7C,CAAU,CACtD,CACD4C,EAAY,YAAYR,CAAQ,EAChCQ,EAAY,aAAa,EAAGC,CAAS,EACrCD,EAAY,KAAK,EAAG,EAAG,EAAG,CAAC,EAC3BA,EAAY,IAAG,EACfzS,EAAe,qBAAqB,CAChC,QAASuT,CACrB,EAAW,CACC,QAASD,EACT,SAAAR,EACA,OAAQ,CACJ,EAAG,EACH,EAAG,EACH,EAAGD,CACN,CACb,EAAW,CACC,MAAOK,GAAarU,EACpB,OAAQsU,GAAcrU,EACtB,mBAAoB,CAChC,CAAS,EACGyT,GACAA,EAAsB,wBAA0BgB,EAChDhB,EAAsB,4BAA8BC,EAChDa,EACAd,EAAsB,8BAAgCG,EAGtDH,EAAsB,sBAAwBG,GAIlD,KAAK,yBAAyB,KAAK,CAACa,EAAe,IAAI,CAAC,EAE5DvT,EAAe,gBAAa,EACxBqS,IACA,KAAK,QAAQ,MAAM,OAAO,CAACrS,EAAe,OAAQ,CAAA,CAAC,EACnDA,EAAiB,KAExB,CAID,cAAcd,EAAasU,EAAa,GAAOC,EAAkB,GAAOrB,EAAU,GAAOQ,EAAmB,GAAOpD,EAAO,GAAOxQ,EAAS,aAA6DK,EAAc,EAAGW,EAAgB0T,EAAQ,GAAIC,EAAmB,EAAGC,EAAO,CAC7QvU,EAAcT,EAAoB,UAAUS,CAAW,EACvD,MAAMwU,EAAa3U,EAAY,QAAU,EACnC4U,EAAc,CAChB,MAAO5U,EAAY,MACnB,OAAQA,EAAY,OACpB,mBAAoB2U,CAChC,EACcE,EAAuBjD,EAA+B9R,CAAM,EAAI,GAAyD,EACzHgV,EAAqBpV,EAAoB,mBAAmBI,CAAM,EAClEiV,EAAgBT,EAAa5U,EAAoB,uBAAuBM,EAAY,MAAOA,EAAY,MAAM,EAAI,EACjHgV,EAASR,GAAS,EAAIA,EAAQ,EACpCC,GAAoBH,GAAc,CAACQ,EAAqB,EAA+CD,EAAuB,EAC1H,CAACC,GAAsB,CAACxE,IAExBmE,GAAoBI,EAAuB,GAE/C,MAAMT,EAAa,KAAK,QAAQ,cAAc,CAC1C,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,WAAW9D,EAAO,KAAO,IAAI,IAAIoE,EAAQA,EAAQ,IAAM,EAAE,GAAGE,EAAY,KAAK,IAAIA,EAAY,MAAM,IAAIA,EAAY,kBAAkB,IAAIN,EAAa,QAAU,QAAQ,IAAIxU,CAAM,WAAWK,CAAW,GAC1P,KAAMyU,EACN,UAAWtE,EAAO,KAAkD,KACpE,OAAAxQ,EACA,MAAOkV,EAASP,EAChB,YAAAtU,EACA,cAAA4U,CACZ,CAAS,EACD,OAAIrV,EAAoB,cAAcM,CAAW,IAC7C,KAAK,cAAcA,EAAaoU,EAAYpU,EAAY,MAAOA,EAAY,OAAQ2U,EAAY7U,EAAQ,EAAG,EAAGoT,EAASQ,EAAkB,EAAG,CAAC,EACxIY,GAAcC,GACd,KAAK,gBAAgBH,EAAYtU,EAAQiV,EAAe,EAAGzE,EAAMxP,CAAc,GAGhFsT,CACV,CACD,kBAAkBa,EAAcX,EAAa,GAAOC,EAAkB,GAAOrB,EAAU,GAAOQ,EAAmB,GAAO5T,EAAS,aAA6DK,EAAc,EAAGW,EAAgB0T,EAAQ,GAAIC,EAAmB,EAAGC,EAAO,CACpQvU,EAAcT,EAAoB,UAAUS,CAAW,EACvD,MAAMR,EAAQD,EAAoB,mBAAmBuV,CAAY,EAAIA,EAAa,CAAC,EAAE,MAAQA,EAAa,MACpGrV,EAASF,EAAoB,mBAAmBuV,CAAY,EAAIA,EAAa,CAAC,EAAE,OAASA,EAAa,OACtGJ,EAAuBjD,EAA+B9R,CAAM,EAAI,GAAyD,EACzHgV,EAAqBpV,EAAoB,mBAAmBI,CAAM,EAClEiV,EAAgBT,EAAa5U,EAAoB,uBAAuBC,EAAOC,CAAM,EAAI,EACzFoV,EAASR,GAAS,EAAIA,EAAQ,EACpCC,GAAoBH,GAAc,CAACQ,EAAqB,EAA+CD,EAAuB,EACzHC,IAEDL,GAAoBI,EAAuB,GAE/C,MAAMT,EAAa,KAAK,QAAQ,cAAc,CAC1C,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,gBAAgBM,EAAQA,EAAQ,IAAM,EAAE,GAAG/U,CAAK,IAAIC,CAAM,MAAM0U,EAAa,QAAU,QAAQ,IAAIxU,CAAM,WAAWK,CAAW,GACjL,KAAM,CACF,MAAAR,EACA,OAAAC,EACA,mBAAoB,CACvB,EACD,UAAW,KACX,OAAAE,EACA,MAAOkV,EAASP,EAChB,YAAAtU,EACA,cAAA4U,CACZ,CAAS,EACD,OAAIrV,EAAoB,mBAAmBuV,CAAY,IACnD,KAAK,mBAAmBA,EAAcb,EAAYzU,EAAOC,EAAQE,EAAQoT,EAASQ,EAAkB,EAAG,CAAC,EACpGY,GAAcC,GACd,KAAK,oBAAoBH,EAAYtU,EAAQiV,EAAejU,CAAc,GAG3EsT,CACV,CACD,oBAAoBA,EAAYtU,EAAQiV,EAAejU,EAAgB,CACnE,MAAMqS,EAAuBrS,IAAmB,OAC5CqS,IACArS,EAAiB,KAAK,QAAQ,qBAAqB,CAAE,CAAA,GAEzDA,EAAe,iBAAiB,yBAAyBiU,CAAa,SAAS,EAC/E,QAASG,EAAI,EAAGA,EAAI,EAAG,EAAEA,EACrB,KAAK,gBAAgBd,EAAYtU,EAAQiV,EAAeG,EAAG,GAAOpU,CAAc,EAEpFA,EAAe,gBAAa,EACxBqS,IACA,KAAK,QAAQ,MAAM,OAAO,CAACrS,EAAe,OAAQ,CAAA,CAAC,EACnDA,EAAiB,KAExB,CACD,gBAAgB2S,EAAiB3T,EAAQiV,EAAepB,EAAY,EAAGrD,EAAO,GAAOxP,EAAgB,CACjG,MAAMqS,EAAuBrS,IAAmB,OAC1C,CAACiS,EAAUK,CAAe,EAAI,KAAK,aAAatT,CAAM,EAC5D6T,EAAY,KAAK,IAAIA,EAAW,CAAC,EAC7BR,IACArS,EAAiB,KAAK,QAAQ,qBAAqB,CAAE,CAAA,GAEzDA,EAAe,iBAAiB,4BAA4B6S,CAAS,MAAMoB,CAAa,SAAS,EACjG,IAAIX,EAUJ,GATI1U,EAAoB,kBAAkB+T,CAAe,GACrDW,EAAaX,EAAgB,mBAC7BA,EAAgB,0BAA4BA,EAAgB,2BAA6B,CAAA,EACzFA,EAAgB,oBAAsBA,EAAgB,qBAAuB,CAAA,IAG7EW,EAAaX,EACbA,EAAkB,QAElB,CAACW,EACD,OAEJ,MAAMf,EAAwBI,EAC9B,QAAS9S,EAAI,EAAGA,EAAIoU,EAAe,EAAEpU,EAAG,CACpC,MAAM2S,EAAuBD,GAAuB,0BAA0BM,CAAS,IAAIhT,EAAI,CAAC,GAAK,CACjG,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,oBAAoBb,CAAM,aAAa6T,CAAS,SAAShT,CAAC,GAC5G,iBAAkB,CACd,CACI,KAAMyT,EAAW,WAAW,CACxB,OAAAtU,EACA,UAAWwQ,EAAO,KAAsD,KACxE,aAAc3P,EACd,cAAe,EACf,gBAAiB,EACjB,eAAgBgT,CAC5C,CAAyB,EACD,OAAQ,OACR,QAAS,OACZ,CACJ,CACjB,EACgBN,IACAA,EAAsB,0BAA0BM,CAAS,EAAIN,EAAsB,0BAA0BM,CAAS,GAAK,GAC3HN,EAAsB,0BAA0BM,CAAS,EAAEhT,EAAI,CAAC,EAAI2S,GAExE,MAAMC,EAAczS,EAAe,gBAAgBwS,CAAoB,EACjEE,EAAYH,GAAuB,oBAAoBM,CAAS,IAAIhT,EAAI,CAAC,GAC3E,KAAK,QAAQ,gBAAgB,CACzB,OAAQyS,EACR,QAAS,CACL,CACI,QAAS,EACT,SAAUgB,EAAW,WAAW,CAC5B,OAAAtU,EACA,UAAWwQ,EAAO,KAAsD,KACxE,aAAc3P,EAAI,EAClB,cAAe,EACf,gBAAiB,EACjB,eAAgBgT,CAChD,CAA6B,CACJ,EACD,CACI,QAAS,EACT,SAAU,KAAK,cAClB,CACJ,CACrB,CAAiB,EACDN,IACAA,EAAsB,oBAAoBM,CAAS,EAAIN,EAAsB,oBAAoBM,CAAS,GAAK,GAC/GN,EAAsB,oBAAoBM,CAAS,EAAEhT,EAAI,CAAC,EAAI6S,GAElED,EAAY,YAAYR,CAAQ,EAChCQ,EAAY,aAAa,EAAGC,CAAS,EACrCD,EAAY,KAAK,EAAG,EAAG,EAAG,CAAC,EAC3BA,EAAY,IAAG,CAClB,CACDzS,EAAe,gBAAa,EACxBqS,IACA,KAAK,QAAQ,MAAM,OAAO,CAACrS,EAAe,OAAQ,CAAA,CAAC,EACnDA,EAAiB,KAExB,CACD,mCAAmCf,EAASJ,EAAOC,EAAQ2Q,EAAO4E,EAAeC,EAAuB,CAC/FrV,EAAQ,mBACTA,EAAQ,iBAAmB,IAAI+P,GAAsB,KAAK,OAAO,GAEjEnQ,IAAU,SACVA,EAAQI,EAAQ,OAEhBH,IAAW,SACXA,EAASG,EAAQ,QAEjBwQ,IAAU,SACVA,EAAQxQ,EAAQ,OAEpB,MAAMsV,EAAoBtV,EAAQ,iBAC5BoO,IAAqBgH,GAAiB,GAAK,KAAO,EACxDE,EAAkB,OAAS3V,EAAoB,uBAAuBK,EAAQ,KAAMA,EAAQ,OAAQA,EAAQ,cAAc,EAC1HsV,EAAkB,cACdtV,EAAQ,UAAY,GAA8CA,EAAQ,SAAW,EAC/E,GACAA,EAAQ,UAAY,GAChB,GACA,GACdsV,EAAkB,wBAA0BlH,EAAmB,EAAsD,EACrH,MAAMmH,EAAavV,EAAQ,gBACrB4U,EAAapE,GAAS,EAC5B,IAAIvP,EAOJ,GANIjB,EAAQ,eAAiB,KACzBiB,EAAcjB,EAAQ,aAGtBiB,EAAcsU,EAAa5V,EAAoB,uBAAuBC,EAAOC,CAAM,EAAI,EAEvFG,EAAQ,OAAQ,CAChB,MAAMqU,EAAa,KAAK,kBAAkB,CAAE,MAAAzU,EAAO,OAAAC,GAAUG,EAAQ,gBAAiBA,EAAQ,gBAAiBA,EAAQ,QAAS,GAAOsV,EAAkB,OAAQ,EAAG,KAAK,2BAA4BA,EAAkB,cAAeA,EAAkB,wBAAyBtV,EAAQ,KAAK,EAC9RsV,EAAkB,IAAIjB,CAAU,EAChC,MAAM3D,EAAkB1Q,EAAQ,KAAO,EAAI4U,EACrC7U,EAASJ,EAAoB,mBAAmB2V,EAAkB,MAAM,EACxE3E,EAAShR,EAAoB,0BAA0B2V,EAAkB,MAAM,EAAI,aAA6D,MAChJ7Q,EAAYzE,EAAQ,UAAY,aAAoE,OAC1GsV,EAAkB,WAAW,CACzB,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,mBAAmBtV,EAAQ,UAAY,SAAW0Q,EAAkB,EAAE,IAAI9Q,CAAK,IAAIC,CAAM,IAAI0V,EAAa,QAAU,QAAQ,IAAIxV,CAAM,IAAI0E,CAAS,IAAIkM,CAAM,IAAI3Q,EAAQ,OAAS,QAAQ,GAC5O,OAAAD,EACA,UAAA0E,EACA,cAAexD,EACf,eAAgB,EAChB,aAAc,EACd,gBAAiB,EACjB,OAAA0P,CACH,EAAEvC,CAAgB,CACtB,KACI,CACD,MAAMiG,EAAa,KAAK,cAAc,CAAE,MAAAzU,EAAO,OAAAC,EAAQ,OAAQ+U,CAAU,EAAI5U,EAAQ,gBAAiBA,EAAQ,gBAAiBA,EAAQ,QAAS,GAAOA,EAAQ,KAAMsV,EAAkB,OAAQ,EAAG,KAAK,2BAA4BA,EAAkB,cAAeA,EAAkB,wBAAyBtV,EAAQ,KAAK,EAC5TsV,EAAkB,IAAIjB,CAAU,EAChC,MAAM3D,EAAkB1Q,EAAQ,KAAO,EAAI4U,EACrC7U,EAASJ,EAAoB,mBAAmB2V,EAAkB,MAAM,EACxE3E,EAAShR,EAAoB,0BAA0B2V,EAAkB,MAAM,EAAI,aAA6D,MAChJ7Q,EAAYzE,EAAQ,UACpB,WACAA,EAAQ,KACJ,KACA,KACVsV,EAAkB,WAAW,CACzB,MAAO,sBAAsB,KAAK,QAAQ,QAAQ,eAAetV,EAAQ,KAAO,KAAO,IAAI,GAAGA,EAAQ,UAAY,SAAW0Q,EAAkB,EAAE,IAAI9Q,CAAK,IAAIC,CAAM,GAAGG,EAAQ,KAAO,IAAM4U,EAAa,EAAE,IAAIW,EAAa,QAAU,QAAQ,IAAIxV,CAAM,IAAI0E,CAAS,IAAIkM,CAAM,IAAI3Q,EAAQ,OAAS,QAAQ,GAC5S,OAAAD,EACA,UAAA0E,EACA,cAAexD,EACf,eAAgB,EAChB,aAAc,EACd,gBAAAyP,EACA,OAAAC,CACH,EAAEvC,CAAgB,CACtB,CACD,OAAApO,EAAQ,MAAQA,EAAQ,UAAYJ,EACpCI,EAAQ,OAASA,EAAQ,WAAaH,EACtCG,EAAQ,MAAQA,EAAQ,UAAYwQ,EAC/B6E,GACD,KAAK,kBAAkBrV,EAASA,EAAQ,OAAO,EAE5CsV,CACV,CACD,kBAAkBtV,EAASwV,EAASC,EAAkB,GAAM3P,EAAQ,EAAG,CACnE,MAAMwP,EAAoBtV,EAAQ,iBAIlC,GAHIyV,GACAH,GAAmB,mBAAkB,EAErC,CAACA,IAAsBE,GAAW,IAAM,EACxC,OAEJ,MAAM5V,EAAQI,EAAQ,MAChBH,EAASG,EAAQ,OACjB0V,EAAiB,KAAK,cAAc,CAAE,MAAA9V,EAAO,OAAAC,EAAQ,OAAQ,CAAG,EAAE,GAAO,GAAO,GAAO,GAAO,GAAOyV,EAAkB,OAAQE,EAAS,KAAK,2BAA4B,GAAwD,EAAGxV,EAAQ,MAAQ,QAAUA,EAAQ,MAAQ,MAAM,EAC1RsV,EAAkB,eAAeI,EAAgB5P,CAAK,CACzD,CAID,mBAAmBoP,EAAcb,EAAYzU,EAAOC,EAAQE,EAAQoT,EAAU,GAAOQ,EAAmB,GAAOgC,EAAU,EAAGC,EAAU,EAAG,CACrI,MAAMC,EAAQ,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC/B,QAASV,EAAI,EAAGA,EAAIU,EAAM,OAAQ,EAAEV,EAAG,CACnC,MAAMlV,EAAciV,EAAaW,EAAMV,CAAC,CAAC,EACzC,KAAK,cAAclV,EAAaoU,EAAYzU,EAAOC,EAAQ,EAAGE,EAAQoV,EAAG,EAAGhC,EAASQ,EAAkBgC,EAASC,CAAO,CAC1H,CACJ,CAED,cAAc3V,EAAaD,EAASJ,EAAOC,EAAQiU,EAAQ/T,EAAQ6T,EAAY,EAAGC,EAAW,EAAGV,EAAU,GAAOQ,EAAmB,GAAOgC,EAAU,EAAGC,EAAU,EAAGzB,EAAsB,CACvL,MAAME,EAAa1U,EAAoB,kBAAkBK,CAAO,EAAIA,EAAQ,iBAAiB,mBAAqBA,EAC5G8V,EAAmBnW,EAAoB,8BAA8BI,CAAM,EAC3E2T,EAAkB/T,EAAoB,kBAAkBK,CAAO,EAAIA,EAAQ,iBAAmBA,EAC9F+V,EAAkB,CACpB,QAAS1B,EACT,OAAQ,CACJ,EAAGsB,EACH,EAAGC,EACH,EAAG,KAAK,IAAIhC,EAAW,CAAC,CAC3B,EACD,SAAUC,EACV,mBAAoBF,CAChC,EACcqC,EAAgB,CAClB,MAAO,KAAK,KAAKpW,EAAQkW,EAAiB,KAAK,EAAIA,EAAiB,MACpE,OAAQ,KAAK,KAAKjW,EAASiW,EAAiB,MAAM,EAAIA,EAAiB,OACvE,mBAAoBhC,GAAU,CAC1C,EACQ,GAAI7T,EAAY,aAAe,OAAW,CACtCA,EAAcA,EACd,MAAMgW,EAAc,KAAK,KAAKrW,EAAQkW,EAAiB,KAAK,EAAIA,EAAiB,OAEjF,GADgB,KAAK,KAAKG,EAAc,GAAG,EAAI,MAAQA,EAC1C,CACT,MAAMlV,EAAiB,KAAK,QAAQ,qBAAqB,CAAE,CAAA,EACrDmV,EAAS,KAAK,eAAe,gBAAgBjW,EAAY,WAAYkS,EAA4B,SAAWA,EAA4B,QAAS,GAAM,8BAAgCkC,EAAa,IAAMA,EAAW,MAAQ,GAAG,EAChO8B,EAAcD,EAAO,iBAC3B,IAAI,WAAWC,CAAW,EAAE,IAAIlW,CAAW,EAC3CiW,EAAO,MAAK,EACZnV,EAAe,oBAAoB,CAC/B,OAAQmV,EACR,OAAQ,EACR,YAAAD,EACA,aAAcpW,CAClC,EAAmBkW,EAAiBC,CAAa,EACjC,KAAK,QAAQ,MAAM,OAAO,CAACjV,EAAe,OAAQ,CAAA,CAAC,EACnD,KAAK,eAAe,cAAcmV,CAAM,CAC3C,MAEG,KAAK,QAAQ,MAAM,aAAaH,EAAiB9V,EAAa,CAC1D,OAAQ,EACR,YAAAgW,EACA,aAAcpW,CACjB,EAAEmW,CAAa,EAEpB,GAAI7C,GAAWQ,EACX,GAAIhU,EAAoB,kBAAkBK,CAAO,EAAG,CAChD,MAAMoW,EAAcT,IAAY,GAAKC,IAAY,GAAKhW,IAAUI,EAAQ,OAASH,IAAWG,EAAQ,OACpG,KAAK,wBAAwB0T,EAAiB1T,EAAQ,MAAOA,EAAQ,OAAQD,EAAQoT,EAASQ,EAAkBC,EAAWC,EAAUC,GAAU,EAAG6B,EAASC,EAASQ,EAAc,EAAIxW,EAAOwW,EAAc,EAAIvW,EAAQ,OAAWsU,CAAoB,CACzP,KAIG,MAAM,gHAGjB,MAEGlU,EAAcA,EACd,KAAK,QAAQ,MAAM,2BAA2B,CAAE,OAAQA,EAAa,MAAOkT,CAAO,EAAI4C,EAAiBC,CAAa,CAE5H,CACD,WAAWhW,EAASyG,EAAGC,EAAG9G,EAAOC,EAAQE,EAAQ6T,EAAY,EAAGC,EAAW,EAAGqC,EAAS,KAAMG,EAAmB,GAAO,CACnH,MAAMP,EAAmBnW,EAAoB,8BAA8BI,CAAM,EAC3EkW,EAAc,KAAK,KAAKrW,EAAQkW,EAAiB,KAAK,EAAIA,EAAiB,OAC3EQ,EAAqB,KAAK,KAAKL,EAAc,GAAG,EAAI,IACpD3P,EAAOgQ,EAAqBzW,EAC5B0W,EAAY,KAAK,eAAe,gBAAgBjQ,EAAM6L,EAA4B,QAAUA,EAA4B,QAAS,OAAW,2BAA6BnS,EAAQ,MAAQ,IAAMA,EAAQ,MAAQ,GAAG,EAClNe,EAAiB,KAAK,QAAQ,qBAAqB,CAAE,CAAA,EAC3D,OAAAA,EAAe,oBAAoB,CAC/B,QAAAf,EACA,SAAA6T,EACA,OAAQ,CACJ,EAAApN,EACA,EAAAC,EACA,EAAG,KAAK,IAAIkN,EAAW,CAAC,CAC3B,CACb,EAAW,CACC,OAAQ2C,EACR,OAAQ,EACR,YAAaD,CACzB,EAAW,CACC,MAAA1W,EACA,OAAAC,EACA,mBAAoB,CAChC,CAAS,EACD,KAAK,QAAQ,MAAM,OAAO,CAACkB,EAAe,OAAQ,CAAA,CAAC,EAC5C,KAAK,eAAe,mBAAmBwV,EAAWjQ,EAAM1G,EAAOC,EAAQoW,EAAaK,EAAoB3W,EAAoB,yBAAyBI,CAAM,EAAG,EAAGmW,EAAQ,GAAMG,CAAgB,CACzM,CAID,eAAerW,EAAS,CACpB,GAAIL,EAAoB,kBAAkBK,CAAO,EAAG,CAChD,MAAMkQ,EAAkBlQ,EAAQ,iBAC1BwW,EAAoBxW,EAAQ,mBAElC,KAAK,yBAAyB,KAAK,CAACkQ,EAAiBsG,CAAiB,CAAC,CAC1E,MAEG,KAAK,yBAAyB,KAAK,CAACxW,EAAS,IAAI,CAAC,CAEzD,CACD,yBAA0B,CACtB,QAASY,EAAI,EAAGA,EAAI,KAAK,yBAAyB,OAAQ,EAAEA,EAAG,CAC3D,KAAM,CAACsP,EAAiBsG,CAAiB,EAAI,KAAK,yBAAyB5V,CAAC,EACxEsP,IACIvQ,EAAoB,kBAAkBuQ,CAAe,EACrDA,EAAgB,QAAO,EAGvBA,EAAgB,QAAO,GAG/BsG,GAAmB,QAAO,CAC7B,CACD,KAAK,yBAAyB,OAAS,CAC1C,CACL,CCr9BO,MAAMC,WAAyBC,EAAW,CAC7C,IAAI,OAAOR,EAAQ,CACf,KAAK,QAAUA,CAClB,CACD,YAAYS,EAAUC,EAAW,EAAG,CAChC,QAEA,KAAK,SAAW,GAChB,KAAK,SAAWA,EACZD,IACA,KAAK,QAAUA,EAEtB,CACD,IAAI,oBAAqB,CACrB,OAAO,KAAK,OACf,CACL,CCXO,MAAME,EAAoB,CAC7B,OAAO,aAAaX,EAAQ,CACxB,OAAOA,EAAO,qBAAuB,MACxC,CACD,OAAO,eAAeY,EAAOC,EAAS,GAAI,CACtC,IAAIC,EAASD,EACb,QAASnW,EAAI,EAAGA,GAAK,EAAG,EAAEA,EAClBkW,EAAS,GAAKlW,IACVoW,IACAA,GAAU,KAEdA,GAAU7E,EAA4B,GAAKvR,CAAC,GAGpD,OAAOoW,CACV,CACD,YAAY5R,EAAQ2M,EAAQ,CACxB,KAAK,wBAA0B,GAC/B,KAAK,QAAU3M,EACf,KAAK,QAAU2M,CAClB,CACD,gBAAgBkF,EAAYH,EAAOI,EAAmB,GAAOvC,EAAO,CAChE,MAAMwC,EAAgBF,EAAW,aAAe,OAAaA,EAAW,WAAa,EAAK,GAAMA,EAAa,EAAK,GAC5GG,EAA2B,CAC7B,MAAO,sBAAwB,KAAK,QAAQ,SAAW,IAAMP,GAAoB,eAAeC,EAAOnC,GAAS,QAAQ,EAAI,QAAUwC,EACtI,iBAAAD,EACA,KAAMC,EACN,MAAOL,CACnB,EACQ,OAAO,KAAK,QAAQ,aAAaM,CAAwB,CAC5D,CACD,aAAaH,EAAYH,EAAOnC,EAAO,CACnC,MAAM0C,EAASJ,EAAW,aAAe,OACnCK,EAAa,IAAIb,GACjBc,EAAU,sBAAwBD,EAAW,SACnD,OAAAA,EAAW,OAAS,KAAK,gBAAgBL,EAAYH,EAAO,OAAWnC,EAAQ4C,EAAU,IAAM5C,EAAQ4C,CAAO,EAC9GD,EAAW,WAAa,EACxBA,EAAW,SAAWD,EAASJ,EAAW,WAAaA,EACvDK,EAAW,SAAW,KAAK,QAAQ,SAC/BD,GACA,KAAK,WAAWC,EAAY,EAAGL,CAAU,EAEtCK,CACV,CAGD,WAAWpB,EAAQsB,EAAeC,EAAKC,EAAeC,EAAY,CAC9DD,GAAiBD,EAAI,WACrB,KAAK,QAAQ,MAAM,YAAYvB,EAAQsB,EAAeC,EAAI,OAAQC,EAAeC,CAAU,CAC9F,CAGD,WAAWL,EAAYE,EAAeC,EAAKC,EAAgB,EAAGC,EAAa,EAAG,CAC1E,MAAMzB,EAASoB,EAAW,mBAC1BK,EAAaA,GAAcF,EAAI,WAAaC,EAE5C,MAAME,EAAWJ,EAAgB,EACjCE,GAAiBE,EACjBJ,GAAiBI,EAEjB,MAAMC,EAAqBF,EAI3B,GAHAA,EAAcA,EAAaC,EAAW,EAAK,GAEjBH,EAAI,OAAO,WAAaA,EAAI,WAC9BE,EAAY,CAIhC,MAAMG,EAAY,IAAI,WAAWH,CAAU,EAC3CG,EAAU,IAAI,IAAI,WAAWL,EAAI,OAAQA,EAAI,WAAaC,EAAeG,CAAkB,CAAC,EAC5FJ,EAAMK,EACNJ,EAAgB,CACnB,CACD,KAAK,WAAWxB,EAAQsB,EAAeC,EAAKC,EAAeC,CAAU,CACxE,CACD,oCAAoCI,EAAY5B,EAAa6B,EAAW,CAC/DA,IACDA,EAAY,IAAI,aAAaD,CAAU,GAE3C,MAAME,EAAU,IAAI,YAAY9B,CAAW,EAC3C,KAAO4B,KACHC,EAAUD,CAAU,EAAIG,GAAcD,EAAQF,CAAU,CAAC,EAE7D,OAAOC,CACV,CACD,mBAAmBzB,EAAWjQ,EAAM1G,EAAOC,EAAQoW,EAAaK,EAAoBpW,EAAO,EAAGiY,EAAS,EAAGjC,EAAS,KAAMkC,EAAgB,GAAM/B,EAAmB,GAAO,CACrK,MAAMgC,EAAcnY,IAAS,EAAI,EAAIA,IAAS,EAAI,EAAI,EAChDoY,EAAW,KAAK,QAAQ,SAC9B,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACpCjC,EAAU,SAAS,EAAsC4B,EAAQ7R,CAAI,EAAE,KAAK,IAAM,CAC9E,MAAMmS,EAAkBlC,EAAU,eAAe4B,EAAQ7R,CAAI,EAC7D,IAAIoS,EAAOxC,EACX,GAAIG,EACIqC,IAAS,KACTA,EAAOC,GAA2BzY,EAAMoG,EAAM,GAAMmS,CAAe,EAGnEC,EAAOC,GAA2BzY,EAAMwY,EAAK,OAAQ,OAAWD,CAAe,UAI/EC,IAAS,KACT,OAAQL,EAAW,CACf,IAAK,GACDK,EAAO,IAAI,WAAWpS,CAAI,EAC1BoS,EAAK,IAAI,IAAI,WAAWD,CAAe,CAAC,EACxC,MACJ,IAAK,GAEDC,EAAO,KAAK,oCAAoCpS,EAAO,EAAGmS,CAAe,EACzE,MACJ,IAAK,GACDC,EAAO,IAAI,aAAapS,EAAO,CAAC,EAChCoS,EAAK,IAAI,IAAI,aAAaD,CAAe,CAAC,EAC1C,KACP,KAGD,QAAQJ,EAAW,CACf,IAAK,GACDK,EAAO,IAAI,WAAWA,EAAK,MAAM,EACjCA,EAAK,IAAI,IAAI,WAAWD,CAAe,CAAC,EACxC,MACJ,IAAK,GAEDC,EAAO,KAAK,oCAAoCpS,EAAO,EAAGmS,EAAiBvC,CAAM,EACjF,MACJ,IAAK,GACDwC,EAAO,IAAI,aAAaA,EAAK,MAAM,EACnCA,EAAK,IAAI,IAAI,aAAaD,CAAe,CAAC,EAC1C,KACP,CAGT,GAAIxC,IAAgBK,EAAoB,CAEhC+B,IAAgB,GAAK,CAAChC,IAEtBJ,GAAe,EACfK,GAAsB,GAE1B,MAAMsC,EAAQ,IAAI,WAAWF,EAAK,MAAM,EACxC,IAAIP,EAASlC,EAAa4C,EAAU,EACpC,QAASnS,EAAI,EAAGA,EAAI7G,EAAQ,EAAE6G,EAAG,CAC7BmS,EAAUnS,EAAI4P,EACd,QAAS7P,EAAI,EAAGA,EAAIwP,EAAa,EAAExP,EAC/BmS,EAAMT,GAAQ,EAAIS,EAAMC,GAAS,CAExC,CACGR,IAAgB,GAAK,CAAChC,EACtBqC,EAAO,IAAI,aAAaE,EAAM,OAAQ,EAAGT,EAAS,CAAC,EAGnDO,EAAO,IAAI,WAAWE,EAAM,OAAQ,EAAGT,CAAM,CAEpD,CACD5B,EAAU,MAAK,EACX6B,GACA,KAAK,cAAc7B,CAAS,EAEhCgC,EAAQG,CAAI,CACf,EAAGI,GAAW,CACP,KAAK,QAAQ,YAAc,KAAK,QAAQ,WAAaR,EAErDC,EAAQ,IAAI,UAAY,EAGxBC,EAAOM,CAAM,CAEjC,CAAa,CACb,CAAS,CACJ,CACD,cAAc5C,EAAQ,CAClB,OAAIW,GAAoB,aAAaX,CAAM,GACvC,KAAK,wBAAwB,KAAKA,CAAM,EACjC,KAEXA,EAAO,aACHA,EAAO,aAAe,GACtB,KAAK,wBAAwB,KAAKA,EAAO,kBAAkB,EACpD,IAEJ,GACV,CACD,wBAAyB,CACrB,QAAStV,EAAI,EAAGA,EAAI,KAAK,wBAAwB,OAAQ,EAAEA,EACvD,KAAK,wBAAwBA,CAAC,EAAE,QAAO,EAE3C,KAAK,wBAAwB,OAAS,CACzC,CACL,CCpMA,MAAMmY,GAAe,CACjB,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,CACJ,EAEMC,GAA2B,CAC5B,EACA,GACA,GACA,GACA,GACA,GACA,GACA,IACA,CACL,EACMC,GAAoB,CACtB,EACA,IACA,IACA,EACA,EACA,EACA,EACA,IACA,EACA,EACA,EACA,EACA,GACJ,EAEO,MAAMC,CAAmB,CAC5B,YAAYnH,EAAQ,CAChB,KAAK,UAAY,GACjB,KAAK,QAAUA,EACf,KAAK,SAAW,EACnB,CACD,OAAO,mBAAmBhM,EAAS,CAE/B,MAAMoT,EAAapT,EAAQ,iCAAmCA,EAAQ,iCAAmC,EASzG,OARagT,GAAahT,EAAQ,YAAY,EAC1CiT,IAA0BjT,EAAQ,qBAAuB,KAAU,IAAS,CAAC,EAC7EkT,GAAkBlT,EAAQ,YAAY,IACpCA,EAAQ,cAAgB,IAAM,KAC9BA,EAAQ,cAAgB,IAAM,MAC9BA,EAAQ,cAAgB,IAAM,MAC9BA,EAAQ,WAAa,EAAI,IAAM,KAChCoT,GAAc,GAEtB,CACD,OAAO,4BAA4BpT,EAASoT,EAAY,CACpD,IAAIC,EAAWC,EAAWC,EAAcC,EAAaC,EACrD,MAAMC,EAAa1T,EAAQ,WAC3B,OAAQA,EAAQ,aAAY,CACxB,IAAK,IACDqT,EAAY,SACZC,EAAY,SACZC,EAAe,UACVG,IACDF,EAAcC,EAAc,GAEhC,MACJ,IAAK,GACL,IAAK,GACDJ,EAAY,SACZC,EAAY,SACPI,EAKDH,EAAe,UAJfA,EAAe,UACfC,EAAcC,EAAc,GAKhC,MACJ,IAAK,GACDJ,EAAY,UACZC,EAAY,UACPI,EAKDH,EAAe,UAJfA,EAAe,UACfC,EAAcC,EAAc,GAKhC,MACJ,IAAK,GACDJ,EAAY,UACZC,EAAY,UACZC,EAAe,UACVG,IACDF,EAAcC,EAAc,GAEhC,MACJ,IAAK,GACDJ,EAAY,UACZC,EAAY,SACZC,EAAe,UACVG,IACDF,EAAcC,EAAc,GAEhC,MACJ,IAAK,GACDJ,EAAY,UACZC,EAAY,SACPI,EAKDH,EAAe,UAJfA,EAAe,UACfC,EAAcC,EAAc,GAKhC,MACJ,IAAK,GACDJ,EAAY,UACZC,EAAY,SACZC,EAAe,UACfC,EAAcC,EAAc,EAC5B,MACJ,IAAK,GACL,IAAK,GACDJ,EAAY,UACZC,EAAY,UACZC,EAAe,UACfC,EAAcC,EAAc,EAC5B,MACJ,IAAK,GACDJ,EAAY,SACZC,EAAY,UACZC,EAAe,UACVG,IACDF,EAAcC,EAAc,GAEhC,MACJ,IAAK,IACDJ,EAAY,SACZC,EAAY,UACPI,EAKDH,EAAe,UAJfA,EAAe,UACfC,EAAcC,EAAc,GAKhC,MACJ,IAAK,GACL,IAAK,GACDJ,EAAY,SACZC,EAAY,SAERF,EAAa,EACbG,EAAe,UAGfA,EAAe,UACfC,EAAcC,EAAc,GAEhC,MACJ,IAAK,IACDJ,EAAY,SACZC,EAAY,UACZC,EAAe,UACfC,EAAcC,EAAc,EAC5B,MACJ,QACIJ,EAAY,UACZC,EAAY,UACZC,EAAe,UACfC,EAAcC,EAAc,EAC5B,KACP,CACD,OAAIL,EAAa,IAAMI,IAAgB,GAAKC,IAAgB,GACjD,CACH,UAAW,SACX,UAAW,SACX,aAAc,SACd,kBAAmB,EACnC,EAEe,CACH,UAAAJ,EACA,UAAAC,EACA,aAAAC,EACA,YAAAC,EACA,YAAAC,CACZ,CACK,CACD,OAAO,iBAAiBE,EAAM,CAC1B,OAAQA,EAAI,CACR,IAAK,GACD,MAAO,SACX,IAAK,GACD,MAAO,gBACX,IAAK,GACD,MAAO,eACd,CACD,MAAO,QACV,CACD,OAAO,8BAA8B3T,EAAS,CAC1C,MAAO,CACH,aAAc,KAAK,iBAAiBA,EAAQ,YAAY,EACxD,aAAc,KAAK,iBAAiBA,EAAQ,YAAY,EACxD,aAAc,KAAK,iBAAiBA,EAAQ,YAAY,CACpE,CACK,CACD,OAAO,sBAAsBA,EAAS4O,EAAO,CAEzC,IAAIwE,GAAcpT,EAAQ,YAAcA,EAAQ,eAAiB,IAAMA,EAAQ,iCACzEA,EAAQ,iCACR,EAEFA,EAAQ,eAAiB,IACzBA,EAAQ,eAAiB,GACzBA,EAAQ,eAAiB,IACzBoT,EAAa,GAEjB,MAAMQ,EAAmB,KAAK,4BAA4B5T,EAASoT,CAAU,EAC7E,MAAO,CACH,MAAAxE,EACA,GAAGgF,EACH,GAAG,KAAK,8BAA8B5T,CAAO,EAC7C,QAASA,EAAQ,oBAAsBmT,EAAmB,mBAAmBnT,EAAQ,mBAAmB,EAAI,OAC5G,cAAe4T,EAAiB,kBAAoBR,EAAa,CAC7E,CACK,CACD,OAAO,mBAAmBS,EAAiB,CACvC,OAAQA,EAAe,CACnB,IAAK,KACD,MAAO,SACX,IAAK,KACD,MAAO,QACX,IAAK,KACD,MAAO,UACX,IAAK,KACD,MAAO,gBACX,IAAK,KACD,MAAO,OACX,IAAK,KACD,MAAO,aACX,IAAK,KACD,MAAO,QACX,IAAK,KACD,MAAO,YACX,QACI,MAAO,MACd,CACJ,CACD,WAAW7T,EAAS8T,EAAc,GAAOC,EAAO,EAAGnF,EAAO,CACtD,GAAI,KAAK,SACL,OAAO,KAAK,QAAQ,cAAcuE,EAAmB,sBAAsBnT,EAAS4O,CAAK,CAAC,EAE1FkF,EACAC,EAAO,EAEFA,IAAS,IACdA,EAAOZ,EAAmB,mBAAmBnT,CAAO,GAExD,IAAIgU,EAAaF,EAAc,OAAY,KAAK,UAAUC,CAAI,EAC9D,OAAKC,IACDA,EAAa,KAAK,QAAQ,cAAcb,EAAmB,sBAAsBnT,EAAS4O,CAAK,CAAC,EAC3FkF,IACD,KAAK,UAAUC,CAAI,EAAIC,IAGxBA,CACV,CACL,CCrRA,MAAMC,GAAwC,CAC1C,CAACC,EAAa,YAAY,EAAG,GAC7B,CAACA,EAAa,UAAU,EAAG,GAC3B,CAACA,EAAa,WAAW,EAAG,GAC5B,CAACA,EAAa,MAAM,EAAG,GACvB,CAACA,EAAa,OAAO,EAAG,GACxB,CAACA,EAAa,OAAO,EAAG,GACxB,CAACA,EAAa,OAAO,EAAG,GACxB,CAACA,EAAa,OAAO,EAAG,GACxB,CAACA,EAAa,OAAO,EAAG,GACxB,CAACA,EAAa,SAAS,EAAG,GAC1B,CAACA,EAAa,iBAAiB,EAAG,GAClC,CAACA,EAAa,mBAAmB,EAAG,GACpC,CAACA,EAAa,mBAAmB,EAAG,GACpC,CAACA,EAAa,wBAAwB,EAAG,GACzC,CAACA,EAAa,wBAAwB,EAAG,EAC7C,EAMA,SAASC,GAAaha,EAAM,CACxB,OAAQA,EAAI,CACR,KAAK+Z,EAAa,KAClB,KAAKA,EAAa,MAClB,KAAKA,EAAa,IAClB,KAAKA,EAAa,MACd,MAAO,GACX,KAAKA,EAAa,cAClB,KAAKA,EAAa,eAClB,KAAKA,EAAa,aACd,MAAO,GACX,QACI,MAAM,IAAI,MAAM,iBAAiB/Z,CAAI,GAAG,CAC/C,CACL,CAOO,SAASia,GAA2BC,EAAe/U,EAAQ,CAC9D,MAAMD,EAASC,EAAO,YAChBgV,EAAkBhV,EAAO,iBAC/B,GAAI,CAACgV,GAAiB,uBAClB,OAEJ,IAAIlV,EAA0B,KAC9B,UAAWmV,KAAQF,EAAe,CAC9B,MAAMG,EAAsBH,EAAcE,CAAI,EAC9C,GAAI,CAACC,GAAuB,CAACP,GAAsCM,CAAI,EACnE,SAEJ,MAAME,EAA0BD,EAAoB,WAAaN,EAAa,MAAQM,EAAoB,KACpGE,EAAmBJ,EAAgB,uBAAuBC,CAAI,GAC/DE,IAA4BP,EAAa,OAASQ,IAAqB,QACvEA,IAAqB,QAAaA,IAAqBD,KACnDrV,IACDA,EAA0BC,EAAO,4BAA4BC,EAAO,eAAgB,EAAK,GAE7FgV,EAAgB,uBAAuBC,CAAI,EAAIE,EAC3CA,IAA4BP,EAAa,QACzC9U,EAAwB,qCAAqCmV,CAAI,EAAIL,EAAa,aAAaK,CAAI,EAC/FJ,GAAaM,CAAuB,IACpCrV,EAAwB,qCAAqCmV,CAAI,GAAK,KAIrF,CACD,GAAInV,EAAyB,CAGzB,MAAMuV,EAAwBtV,EAAO,MAAM,sBAC3CA,EAAO,MAAM,sBAAwB,OACrCC,EAAO,wBAAwB,KAAMD,EAAO,UAAU,uDAAwDD,CAAuB,EACrIC,EAAO,MAAM,sBAAwBsV,CACxC,CACL,CCvEA,IAAIC,GACH,SAAUA,EAAe,CACtBA,EAAcA,EAAc,gBAAqB,CAAC,EAAI,kBACtDA,EAAcA,EAAc,iBAAsB,CAAC,EAAI,mBAEvDA,EAAcA,EAAc,UAAe,CAAC,EAAI,YAChDA,EAAcA,EAAc,oBAAyB,CAAC,EAAI,sBAC1DA,EAAcA,EAAc,kBAAuB,CAAC,EAAI,oBACxDA,EAAcA,EAAc,gBAAqB,CAAC,EAAI,kBACtDA,EAAcA,EAAc,gBAAqB,CAAC,EAAI,kBACtDA,EAAcA,EAAc,mBAAwB,CAAC,EAAI,qBACzDA,EAAcA,EAAc,YAAiB,CAAC,EAAI,cAClDA,EAAcA,EAAc,YAAiB,CAAC,EAAI,cAClDA,EAAcA,EAAc,aAAkB,EAAE,EAAI,eACpDA,EAAcA,EAAc,YAAiB,EAAE,EAAI,cACnDA,EAAcA,EAAc,UAAe,EAAE,EAAI,WACrD,GAAGA,IAAkBA,EAAgB,CAAE,EAAC,EACxC,MAAMC,EAA0B,CAC5B,EAAG,EACH,EAAG,EACH,IAAQ,EACR,IAAQ,EACR,IAAQ,EACR,IAAQ,EACR,IAAQ,EACR,IAAQ,EACR,IAAQ,EACR,IAAQ,GACR,IAAQ,GACR,MAAQ,GACR,MAAQ,GACR,MAAQ,GACR,MAAQ,EACZ,EACMC,EAAmB,CACrB,EAAQ,EACR,KAAQ,EACR,KAAQ,EACR,KAAQ,EACR,KAAQ,EACR,KAAQ,EACR,MAAQ,EACR,MAAQ,CACZ,EAEO,MAAMC,CAA0B,CACnC,YAAY/I,EAAQgJ,EAAmB,CACnC,KAAK,gBAAkB,EACvB,KAAK,QAAUhJ,EACf,KAAK,iBAAmB,GACxB,KAAK,QAAU,IAAI,MAAM,EAAE,EAC3B,KAAK,cAAgB,EACrB,KAAK,uBAAyB,EAC9B,KAAK,mBAAqBgJ,EAC1B,KAAK,YAAc,GACnB,KAAK,WAAa,CAAE,MAAO,OAAW,SAAU,MAChD,KAAK,SAAW,GAChB,KAAK,cAAgB,GACrB,KAAK,wBAA0BhJ,EAAO,OAAO,4BAA8B,KAC3E,KAAK,MAAK,CACb,CACD,OAAQ,CACJ,KAAK,SAAW,GAChB,KAAK,cAAc,OAAS,EAC5B,KAAK,mBAAmB,EAAK,EAC7B,KAAK,uBAAsB,EAC3B,KAAK,cAAc,EAAK,EACxB,KAAK,aAAa,CAAC,EAEnB,KAAK,mBAAqB,CAAC,cAC3B,KAAK,eAAe,cACpB,KAAK,OAAO,CAAA,CAAE,EACd,KAAK,qBAAqB,EAAK,EAC/B,KAAK,qBAAqB,CAAC,KAAM,KAAM,KAAM,IAAI,EAAG,CAAC,KAAM,IAAI,CAAC,EAChE,KAAK,aAAa,EAAG,EACrB,KAAK,sBAAsB,wBAC3B,KAAK,kBAAkB,EAAK,EAC5B,KAAK,kBAAiB,EACtB,KAAK,WAAW,KAAM,KAAM,IAAI,EAChC,KAAK,iBAAiB,CAAC,CAC1B,CACD,IAAI,cAAe,CACf,OAAO,KAAK,iBAAmB,EAAI,KAAK,YAAc,KAAK,kBAC9D,CACD,kBAAkBiJ,EAAU3V,EAAQjF,EAAa6a,EAAe,EAAG,CAE/D,GADA7a,EAAcT,EAAoB,UAAUS,CAAW,EACnD,KAAK,SAAU,CACf,MAAM8a,EAAWJ,EAA0B,aAAaE,CAAQ,EAChE,YAAK,gBAAgB3V,CAAM,EAC3B,KAAK,iBAAiB4V,CAAY,EAClC,KAAK,WAAW,SAAW,KAAK,sBAAsB5V,EAAQ6V,EAAU9a,CAAW,EACnF0a,EAA0B,eAC1BA,EAA0B,mCACnB,KAAK,WAAW,QAC1B,CAQD,GAPA,KAAK,gBAAgBzV,EAAO,QAAQ,EACpC,KAAK,uBAAuB2V,EAAU5a,CAAW,EACjD,KAAK,gBAAe,EACpB,KAAK,sBAAqB,EAC1B,KAAK,gBAAgBiF,CAAM,EAC3B,KAAK,iBAAiB4V,CAAY,EAClC,KAAK,0BAA4B,KAAK,uBAClC,CAAC,KAAK,UAAY,KAAK,WAAW,SAClC,YAAK,uBAAyB,KAAK,cACnCH,EAA0B,yBACnB,KAAK,WAAW,SAK3B,GAHA,KAAK,mBAAmB,KAAK,UAAU,EACvC,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,cAC/B,KAAK,WAAW,SAChB,OAAAA,EAA0B,sBACnB,KAAK,WAAW,SAE3B,MAAMI,EAAWJ,EAA0B,aAAaE,CAAQ,EAChE,YAAK,WAAW,SAAW,KAAK,sBAAsB3V,EAAQ6V,EAAU9a,CAAW,EACnF,KAAK,mBAAmB,KAAK,UAAU,EACvC0a,EAA0B,eAC1BA,EAA0B,mCACnB,KAAK,WAAW,QAC1B,CACD,UAAW,CACPA,EAA0B,6BAA+BA,EAA0B,iCACnFA,EAA0B,iCAAmC,CAChE,CACD,mBAAmBK,EAAS,CACxB,KAAK,wBAA0BA,CAClC,CACD,aAAaC,EAAW,CACpB,KAAK,WAAaA,CACrB,CACD,eAAeD,EAAS,CACpB,KAAK,aAAeA,CACvB,CACD,YAAYE,EAAU,CAClB,KAAK,UAAYA,CACpB,CACD,cAAcC,EAAY,CACtB,KAAK,YAAcA,CACtB,CACD,wBAAyB,CACrB,KAAK,qBAAqB,GAAO,EAAG,EAAG,EAAG,EAAG,GAAM,GAAM,GAAG,CAC/D,CACD,qBAAqBC,EAAaH,EAAWC,EAAUG,EAASC,EAAcC,EAAkBC,EAAmBC,EAAc,CAC7H,KAAK,mBAAqBD,EAC1B,KAAK,kBAAoBD,EACzB,KAAK,eAAiBE,GAAgB,KAAO,IAC7C,KAAK,UAAYP,EACjB,KAAK,aAAeE,EACpB,KAAK,WAAaH,EAClB,KAAK,uBAAuBI,CAAO,EACnC,KAAK,aAAaC,CAAY,CACjC,CACD,aAAaI,EAAW,CAChB,KAAK,aAAeA,IACpB,KAAK,WAAaA,EAClB,KAAK,QAAQlB,EAAc,SAAS,EAAIkB,EACxC,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBlB,EAAc,SAAS,EAElG,CAQD,uBAAuBmB,EAAqB,CACpC,KAAK,uBAAyBA,IAC9B,KAAK,qBAAuBA,EAC5B,KAAK,QAAQnB,EAAc,mBAAmB,EAAImB,EAClD,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBnB,EAAc,mBAAmB,EAE5G,CACD,eAAe5a,EAAQ,CACnB,KAAK,mBAAmB,CAAC,EAAIA,EAC7B,KAAK,aAAe8R,EAA+B9R,GAAU,EAAE,CAClE,CACD,kBAAkBgc,EAAa,CAC3B,KAAK,eAAiBA,EACtB,IAAIC,EAAO,EACX,QAASpb,EAAI,EAAGA,EAAImb,EAAY,OAAQ,EAAEnb,EAClCmb,EAAYnb,CAAC,IAAM,IACnBob,GAAQ,GAAKpb,GAGjB,KAAK,kBAAoBob,IACzB,KAAK,gBAAkBA,EACvB,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBrB,EAAc,eAAe,EAExG,CACD,OAAOsB,EAAcC,EAAc,CAE/B,GADAA,EAAeA,GAAgBD,EAAa,OACxCC,EAAe,GAKf,KAAM,4EAEV,KAAK,gBAAkBD,EACvB,KAAK,gBAAkBC,EACvB,KAAK,gBAAkB,MACvB,MAAMC,EAAO,CAAC,EAAG,CAAC,EAClB,IAAIC,EAAY,EAAGJ,EAAO,EAAGK,EAAQ,EACrC,QAASzb,EAAI,EAAGA,EAAIsb,EAAc,EAAEtb,EAAG,CAEnC,MAAM0b,EADUL,EAAarb,CAAC,GACF,iBAC5B,KAAK,YAAYyb,CAAK,EAAIC,GAAY,QAAU,KAAK,mBAAmB,CAAC,EACzEH,EAAKC,CAAS,GAAKvK,EAA+B,KAAK,YAAYwK,CAAK,GAAK,EAAE,GAAKL,EACpFA,GAAQ,EACRK,IACIL,GAAQ,KACRA,EAAO,EACPI,IAEP,CACD,KAAK,YAAY,OAASC,GACtB,KAAK,mBAAqBF,EAAK,CAAC,GAAK,KAAK,mBAAqBA,EAAK,CAAC,KACrE,KAAK,iBAAmBA,EAAK,CAAC,EAC9B,KAAK,iBAAmBA,EAAK,CAAC,EAC9B,KAAK,QAAQxB,EAAc,eAAe,EAAIwB,EAAK,CAAC,EACpD,KAAK,QAAQxB,EAAc,eAAe,EAAIwB,EAAK,CAAC,EACpD,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBxB,EAAc,eAAe,EAExG,CACD,qBAAqBQ,EAAS,CAC1B,KAAK,mBAAqBA,CAC7B,CACD,qBAAqBoB,EAASC,EAAY,CACtC,KAAK,sBAAwBD,EAC7B,KAAK,oBAAsBC,CAC9B,CACD,aAAaR,EAAM,CACf,KAAK,WAAaA,CACrB,CACD,sBAAsBjc,EAAQ,CAC1B,KAAK,0BAA4BA,EACjC,KAAK,oBAAsBA,IAAW,OAAY,EAAI8R,EAA+B9R,CAAM,CAC9F,CACD,oBAAoBob,EAAS,CACzB,KAAK,kBAAoBA,CAC5B,CACD,qBAAqBA,EAAS,CAC1B,KAAK,mBAAqBA,CAC7B,CACD,gBAAgBsB,EAAM,CAClB,KAAK,eAAiBA,GAAQ,KAAO,GACxC,CACD,kBAAkBtB,EAAS,CACvB,KAAK,gBAAkBA,CAC1B,CACD,kBAAkBsB,EAAM,CACpB,KAAK,sBAAwBA,GAAQ,KAAO,GAC/C,CACD,sBAAsBC,EAAI,CACtB,KAAK,yBAA2BA,IAAO,KAAO,EAAe7B,EAAiB6B,CAAE,CACnF,CACD,iBAAiBA,EAAI,CACjB,KAAK,oBAAsBA,IAAO,KAAO,EAAkB7B,EAAiB6B,CAAE,CACjF,CACD,iBAAiBA,EAAI,CACjB,KAAK,oBAAsBA,IAAO,KAAO,EAAe7B,EAAiB6B,CAAE,CAC9E,CACD,mBAAmBV,EAAM,CACjB,KAAK,mBAAqBA,IAC1B,KAAK,iBAAmBA,EACxB,KAAK,QAAQrB,EAAc,eAAe,EAAIqB,EAC9C,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBrB,EAAc,eAAe,EAExG,CACD,oBAAoBqB,EAAM,CAClB,KAAK,oBAAsBA,IAC3B,KAAK,kBAAoBA,EACzB,KAAK,QAAQrB,EAAc,gBAAgB,EAAIqB,EAC/C,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBrB,EAAc,gBAAgB,EAEzG,CACD,mBAAoB,CAChB,KAAK,gBAAgB,GAAO,IAAK,KAAM,KAAM,KAAM,IAAM,GAAI,CAChE,CACD,gBAAgBgC,EAAgBC,EAASC,EAAaC,EAAQC,EAAQC,EAAUC,EAAW,CACvF,KAAK,gBAAkBN,EACvB,KAAK,sBAAwBC,GAAW,KAAO,IAC/C,KAAK,yBAA2BC,IAAgB,KAAO,EAAehC,EAAiBgC,CAAW,EAClG,KAAK,oBAAsBC,IAAW,KAAO,EAAkBjC,EAAiBiC,CAAM,EACtF,KAAK,oBAAsBC,IAAW,KAAO,EAAelC,EAAiBkC,CAAM,EACnF,KAAK,mBAAmBC,CAAQ,EAChC,KAAK,oBAAoBC,CAAS,CACrC,CACD,WAAW7C,EAAe8C,EAAaC,EAAuB,CAC1D,KAAK,eAAiB/C,EACtB,KAAK,uBAAyB+C,EAC9B,KAAK,aAAeD,CACvB,CACD,OAAO,aAAalC,EAAU,CAC1B,OAAQA,EAAQ,CAEZ,IAAK,GACD,MAAO,gBACX,IAAK,GACD,MAAO,aACX,IAAK,GACD,MAAO,YAEX,IAAK,GACD,MAAO,aACX,IAAK,GACD,MAAO,YACX,IAAK,GAID,KAAM,gDACV,IAAK,GACD,MAAO,aACX,IAAK,GACD,MAAO,iBACX,IAAK,GAID,KAAM,mDACV,QACI,MAAO,eACd,CACJ,CACD,OAAO,uBAAuBoC,EAAW,CACrC,OAAQA,EAAS,CACb,IAAK,OACD,MAAO,MACX,IAAK,OACD,MAAO,WACX,IAAK,OACD,MAAO,mBACX,IAAK,OACD,MAAO,MACX,IAAK,OACD,MAAO,MACX,QACI,MAAO,KACd,CACJ,CACD,OAAO,oBAAoBC,EAAQ,CAC/B,OAAQA,EAAM,CACV,IAAK,GACD,MAAO,OACX,IAAK,GACD,MAAO,MACX,IAAK,KACD,MAAO,MACX,IAAK,KACD,MAAO,gBACX,IAAK,KACD,MAAO,YACX,IAAK,KACD,MAAO,sBACX,IAAK,KACD,MAAO,YACX,IAAK,KACD,MAAO,sBACX,IAAK,KACD,MAAO,MACX,IAAK,KACD,MAAO,gBACX,IAAK,KACD,MAAO,sBACX,IAAK,OACD,MAAO,WACX,IAAK,OACD,MAAO,qBACX,IAAK,OACD,MAAO,WACX,IAAK,OACD,MAAO,qBACX,IAAK,OACD,MAAO,OACX,IAAK,OACD,MAAO,iBACX,IAAK,OACD,MAAO,aACX,IAAK,OACD,MAAO,uBACX,QACI,MAAO,KACd,CACJ,CACD,OAAO,oBAAoBzD,EAAiB,CACxC,OAAQA,EAAe,CACnB,IAAK,GACD,MAAO,QACX,IAAK,GACD,MAAO,OACX,IAAK,GACD,MAAO,QACX,IAAK,GACD,MAAO,aACX,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,YACX,IAAK,GACD,MAAO,gBACX,IAAK,GACD,MAAO,QACd,CACD,MAAO,OACV,CACD,OAAO,sBAAsBwD,EAAW,CACpC,OAAQA,EAAS,CACb,IAAK,GACD,MAAO,OACX,IAAK,GACD,MAAO,OACX,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,kBACX,IAAK,GACD,MAAO,kBACX,IAAK,GACD,MAAO,SACX,IAAK,GACD,MAAO,iBACX,IAAK,GACD,MAAO,gBACd,CACD,MAAO,MACV,CACD,OAAO,gCAAgCE,EAAc,CACjD,MAAMpd,EAAOod,EAAa,KACpBC,EAAaD,EAAa,WAC1BhX,EAAOgX,EAAa,UAC1B,OAAQpd,EAAI,CACR,KAAK+Z,EAAa,KACd,OAAQ3T,EAAI,CACR,IAAK,GACL,IAAK,GACD,OAAOiX,EAAa,WAAyD,UACjF,IAAK,GACL,IAAK,GACD,OAAOA,EAAa,WAAyD,SACpF,CACD,MACJ,KAAKtD,EAAa,cACd,OAAQ3T,EAAI,CACR,IAAK,GACL,IAAK,GACD,OAAOiX,EAAa,WAAyD,UACjF,IAAK,GACL,IAAK,GACD,OAAOA,EAAa,WAAyD,SACpF,CACD,MACJ,KAAKtD,EAAa,MACd,OAAQ3T,EAAI,CACR,IAAK,GACL,IAAK,GACD,OAAOiX,EAAa,YAA2D,WACnF,IAAK,GACL,IAAK,GACD,OAAOA,EAAa,YAA2D,UACtF,CACD,MACJ,KAAKtD,EAAa,eACd,OAAQ3T,EAAI,CACR,IAAK,GACL,IAAK,GACD,OAAOiX,EAAa,YAA2D,WACnF,IAAK,GACL,IAAK,GACD,OAAOA,EAAa,YAA2D,UACtF,CACD,MACJ,KAAKtD,EAAa,IACd,OAAQ3T,EAAI,CACR,IAAK,GACD,MAAO,SACX,IAAK,GACD,MAAO,WACX,IAAK,GACD,MAAO,WACX,IAAK,GACD,MAAO,UACd,CACD,MACJ,KAAK2T,EAAa,aACd,OAAQ3T,EAAI,CACR,IAAK,GACD,MAAO,SACX,IAAK,GACD,MAAO,WACX,IAAK,GACD,MAAO,WACX,IAAK,GACD,MAAO,UACd,CACD,MACJ,KAAK2T,EAAa,MACd,OAAQ3T,EAAI,CACR,IAAK,GACD,MAAO,UACX,IAAK,GACD,MAAO,YACX,IAAK,GACD,MAAO,YACX,IAAK,GACD,MAAO,WACd,CACD,KACP,CACD,MAAM,IAAI,MAAM,mBAAmBgX,EAAa,QAAO,CAAE,YAAYpd,CAAI,gBAAgBqd,CAAU,UAAUjX,CAAI,EAAE,CACtH,CACD,oBAAqB,CACjB,OAAK,KAAK,mBAGH,CACH,UAAWwU,EAA0B,oBAAoB,KAAK,sBAAsB,CAAC,CAAC,EACtF,UAAWA,EAA0B,oBAAoB,KAAK,sBAAsB,CAAC,CAAC,EACtF,UAAWA,EAA0B,uBAAuB,KAAK,oBAAoB,CAAC,CAAC,CACnG,EANmB,IAOd,CACD,qBAAsB,CAClB,OAAK,KAAK,mBAGH,CACH,UAAWA,EAA0B,oBAAoB,KAAK,sBAAsB,CAAC,CAAC,EACtF,UAAWA,EAA0B,oBAAoB,KAAK,sBAAsB,CAAC,CAAC,EACtF,UAAWA,EAA0B,uBAAuB,KAAK,oBAAoB,CAAC,CAAC,CACnG,EANmB,IAOd,CACD,gBAAgB0C,EAAI,CACZ,KAAK,YAAcA,IACnB,KAAK,UAAYA,EACjB,KAAK,QAAQ7C,EAAc,WAAW,EAAI6C,EAC1C,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwB7C,EAAc,WAAW,EAEpG,CACD,uBAAuBO,EAAU9a,EAAa,CAC1C,MAAMgb,EAAY,KAAK,WACjBqC,EAAW,KAAK,aAAe,KAAK,UAAY,EAChDnC,EAAa,KAAK,YAAc,EAAI,EACpCoC,EAAkB,KAAK,wBAA0B,EAAI,EACrDC,EAAqBvC,EAAY,GAAKqC,GAAY,IAAMnC,GAAc,IAAMoC,GAAmB,IAAMxC,GAAY,IAAM9a,GAAe,GACxI,KAAK,sBAAwBud,IAC7B,KAAK,oBAAsBA,EAC3B,KAAK,QAAQhD,EAAc,kBAAkB,EAAI,KAAK,oBACtD,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBA,EAAc,kBAAkB,EAE3G,CACD,iBAAkB,CACd,IAAIiD,IAAgB,KAAK,WAAa,EAAI,IAAM,KAAO,KAAK,cAAgB,MAAQ,KAAK,mBAAqB,EAAI,IAAM,IACpH,KAAK,qBACLA,KACM,KAAK,sBAAsB,CAAC,IAAM,KAAO,EAAIhD,EAAwB,KAAK,sBAAsB,CAAC,CAAC,IAAM,KACpG,KAAK,sBAAsB,CAAC,IAAM,KAAO,EAAIA,EAAwB,KAAK,sBAAsB,CAAC,CAAC,IAAM,KACxG,KAAK,sBAAsB,CAAC,IAAM,KAAO,EAAIA,EAAwB,KAAK,sBAAsB,CAAC,CAAC,IAAM,KACxG,KAAK,sBAAsB,CAAC,IAAM,KAAO,EAAIA,EAAwB,KAAK,sBAAsB,CAAC,CAAC,IAAM,MACxG,KAAK,oBAAoB,CAAC,IAAM,KAAO,EAAI,KAAK,oBAAoB,CAAC,EAAI,QAAW,MACpF,KAAK,oBAAoB,CAAC,IAAM,KAAO,EAAI,KAAK,oBAAoB,CAAC,EAAI,QAAW,KAE9FgD,IAAgB,KAAK,eACrB,KAAK,aAAeA,EACpB,KAAK,QAAQjD,EAAc,WAAW,EAAI,KAAK,aAC/C,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBA,EAAc,WAAW,EAEpG,CACD,uBAAwB,CACpB,MAAMkD,EAAgB,KAAK,gBAErB,KAAK,sBAAwB,KAAK,0BAA4B,IAAM,KAAK,qBAAuB,IAAM,KAAK,qBAAuB,GADlI,IAEAC,EAAoB,KAAK,sBAAwB,KAAK,kBAAoB,KAAK,cAAgB,IAAmB,IAAMD,GAAgB,IAC1I,KAAK,qBAAuBC,IAC5B,KAAK,mBAAqBA,EAC1B,KAAK,QAAQnD,EAAc,iBAAiB,EAAI,KAAK,mBACrD,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBA,EAAc,iBAAiB,EAE1G,CACD,gBAAgBtV,EAAQ,CACpB,MAAM0Y,EAAe,KAAK,cAC1B,IAAIC,EAAerD,EAAc,YACjC,MAAMsD,EAAwB5Y,EAAO,iBAC/BO,EAAaqY,EAAsB,wBAAwB,yBAC3DC,EAAYD,EAAsB,wBAAwB,6BAChE,IAAIE,EACAC,EAAmB,EACvB,QAAStY,EAAQ,EAAGA,EAAQF,EAAW,OAAQE,IAAS,CACpD,MAAMK,EAAW+X,EAAUpY,CAAK,EAChC,IAAIwX,GAAgB,KAAK,wBAA0B,KAAK,uBAAuB1X,EAAWE,CAAK,CAAC,IAAM,KAAK,eAAeF,EAAWE,CAAK,CAAC,EACtIwX,IAGDA,EAAe,KAAK,mBAChBxC,EAA0B,0BAC1Bha,EAAO,MAAM,yCAAyC8E,EAAWE,CAAK,CAAC,yGAAyG,GAGxL,MAAMoQ,EAASoH,EAAa,iBAAiB,mBAI7C,GAAIA,EAAa,oBAAsB,OAAW,CAC9C,MAAMnF,EAASmF,EAAa,oBACtBe,EAAaf,EAAa,QAAQ,EAAI,EACtCgB,EAAahB,EAAa,oBAChCA,EAAa,kBACRnF,EAASkG,GAAc,KAAK,yBAA2BC,IAAe,GAAOA,IAAe,GAAKnG,EAASkG,GAAcC,CAChI,CACKH,GAAoBA,IAAqBjI,GAAUoH,EAAa,oBAElE,KAAK,cAAcc,GAAkB,EAAId,EACzCa,EAAmBb,EAAa,kBAAoBpH,EAAS,MAEjE,MAAMqI,EAAMjB,EAAa,UAAYnX,GAAY,GACjD,KAAK,SAAW,KAAK,UAAY,KAAK,QAAQ6X,CAAY,IAAMO,EAChE,KAAK,QAAQP,GAAc,EAAIO,CAClC,CACD,KAAK,cAAc,OAASH,EAC5B,KAAK,cAAgBJ,EACrB,KAAK,SAAW,KAAK,UAAYA,IAAiBD,EAC9C,KAAK,WACL,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBpD,EAAc,WAAW,EAEpG,CACD,iBAAiBM,EAAc,CACvB,KAAK,gBAAkBA,IACvB,KAAK,cAAgBA,EACrB,KAAK,QAAQN,EAAc,YAAY,EAAI,KAAK,cAChD,KAAK,SAAW,GAChB,KAAK,uBAAyB,KAAK,IAAI,KAAK,uBAAwBA,EAAc,YAAY,EAErG,CACD,sBAAsBsD,EAAuB,CACzC,GAAI,KAAK,iBACL,OAAO,KAAK,sCAAsCA,CAAqB,EAE3E,MAAMO,EAAmB,CAAA,EACnBC,EAAyBR,EAAsB,wBAAwB,uBAC7E,QAASrd,EAAI,EAAGA,EAAI6d,EAAuB,OAAQ7d,IAAK,CACpD,MAAMqD,EAAgBwa,EAAuB7d,CAAC,EAC9C4d,EAAiB5d,CAAC,EAAI,KAAK,QAAQ,sBAAsB,CACrD,QAASqD,CACzB,CAAa,CACJ,CACD,OAAAga,EAAsB,iBAAiB,CAAC,EAAIO,EACrC,KAAK,QAAQ,qBAAqB,CAAE,iBAAAA,CAAkB,CAAA,CAChE,CACD,sCAAsCP,EAAuB,CACzD,MAAM9Y,EAA0B8Y,EAAsB,wBAChDQ,EAAyBtZ,EAAwB,uBACvD,IAAIuZ,EAAS,EACb,QAAS9d,EAAI,EAAGA,EAAI6d,EAAuB,OAAQ7d,IAAK,CACpD,MAAMqD,EAAgBwa,EAAuB7d,CAAC,EAC9C,QAASsD,EAAI,EAAGA,EAAID,EAAc,OAAQC,IAAK,CAC3C,MAAMC,EAAQsa,EAAuB7d,CAAC,EAAEsD,CAAC,EACzC,GAAIC,EAAM,QAAS,CACf,MAAMP,EAAOuB,EAAwB,yBAAyBvE,CAAC,EAAEuD,EAAM,OAAO,EAAE,KAC1EI,EAAcY,EAAwB,kBAAkBvB,CAAI,EAC5DmB,EAAcR,EAAY,gBAAkBY,EAAwB,kBAAkBvB,EAAO,SAAS,EAAI,KAChH,IAAIiI,EAAatH,EAAY,WACzBiH,EAAczG,GAAa,MAAQ,YAUvC,GATI,KAAK,cAAgB2Z,GAAU7S,IAAe,UAG1CtH,EAAY,kBACZiH,EAAc,iBAElBK,EAAa,sBAEjB1H,EAAM,QAAQ,WAAa0H,EACvB9G,EAAa,CACb,MAAMgD,EAAU5C,EAAwB,yBAAyBJ,EAAY,QAAQ,UAAU,EAAEA,EAAY,QAAQ,YAAY,EAAE,MACnI0Z,EAAuB1Z,EAAY,QAAQ,UAAU,EAAEgD,CAAO,EAAE,QAAQ,KAAOyD,CAClF,CACDkT,EAASA,GAAU,CACtB,CACJ,CACJ,CACD,MAAMF,EAAmB,CAAA,EACzB,QAAS5d,EAAI,EAAGA,EAAI6d,EAAuB,OAAQ,EAAE7d,EACjD4d,EAAiB5d,CAAC,EAAI,KAAK,QAAQ,sBAAsB,CACrD,QAAS6d,EAAuB7d,CAAC,CACjD,CAAa,EAEL,OAAAqd,EAAsB,iBAAiB,KAAK,aAAa,EAAIO,EACtD,KAAK,QAAQ,qBAAqB,CAAE,iBAAAA,CAAkB,CAAA,CAChE,CACD,0BAA0BnZ,EAAQ,CAC9B,MAAMsZ,EAAc,CAAA,EACdV,EAAwB5Y,EAAO,iBAC/BO,EAAaqY,EAAsB,wBAAwB,yBAC3DC,EAAYD,EAAsB,wBAAwB,6BAChE,IAAIE,EACAS,EACJ,QAAS9Y,EAAQ,EAAGA,EAAQF,EAAW,OAAQE,IAAS,CACpD,MAAMK,EAAW+X,EAAUpY,CAAK,EAChC,IAAIwX,GAAgB,KAAK,wBAA0B,KAAK,uBAAuB1X,EAAWE,CAAK,CAAC,IAAM,KAAK,eAAeF,EAAWE,CAAK,CAAC,EACtIwX,IAGDA,EAAe,KAAK,oBAExB,IAAIpH,EAASoH,EAAa,iBAAiB,mBAEvCnF,EAASmF,EAAa,oBAC1B,MAAMuB,EAAqB,CAACvB,EAAa,kBACzC,GAAI,EAAEa,GAAoBS,GAAwBT,IAAqBjI,IAAW2I,EAAoB,CAClG,MAAMC,EAAyB,CAC3B,YAAaxB,EAAa,oBAC1B,SAAUA,EAAa,eAAgB,EAAG,WAA2D,SACrG,WAAY,CAAE,CAClC,EACgBqB,EAAY,KAAKG,CAAsB,EACvCF,EAAuBE,EAAuB,WAC1CD,IACA1G,EAAS,EACTjC,EAAS,KAEhB,CACD0I,EAAqB,KAAK,CACtB,eAAgBzY,EAChB,OAAAgS,EACA,OAAQ2C,EAA0B,gCAAgCwC,CAAY,CAC9F,CAAa,EACDa,EAAmBjI,CACtB,CACD,OAAOyI,CACV,CACD,sBAAsBtZ,EAAQ6V,EAAU9a,EAAa,CACjD,MAAM6d,EAAwB5Y,EAAO,iBAC/B0Z,EAAuB,KAAK,0BAA0B1Z,CAAM,EAC5D2Z,EAAiB,KAAK,sBAAsBf,CAAqB,EACjEL,EAAc,CAAA,EACdqB,EAAa,KAAK,qBAClBC,EAAa,KAAK,sBAIxB,GAHI,KAAK,gBACL/E,GAA2B,KAAK,eAAgB9U,CAAM,EAEtD,KAAK,iBAAmB,EACxB,QAASzE,EAAI,EAAGA,EAAI,KAAK,YAAY,OAAQ,EAAEA,EAAG,CAC9C,MAAMb,EAAS,KAAK,YAAYa,CAAC,EACjC,GAAIb,EAAQ,CACR,MAAMof,EAAQ,CACV,OAAApf,EACA,UAAY,KAAK,gBAAmB,GAAKa,EAAY,KAAK,WAAa,CAC/F,EACwBqe,GAAcC,IACdC,EAAM,MAAQ,CACV,MAAOF,EACP,MAAOC,CACnC,GAEoBtB,EAAY,KAAKuB,CAAK,CACzB,MAEGvB,EAAY,KAAK,IAAI,CAE5B,SAGG,KAAK,mBAAmB,CAAC,EAAG,CAC5B,MAAMuB,EAAQ,CACV,OAAQ,KAAK,mBAAmB,CAAC,EACjC,UAAW,KAAK,UACpC,EACoBF,GAAcC,IACdC,EAAM,MAAQ,CACV,MAAOF,EACP,MAAOC,CAC/B,GAEgBtB,EAAY,KAAKuB,CAAK,CACzB,MAEGvB,EAAY,KAAK,IAAI,EAG7B,MAAMwB,EAAmB,CACrB,QAAStE,EAA0B,oBAAoB,KAAK,gBAAkB,KAAK,qBAAuB,CAAe,EACzH,YAAaA,EAA0B,sBAAsB,KAAK,gBAAkB,KAAK,yBAA2B,CAAa,EACjI,OAAQA,EAA0B,sBAAsB,KAAK,gBAAkB,KAAK,oBAAsB,CAAa,EACvH,OAAQA,EAA0B,sBAAsB,KAAK,gBAAkB,KAAK,oBAAsB,CAAa,CACnI,EACcuE,EAAqBnE,IAAa,iBAAwEA,IAAa,iBAC7H,IAAIoE,GACApE,IAAa,cAAkEA,IAAa,oBAC5FoE,EAAmB,CAAC,KAAK,cAAgB,KAAK,aAAa,SAAW,SAAoD,UAE9H,MAAMC,EAA+B,KAAK,0BAA4B5f,EAAoB,iBAAiB,KAAK,yBAAyB,EAAI,GAC7I,OAAO,KAAK,QAAQ,qBAAqB,CACrC,MAAO,kBAAkBie,EAAY,CAAC,GAAG,QAAU,UAAU,IAAI,KAAK,2BAA6B,SAAS,WAAWxd,CAAW,gBAAgB,KAAK,aAAa,GACpK,OAAQ4e,EACR,OAAQ,CACJ,OAAQf,EAAsB,OAAO,YAAY,OACjD,WAAYA,EAAsB,OAAO,YAAY,WACrD,QAASc,CACZ,EACD,UAAW,CACP,SAAA7D,EACA,iBAAAoE,EACA,UAAW,KAAK,aAAe,EAAI,MAA4C,KAC/E,SAAW,KAAK,aAA4D,KAAK,YAAc,EAAI,QAA+C,OAAnH,MAClC,EACD,SAAWrB,EAAsB,OAAO,cAElC,CACE,OAAQA,EAAsB,OAAO,cAAc,OACnD,WAAYA,EAAsB,OAAO,cAAc,WACvD,QAASL,CACZ,EALC,OAMN,YAAa,CACT,MAAOxd,CAGV,EACD,aAAc,KAAK,4BAA8B,OAC3C,OACA,CACE,kBAAmB,KAAK,mBACxB,aAAc,KAAK,kBAAoB0a,EAA0B,oBAAoB,KAAK,aAAa,EAAI,SAC3G,OAAQ,KAAK,0BACb,aAAc,KAAK,iBAAmByE,EAA+BH,EAAmB,OACxF,YAAa,KAAK,iBAAmBG,EAA+BH,EAAmB,OACvF,gBAAiB,KAAK,iBAAmBG,EAA+B,KAAK,iBAAmB,OAChG,iBAAkB,KAAK,iBAAmBA,EAA+B,KAAK,kBAAoB,OAClG,UAAW,KAAK,WAChB,eAAgBF,EAAqB,KAAK,gBAAkB,EAC5D,oBAAqBA,EAAqB,KAAK,qBAAuB,CACzE,CACjB,CAAS,CACJ,CACL,CACAvE,EAA0B,yBAA2B,GACrDA,EAA0B,uBAAyB,EACnDA,EAA0B,oBAAsB,EAChDA,EAA0B,aAAe,EACzCA,EAA0B,6BAA+B,EACzDA,EAA0B,iCAAmC,ECx1B7D,MAAM0E,EAAU,CACZ,aAAc,CACV,KAAK,OAAS,EACjB,CACD,OAAQ,CACJ,IAAIC,EAAY,EAAGC,EAAgB,KAAK,SAAW,EAAI,EACvD,UAAWlZ,KAAS,KAAK,OAAQ,CAC7B,MAAMmZ,EAAO,KAAK,OAAOnZ,CAAK,EACxB,CAACoZ,EAAiBC,CAAkB,EAAIF,EAAK,MAAK,EACxDF,GAAaG,EACbF,GAAiBG,EACjBJ,GACH,CACD,MAAO,CAACA,EAAWC,CAAa,CACnC,CACL,CAEO,MAAMI,UAAsChF,CAA0B,CACzE,OAAO,eAAgB,CACnB,MAAMiF,EAASD,EAA8B,OAAO,MAAK,EACzD,MAAO,CAAE,UAAWC,EAAO,CAAC,EAAG,cAAeA,EAAO,CAAC,EACzD,CACD,OAAO,cAAcJ,EAAMK,EAAWC,EAASC,EAAY,CACvD,GAAIP,EAAK,SAAU,CACf,MAAMQ,EAAOF,EAAQ,QACrBE,EAAK,OAASD,EACdF,EAAU,KAAKG,CAAI,CACtB,CACD,UAAW3Z,KAASmZ,EAAK,OAAQ,CAC7B,MAAMS,EAAQT,EAAK,OAAOnZ,CAAK,EAC/ByZ,EAAQC,CAAU,EAAI,SAAS1Z,CAAK,EACpCsZ,EAA8B,cAAcM,EAAOJ,EAAWC,EAASC,EAAa,CAAC,CACxF,CACJ,CACD,OAAO,cAAe,CAClB,MAAMF,EAAY,CAAA,EAClB,OAAAF,EAA8B,cAAcA,EAA8B,OAAQE,EAAW,CAAA,EAAI,CAAC,EAC3FA,CACV,CACD,OAAO,YAAa,CAChBF,EAA8B,OAAS,IAAIN,EAC9C,CACD,OAAQ,CACJ,KAAK,WAAa,GAClB,KAAK,WAAW,CAAC,EAAIM,EAA8B,OACnD,MAAM,MAAK,CACd,CACD,mBAAmBO,EAAO,CACtB,IAAIV,EAAO,KAAK,WAAW,KAAK,sBAAsB,EACtD,QAAS/e,EAAI,KAAK,uBAAwBA,EAAI,KAAK,cAAe,EAAEA,EAAG,CACnE,IAAI0f,EAAKX,EAAK,OAAO,KAAK,QAAQ/e,CAAC,CAAC,EAC/B0f,IACDA,EAAK,IAAId,GACTG,EAAK,OAAO,KAAK,QAAQ/e,CAAC,CAAC,EAAI0f,GAEnCX,EAAOW,EACP,KAAK,WAAW1f,EAAI,CAAC,EAAI+e,CAC5B,CACDU,EAAM,MAAQV,EACdU,EAAM,SAAWV,EAAK,QACzB,CACD,mBAAmBU,EAAO,CACtBA,EAAM,MAAM,SAAWA,EAAM,QAChC,CACL,CACAP,EAA8B,OAAS,IAAIN,GC/DpC,MAAMe,WAAmCC,EAAqB,CACjE,YAAYC,EAAO,CACf,MAAM,EAAK,EACX,KAAK,OAASA,EACd,KAAK,MAAK,CACb,CACD,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CACD,IAAI,KAAKja,EAAO,CACR,KAAK,QAAUA,IAGnB,KAAK,MAAQA,EACb,KAAK,OAAO,kBAAkBA,CAAK,EACtC,CACD,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CACD,IAAI,SAASA,EAAO,CACZ,KAAK,YAAcA,IAGvB,KAAK,UAAYA,EACjB,KAAK,OAAO,mBAAmBA,CAAK,EACvC,CACD,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CACD,IAAI,cAAcA,EAAO,CACjB,KAAK,iBAAmBA,IAG5B,KAAK,eAAiBA,EACtB,KAAK,OAAO,iBAAiBA,CAAK,EACrC,CACD,IAAI,aAAc,CACd,OAAO,KAAK,YACf,CACD,IAAI,YAAYA,EAAO,CACf,KAAK,eAAiBA,IAG1B,KAAK,aAAeA,EACpB,KAAK,OAAO,sBAAsBA,CAAK,EAC1C,CACD,IAAI,oBAAqB,CACrB,OAAO,KAAK,mBACf,CACD,IAAI,mBAAmBA,EAAO,CACtB,KAAK,sBAAwBA,IAGjC,KAAK,oBAAsBA,EAC3B,KAAK,OAAO,iBAAiBA,CAAK,EACrC,CACD,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CACD,IAAI,KAAKA,EAAO,CACR,KAAK,QAAUA,IAGnB,KAAK,MAAQA,EACb,KAAK,OAAO,oBAAoBA,CAAK,EACxC,CACD,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CACD,IAAI,QAAQA,EAAO,CACX,KAAK,WAAaA,IAGtB,KAAK,SAAWA,EAChB,KAAK,OAAO,kBAAkBA,CAAK,EACtC,CACD,OAAQ,CACJ,MAAM,MAAK,EACX,KAAK,OAAO,mBACf,CACD,OAAQ,CACJ,MAAMka,EAAyB,KAAK,iBAAiB,QACrD,KAAK,QAAUA,EAAyB,KAAK,gBAAgB,QAAU,KAAK,cAAc,QACrF,KAAK,UAGV,KAAK,KAAOA,EAAyB,KAAK,gBAAgB,KAAO,KAAK,cAAc,KACpF,KAAK,QAAUA,EAAyB,KAAK,gBAAgB,QAAU,KAAK,cAAc,QAC1F,KAAK,SAAWA,EAAyB,KAAK,gBAAgB,SAAW,KAAK,cAAc,SAC5F,KAAK,cAAgBA,EAAyB,KAAK,gBAAgB,cAAgB,KAAK,cAAc,cACtG,KAAK,YAAcA,EAAyB,KAAK,gBAAgB,YAAc,KAAK,cAAc,YAClG,KAAK,mBAAqBA,EAAyB,KAAK,gBAAgB,mBAAqB,KAAK,cAAc,mBAChH,KAAK,KAAOA,EAAyB,KAAK,gBAAgB,KAAO,KAAK,cAAc,KACvF,CACL,CC9FO,MAAMC,WAAgCC,EAAkB,CAK3D,YAAYH,EAAO,CACf,MAAM,EAAK,EACX,KAAK,OAASA,EACd,KAAK,MAAK,CACb,CACD,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CACD,IAAI,QAAQja,EAAO,CACX,KAAK,WAAaA,IAGtB,KAAK,SAAWA,EAChB,KAAK,gBAAkB,GACvB,KAAK,OAAO,uBAAuBA,CAAK,EAC3C,CACD,IAAI,cAAe,CACf,OAAO,KAAK,aACf,CACD,IAAI,aAAaA,EAAO,CAChB,KAAK,gBAAkBA,IAG3B,KAAK,cAAgBA,EACrB,KAAK,gBAAkB,GACvB,KAAK,OAAO,aAAaA,CAAK,EACjC,CACD,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CACD,IAAI,SAASA,EAAO,CACZ,KAAK,YAAcA,IAGvB,KAAK,UAAYA,EACjB,KAAK,iBAAmB,GACxB,KAAK,OAAO,YAAYA,GAAS,CAAC,EACrC,CACD,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CACD,IAAI,KAAKA,EAAO,CACR,KAAK,QAAUA,IAGnB,KAAK,MAAQA,EACb,KAAK,aAAe,GACpB,KAAK,OAAO,eAAe,CAAC,CAACA,CAAK,EACrC,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CACD,IAAI,UAAUA,EAAO,CACb,KAAK,aAAeA,IAGxB,KAAK,WAAaA,EAClB,KAAK,kBAAoB,GACzB,KAAK,OAAO,gBAAgBA,CAAK,EACpC,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CACD,IAAI,UAAUA,EAAO,CACb,KAAK,aAAeA,IAGxB,KAAK,WAAaA,EAClB,KAAK,kBAAoB,GACzB,KAAK,OAAO,qBAAqBA,CAAK,EACzC,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CACD,IAAI,UAAUA,EAAO,CACb,KAAK,aAAeA,IAGxB,KAAK,WAAaA,EAClB,KAAK,kBAAoB,GACzB,KAAK,OAAO,oBAAoBA,CAAK,EACxC,CACD,IAAI,WAAY,CACZ,OAAO,KAAK,UACf,CACD,IAAI,UAAUA,EAAO,CACb,KAAK,aAAeA,IAGxB,KAAK,WAAaA,EAClB,KAAK,kBAAoB,GACzB,KAAK,OAAO,aAAaA,GAAS,CAAC,EACtC,CACD,OAAQ,CACJ,MAAM,MAAK,EACX,KAAK,OAAO,wBACf,CACD,OAAQ,CAEP,CACL,CCxGO,MAAMqa,EAAgB,CAMzB,OAAO,kBAAkB7gB,EAAS,CAC9B,OAAOA,EAAQ,qBAAuB,MACzC,CAKD,cAAe,CACX,MAAO,iBACV,CAID,IAAI,oBAAqB,CACrB,OAAO,KAAK,MACf,CAKD,YAAYkT,EAAO,CAIf,KAAK,WAAa,GAIlB,KAAK,KAAO,GAIZ,KAAK,OAAS,WACd,KAAK,OAASA,EACd,KAAK,SAAW4N,EAAgB,UACnC,CAKD,SAAU,CACN,OAAO,KAAK,OAAO,YAAc,KAAK,OAAO,iBAChD,CAID,SAAU,CAAG,CACjB,CCpDO,MAAMC,EAAsB,CAC/B,IAAI,wBAAyB,CAGzB,OAAO,KAAK,qBAAuB,CACtC,CACD,IAAI,yBAA0B,CAC1B,OAAO,KAAK,yBAA2B,CAC1C,CACD,aAAc,CACV,KAAK,SAAWA,GAAsB,WACtC,KAAK,SAAW,EAChB,KAAK,aAAe,EACpB,KAAK,MAAK,CACb,CACD,OAAQ,CACJ,KAAK,SAAW,GAChB,KAAK,SAAW,GAChB,KAAK,QAAU,GACf,KAAK,yBAA2B,EAChC,KAAK,qBAAuB,CAC/B,CACD,WAAWnd,EAAMmC,EAAS,CACtB,IAAIib,EAAe,KAAK,SAASpd,CAAI,EACjCqd,EAAkB,GACjBD,EAIDC,EAAkBD,EAAa,SAH/B,KAAK,SAASpd,CAAI,EAAIod,EAAe,CAAE,QAAAjb,EAAS,SAAU,GAK9Dib,EAAa,QAAUjb,EACvBib,EAAa,SAAWjb,EAAUmT,EAAmB,mBAAmBnT,CAAO,EAAI,EACnF,MAAMmb,EAAUD,IAAoBD,EAAa,SAC7CE,GACA,KAAK,WAET,KAAK,UAAY,KAAK,QAAUA,EACnC,CACD,WAAWtd,EAAM5D,EAAS,CACtB,IAAImhB,EAAe,KAAK,SAASvd,CAAI,EACjCwd,EAAmB,GAClBD,EAIDC,EAAmBD,EAAa,SAAS,UAAY,GAHrD,KAAK,SAASvd,CAAI,EAAIud,EAAe,CAAE,QAAAnhB,EAAS,sBAAuB,GAAO,kBAAmB,IAKjGmhB,EAAa,mBACb,KAAK,uBAELA,EAAa,uBACb,KAAK,2BAELnhB,GACAmhB,EAAa,sBACTnhB,EAAQ,OAAS,GACZA,EAAQ,QAAU,IAAMA,EAAQ,QAAU,GACnDmhB,EAAa,kBAAoBN,GAAgB,kBAAkB7gB,CAAO,EACtEmhB,EAAa,uBACb,KAAK,2BAELA,EAAa,mBACb,KAAK,yBAITA,EAAa,sBAAwB,GACrCA,EAAa,kBAAoB,IAErCA,EAAa,QAAUnhB,EACvB,MAAMkhB,EAAUE,KAAsBphB,GAAS,UAAY,IACvDkhB,GACA,KAAK,WAET,KAAK,UAAY,KAAK,QAAUA,EACnC,CACL,CACAH,GAAsB,SAAW,EClF1B,MAAMM,EAAkB,CAC3B,QAAQC,EAAyB,CAC7B,OAAO,KAAK,UAAY,KAAK,2BAA6BA,CAC7D,CACD,aAAaA,EAAyB,CAClC,KAAK,SAAW,GAChB,KAAK,yBAA2BA,CACnC,CACD,IAAI,eAAgB,CAChB,OAAO,KAAK,cACf,CACD,IAAI,cAAcC,EAAK,CACf,KAAK,iBAAmBA,IAGvBA,GAQD,KAAK,mBAAqB,KAAK,eAAe,gBAAgB,GAAIpP,EAA4B,QAAUA,EAA4B,SAAWA,EAA4B,QAAS,OAAW,oBAAoB,EACnN,KAAK,kBAAoB,IAAI,YAAY,CAAC,EAC1C,KAAK,kBAAkB,CAAC,EAAI,EAC5B,KAAK,kBAAkB,CAAC,EAAI,IAVxB,KAAK,oBACL,KAAK,eAAe,cAAc,KAAK,kBAAkB,EAE7D,KAAK,mBAAqB,OAC1B,KAAK,kBAAoB,QAQ7B,KAAK,eAAiBoP,EACtB,KAAK,sBAAwB,GAChC,CACD,YAAYvP,EAAe,CACvB,KAAK,eAAiBA,EACtB,KAAK,SAAWqP,GAAkB,WAClC,KAAK,eAAiB,GACtB,KAAK,sBAAwB,EAC7B,KAAK,MAAK,CACb,CACD,OAAQ,CACJ,KAAK,QAAU,GACf,KAAK,SAAW,GAChB,KAAK,yBAA2B,EAChC,KAAK,WAAa,OAClB,KAAK,WAAa,MACrB,CACD,UAAUzd,EAAMsS,EAAQ,CACpB,KAAK,WAAa,KAAK,SAAWA,GAAQ,WAAa,KAAK,QAAQtS,CAAI,GAAG,UAC3E,KAAK,QAAQA,CAAI,EAAIsS,CACxB,CACD,gBAAgBsL,EAAoBC,EAAeC,EAAoB,CAC/DD,IAAkB,KAAK,uBAAyB,CAAC,KAAK,oBAAsB,CAAC,KAAK,oBAMtF,KAAK,sBAAwBA,EAC7B,KAAK,kBAAkB,CAAC,EAAID,EAC5B,KAAK,kBAAkB,CAAC,EAAIC,EAC5B,KAAK,kBAAkB,CAAC,EAAIC,EAC5B,KAAK,eAAe,WAAW,KAAK,mBAAoB,EAAG,KAAK,kBAAmB,EAAG,EAAE,EAC3F,CACD,SAAU,CACF,KAAK,qBACL,KAAK,eAAe,cAAc,KAAK,kBAAkB,EACzD,KAAK,mBAAqB,OAC1B,KAAK,kBAAoB,QAE7B,KAAK,WAAa,OAClB,KAAK,WAAa,OAClB,KAAK,QAAU,MAClB,CACL,CACAL,GAAkB,SAAW,ECrE7B,MAAMM,GAAgB,GAAK,GAOrBC,GAAiB,GAAK,GAC5B,MAAMC,CAAyB,CAC3B,aAAc,CACV,KAAK,OAAS,EACjB,CACL,CAEO,MAAMC,CAAsB,CAC/B,WAAW,YAAa,CACpB,MAAO,CACH,aAAcA,EAAsB,0BACpC,iBAAkBA,EAAsB,8BACxC,gBAAiBA,EAAsB,6BACvC,kBAAmBA,EAAsB,8BACrD,CACK,CACD,OAAO,YAAa,CAChBA,EAAsB,OAAS,IAAID,EACnCC,EAAsB,0BAA4B,EAClDA,EAAsB,8BAAgC,EACtDA,EAAsB,6BAA+B,EACrDA,EAAsB,+BAAiC,EACvDA,EAAsB,kCAAoC,EAC1DA,EAAsB,iCAAmC,EACzDA,EAAsB,mCAAqC,CAC9D,CACD,YAAY/P,EAAQgQ,EAAc3c,EAAQ,CACtC,KAAK,SAAW,GAChB,KAAK,QAAU2M,EACf,KAAK,cAAgBgQ,EACrB,KAAK,QAAU3c,CAClB,CACD,UAAW,CACP0c,EAAsB,8BAAgCA,EAAsB,kCAC5EA,EAAsB,6BAA+BA,EAAsB,iCAC3EA,EAAsB,+BAAiCA,EAAsB,mCAC7EA,EAAsB,kCAAoC,EAC1DA,EAAsB,iCAAmC,EACzDA,EAAsB,mCAAqC,CAC9D,CAUD,cAAc7D,EAAuB+D,EAAaC,EAAiB,CAC/D,IAAIC,EACAvC,EAAOmC,EAAsB,OACjC,MAAMK,EAAkB,KAAK,UAAYF,EAAgB,uBACzD,GAAI,CAACE,EAAiB,CAClB,GAAI,CAACH,EAAY,QAAQC,EAAgB,QAAQ,GAAK,CAACA,EAAgB,QACnE,OAAAH,EAAsB,qCACfE,EAAY,WAEvB,UAAWI,KAAcnE,EAAsB,wBAAwB,YAAa,CAChF,MAAMoE,GAASL,EAAY,QAAQI,CAAU,GAAG,UAAY,GAAKT,GACjE,IAAIW,EAAW3C,EAAK,OAAO0C,CAAK,EAC3BC,IACDA,EAAW,IAAIT,EACflC,EAAK,OAAO0C,CAAK,EAAIC,GAEzB3C,EAAO2C,CACV,CACD,UAAW3W,KAAesS,EAAsB,wBAAwB,aAAc,CAClF,MAAMsE,EAAkBN,EAAgB,SAAStW,CAAW,GAAG,UAAY,EAC3E,IAAI2W,EAAW3C,EAAK,OAAO4C,CAAe,EACrCD,IACDA,EAAW,IAAIT,EACflC,EAAK,OAAO4C,CAAe,EAAID,GAEnC3C,EAAO2C,CACV,CACD,UAAWxd,KAAemZ,EAAsB,wBAAwB,aAAc,CAClF,MAAMuE,GAAaP,EAAgB,SAASnd,CAAW,GAAG,SAAS,UAAY,GAAK8c,GACpF,IAAIU,EAAW3C,EAAK,OAAO6C,CAAS,EAC/BF,IACDA,EAAW,IAAIT,EACflC,EAAK,OAAO6C,CAAS,EAAIF,GAE7B3C,EAAO2C,CACV,CACDJ,EAAavC,EAAK,UACrB,CAGD,GAFAqC,EAAY,aAAaC,EAAgB,QAAQ,EACjDA,EAAgB,QAAU,GACtBC,EACA,OAAAF,EAAY,WAAaE,EACzBJ,EAAsB,mCACfI,EAEXA,EAAa,CAAA,EACbF,EAAY,WAAaE,EACpBC,IACDxC,EAAK,WAAauC,GAEtBJ,EAAsB,4BACtBA,EAAsB,oCACtB,MAAMtD,EAAmBP,EAAsB,iBAAiBgE,EAAgB,YAAY,EAC5F,QAASrhB,EAAI,EAAGA,EAAIqd,EAAsB,wBAAwB,uBAAuB,OAAQrd,IAAK,CAClG,MAAMqD,EAAgBga,EAAsB,wBAAwB,uBAAuBrd,CAAC,EACtF0D,EAAU2Z,EAAsB,wBAAwB,iBAAiBrd,CAAC,EAChF,QAASsD,EAAI,EAAGA,EAAID,EAAc,OAAQC,IAAK,CAC3C,MAAMC,EAAQ8Z,EAAsB,wBAAwB,uBAAuBrd,CAAC,EAAEsD,CAAC,EACjFue,EAAYxE,EAAsB,wBAAwB,yBAAyBrd,CAAC,EAAEuD,EAAM,OAAO,EACnGP,EAAO6e,EAAU,sBAAwBA,EAAU,KACzD,GAAIte,EAAM,QAAS,CACf,MAAMue,EAAcT,EAAgB,SAASre,CAAI,EACjD,GAAI8e,EAAa,CACb,MAAM3c,EAAU2c,EAAY,QAC5B,GAAI,CAAC3c,EAAS,CACN,KAAK,QAAQ,iBACbjF,EAAO,MAAM,wCAAwC,KAAK,UAAUqD,CAAK,CAAC,UAAUP,CAAI,iBAAiB,KAAK,UAAU8e,EAAa,CAAC5U,EAAKtH,IAAWsH,IAAQ,UAAY,YAActH,CAAM,CAAC,8BAA8Byb,EAAgB,QAAQ,GAAI,EAAE,EAE/P,QACH,CACD3d,EAAQJ,CAAC,EAAE,SAAW,KAAK,cAAc,WAAW6B,EAAS,GAAO2c,EAAY,SAAU3c,EAAQ,KAAK,CAC1G,MAEGjF,EAAO,MAAM,YAAY8C,CAAI,+BAA+B,KAAK,UAAUO,CAAK,CAAC,qBAAqB,KAAK,UAAU8d,EAAiB,CAACnU,EAAKtH,IAAUsH,IAAQ,WAAaA,IAAQ,UAAY,YAActH,CAAK,CAAC,GAAI,EAAE,CAEhO,SACQrC,EAAM,SAAWA,EAAM,eAAgB,CAC5C,MAAMue,EAAcT,EAAgB,SAASre,CAAI,EACjD,GAAI8e,EAAa,CACb,GAAI,KAAK,QAAQ,iBAAmBA,EAAY,UAAY,KAAM,CAC9D5hB,EAAO,MAAM,wCAAwC8C,CAAI,YAAY,KAAK,UAAUO,CAAK,CAAC,iBAAiB,KAAK,UAAUue,EAAa,CAAC5U,EAAKtH,IAAWsH,IAAQ,UAAY,YAActH,CAAM,CAAC,8BAA8Byb,EAAgB,QAAQ,GAAI,EAAE,EAC7P,QACH,CACD,MAAM/R,EAAkBwS,EAAY,QAAQ,iBAC5C,GAAI,KAAK,QAAQ,kBACZ,CAACxS,GAAoB/L,EAAM,SAAW,CAAC+L,EAAgB,MAAU/L,EAAM,gBAAkB,CAAC+L,EAAgB,gBAAkB,CAC7HpP,EAAO,MAAM,oDAAoD,KAAK,UAAUqD,CAAK,CAAC,UAAUP,CAAI,iBAAiB,KAAK,UAAU8e,EAAa,CAAC5U,EAAKtH,IAAWsH,IAAQ,UAAY,YAActH,CAAM,CAAC,aAAakc,EAAY,SAAS,OAAO,8BAA8BT,EAAgB,QAAQ,GAAI,EAAE,EAChT,QACH,CACD3d,EAAQJ,CAAC,EAAE,SAAWC,EAAM,eAAiB+L,EAAgB,eAAiBA,EAAgB,IACjG,MAEGpP,EAAO,MAAM,YAAY8C,CAAI,+BAA+B,KAAK,UAAUO,CAAK,CAAC,qBAAqB,KAAK,UAAU8d,EAAiB,CAACnU,EAAKtH,IAAUsH,IAAQ,WAAaA,IAAQ,UAAY,YAActH,CAAK,CAAC,GAAI,EAAE,CAEhO,SACQrC,EAAM,gBAAiB,CAC5B,MAAMue,EAAcT,EAAgB,SAASre,CAAI,EACjD,GAAI8e,EAAa,CACb,GAAI,KAAK,QAAQ,iBAAmBA,EAAY,UAAY,KAAM,CAC9D5hB,EAAO,MAAM,iDAAiD,KAAK,UAAUqD,CAAK,CAAC,UAAUP,CAAI,iBAAiB,KAAK,UAAU8e,EAAa,CAAC5U,EAAKtH,IAAWsH,IAAQ,UAAY,YAActH,CAAM,CAAC,8BAA8Byb,EAAgB,QAAQ,GAAI,EAAE,EACpQ,QACH,CACD,MAAMU,EAAkBD,EAAY,QAAQ,mBAC5C,GAAI,KAAK,QAAQ,iBAAmB,CAACC,EAAiB,CAClD7hB,EAAO,MAAM,qDAAqD,KAAK,UAAUqD,CAAK,CAAC,UAAUP,CAAI,iBAAiB,KAAK,UAAU8e,EAAa,CAAC5U,EAAKtH,IAAWsH,IAAQ,UAAY,YAActH,CAAM,CAAC,aAAakc,EAAY,SAAS,OAAO,8BAA8BT,EAAgB,QAAQ,GAAI,EAAE,EACjT,QACH,CACD3d,EAAQJ,CAAC,EAAE,SAAW,KAAK,QAAQ,sBAAsB,CAAE,OAAQye,CAAe,CAAE,CACvF,MAEG7hB,EAAO,MAAM,YAAY8C,CAAI,+BAA+B,KAAK,UAAUO,CAAK,CAAC,qBAAqB,KAAK,UAAU8d,EAAiB,CAACnU,EAAKtH,IAAUsH,IAAQ,WAAaA,IAAQ,UAAY,YAActH,CAAK,CAAC,GAAI,EAAE,CAEhO,SACQrC,EAAM,OAAQ,CACnB,MAAMmT,EAAa0K,EAAY,QAAQpe,CAAI,EAC3C,GAAI0T,EAAY,CACZ,MAAMsL,EAAetL,EAAW,mBAChChT,EAAQJ,CAAC,EAAE,SAAS,OAAS0e,EAC7Bte,EAAQJ,CAAC,EAAE,SAAS,KAAOoT,EAAW,QACzC,MAEGxW,EAAO,MAAM,sBAAsB8C,CAAI,YAAY,KAAK,UAAUO,CAAK,CAAC,aAAa,KAAK,UAAU6d,EAAY,OAAO,CAAC,0BAA0BA,EAAY,QAAQ,GAAI,EAAE,CAEnL,CACJ,CACD,MAAMa,EAAcrE,EAAiB5d,CAAC,EACtCshB,EAAWthB,CAAC,EAAI,KAAK,QAAQ,gBAAgB,CACzC,OAAQiiB,EACR,QAAAve,CAChB,CAAa,CACJ,CACD,OAAO4d,CACV,CACL,CACAJ,EAAsB,0BAA4B,EAClDA,EAAsB,8BAAgC,EACtDA,EAAsB,6BAA+B,EACrDA,EAAsB,+BAAiC,EACvDA,EAAsB,OAAS,IAAID,EACnCC,EAAsB,kCAAoC,EAC1DA,EAAsB,iCAAmC,EACzDA,EAAsB,mCAAqC,ECzM3D,MAAMle,GAAO,wBACPkf,GAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeVC,GAAY,iBAAiBnf,EAAI,IAClCmf,GAAY,iBAAiBnf,EAAI,EAAIkf,ICjBzC,MAAMlf,GAAO,uBACPkf,GAAS;AAAA;AAAA,EAIVC,GAAY,iBAAiBnf,EAAI,IAClCmf,GAAY,iBAAiBnf,EAAI,EAAIkf,ICAlC,MAAME,EAAgB,CACzB,sBAAsBjjB,EAAQ,CAC1B,KAAK,oBAAsBA,EAC3B,KAAK,qBAAqB,sBAAsBA,CAAM,CACzD,CACD,eAAeA,EAAQ,CACnB,KAAK,qBAAqB,eAAeA,CAAM,CAClD,CACD,kBAAkBgc,EAAaE,EAAcC,EAAc,CACvD,KAAK,qBAAqB,OAAOD,EAAcC,CAAY,EAC3D,KAAK,qBAAqB,kBAAkBH,CAAW,CAC1D,CACD,YAAYhK,EAAQ3M,EAAQ2V,EAAmB,CAC3C,KAAK,YAAc,GACnB,KAAK,aAAe,GACpB,KAAK,SAAW,GAChB,KAAK,QAAUhJ,EACf,KAAK,QAAU3M,EACf,KAAK,qBAAuB,IAAI0a,EAA8B,KAAK,QAAS/E,CAAiB,EAC7F,KAAK,qBAAqB,oBAAoB,EAAK,EACnD,KAAK,qBAAqB,mBAAmB,GAAI,EACjD,KAAK,QAAU3V,EAAO,aAAa,YAAa,CAAA,EAAI,CAAC,QAAS,YAAY,EAAG,OAAW,OAAW,OAAW,OAAW,OAAW,OAAW,EAClJ,CACD,MAAM6d,EAAYC,EAAYC,EAAYC,EAAchjB,EAAc,EAAG,CACrE,IAAIijB,EACAC,EAAS,KACTC,EACJ,MAAMC,EAAY,CAAC,CAAC,KAAK,QAAQ,qBACjC,GAAIP,EACAI,EAAcJ,MAEb,CACD,IAAIpZ,EAAM,EACV,KAAK,SAAS,OAAS,EACvB,QAASjJ,EAAI,EAAGA,EAAI,KAAK,qBAAqB,aAAa,OAAQ,EAAEA,EACjE,KAAK,SAASiJ,GAAK,EAAIgI,EAA+B,KAAK,qBAAqB,aAAajR,CAAC,GAAK,EAAE,EAEzG,MAAM6iB,EAA0B5R,EAA+B,KAAK,qBAAuB,CAAC,EAW5F,GAVA,KAAK,SAAShI,CAAG,GACZqZ,EAAaA,EAAW,EAAIA,EAAW,EAAI,IAAMA,EAAW,EAAI,IAAM,IAAMA,EAAW,EAAI,IAAM,IAAM,IAAM,IACzGC,EAAa,GAAK,GAAK,IACvBC,EAAe,GAAK,GAAK,IACzB,KAAK,QAAQ,sBAAwB,GAAK,GAAK,IAC/CI,EAAY,GAAK,GAAK,IACtBpjB,EAAc,EAAI,GAAK,GAAK,GAC7BqjB,EAA0B,GAAK,GACvCF,EAAY,KAAK,SAAS,KAAK,GAAG,EAClCD,EAAS,KAAK,aAAaC,CAAS,EAChCD,EACA,OAAOA,EAEXD,EAAc,KAAK,QAAQ,0BAA0B,CACjD,MAAO,wBACP,aAAc,KAAK,qBAAqB,aACxC,mBAAoB,KAAK,oBACzB,YAAa1jB,EAAoB,UAAUS,CAAW,CACtE,CAAa,CACJ,CACD,KAAK,qBAAqB,qBAAqB,CAAC,CAAC+iB,CAAU,EAC3D,KAAK,qBAAqB,kBAAkB,CAAC,CAACC,GAAgB,CAAC,CAAC,KAAK,qBAAuBzjB,EAAoB,iBAAiB,KAAK,mBAAmB,CAAC,EAC1J,KAAK,qBAAqB,oBAAoByjB,EAAe,IAAO,CAAC,EACrE,KAAK,qBAAqB,kBAAkBA,EAAe,IAAM,GAAG,EACpE,KAAK,qBAAqB,iBAAiBA,EAAe,KAAO,IAAI,EACrE,KAAK,qBAAqB,aAAaF,EAAa,GAAM,CAAC,EAC3D,MAAMlQ,EAAW,KAAK,qBAAqB,kBAAkB,EAAG,KAAK,QAAS5S,CAAW,EACnF6d,EAAwB,KAAK,QAAQ,iBACvCiF,GACA,KAAK,QAAQ,gBAAgB,QAASA,CAAU,EAEpD,KAAK,QAAQ,SAAS,aAAc,KAAK,QAAQ,sBAAwB,KAAK,QAAQ,wBAA0B,KAAK,QAAQ,gBAAgB,EAC7IjF,EAAsB,cAAc,SACpC,MAAMyF,EAAkBF,EAAY,KAAK,QAAQ,WAAa,KAAK,QAAQ,eACrEG,EAAiB1F,EAAsB,cAAc,UAAS,EAC9DnQ,EAAM6V,EAAe,SAAW,IAAMD,EAAgB,SAC5D,IAAIxB,EAAa,KAAK,YAAYpU,CAAG,EACrC,GAAI,CAACoU,EAAY,CACb,MAAM1D,EAAmBP,EAAsB,iBAAiB,CAAC,EACjEiE,EAAa,KAAK,YAAYpU,CAAG,EAAI,CAAA,EACrCoU,EAAW,KAAK,KAAK,QAAQ,gBAAgB,CACzC,MAAO,uBAAuBpU,CAAG,GACjC,OAAQ0Q,EAAiB,CAAC,EAC1B,QAAS,CAAE,CACd,CAAA,CAAC,EACG9W,EAA8B,0BAC/Bwa,EAAW,KAAK,KAAK,QAAQ,gBAAgB,CACzC,MAAO,uBAAuBpU,CAAG,GACjC,OAAQ0Q,EAAiB,CAAC,EAC1B,QAAS,CAAE,CACd,CAAA,CAAC,EAEN0D,EAAW,KAAK,KAAK,QAAQ,gBAAgB,CACzC,MAAO,qBAAqBxa,EAA8B,yBAA2B,EAAI,CAAC,IAAIoG,CAAG,GACjG,OAAQ0Q,EAAiB9W,EAA8B,yBAA2B,EAAI,CAAC,EACvF,QAAS,CACL,CACI,QAAS,EACT,SAAU,CACN,OAAQgc,EAAgB,mBACxB,KAAMA,EAAgB,QACzB,CACJ,EACD,CACI,QAAS,EACT,SAAU,CACN,OAAQC,EAAe,mBACvB,KAAMA,EAAe,QACxB,CACJ,CACJ,CACJ,CAAA,CAAC,CACL,CACDN,EAAY,YAAYrQ,CAAQ,EAChC,QAASpS,EAAI,EAAGA,EAAIshB,EAAW,OAAQ,EAAEthB,EACrCyiB,EAAY,aAAaziB,EAAGshB,EAAWthB,CAAC,CAAC,EAE7C,OAAAyiB,EAAY,KAAK,EAAG,EAAG,EAAG,CAAC,EACtBJ,IACDK,EAASD,EAAY,SACrB,KAAK,aAAaE,CAAS,EAAID,GAE5BA,CACV,CACL,CChIO,MAAMM,EAAyB,CAClC,YAAYnd,EAAGC,EAAGE,EAAGid,EAAG,CACpB,KAAK,EAAI,KAAK,MAAMpd,CAAC,EACrB,KAAK,EAAI,KAAK,MAAMC,CAAC,EACrB,KAAK,EAAI,KAAK,MAAME,CAAC,EACrB,KAAK,EAAI,KAAK,MAAMid,CAAC,CACxB,CACD,IAAIZ,EAAY,CACZA,EAAW,YAAY,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,EAAG,CAAC,CAC9D,CACD,OAAQ,CACJ,OAAO,IAAIW,GAAyB,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CACrE,CACL,CAEO,MAAME,EAAwB,CACjC,YAAYrd,EAAGC,EAAGE,EAAGid,EAAG,CACpB,KAAK,EAAIpd,EACT,KAAK,EAAIC,EACT,KAAK,EAAIE,EACT,KAAK,EAAIid,CACZ,CACD,IAAIZ,EAAY,CACZA,EAAW,eAAe,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CAC3D,CACD,OAAQ,CACJ,OAAO,IAAIa,GAAwB,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,CAAC,CACpE,CACL,CAEO,MAAMC,EAA2B,CACpC,YAAYC,EAAK,CACb,KAAK,IAAMA,CACd,CACD,IAAIf,EAAY,CACZA,EAAW,oBAAoB,KAAK,GAAG,CAC1C,CACD,OAAQ,CACJ,OAAO,IAAIc,GAA2B,KAAK,GAAG,CACjD,CACL,CAEO,MAAME,EAA2B,CACpC,YAAYC,EAAO,CACf,KAAK,MAAQA,CAChB,CACD,IAAIjB,EAAY,CACZA,EAAW,iBAAiB,KAAK,KAAK,CACzC,CACD,OAAQ,CACJ,OAAO,IAAIgB,GAA2B,KAAK,KAAK,CACnD,CACL,CAEO,MAAME,EAAoC,CAC7C,YAAYC,EAAO,CACf,KAAK,MAAQA,CAChB,CACD,IAAInB,EAAY,CACZA,EAAW,oBAAoB,KAAK,KAAK,CAC5C,CACD,OAAQ,CACJ,OAAO,IAAIkB,GAAoC,KAAK,KAAK,CAC5D,CACL,CAEO,MAAME,EAAkC,CAC3C,aAAc,CAAG,CACjB,IAAIpB,EAAY,CACZA,EAAW,kBAAiB,CAC/B,CACD,OAAQ,CACJ,OAAO,IAAIoB,EACd,CACL,CACA,MAAMC,EAAwB,CAC1B,aAAc,CACV,KAAK,QAAU,EAClB,CACD,IAAIrB,EAAY,CACZA,EAAW,eAAe,KAAK,OAAO,CACzC,CACD,OAAQ,CACJ,MAAMsB,EAAS,IAAID,GACnB,OAAAC,EAAO,QAAU,KAAK,QACfA,CACV,CACL,CAEO,MAAMC,EAAiB,CAC1B,YAAYzS,EAAQ,CAChB,KAAK,aAAe,EACpB,KAAK,QAAUA,EACf,KAAK,MAAQ,IAAI,MAAM,EAAE,EACzB,KAAK,YAAc,CACtB,CACD,UAAUuR,EAAQ,CACd,GAAI,CAAC,KAAK,qBAAsB,CAC5B,MAAMmB,EAAO,IAAIH,GACjB,KAAK,MAAM,KAAK,aAAa,EAAIG,EACjC,KAAK,mBAAqBA,EAAK,QAC/B,KAAK,qBAAuB,EAC/B,CACGnB,GACA,KAAK,mBAAmB,KAAKA,CAAM,CAE1C,CACD,eAAgB,CACR,KAAK,sBAAwB,KAAK,iBAClC,KAAK,mBAAmB,KAAK,KAAK,eAAe,OAAM,CAAE,EACzD,KAAK,eAAiB,OACtB,KAAK,qBAAuB,GAEnC,CACD,QAAQmB,EAAM,CACV,KAAK,cAAa,EAClB,KAAK,MAAM,KAAK,aAAa,EAAIA,EACjC,KAAK,qBAAuB,EAC/B,CACD,iBAAiBC,EAAcC,EAAoBvkB,EAAa,CAC5D,OAAK,KAAK,uBACN,KAAK,UAAS,EACd,KAAK,eAAiB,KAAK,QAAQ,0BAA0B,CACzD,aAAAskB,EACA,mBAAAC,EACA,YAAahlB,EAAoB,UAAUS,CAAW,CACtE,CAAa,GAEE,KAAK,cACf,CACD,OAAQ,CACJ,KAAK,cAAa,CACrB,CACD,IAAI6iB,EAAY,CACZ,KAAK,MAAK,EACV,QAASriB,EAAI,EAAGA,EAAI,KAAK,YAAa,EAAEA,EACpC,KAAK,MAAMA,CAAC,EAAE,IAAIqiB,CAAU,CAEnC,CACD,OAAQ,CACJ,KAAK,YAAc,EACnB,KAAK,qBAAuB,GAC5B,KAAK,aAAe,CACvB,CACD,OAAQ,CACJ,KAAK,MAAK,EACV,MAAMsB,EAAS,IAAIC,GAAiB,KAAK,OAAO,EAChDD,EAAO,MAAQ,IAAI,MAAM,KAAK,WAAW,EACzCA,EAAO,YAAc,KAAK,YAC1BA,EAAO,aAAe,KAAK,aAC3B,QAAS3jB,EAAI,EAAGA,EAAI,KAAK,YAAa,EAAEA,EACpC2jB,EAAO,MAAM3jB,CAAC,EAAI,KAAK,MAAMA,CAAC,EAAE,QAEpC,OAAO2jB,CACV,CACL,CC3JO,MAAMK,EAAe,CACxB,IAAI,UAAW,CACX,OAAO,KAAK,SACf,CACD,YAAYxf,EAAQyf,EAAO3kB,EAAM6R,EAAQC,EAAe8S,EAAwB,GAAMnQ,EAAO,CACzF,KAAK,YAAc,GACnB,KAAK,QAAUvP,EACf,KAAK,QAAU2M,EACf,KAAK,eAAiBC,EACtB,KAAK,OAAS6S,EACd,KAAK,uBAAyBC,EAC9B,KAAK,UAAY/S,EAAO,eAAe,CACnC,MAAO4C,GAAS,WAChB,KAAAzU,EACA,MAAA2kB,CACZ,CAAS,EACD,KAAK,aAAe7S,EAAc,gBAAgB,EAAI6S,EAAO1S,EAA4B,aAAeA,EAA4B,QAAS,OAAW,aAAa,EAChK2S,GACD,KAAK,YAAY,KAAK,KAAK,eAAe,gBAAgB,EAAI,KAAK,OAAQ3S,EAA4B,QAAUA,EAA4B,QAAS,OAAW,8BAA8B,CAAC,CAEvM,CACD,WAAW4S,EAAYC,EAAY,CAC/B,GAAI,CAAC,KAAK,wBAA0B,KAAK,YAAY,SAAW,EAC5D,OAAO,KAEX,MAAMC,EAAgB,KAAK,QAAQ,qBAAoB,EACvD,IAAI/O,EACJ,OAAI,KAAK,YAAY,SAAW,EAC5BA,EAAS,KAAK,eAAe,gBAAgB,EAAI,KAAK,OAAQ/D,EAA4B,QAAUA,EAA4B,QAAS,OAAW,6BAA6B,GAGjL+D,EAAS,KAAK,YAAY,KAAK,YAAY,OAAS,CAAC,EACrD,KAAK,YAAY,UAErB+O,EAAc,gBAAgB,KAAK,UAAWF,EAAYC,EAAY,KAAK,aAAc,CAAC,EAC1FC,EAAc,mBAAmB,KAAK,aAAc,EAAG/O,EAAQ,EAAG,EAAI8O,CAAU,EAChF,KAAK,QAAQ,MAAM,OAAO,CAACC,EAAc,OAAQ,CAAA,CAAC,EAC3C/O,CACV,CACD,MAAM,WAAW6O,EAAa,EAAGC,EAAa,EAAG,CAC7C,MAAM9O,EAAS,KAAK,WAAW6O,EAAYC,CAAU,EACrD,GAAI9O,IAAW,KACX,OAAO,KAEX,MAAMoC,EAAW,KAAK,QAAQ,SAC9B,OAAOpC,EAAO,SAAS,CAAqC,EAAC,KAAK,IAAM,CACpE,MAAMgP,EAAW,IAAI,eAAehP,EAAO,eAAgB,CAAA,EAAE,QAC7D,OAAAA,EAAO,MAAK,EACZ,KAAK,YAAY,KAAK,YAAY,MAAM,EAAIA,EACrCgP,CACV,EAAGC,GAAQ,CACR,GAAI,KAAK,QAAQ,YAAc,KAAK,QAAQ,WAAa7M,EAErD,OAAO,KAEX,MAAM6M,CAClB,CAAS,CACJ,CACD,MAAM,UAAUJ,EAAa,EAAG,CAC5B,MAAM7O,EAAS,KAAK,WAAW6O,EAAY,CAAC,EAC5C,GAAI7O,IAAW,KACX,OAAO,KAEX,MAAMoC,EAAW,KAAK,QAAQ,SAC9B,OAAOpC,EAAO,SAAS,CAAqC,EAAC,KAAK,IAAM,CACpE,MAAMgP,EAAW,IAAI,eAAehP,EAAO,eAAgB,CAAA,EACrD1P,EAAQ,OAAO0e,EAAS,CAAC,CAAC,EAChC,OAAAhP,EAAO,MAAK,EACZ,KAAK,YAAY,KAAK,YAAY,MAAM,EAAIA,EACrC1P,CACV,EAAG2e,GAAQ,CACR,GAAI,KAAK,QAAQ,YAAc,KAAK,QAAQ,WAAa7M,EAErD,MAAO,GAEX,MAAM6M,CAClB,CAAS,CACJ,CACD,MAAM,yBAAyBJ,EAAa,EAAG,CAC3C,MAAM7O,EAAS,KAAK,WAAW6O,EAAY,CAAC,EAC5C,GAAI7O,IAAW,KACX,OAAO,KAEX,MAAMoC,EAAW,KAAK,QAAQ,SAC9B,OAAOpC,EAAO,SAAS,CAAqC,EAAC,KAAK,IAAM,CACpE,MAAMgP,EAAW,IAAI,eAAehP,EAAO,eAAgB,CAAA,EACrD1P,EAAQ,OAAO0e,EAAS,CAAC,EAAIA,EAAS,CAAC,CAAC,EAC9C,OAAAhP,EAAO,MAAK,EACZ,KAAK,YAAY,KAAK,YAAY,MAAM,EAAIA,EACrC1P,CACV,EAAG2e,GAAQ,CACR,GAAI,KAAK,QAAQ,YAAc,KAAK,QAAQ,WAAa7M,EAErD,MAAO,GAEX,MAAM6M,CAClB,CAAS,CACJ,CACD,SAAU,CACN,KAAK,UAAU,UACf,KAAK,eAAe,cAAc,KAAK,YAAY,EACnD,QAASvkB,EAAI,EAAGA,EAAI,KAAK,YAAY,OAAQ,EAAEA,EAC3C,KAAK,eAAe,cAAc,KAAK,YAAYA,CAAC,CAAC,CAE5D,CACL,CCvGO,MAAMwkB,EAAqB,CAC9B,IAAI,qBAAsB,CACtB,OAAO,KAAK,oBACf,CACD,YAAYhgB,EAAQ2M,EAAQC,EAAe,CACvC,KAAK,SAAW,GAChB,KAAK,qBAAuB,IAAI1R,GAChC,KAAK,sBAAwB,EAC7B,KAAK,QAAU8E,EACf,KAAK,QAAU2M,EACf,KAAK,eAAiBC,CACzB,CACD,IAAI,QAAS,CACT,OAAO,KAAK,QACf,CACD,IAAI,OAAOxL,EAAO,CACd,GAAI,KAAK,WAAaA,EAKtB,GAFA,KAAK,SAAWA,EAChB,KAAK,sBAAwB,EACzBA,EACA,GAAI,CACA,KAAK,iBAAmB,IAAI6e,GAAsB,KAAK,QAAS,KAAK,QAAS,KAAK,eAAgB,IAAM,yBAAyB,CACrI,OACMC,EAAG,CACN,KAAK,SAAW,GAChBxkB,EAAO,MAAM;AAAA,SAAuDwkB,EAAE,QAAU;AAAA,oEAAuE,EACvJ,MACH,MAGD,KAAK,iBAAiB,SAE7B,CACD,WAAWvkB,EAAgB,CACnB,KAAK,UAAY,KAAK,wBAA0B,IAChD,KAAK,iBAAiB,MAAMA,CAAc,EAC1C,KAAK,sBAAwB,EAEpC,CACD,SAASA,EAAgB,CACjB,KAAK,wBAA0B,IAC/B,KAAK,sBAAwB,EAC7B,KAAK,iBAAiB,KAAKA,CAAc,EAAE,KAAMP,GAAa,CACtDA,IAAa,MAAQA,GAAY,IACjC,KAAK,qBAAqB,gBAC1B,KAAK,qBAAqB,SAASA,EAAU,EAAI,GAErD,KAAK,sBAAwB,CAC7C,CAAa,EAER,CACD,UAAUoQ,EAAY9K,EAAO,CACrB,KAAK,SACL,KAAK,iBAAiB,UAAU8K,EAAY9K,CAAK,EAGjD8K,EAAW,gBAAkB,MAEpC,CACD,QAAQ9K,EAAOyf,EAAgB,CAC3B,GAAI,CAAC,KAAK,UAAY,CAACA,EACnB,OAEJ,MAAMhlB,EAAiB,KAAK,QAAQ,QACpC,KAAK,iBAAiB,SAASuF,CAAK,EAAE,KAAM0f,GAAc,CACtDD,EAAe,aAAahlB,EAAgBilB,IAAc,MAAQA,EAAY,EAAIA,EAAY,CAAC,CAC3G,CAAS,CACJ,CACD,SAAU,CACN,KAAK,kBAAkB,SAC1B,CACL,CAEO,MAAMH,EAAsB,CAC/B,YAAYjgB,EAAQ2M,EAAQC,EAAe6S,EAAQ,EAAGY,EAAe,CACjE,KAAK,OAASZ,EACd,KAAK,UAAY,IAAID,GAAexf,EAAQyf,EAAO,YAAuD9S,EAAQC,EAAe,GAAMyT,CAAa,CACvJ,CACD,MAAMxS,EAAS,CACXA,EAAQ,iBAAiB,KAAK,UAAU,SAAU,CAAC,CACtD,CACD,MAAM,KAAKA,EAAS,CAChB,OAAAA,EAAQ,iBAAiB,KAAK,UAAU,SAAU,CAAC,EAC5CA,EAAQ,eAAiB,KAAK,UAAU,yBAAyB,CAAC,EAAI,CAChF,CACD,UAAUrC,EAAY9K,EAAO,CACzB,GAAIA,EAAQ,EAAI,KAAK,OACjB,MAAM,IAAI,MAAM,8CAAgDA,EAAQ,GAAG,EAE/E8K,EAAW,gBAAkB,CACzB,SAAU,KAAK,UAAU,SACzB,0BAA2B9K,EAAQ,EACnC,oBAAqBA,EAAQ,CACzC,CACK,CACD,MAAM,SAASA,EAAO,CAClB,OAAO,KAAK,UAAU,yBAAyBA,EAAQ,CAAC,CAC3D,CACD,SAAU,CACN,KAAK,UAAU,SAClB,CACL,CCzGO,MAAM4f,EAAqB,CAC9B,IAAI,UAAW,CACX,OAAO,KAAK,UAAU,QACzB,CACD,IAAI,YAAa,CACb,OAAO,KAAK,uBAAyB,KAAK,kBAAkB,MAC/D,CACD,cAAc5f,EAAO,CACjB,GAAI,KAAK,wBAA0B,KAAK,QAAQ,SAAW,KAAK,cAAcA,CAAK,IAAM,KAAK,QAAQ,QAClG,MAAO,GAEX,MAAM6f,EAAW,KAAK,QAAQ,6BAA4B,EAAG,qBAAqB,oBAAsB,OACxG,OAAIA,IACA,KAAK,cAAc7f,CAAK,EAAI,KAAK,QAAQ,SAEtC6f,CACV,CACD,YAAYvgB,EAAQ2M,EAAQC,EAAe4T,EAAa,GAAIC,EAAiB,IAAK,CAC9E,KAAK,kBAAoB,GACzB,KAAK,sBAAwB,GAC7B,KAAK,cAAgB,GACrB,KAAK,QAAUzgB,EACf,KAAK,QAAU2M,EACf,KAAK,eAAiBC,EACtB,KAAK,iBAAmB,GACxB,KAAK,qBAAuB,EAC5B,KAAK,gBAAkB6T,EACvB,KAAK,oBAAoBD,CAAU,CACtC,CACD,aAAc,CACN,KAAK,kBAAkB,SAAW,GAClC,KAAK,oBAAmB,EAE5B,MAAM9f,EAAQ,KAAK,kBAAkB,KAAK,kBAAkB,OAAS,CAAC,EACtE,YAAK,kBAAkB,SAChBA,CACV,CACD,YAAYA,EAAO,CACf,KAAK,kBAAkB,KAAK,kBAAkB,MAAM,EAAIA,CAC3D,CACD,uBAAuBA,EAAO,CAC1B,YAAK,qBAAoB,EAClB,CAAC,CAAC,KAAK,aAAeA,EAAQ,KAAK,YAAY,MACzD,CACD,eAAeA,EAAO,CAClB,OAAO,OAAO,KAAK,cAAcA,CAAK,GAAK,EAAE,CAChD,CACD,sBAAuB,CACf,KAAK,aAAe,KAAK,mBAAqB,KAAK,QAAQ,SAG3D,KAAK,mBAAqB,KAAK,QAAQ,UACvC,KAAK,iBAAmB,KAAK,QAAQ,QACrC,KAAK,UAAU,WAAW,EAAG,KAAK,oBAAoB,EAAE,KAAMqQ,GAAgB,CAC1E,KAAK,YAAcA,CACnC,CAAa,EAER,CACD,oBAAoB2P,EAAY,CAC5BA,EAAaA,GAAc,KAAK,gBAChC,KAAK,sBAAqB,EAC1B,QAASllB,EAAI,EAAGA,EAAIklB,EAAY,EAAEllB,EAC9B,KAAK,kBAAkB,KAAK,KAAK,qBAAuBA,CAAC,EAE7D,KAAK,sBAAwBklB,EAC7B,KAAK,UAAY,IAAIlB,GAAe,KAAK,QAAS,KAAK,qBAAsB,YAAuD,KAAK,QAAS,KAAK,eAAgB,GAAO,iCAAmC,KAAK,oBAAoB,EAC1O,KAAK,sBAAwB,KAAK,QAAQ,OAC7C,CACD,uBAAwB,CACpB,MAAMmB,EAAW,KAAK,UAClBA,GAEA,WAAW,IAAMA,EAAS,QAAS,GAAI,CAE9C,CACD,SAAU,CACN,KAAK,WAAW,UAChB,KAAK,kBAAkB,OAAS,CACnC,CACL,CC5EO,MAAMC,EAAkB,CAE3B,IAAI,MAAO,CACP,OAAO,KAAK,WACf,CAMD,YAAYC,EAAYC,EAAmB,GAAI,CAE3C,KAAK,MAAQ,GACb,KAAK,YAAcD,EACnB,KAAK,kBAAoBC,EACzB,KAAK,eAAiB,GACtB,KAAK,YAAc,gBACtB,CAID,aAAc,CACN,KAAK,OACLplB,EAAO,IAAI,qCAAqC,KAAK,YAAY,MAAM,MAAM,EAEjF,KAAK,kBAAiB,EACtB,KAAK,iBAAiB,KAAK,iBAAiB,EACxC,KAAK,OACLA,EAAO,IAAI,0BAA0B,CAE5C,CACD,mBAAoB,CAChB,IAAI0H,EAAa,EACjB,KAAOA,EAAa,KAAK,YAAY,QAAQ,CAEzC,MAAM2d,EAAmB,KAAK,YAAY,QAAQ,KAAK,YAAa3d,CAAU,EAC9E,GAAI2d,EAAmB,EACnB,MAEJ,MAAMC,EAAuB,KAAK,YAAY,QAAQ,IAAKD,EAAmB,KAAK,YAAY,MAAM,EACrG,GAAIC,EAAuB,EAAG,CACtB,KAAK,OACLtlB,EAAO,KAAK,sEAAsE0H,CAAU,EAAE,EAElGA,EAAa2d,EAAmB,KAAK,YAAY,OACjD,QACH,CACD,MAAME,EAAgBL,GAAkB,+BAA+B,KAAK,KAAK,YAAY,UAAUG,EAAmB,KAAK,YAAY,OAAQC,CAAoB,CAAC,EACxK,GAAI,CAACC,EAAe,CACZ,KAAK,OACLvlB,EAAO,KAAK,yDAAyD,KAAK,YAAY,UAAUqlB,EAAmB,KAAK,YAAY,OAAQC,CAAoB,CAAC,EAAE,EAEvK5d,EAAa2d,EAAmB,KAAK,YAAY,OACjD,QACH,CACD,KAAM,CAACG,EAAUC,CAAQ,EAAI,CAACF,EAAc,CAAC,EAAGA,EAAc,CAAC,CAAC,EAE1DG,EAAqBpe,EAAsB,IAAK,IAAK,KAAK,YAAage,CAAoB,EACjG,GAAII,EAAqB,EAAG,CACpB,KAAK,OACL1lB,EAAO,KAAK,kDAAkDylB,CAAQ,WAAWD,CAAQ,2BAA2BF,CAAoB,EAAE,EAE9I5d,EAAa2d,EAAmB,KAAK,YAAY,OACjD,QACH,CACD,MAAMM,EAAa,KAAK,YAAY,UAAUL,EAAuB,EAAGI,CAAkB,EAEpFE,EAAqB5d,GAAgB,KAAK,YAAa0d,EAAqB,CAAC,EACnF,GAAIE,IAAuB,KAAK,YAAY,OAAQ,CAC5C,KAAK,OACL5lB,EAAO,KAAK,+CAA+CylB,CAAQ,WAAWD,CAAQ,yBAAyBE,CAAkB,EAAE,EAEvIhe,EAAa2d,EAAmB,KAAK,YAAY,OACjD,QACH,CACD,MAAMQ,EAAmBve,EAAsB,IAAK,IAAK,KAAK,YAAase,CAAkB,EAC7F,GAAIC,EAAmB,EAAG,CAClB,KAAK,OACL7lB,EAAO,KAAK,+CAA+CylB,CAAQ,WAAWD,CAAQ,yBAAyBI,CAAkB,EAAE,EAEvIle,EAAa2d,EAAmB,KAAK,YAAY,OACjD,QACH,CACD,MAAMS,EAAW,KAAK,YAAY,UAAUF,EAAoBC,EAAmB,CAAC,EAE9EvU,EAASlJ,GAAeud,CAAU,EAAE,MAAM,GAAG,EAC7CI,EAAa,CAAA,EACnB,QAAS,EAAI,EAAG,EAAIzU,EAAO,OAAQ,EAAE,EAAG,CACpC,MAAMiO,EAAQjO,EAAO,CAAC,EAAE,KAAI,EACtBvI,EAAMwW,EAAM,YAAY,GAAG,EAC7BxW,GAAO,GACPgd,EAAW,KAAKxG,EAAM,UAAUxW,EAAM,CAAC,CAAC,CAE/C,CACGyc,IAAa,QAEbO,EAAW,KAAK,QAAQ,EAG5B,KAAK,eAAe,KAAK,CACrB,KAAMN,EACN,KAAMD,EACN,WAAYO,EACZ,KAAMD,EACN,UAAW,CAC3B,CAAa,EACDpe,EAAame,EAAmB,EAEhC,MAAMG,EAAaX,EAAmB,EAAI,KAAK,YAAY,UAAU,EAAGA,CAAgB,EAAI,GACtFY,EAAYJ,EAAmB,EAAI,KAAK,YAAY,OAAS,EAAI,KAAK,YAAY,UAAUA,EAAmB,CAAC,EAAI,GAC1H,KAAK,YAAcG,EAAaC,EAChCve,GAAcme,EAAmB,EAAIR,CACxC,CACG,KAAK,OACLrlB,EAAO,IAAI,sBAAsB,KAAK,eAAe,MAAM,mCAAmC,KAAK,cAAc,EAAE,CAE1H,CACD,iBAAiBolB,EAAmB,GAAI,CACpC,KAAOA,KAAsB,GACpB,KAAK,+BAAV,CAIJ,OAAI,KAAK,OACLplB,EAAO,IAAI,uBAAuBolB,CAAgB,yBAAyB,EAExEA,GAAoB,CAC9B,CACD,6BAA8B,CAC1B,IAAIc,EAAU,GACd,UAAWvK,KAAQ,KAAK,eAAgB,CACpC,KAAM,CAAE,KAAA7Y,EAAM,KAAA1D,EAAM,WAAA+mB,EAAY,KAAAC,CAAI,EAAKzK,EACzC,IAAIjU,EAAa,EACjB,KAAOA,EAAa,KAAK,YAAY,QAAQ,CAEzC,MAAM2e,EAAoB,KAAK,YAAY,QAAQvjB,EAAM4E,CAAU,EACnE,GAAI2e,EAAoB,EACpB,MAGJ,GAAIA,IAAsB,GAAKne,GAAiB,KAAK,YAAY,OAAOme,EAAoB,CAAC,CAAC,EAAG,CAC7F3e,EAAa2e,EAAoBvjB,EAAK,OACtC,QACH,CAED,MAAMwjB,EAAuBte,GAAgB,KAAK,YAAaqe,EAAoBvjB,EAAK,MAAM,EAC9F,GAAIwjB,IAAyB,KAAK,YAAY,QAAU,KAAK,YAAY,OAAOA,CAAoB,IAAM,IAAK,CAC3G5e,EAAa2e,EAAoBvjB,EAAK,OACtC,QACH,CAED,MAAMyjB,EAAqBjf,EAAsB,IAAK,IAAK,KAAK,YAAagf,CAAoB,EACjG,GAAIC,EAAqB,EAAG,CACpB,KAAK,OACLvmB,EAAO,KAAK,oEAAoE8C,CAAI,WAAW1D,CAAI,2BAA2BknB,CAAoB,EAAE,EAExJ5e,EAAa2e,EAAoBvjB,EAAK,OACtC,QACH,CACD,MAAM0jB,EAAa,KAAK,YAAY,UAAUF,EAAuB,EAAGC,CAAkB,EA0BpFjV,GAtBsBhJ,GAAM,CAC9B,MAAM6d,EAAa,CAAA,EACnB,IAAIM,EAAS,EAAGC,EAAgB,EAChC,KAAOD,EAASne,EAAE,QAAQ,CACtB,GAAIA,EAAE,OAAOme,CAAM,IAAM,IAAK,CAC1B,MAAME,EAAOrf,EAAsB,IAAK,IAAKgB,EAAGme,CAAM,EACtD,GAAIE,EAAO,EACP,OAAO,KAEXF,EAASE,CACZ,MACQre,EAAE,OAAOme,CAAM,IAAM,MAC1BN,EAAW,KAAK7d,EAAE,UAAUoe,EAAeD,CAAM,CAAC,EAClDC,EAAgBD,EAAS,GAE7BA,GACH,CACD,OAAIC,EAAgBD,GAChBN,EAAW,KAAK7d,EAAE,UAAUoe,EAAeD,CAAM,CAAC,EAE/CN,CAC3B,GACkD/d,GAAeoe,CAAU,CAAC,EAC5D,GAAIlV,IAAW,KAAM,CACb,KAAK,OACLtR,EAAO,KAAK,uFAAuF8C,CAAI,WAAW1D,CAAI,2BAA2BknB,CAAoB,gBACjKE,CAAU,EAElB9e,EAAa2e,EAAoBvjB,EAAK,OACtC,QACH,CACD,MAAMijB,EAAa,CAAA,EACnB,QAASa,EAAI,EAAGA,EAAItV,EAAO,OAAQ,EAAEsV,EAAG,CACpC,MAAMrH,EAAQjO,EAAOsV,CAAC,EAAE,KAAI,EAC5Bb,EAAW,KAAKxG,CAAK,CACxB,CACD,MAAMsH,EAAeznB,IAAS,OAAS0D,EAAO,IAAM6Y,EAAK,YAAc,KAIvE,GAHIkL,GACAd,EAAW,KAAKc,EAAe,IAAI,EAEnCd,EAAW,SAAWI,EAAW,OAAQ,CACrC,KAAK,OACLnmB,EAAO,KAAK,6HAA6H8C,CAAI,WAAW1D,CAAI,0BAA0B+mB,CAAU,qBAAqBJ,CAAU,EAAE,EAErOre,EAAa2e,EAAoBvjB,EAAK,OACtC,QACH,CACD4E,EAAa6e,EAAqB,EAElC,MAAMT,EAAW,KAAK,cAAcM,EAAMD,EAAYJ,CAAU,EAChE,IAAIC,EAAaK,EAAoB,EAAI,KAAK,YAAY,UAAU,EAAGA,CAAiB,EAAI,GAC5F,MAAMJ,EAAYM,EAAqB,EAAI,KAAK,YAAY,OAAS,EAAI,KAAK,YAAY,UAAUA,EAAqB,CAAC,EAAI,GAC9H,GAAIM,EAAc,CAKd,MAAMC,EAAyBve,GAAa,KAAK,YAAa8d,EAAoB,EAAG;AAAA,EAAM,GAAG,EAC9FL,EAAa,KAAK,YAAY,UAAU,EAAGc,EAAyB,CAAC,EACrE,MAAMC,EAAc,KAAK,YAAY,UAAUD,EAAyB,EAAGT,CAAiB,EAC5F,KAAK,YAAcL,EAAa5mB,EAAO,IAAMynB,EAAe;AAAA,EAAQf,EAAW;AAAA,EAAOiB,EAAcF,EAAeZ,EAC/G,KAAK,OACLjmB,EAAO,IAAI,4CAA4C8C,CAAI,WAAW1D,CAAI,6BAA6B0nB,CAAsB,qBAAqBf,CAAU,EAAE,CAErK,MAGG,KAAK,YAAcC,EAAaF,EAAWG,EAC3Cve,GAAcoe,EAAS,QAAUS,EAAqB,EAAIF,GACtD,KAAK,OACLrmB,EAAO,IAAI,4CAA4C8C,CAAI,WAAW1D,CAAI,wBAAwBinB,CAAiB,qBAAqBN,CAAU,EAAE,EAG5JG,EAAU,EACb,CACJ,CACD,OAAOA,CACV,CACD,cAAcvd,EAAMqe,EAASC,EAAc,CACvC,QAASnnB,EAAI,EAAGA,EAAIknB,EAAQ,OAAQ,EAAElnB,EAAG,CACrC,MAAMonB,EAAS,IAAI,OAAOze,GAAaue,EAAQlnB,CAAC,CAAC,EAAG,GAAG,EAAGqnB,EAAYH,EAAQlnB,CAAC,EAAE,OAAQsnB,EAAcH,EAAannB,CAAC,EACrH6I,EAAOA,EAAK,QAAQue,EAAQ,CAACnd,KAAUsd,IAAS,CAC5C,MAAMhQ,EAASgQ,EAAK,CAAC,EAErB,OAAInf,GAAiBS,EAAK,OAAO0O,EAAS,CAAC,CAAC,GAAKnP,GAAiBS,EAAK,OAAO0O,EAAS8P,CAAS,CAAC,EACtFH,EAAQlnB,CAAC,EAEbsnB,CACvB,CAAa,CACJ,CACD,OAAOze,CACV,CACL,CACAuc,GAAkB,+BAAiC,6BClQ5C,MAAMoC,CAAe,CACxB,MAAM,UAAUC,EAAc,CAC1B,GAAI,CAAAD,EAAe,OAQnB,OALAC,EAAeA,GAAgB,GAC/BA,EAAe,CACX,GAAGD,EAAe,qBAClB,GAAGC,CACf,EACYA,EAAa,OACbD,EAAe,OAASC,EAAa,MAC9B,QAAQ,YAEfA,EAAa,QAAUA,EAAa,UACpC,MAAMC,EAAM,uBAAuBD,EAAa,MAAM,EAEtD,KAAK,OACLD,EAAe,OAAS,MAAM,KAAK,MAAME,EAAM,oBAAoBD,EAAa,QAAQ,CAAC,EAClF,QAAQ,WAEZ,QAAQ,OAAO,yBAAyB,EAClD,CACD,kBAAkB5e,EAAM8e,EAA4B,GAAO,CACvD,MAAMC,EAAQJ,EAAe,OAAO,kBAAkB3e,EAAM2e,EAAe,2BAA6BG,CAAyB,EACjI,OAAIH,EAAe,qBACftnB,EAAO,IAAI0nB,CAAK,EAChB1nB,EAAO,IAAI,iDAAiD,GAEzDsnB,EAAe,2BAA6BG,EAA4B;AAAA,EAA8CC,EAAQA,CACxI,CACL,CAEAJ,EAAe,qBAAuB,CAClC,OAAQ,GAAGE,EAAM,cAAc,kBAC/B,SAAU,GAAGA,EAAM,cAAc,mBACrC,EACAF,EAAe,mBAAqB,GACpCA,EAAe,0BAA4B,GAC3CA,EAAe,OAAS,KCvCjB,MAAMK,EAAwB,CACjC,YAAYrjB,EAAQsjB,EAAeC,EAAY,CAC3C,KAAK,QAAU,GACf,KAAK,MAAQ,GACb,KAAK,qBAAuB,EAC5B,KAAK,gBAAkB,GACvB,KAAK,SAAW,GAChB,KAAK,cAAgB,GACrB,KAAK,QAAUvjB,EACf,KAAK,MAAQsjB,EACb,KAAK,YAAcC,CACtB,CACD,IAAI,SAAU,CACV,OAAO,KAAK,QACf,CACD,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CACD,IAAI,QAAS,CACT,OAAO,KAAK,OACf,CACD,IAAI,QAAQC,EAAU,CAClB,KAAK,KAAK,UAAW,YAAYA,CAAQ,UAAU,KAAK,KAAK,EAAE,EAC/D,KAAK,gBAAgB,OAAS,EAC9B,KAAK,QAAU,KAAK,SAAWA,EAC/B,KAAK,MAAQ,GACTA,IACA,KAAK,WAAa,KAAK,MACvB,KAAK,MAAQ,EAEpB,CACD,IAAI,MAAO,CACP,OAAO,KAAK,KACf,CACD,IAAI,KAAKlP,EAAM,CACP,KAAK,QACL,KAAK,WAAaA,EAGlB,KAAK,MAAQA,CAEpB,CACD,cAAcmP,EAAmB,CAC7B,GAAI,CAAC,KAAK,SAAW,CAAC,KAAK,MAEvB,MAAO,GAEX,IAAIF,EAAa,KACjB,OAAI,KAAK,SACLA,EAAa,KAAK,YAAY,QAC9B,KAAK,gBAAgB,KAAKA,CAAU,EACpC,KAAK,YAAY,QACjB,KAAK,KAAK,gBAAiB,oCAAoC,KAAK,gBAAgB,OAAS,CAAC,EAAE,GAI5F,KAAK,sBAAwB,KAAK,gBAAgB,OAClD,KAAK,KAAK,gBAAiB,2DAA2D,KAAK,gBAAgB,MAAM,yBAAyB,KAAK,oBAAoB,GAAG,GAGtK,KAAK,KAAK,gBAAiB,mBAAmB,KAAK,oBAAoB,EAAE,EACzEA,EAAa,KAAK,gBAAgB,KAAK,sBAAsB,GAGjEA,IACAA,EAAW,IAAIE,CAAiB,EAC5B,KAAK,QAAU,GACf,KAAK,QAAQ,gBAAgBF,EAAW,YAAY,GAGrD,EACV,CACD,UAAW,CACH,KAAK,UAEL,KAAK,QAAU,GACf,KAAK,MAAQ,GACb,KAAK,MAAQ,KAAK,WAClB,KAAK,KAAK,WAAY,0CAA0C,GAEpE,KAAK,qBAAuB,CAC/B,CACD,OAAQ,CACJ,KAAK,KAAK,QAAS,QAAQ,EACvB,KAAK,UACL,KAAK,MAAQ,KAAK,YAEtB,KAAK,QAAU,GACf,KAAK,QAAU,EAClB,CACD,KAAKpC,EAAUuC,EAAS,CAChB,KAAK,eACLhoB,EAAO,IAAI,WAAW,KAAK,QAAQ,OAAO,6BAA6BylB,CAAQ,MAAMuC,CAAO,EAAE,CAErG,CACL,CCjGA,MAAMC,GAAkB,IAAM,CAC1B,MAAMliB,EAAQ,IAAI,WAAW,CAAC,EACxBmiB,EAAO,IAAI,YAAYniB,EAAM,MAAM,EACzC,MAAO,CAAC,GAAGmiB,EAAK,CAAC,EAAI,GAAKniB,EAAM,CAAC,EACrC,KACA,OAAO,eAAeoT,EAAa,UAAW,sBAAuB,CACjE,IAAK,UAAY,CACb,OAAQ,KAAK,gBAAkB,KAAK,eAAe,YAAe,KAAK,UAC1E,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACD,OAAO,eAAeA,EAAa,UAAW,sBAAuB,CACjE,IAAK,UAAY,CACb,OAAO,KAAK,eAAiB,EAAI,KAAK,UACzC,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACD,OAAO,eAAeA,EAAa,UAAW,kBAAmB,CAC7D,IAAK,UAAY,CACb,OAAQ,KAAK,gBAAkB,KAAK,eAAe,UAAS,GAAO,KAAK,QAAQ,WACnF,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACDA,EAAa,UAAU,SAAW,UAAY,CAC1C,KAAK,SAAS,WACd,KAAK,gBAAgB,UACzB,EACAA,EAAa,UAAU,QAAU,UAAY,CACrC,KAAK,aACL,KAAK,QAAQ,UAEjB,KAAK,gBAAgB,UACrB,KAAK,eAAiB,OACtB,KAAK,YAAc,EACvB,EACAA,EAAa,UAAU,iBAAmB,UAAY,CAClD,OAAO,KAAK,gBAAkB,KAAK,OACvC,EACAA,EAAa,UAAU,aAAe,UAAY,CAC9C,MAAMvB,EAAO,KAAK,QAAQ,QAAO,EACjC,GAAI,CAAC,KAAK,OAAO,UAAU,gDAAmD,KAAK,WAAa,IAAM,GAAK,KAAK,WAAa,IAAM,GAAM,CAACA,EACtI,OAEJ,MAAMuQ,EAAiBhP,EAAa,kBAAkB,KAAK,IAAI,EACzDiP,EAAqB,KAAK,WAAa,EAAK,GAC5CC,EAAcD,EAAoBD,EAClCG,EAAgB,KAAK,kBAErBC,EADkBD,EAAgBF,EACFD,EACtC,IAAIK,EACJ,GAAI,MAAM,QAAQ5Q,CAAI,EAAG,CACrB,MAAM6Q,EAAoB,IAAI,aAAa7Q,CAAI,EAC/C4Q,EAAa,IAAI,SAASC,EAAkB,OAAQA,EAAkB,WAAYA,EAAkB,UAAU,CACjH,MACQ7Q,aAAgB,YACrB4Q,EAAa,IAAI,SAAS5Q,EAAM,EAAGA,EAAK,UAAU,EAGlD4Q,EAAa,IAAI,SAAS5Q,EAAK,OAAQA,EAAK,WAAYA,EAAK,UAAU,EAE3E,IAAI8Q,EACA,KAAK,OAASvP,EAAa,KAC3BuP,EAAc,IAAI,UAAUH,CAAW,EAElC,KAAK,OAASpP,EAAa,cAChCuP,EAAc,IAAI,WAAWH,CAAW,EAEnC,KAAK,OAASpP,EAAa,MAChCuP,EAAc,IAAI,WAAWH,CAAW,EAEnC,KAAK,OAASpP,EAAa,eAChCuP,EAAc,IAAI,YAAYH,CAAW,EAEpC,KAAK,OAASpP,EAAa,IAChCuP,EAAc,IAAI,WAAWH,CAAW,EAEnC,KAAK,OAASpP,EAAa,aAChCuP,EAAc,IAAI,YAAYH,CAAW,EAGzCG,EAAc,IAAI,aAAaH,CAAW,EAE9C,MAAMle,EAAgB,KAAK,UAC3B,IAAIse,EAAe,KAAK,WACxB,QAAS7oB,EAAI,EAAGA,EAAIwoB,EAAe,EAAExoB,EAAG,CACpC,QAASsD,EAAI,EAAGA,EAAIiH,EAAe,EAAEjH,EACjC,OAAQ,KAAK,KAAI,CACb,KAAK+V,EAAa,KACduP,EAAY5oB,EAAIuoB,EAAcjlB,CAAC,EAAIolB,EAAW,QAAQG,EAAevlB,CAAC,EACtE,MACJ,KAAK+V,EAAa,cACduP,EAAY5oB,EAAIuoB,EAAcjlB,CAAC,EAAIolB,EAAW,SAASG,EAAevlB,CAAC,EACvE,MACJ,KAAK+V,EAAa,MACduP,EAAY5oB,EAAIuoB,EAAcjlB,CAAC,EAAIolB,EAAW,SAASG,EAAevlB,EAAI,EAAG6kB,CAAc,EAC3F,MACJ,KAAK9O,EAAa,eACduP,EAAY5oB,EAAIuoB,EAAcjlB,CAAC,EAAIolB,EAAW,UAAUG,EAAevlB,EAAI,EAAG6kB,CAAc,EAC5F,MACJ,KAAK9O,EAAa,IACduP,EAAY5oB,EAAIuoB,EAAcjlB,CAAC,EAAIolB,EAAW,SAASG,EAAevlB,EAAI,EAAG6kB,CAAc,EAC3F,MACJ,KAAK9O,EAAa,aACduP,EAAY5oB,EAAIuoB,EAAcjlB,CAAC,EAAIolB,EAAW,UAAUG,EAAevlB,EAAI,EAAG6kB,CAAc,EAC5F,MACJ,KAAK9O,EAAa,MACduP,EAAY5oB,EAAIuoB,EAAcjlB,CAAC,EAAIolB,EAAW,WAAWG,EAAevlB,EAAI,EAAG6kB,CAAc,EAC7F,KACP,CAELU,GAAgB,KAAK,UACxB,CACD,KAAK,gBAAgB,UACrB,KAAK,eAAiB,IAAIC,GAAO,KAAK,OAAQF,EAAa,GAAON,EAAmB,GAAO,KAAK,eAAgB,EAAE,GAAM,KAAK,iBAAkB,KAAK,QAAU,gBAAkB,UAAU,CAC/L,EChHO,MAAMS,WAA8B9I,EAAgB,CACvD,YAAY3N,EAAO,CACf,MAAMA,CAAK,CACd,CACL,CCNAzS,EAAiB,UAAU,aAAe,SAAUiZ,EAAMkQ,EAAqB,GAAO,CAClF,GAAI,KAAK,aAAelQ,IAAUA,IAAS,GAAK,CAAC,KAAK,YAAY,YAAgBA,IAAS,GAAK,KAAK,YAAY,YAAc,CAC3H,GAAI,CAACkQ,EAAoB,CAErB,MAAMC,EAAYnQ,IAAS,EACvB,KAAK,kBAAkB,YAAcmQ,IACrC,KAAK,cAAcA,CAAS,EAC5B,KAAK,qBAAqB,qBAAqBA,CAAS,EAE/D,CACD,MACH,CACD,OAAQnQ,EAAI,CACR,IAAK,GACD,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,EAAG,IAAK,EAAG,CAAC,EAC7D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,EAAG,IAAK,EAAG,GAAG,EAC/D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,IAAK,IAAK,EAAG,CAAC,EAC/D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,EAAG,EAAG,EAAG,CAAC,EAC3D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,IAAK,EAAG,EAAG,CAAC,EAC7D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,EAAG,IAAK,EAAG,CAAC,EAC7D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,IAAK,EAAG,EAAG,CAAC,EAC7D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,IAAK,IAAK,EAAG,CAAC,EAC/D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,GACD,KAAK,YAAY,gCAAgC,MAAO,MAAO,MAAO,KAAK,EAC3E,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,IACD,KAAK,YAAY,gCAAgC,EAAG,IAAK,EAAG,GAAG,EAC/D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,IACD,KAAK,YAAY,gCAAgC,EAAG,EAAG,EAAG,CAAC,EAC3D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,IACD,KAAK,YAAY,gCAAgC,IAAK,EAAG,EAAG,CAAC,EAC7D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,IACD,KAAK,YAAY,gCAAgC,IAAK,IAAK,IAAK,GAAG,EACnE,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,IACD,KAAK,YAAY,gCAAgC,EAAG,IAAK,EAAG,GAAG,EAC/D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,IACD,KAAK,YAAY,gCAAgC,EAAG,EAAG,EAAG,CAAC,EAC3D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,IACD,KAAK,YAAY,gCAAgC,IAAK,IAAK,EAAG,CAAC,EAC/D,KAAK,YAAY,WAAa,GAC9B,MACJ,IAAK,IAED,KAAK,YAAY,gCAAgC,IAAK,IAAK,EAAG,GAAG,EACjE,KAAK,YAAY,WAAa,GAC9B,KACP,CACIkQ,IACD,KAAK,cAAclQ,IAAS,CAAC,EAC7B,KAAK,qBAAqB,qBAAqBA,IAAS,CAAC,GAE7D,KAAK,WAAaA,EAClB,KAAK,qBAAqB,qBAAqB,KAAK,YAAY,UAAU,EAC1E,KAAK,qBAAqB,qBAAqB,KAAK,YAAY,yBAA0B,KAAK,YAAY,wBAAwB,CACvI,EACAjZ,EAAiB,UAAU,iBAAmB,SAAUqpB,EAAU,CAC9DppB,EAAe,UAAU,iBAAiB,KAAK,KAAMopB,CAAQ,EAC7D,KAAK,qBAAqB,qBAAqB,KAAK,YAAY,yBAA0B,KAAK,YAAY,wBAAwB,CACvI,ECjGArpB,EAAiB,UAAU,iBAAmB,SAAUiY,EAAM9Y,EAAOC,EAAQE,EAAQqQ,EAAiB+C,EAAS4W,EAAcC,EAAc,KAAM9pB,EAAO,EAAGkV,EAAgB,EAAGjV,EAAgB,GAAO,CACjM,MAAMH,EAAU,IAAI8gB,EAAgB,KAAM,CAAC,EAC3C,OAAA9gB,EAAQ,UAAYJ,EACpBI,EAAQ,WAAaH,EACrBG,EAAQ,MAAQJ,EAChBI,EAAQ,OAASH,EACjBG,EAAQ,OAASD,EACjBC,EAAQ,gBAAkBoQ,EAC1BpQ,EAAQ,aAAe+pB,EACvB/pB,EAAQ,QAAUmT,EAClBnT,EAAQ,aAAegqB,EACvBhqB,EAAQ,KAAOE,EACfF,EAAQ,eAAiBoV,EACzBpV,EAAQ,eAAiBG,EACpB,KAAK,0BACNH,EAAQ,YAAc0Y,GAE1B,KAAK,eAAe,mCAAmC1Y,EAASJ,EAAOC,EAAQ,OAAWuV,CAAa,EACvG,KAAK,iBAAiBpV,EAAS0Y,EAAM3Y,EAAQoT,EAAS6W,EAAa9pB,EAAMC,CAAa,EACtF,KAAK,uBAAuB,KAAKH,CAAO,EACjCA,CACX,EACAS,EAAiB,UAAU,iBAAmB,SAAUT,EAASiqB,EAAYlqB,EAAQoT,EAAS6W,EAAc,KAAM9pB,EAAO,EAAGC,EAAgB,GAAO,CAC/I,GAAKH,EASL,IANK,KAAK,0BACNA,EAAQ,YAAciqB,EACtBjqB,EAAQ,QAAUmT,EAClBnT,EAAQ,aAAegqB,EACvBhqB,EAAQ,eAAiBG,GAEzB8pB,EAAY,CACZ,MAAM3U,EAAoBtV,EAAQ,iBACXD,IAAW,IAE9BkqB,EAAaC,EAA6BD,EAAYjqB,EAAQ,MAAOA,EAAQ,OAAQE,CAAI,GAE7F,MAAMwY,EAAO,IAAI,WAAWuR,EAAW,OAAQA,EAAW,WAAYA,EAAW,UAAU,EAC3F,KAAK,eAAe,cAAcvR,EAAM1Y,EAASA,EAAQ,MAAOA,EAAQ,OAAQA,EAAQ,MAAOsV,EAAkB,OAAQ,EAAG,EAAGnC,EAAS,GAAO,EAAG,CAAC,EAC/InT,EAAQ,iBACR,KAAK,iBAAiBA,EAAS,KAAK,cAAc,CAEzD,CACDA,EAAQ,QAAU,GACtB,EACAS,EAAiB,UAAU,qBAAuB,SAAUiY,EAAMpS,EAAMvG,EAAQG,EAAMkQ,EAAiB+C,EAAS4W,EAAcC,EAAc,KAAM,CAC9I,MAAMhqB,EAAU,IAAI8gB,EAAgB,KAAM,CAAC,EAmC3C,GAlCI5gB,IAAS,GAAK,CAAC,KAAK,MAAM,6BAC1BkQ,EAAkB,GAClB2Z,EAAe,EACfjpB,EAAO,KAAK,mJAAmJ,GAE1JZ,IAAS,GAAK,CAAC,KAAK,MAAM,iCAC/BkQ,EAAkB,GAClB2Z,EAAe,EACfjpB,EAAO,KAAK,wJAAwJ,GAE/JZ,IAAS,GAAK,CAAC,KAAK,MAAM,oBAC/BkQ,EAAkB,GAClBtP,EAAO,KAAK,+EAA+E,GAEtFZ,IAAS,GAAK,CAAC,KAAK,MAAM,mBAC/BkQ,EAAkB,GAClBtP,EAAO,KAAK,oFAAoF,GAEpGd,EAAQ,OAAS,GACjBA,EAAQ,gBAAkBD,EAC1BC,EAAQ,OAASD,IAAW,EAAI,EAAIA,EACpCC,EAAQ,KAAOE,EACfF,EAAQ,gBAAkBoQ,EAC1BpQ,EAAQ,MAAQsG,EAChBtG,EAAQ,OAASsG,EACjBtG,EAAQ,aAAe+pB,EAClB,KAAK,0BACN/pB,EAAQ,iBAAmB0Y,GAE/B1Y,EAAQ,QAAUmT,EAClBnT,EAAQ,aAAegqB,EACvBhqB,EAAQ,aAAe,EACvBA,EAAQ,aAAe,EACvB,KAAK,eAAe,mCAAmCA,CAAO,EAC1DD,IAAW,EAAG,CACd,MAAMuV,EAAoBtV,EAAQ,iBAClCsV,EAAkB,qBAAuB,EAC5C,CACD,OAAIoD,GACA,KAAK,qBAAqB1Y,EAAS0Y,EAAM3Y,EAAQG,EAAMiT,EAAS6W,CAAW,EAE/EhqB,EAAQ,QAAU,GACXA,CACX,EACAS,EAAiB,UAAU,qBAAuB,SAAUT,EAASiqB,EAAYE,EAASjqB,EAAMiT,EAAS6W,EAAc,KAAM,CACzHhqB,EAAQ,iBAAmBiqB,EAC3BjqB,EAAQ,QAAUmT,EAClBnT,EAAQ,aAAegqB,EACvB,MAAM1U,EAAoBtV,EAAQ,iBAC5BoqB,EAAiB9U,EAAkB,qBACnCO,EAAQ,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EACzB6C,EAAO,CAAA,EACb,QAAS9X,EAAI,EAAGA,EAAIqpB,EAAW,OAAQ,EAAErpB,EAAG,CACxC,IAAIypB,EAAWJ,EAAWpU,EAAMjV,CAAC,CAAC,EAC9BwpB,IACAC,EAAWH,EAA6BG,EAAUrqB,EAAQ,MAAOA,EAAQ,OAAQE,CAAI,GAEzFwY,EAAK,KAAK,IAAI,WAAW2R,EAAS,OAAQA,EAAS,WAAYA,EAAS,UAAU,CAAC,CACtF,CACD,KAAK,eAAe,mBAAmB3R,EAAMpD,EAAkB,mBAAoBtV,EAAQ,MAAOA,EAAQ,OAAQsV,EAAkB,OAAQnC,EAAS,GAAO,EAAG,CAAC,EAC5JnT,EAAQ,iBACR,KAAK,iBAAiBA,EAAS,KAAK,cAAc,EAEtDA,EAAQ,QAAU,EACtB,EACAS,EAAiB,UAAU,4BAA8B,SAAU6pB,EAAKC,EAAOjkB,EAAMvG,EAAQG,EAAMsqB,EAAUC,EAAUC,EAAiBC,EAAS,KAAMC,EAAU,KAAMb,EAAe,EAAG5W,EAAU,GAAO,CACtM,MAAMnT,EAAU,KAAK,qBAAqB,KAAMsG,EAAMvG,EAAQG,EAAM,CAACsqB,EAAUrX,EAAS4W,EAAc,IAAI,EAC1GQ,GAAO,eAAevqB,CAAO,EAC7BA,EAAQ,IAAMsqB,EACdtqB,EAAQ,QAAU,GAClB,KAAK,uBAAuB,KAAKA,CAAO,EACxC,MAAM6qB,EAAU,CAACC,EAASC,IAAc,CACpCR,GAAO,kBAAkBvqB,CAAO,EAC5B4qB,GAAWE,GACXF,EAAQE,EAAQ,OAAS,IAAMA,EAAQ,WAAYC,CAAS,CAExE,EACUC,EAAoBtS,GAAS,CAC/B,MAAM9Y,EAAQI,EAAQ,MAChBirB,EAAiBR,EAAS/R,CAAI,EACpC,GAAKuS,EAGL,IAAIP,EAAiB,CACjB,MAAMN,EAAiBrqB,IAAW,EAC5BmrB,EAAUR,EAAgBO,CAAc,EACxC3V,EAAoBtV,EAAQ,iBAC5B6V,EAAQ,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC/B,QAASsV,EAAQ,EAAGA,EAAQD,EAAQ,OAAQC,IAAS,CACjD,MAAMC,EAAUxrB,GAASurB,EACnBE,EAAW,CAAA,EACjB,QAASzX,EAAY,EAAGA,EAAY,EAAGA,IAAa,CAChD,IAAI0X,EAAcJ,EAAQC,CAAK,EAAEtV,EAAMjC,CAAS,CAAC,EAC7CwW,IACAkB,EAAcpB,EAA6BoB,EAAaF,EAASA,EAASlrB,CAAI,GAElFmrB,EAAS,KAAK,IAAI,WAAWC,EAAY,OAAQA,EAAY,WAAYA,EAAY,UAAU,CAAC,CACnG,CACD,KAAK,eAAe,mBAAmBD,EAAU/V,EAAkB,mBAAoB8V,EAASA,EAAS9V,EAAkB,OAAQnC,EAAS,GAAO,EAAG,CAAC,CAC1J,CACJ,MAEG,KAAK,qBAAqBnT,EAASirB,EAAgBlrB,EAAQG,EAAMiT,CAAO,EAE5EnT,EAAQ,QAAU,GAClBuqB,GAAO,kBAAkBvqB,CAAO,EAC5B2qB,GACAA,IAEZ,EACI,YAAK,UAAUL,EAAM5R,GAAS,CAC1BsS,EAAiBtS,CAAI,CACxB,EAAE,OAAW6R,GAAO,gBAAiB,GAAMM,CAAO,EAC5C7qB,CACX,EACAS,EAAiB,UAAU,mBAAqB,SAAUiY,EAAM9Y,EAAOC,EAAQ2Q,EAAOzQ,EAAQqQ,EAAiB+C,EAAS4W,EAAcC,EAAc,KAAM9d,EAAc,EAAGkJ,EAAgB,EAAG,CAE1L,MAAMpV,EAAU,IAAI8gB,EAAgB,KAAM,EAAM,EAChD,OAAA9gB,EAAQ,UAAYJ,EACpBI,EAAQ,WAAaH,EACrBG,EAAQ,UAAYwQ,EACpBxQ,EAAQ,MAAQJ,EAChBI,EAAQ,OAASH,EACjBG,EAAQ,MAAQwQ,EAChBxQ,EAAQ,OAASD,EACjBC,EAAQ,KAAOkM,EACflM,EAAQ,gBAAkBoQ,EAC1BpQ,EAAQ,aAAe+pB,EACvB/pB,EAAQ,KAAO,GACfA,EAAQ,eAAiBoV,EACpB,KAAK,0BACNpV,EAAQ,YAAc0Y,GAE1B,KAAK,eAAe,mCAAmC1Y,EAASJ,EAAOC,EAAQ,OAAWuV,CAAa,EACvG,KAAK,mBAAmBpV,EAAS0Y,EAAM3Y,EAAQoT,EAAS6W,EAAa9d,CAAW,EAChF,KAAK,uBAAuB,KAAKlM,CAAO,EACjCA,CACX,EACAS,EAAiB,UAAU,mBAAqB,SAAUT,EAASiqB,EAAYlqB,EAAQoT,EAAS6W,EAAc,KAAM9d,EAAc,EAAG,CAOjI,GANK,KAAK,0BACNlM,EAAQ,YAAciqB,EACtBjqB,EAAQ,OAASD,EACjBC,EAAQ,QAAUmT,EAClBnT,EAAQ,aAAegqB,GAEvBC,EAAY,CACZ,MAAM3U,EAAoBtV,EAAQ,iBACXD,IAAW,IAE9BkqB,EAAaC,EAA6BD,EAAYjqB,EAAQ,MAAOA,EAAQ,OAAQkM,CAAW,GAEpG,MAAMwM,EAAO,IAAI,WAAWuR,EAAW,OAAQA,EAAW,WAAYA,EAAW,UAAU,EAC3F,KAAK,eAAe,cAAcvR,EAAM1Y,EAASA,EAAQ,MAAOA,EAAQ,OAAQA,EAAQ,MAAOsV,EAAkB,OAAQ,EAAG,EAAGnC,EAAS,GAAO,EAAG,CAAC,EAC/InT,EAAQ,iBACR,KAAK,iBAAiBA,EAAS,KAAK,cAAc,CAEzD,CACDA,EAAQ,QAAU,EACtB,EACAS,EAAiB,UAAU,wBAA0B,SAAUiY,EAAM9Y,EAAOC,EAAQ2Q,EAAOzQ,EAAQqQ,EAAiB+C,EAAS4W,EAAcC,EAAc,KAAM9d,EAAc,EAAGkJ,EAAgB,EAAG,CAE/L,MAAMpV,EAAU,IAAI8gB,EAAgB,KAAM,EAAM,EAChD,OAAA9gB,EAAQ,UAAYJ,EACpBI,EAAQ,WAAaH,EACrBG,EAAQ,UAAYwQ,EACpBxQ,EAAQ,MAAQJ,EAChBI,EAAQ,OAASH,EACjBG,EAAQ,MAAQwQ,EAChBxQ,EAAQ,OAASD,EACjBC,EAAQ,KAAOkM,EACflM,EAAQ,gBAAkBoQ,EAC1BpQ,EAAQ,aAAe+pB,EACvB/pB,EAAQ,UAAY,GACpBA,EAAQ,eAAiBoV,EACpB,KAAK,0BACNpV,EAAQ,YAAc0Y,GAE1B,KAAK,eAAe,mCAAmC1Y,EAASJ,EAAOC,EAAQ2Q,EAAO4E,CAAa,EACnG,KAAK,wBAAwBpV,EAAS0Y,EAAM3Y,EAAQoT,EAAS6W,EAAa9d,CAAW,EACrF,KAAK,uBAAuB,KAAKlM,CAAO,EACjCA,CACX,EACAS,EAAiB,UAAU,wBAA0B,SAAUT,EAASiqB,EAAYlqB,EAAQoT,EAAS6W,EAAc,KAAM9d,EAAc,EAAG,CAOtI,GANK,KAAK,0BACNlM,EAAQ,YAAciqB,EACtBjqB,EAAQ,OAASD,EACjBC,EAAQ,QAAUmT,EAClBnT,EAAQ,aAAegqB,GAEvBC,EAAY,CACZ,MAAM3U,EAAoBtV,EAAQ,iBACXD,IAAW,IAE9BkqB,EAAaC,EAA6BD,EAAYjqB,EAAQ,MAAOA,EAAQ,OAAQkM,CAAW,GAEpG,MAAMwM,EAAO,IAAI,WAAWuR,EAAW,OAAQA,EAAW,WAAYA,EAAW,UAAU,EAC3F,KAAK,eAAe,cAAcvR,EAAM1Y,EAASA,EAAQ,MAAOA,EAAQ,OAAQA,EAAQ,MAAOsV,EAAkB,OAAQ,EAAG,EAAGnC,EAAS,GAAO,EAAG,CAAC,EAC/InT,EAAQ,iBACR,KAAK,iBAAiBA,EAAS,KAAK,cAAc,CAEzD,CACDA,EAAQ,QAAU,EACtB,EAKA,SAASkqB,EAA6BqB,EAAS3rB,EAAOC,EAAQqM,EAAa,CAEvE,IAAIsf,EACAC,EAAO,EACPvf,IAAgB,EAChBsf,EAAW,IAAI,aAAa5rB,EAAQC,EAAS,CAAC,EAEzCqM,IAAgB,GACrBsf,EAAW,IAAI,YAAY5rB,EAAQC,EAAS,CAAC,EAC7C4rB,EAAO,OAEFvf,IAAgB,EACrBsf,EAAW,IAAI,YAAY5rB,EAAQC,EAAS,CAAC,EAG7C2rB,EAAW,IAAI,WAAW5rB,EAAQC,EAAS,CAAC,EAGhD,QAAS4G,EAAI,EAAGA,EAAI7G,EAAO6G,IACvB,QAASC,EAAI,EAAGA,EAAI7G,EAAQ6G,IAAK,CAC7B,MAAMZ,GAASY,EAAI9G,EAAQ6G,GAAK,EAC1BilB,GAAYhlB,EAAI9G,EAAQ6G,GAAK,EAEnC+kB,EAASE,EAAW,CAAC,EAAIH,EAAQzlB,EAAQ,CAAC,EAC1C0lB,EAASE,EAAW,CAAC,EAAIH,EAAQzlB,EAAQ,CAAC,EAC1C0lB,EAASE,EAAW,CAAC,EAAIH,EAAQzlB,EAAQ,CAAC,EAE1C0lB,EAASE,EAAW,CAAC,EAAID,CAC5B,CAEL,OAAOD,CACX,CCjSA/qB,EAAiB,UAAU,mBAAqB,SAAUT,EAASJ,EAAOC,EAAQ+T,EAAY,GAAIuX,EAAQ,EAAGjV,EAAS,KAAMyV,EAAgB,GAAMtV,EAAmB,GAAO5P,EAAI,EAAGC,EAAI,EAAG,CACtL,MAAM4O,EAAoBtV,EAAQ,iBAClC,OAAI2rB,GACA,KAAK,iBAAgB,EAElB,KAAK,eAAe,WAAWrW,EAAkB,mBAAoB7O,EAAGC,EAAG9G,EAAOC,EAAQyV,EAAkB,OAAQ1B,EAAWuX,EAAOjV,EAAQG,CAAgB,CACzK,EACA5V,EAAiB,UAAU,uBAAyB,UAAY,CAE5D,KAAM,kDACV,ECPAA,EAAiB,UAAU,+BAAiC,SAAU6F,EAAMslB,EAAS,CACjF,MAAMC,EAAkB,IAAI/K,EAAgB,KAAM8K,EAAQ,gBAAkB,GAA8C,IAC1HC,EAAgB,OAAS,GACzBA,EAAgB,MAAQD,EAAQ,MAChC,MAAME,EAAkB,CACpB,kBAAmB,GACnB,mBAAoB,EACpB,gBAAiB,GACjB,QAAS,EACT,mBAAoBF,EAAQ,gBAAkB,GAAK,GACnD,GAAGA,CACX,EACIC,EAAgB,OAASC,EAAgB,mBACzC,KAAK,0BAA0BD,EAAiBvlB,EAAMwlB,EAAgB,kBAAmBA,EAAgB,mBAAoBA,EAAgB,OAAO,EACpJ,KAAK,eAAe,mCAAmCD,CAAe,EAEtE,MAAMvW,EAAoBuW,EAAgB,iBAC1C,OAAAA,EAAgB,KAAOlsB,EAAoB,yBAAyB2V,EAAkB,MAAM,EAC5F,KAAK,uBAAuB,KAAKuW,CAAe,EACzCA,CACX,EACAprB,EAAiB,UAAU,kBAAoB,SAAUsrB,EAASxB,EAAOyB,EAAOxB,EAAUG,EAAS,KAAMC,EAAU,KAAM7qB,EAAQksB,EAAkB,KAAMC,EAAoB,GAAOC,EAAW,EAAGC,EAAY,EAAGC,EAAW,KAAMC,EAAensB,EAAgB,GAAO+V,EAAS,KAAM,CACnR,OAAO,KAAK,sBAAsB6V,EAASxB,EAAOyB,EAAO,CAAC,CAACxB,EAAUG,EAAQC,EAAS7qB,EAAQksB,EAAiBC,EAAmBC,EAAUC,EAAWC,EAAU,KAAM,CAACrsB,EAASusB,IAAS,CACtL,MAAMrX,EAAeqX,EACf3sB,EAAQsV,EAAa,CAAC,EAAE,MACxBrV,EAASD,EACf,KAAK,yBAAyBI,EAAS,CAACwqB,CAAQ,EAChDxqB,EAAQ,OAASD,GAAU,GAC3B,MAAMuV,EAAoB,KAAK,eAAe,mCAAmCtV,EAASJ,EAAOC,CAAM,EACvG,KAAK,eAAe,mBAAmBqV,EAAcI,EAAkB,mBAAoB1V,EAAOC,EAAQyV,EAAkB,OAAQ,GAAO,GAAO,EAAG,CAAC,EACjJkV,GACD,KAAK,iBAAiBxqB,EAAS,KAAK,cAAc,EAEtDA,EAAQ,QAAU,GAClBA,EAAQ,mBAAmB,gBAAgBA,CAAO,EAClDA,EAAQ,mBAAmB,QACvB2qB,GACAA,GAEZ,EAAO,CAAC,CAACxqB,EAAe+V,CAAM,CAC9B,EACAzV,EAAiB,UAAU,yBAA2B,SAAUT,EAASwsB,EAAYC,EAAU,CAC3FzsB,EAAQ,aAAewsB,EAAa,EAAI,EACxCxsB,EAAQ,aAAe,EACvBA,EAAQ,aAAe,EACnBysB,IACAzsB,EAAQ,aAAeysB,EAE/B,EACAhsB,EAAiB,UAAU,0BAA4B,SAAUT,EAAS,CAClEA,EAAQ,kBACWA,EAAQ,kBAAkB,oBAEzC,KAAK,eAAe,mCAAmCA,CAAO,EAElE,KAAK,iBAAiBA,CAAO,EAErC,ECxDO,MAAM0sB,WAAkCC,EAAoB,CAS/D,YAAYC,EAAStc,EAAQhK,EAAMlB,EAAQuP,EAAO,CAC9C,MAAMiY,EAAStc,EAAQhK,EAAMlB,EAAQuP,CAAK,EACtCvP,EAAO,8BACP,KAAK,eAAiB,IAAI/E,GAEjC,CACL,CCdAI,EAAiB,UAAU,mCAAqC,SAAUmsB,EAAStc,EAAQhK,EAAM,CAC7F,MAAMumB,EAAY,IAAIH,GAA0BE,EAAStc,EAAQhK,EAAM,IAAI,EAC3E,YAAK,0BAA0B,KAAKumB,CAAS,EACtCA,CACX,EACApsB,EAAiB,UAAU,0BAA4B,SAAU6F,EAAMslB,EAAS,CAC5E,MAAMiB,EAAY,KAAK,mCAAmC,GAAO,GAAOvmB,CAAI,EACtEwmB,EAAc,CAAA,EAChBlB,IAAY,QAAa,OAAOA,GAAY,UAC5CkB,EAAY,gBAAkBlB,EAAQ,gBACtCkB,EAAY,oBAAsBlB,EAAQ,sBAAwB,OAAY,GAAOA,EAAQ,oBAC7FkB,EAAY,sBAAwBA,EAAY,qBAAuBlB,EAAQ,sBAC/EkB,EAAY,aAAelB,EAAQ,eAAiB,OAAY,EAAIA,EAAQ,aAC5EkB,EAAY,cAAgBlB,EAAQ,eAAiB,EACrDkB,EAAY,kBAAoB,CAAC,CAAClB,EAAQ,kBAC1CkB,EAAY,gBAAkBlB,EAAQ,gBACtCkB,EAAY,QAAUlB,EAAQ,QAC9BkB,EAAY,MAAQlB,EAAQ,MAC5BkB,EAAY,OAASlB,EAAQ,OAC7BkB,EAAY,KAAOlB,EAAQ,OAG3BkB,EAAY,gBAAkBlB,EAC9BkB,EAAY,oBAAsB,GAClCA,EAAY,sBAAwB,GACpCA,EAAY,aAAe,EAC3BA,EAAY,cAAgB,EAC5BA,EAAY,kBAAoB,IAEpC,MAAM9sB,EAAU8sB,EAAY,kBAAoBA,EAAY,kBAAoB,KAAO,KAAK,uBAAuBxmB,EAAMwmB,EAAa,GAAM,CAA2C,GACvL,OAAAD,EAAU,MAAQC,EAAY,OAAS,sBACvCD,EAAU,SAAWC,EAAY,iBAAiB,SAAWA,EAAY,SAAW,EACpFD,EAAU,qBAAuBC,EAAY,oBAC7CD,EAAU,uBAAyB,EAAAC,EAAY,sBAC/CD,EAAU,YAAY7sB,CAAO,GACzB6sB,EAAU,sBAAwBA,EAAU,yBAC5CA,EAAU,0BAA0B,EAAG,GACvCA,EAAU,uBAAwBA,EAAU,QAASC,EAAY,sBAAwB,GAAK,GAAIA,EAAY,MAAQA,EAAY,MAAQ,gBAAkB,MAAS,EAErK9sB,GAAW,CAAC8sB,EAAY,kBACpBlB,IAAY,QAAa,OAAOA,GAAY,UAAYA,EAAQ,eAAiB,CAACkB,EAAY,kBAC9F9sB,EAAQ,gBAAkB,IAE9B,KAAK,eAAe,mCAAmCA,EAAS,OAAW,OAAW,OAAW8sB,EAAY,aAAa,EACtHlB,IAAY,QAAa,OAAOA,GAAY,UAAYA,EAAQ,eAAiB,CAACkB,EAAY,kBAC9F9sB,EAAQ,gBAAkB,KAG3B6sB,CACX,EACApsB,EAAiB,UAAU,2BAA6B,SAAU6F,EAAMslB,EAASmB,EAAS,CACtF,MAAMjB,EAAkB,CACpB,kBAAmB,GACnB,mBAAoB,EACpB,gBAAiB,GACjB,QAAS,EACT,mBAAoBF,EAAQ,gBAAkB,GAAK,GACnD,GAAGA,CACX,EACUoB,EAAaC,GAAiBnB,EAAgB,kBAAkB,EACtEiB,EAAQ,gCAAkCC,EAC1C,MAAMnB,EAAkB,IAAI/K,EAAgB,KAAMkM,EAAa,GAA8C,IAC7G,OAAAnB,EAAgB,MAAQD,EAAQ,MAChCC,EAAgB,OAASC,EAAgB,mBACzCD,EAAgB,KAAOqB,GAAuBrB,EAAgB,MAAM,EACpE,KAAK,0BAA0BA,EAAiBvlB,EAAMwlB,EAAgB,kBAAmBA,EAAgB,mBAAoBA,EAAgB,OAAO,EACpJ,KAAK,eAAe,mCAAmCD,CAAe,EACtE,KAAK,uBAAuB,KAAKA,CAAe,EACzCA,CACX,EACAprB,EAAiB,UAAU,0BAA4B,SAAUorB,EAAiBvlB,EAAM6mB,EAAmBC,EAAoB5X,EAAU,EAAG,CACxI,MAAM5V,EAAQ0G,EAAK,OAASA,EACtBzG,EAASyG,EAAK,QAAUA,EACxBwN,EAASxN,EAAK,QAAU,EACxBkK,EAAQlK,EAAK,OAAS,EAC5BulB,EAAgB,UAAYjsB,EAC5BisB,EAAgB,WAAahsB,EAC7BgsB,EAAgB,MAAQjsB,EACxBisB,EAAgB,OAAShsB,EACzBgsB,EAAgB,UAAY/X,EAAS,EACrC+X,EAAgB,KAAOrb,EAAQ,EAC/Bqb,EAAgB,MAAQ/X,GAAUtD,EAClCqb,EAAgB,QAAU,GAC1BA,EAAgB,QAAUrW,EAC1BqW,EAAgB,gBAAkB,GAClCA,EAAgB,aAAesB,EAAoB,EAAI,EACvDtB,EAAgB,KAAO,EACvBA,EAAgB,oBAAsBuB,EACtCvB,EAAgB,aAAe,EAC/BA,EAAgB,aAAe,CACnC,EACAprB,EAAiB,UAAU,qCAAuC,SAAUosB,EAAWrX,EAAS,CAC5F,MAAI,CAACqX,GAAa,CAACA,EAAU,SAAWA,EAAU,UAAYrX,IAG9DA,EAAU,KAAK,IAAIA,EAAS,KAAK,QAAO,EAAG,cAAc,EACzD,KAAK,eAAe,kBAAkBqX,EAAU,QAASrX,CAAO,EAC5DqX,EAAU,uBACV,KAAK,eAAe,kBAAkBA,EAAU,qBAAsBrX,CAAO,EAC7EqX,EAAU,qBAAqB,QAAUrX,GAE7CqX,EAAU,SAAWrX,EACrBqX,EAAU,QAAQ,QAAUrX,GACrBA,CACX,EC7GA/U,EAAiB,UAAU,uBAAyB,SAAU4sB,EAAS/hB,EAAStL,EAAS4D,EAAM,CACvF,CAAC5D,GAAW,CAACA,EAAQ,oBACrB,KAAK,YAAYqtB,EAAS,KAAM,OAAW,OAAWzpB,CAAI,EAG1D,KAAK,YAAYypB,EAASrtB,EAAS,GAAO,GAAM4D,CAAI,CAE5D,ECLAnD,EAAiB,UAAU,8BAAgC,SAAU6F,EAAMslB,EAAS,CAChF,MAAMiB,EAAY,KAAK,mCAAmC,GAAO,GAAMvmB,CAAI,EACrEwmB,EAAc,CAChB,gBAAiB,GACjB,oBAAqB,GACrB,sBAAuB,GACvB,KAAM,EACN,aAAc,EACd,OAAQ,EACR,QAAS,EACT,GAAGlB,CACX,EACIkB,EAAY,sBAAwBA,EAAY,qBAAuBA,EAAY,sBACnFD,EAAU,MAAQC,EAAY,OAAS,sBACvCD,EAAU,qBAAuBC,EAAY,oBAC7CD,EAAU,uBAAyBC,EAAY,sBAC/C,MAAM9sB,EAAU,IAAI8gB,EAAgB,KAAM,CAAC,EAC3C,OAAA9gB,EAAQ,MAAQsG,EAChBtG,EAAQ,OAASsG,EACjBtG,EAAQ,MAAQ,EAChBA,EAAQ,QAAU,GAClBA,EAAQ,OAAS,GACjBA,EAAQ,QAAU8sB,EAAY,QAC9B9sB,EAAQ,gBAAkB8sB,EAAY,gBACtC9sB,EAAQ,aAAe8sB,EAAY,aACnC9sB,EAAQ,KAAO8sB,EAAY,KAC3B9sB,EAAQ,OAAS8sB,EAAY,OAC7B,KAAK,uBAAuB,KAAK9sB,CAAO,EACxC6sB,EAAU,YAAY7sB,CAAO,GACzB6sB,EAAU,sBAAwBA,EAAU,yBAC5CA,EAAU,0BAA0B,EAAGC,EAAY,eAAiB,QAChEA,EAAY,eAAiB,GAC7BA,EAAY,eAAiB,GAC7BA,EAAY,eAAiB,GAC7BA,EAAY,eAAiB,GAC7BA,EAAY,eAAiB,GAC7BA,EAAY,eAAiB,GAC7BA,EAAY,eAAiB,GAC7BA,EAAY,eAAiB,GAAID,EAAU,uBAAwBA,EAAU,OAAO,EAExFjB,GAAWA,EAAQ,eAAiB,CAACkB,EAAY,kBACjD9sB,EAAQ,gBAAkB,IAE9B,KAAK,eAAe,mCAAmCA,CAAO,EAC1D4rB,GAAWA,EAAQ,eAAiB,CAACkB,EAAY,kBACjD9sB,EAAQ,gBAAkB,IAEvB6sB,CACX,EC/CO,MAAMS,EAAsB,CAC/B,aAAc,CAEV,KAAK,8BAAgC,EAErC,KAAK,2BAA6B,GAElC,KAAK,WAAa,GAElB,KAAK,oBAAsB,GAE3B,KAAK,cAAgBC,EAAa,oBAElC,KAAK,4BAA8BA,EAAa,sCAEhD,KAAK,2BAA6B,EACrC,CACL,CACA7sB,EAAe,UAAU,YAAc,UAAY,CAC/C,OAAO,IACX,EACAA,EAAe,UAAU,YAAc,SAAU0jB,EAAO,CAEpD,OAAO,IACX,EACA1jB,EAAe,UAAU,uBAAyB,SAAU0jB,EAAO,CAE/D,MAAO,EACX,EACA1jB,EAAe,UAAU,eAAiB,SAAU0jB,EAAO,CAEvD,MAAO,EACX,EACA1jB,EAAe,UAAU,oBAAsB,SAAU8sB,EAAepJ,EAAO,CAE3E,MAAO,EACX,EACA1jB,EAAe,UAAU,kBAAoB,SAAU8sB,EAAe,CAElE,OAAO,IACX,EACA,OAAO,eAAeD,EAAa,UAAW,6BAA8B,CACxE,IAAK,UAAY,CACb,OAAO,KAAK,sBAAsB,0BACrC,EACD,IAAK,SAAU/mB,EAAO,CAClB,KAAK,sBAAsB,2BAA6BA,CAC3D,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACD,OAAO,eAAe+mB,EAAa,UAAW,wBAAyB,CACnE,IAAK,UAAY,CACb,OAAK,KAAK,yBACN,KAAK,uBAAyB,IAAID,IAE/B,KAAK,sBACf,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACD,OAAO,eAAeC,EAAa,UAAW,aAAc,CACxD,IAAK,UAAY,CACb,OAAO,KAAK,sBAAsB,UACrC,EACD,IAAK,SAAU/mB,EAAO,CAClB,KAAK,sBAAsB,WAAaA,CAC3C,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACD,OAAO,eAAe+mB,EAAa,UAAW,8BAA+B,CACzE,IAAK,UAAY,CACb,OAAO,KAAK,sBAAsB,2BACrC,EACD,IAAK,SAAU/mB,EAAO,CAClB,KAAK,sBAAsB,4BAA8BA,CAC5D,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACD,OAAO,eAAe+mB,EAAa,UAAW,gBAAiB,CAC3D,IAAK,UAAY,CACb,OAAO,KAAK,sBAAsB,aACrC,EACD,IAAK,SAAU/mB,EAAO,CAClB,KAAK,sBAAsB,cAAgBA,CAC9C,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACD,OAAO,eAAe+mB,EAAa,UAAW,sBAAuB,CACjE,IAAK,UAAY,CACb,OAAO,KAAK,sBAAsB,mBACrC,EACD,IAAK,SAAU/mB,EAAO,CAClB,KAAK,sBAAsB,oBAAsBA,CACpD,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EACD,OAAO,eAAe+mB,EAAa,UAAW,6BAA8B,CACxE,IAAK,UAAY,CACb,OAAO,KAAK,sBAAsB,0BACrC,EACD,IAAK,SAAU/mB,EAAO,CAClB,KAAK,sBAAsB,2BAA6BA,CAC3D,EACD,WAAY,GACZ,aAAc,EAClB,CAAC,EAED+mB,EAAa,UAAU,qBAAuB,UAAY,CACtD,MAAME,EAAc,KAAK,sBACzB,GAAIA,EAAY,gBAAkBF,EAAa,oBAC3C,OAAAE,EAAY,WAAa,GAClB,GAEX,MAAMroB,EAAS,KAAK,YAKpB,GAJI,CAACA,EAAO,QAAS,EAAC,uBAIlB,CAACA,EAAO,uBAER,OAAAqoB,EAAY,WAAa,GAClB,GAEX,GAAI,KAAK,4BAA8B,KAAK,kBAAoB,MAAQ,KAAK,kBAAoB,OAE7F,GADkCroB,EAAO,uBAAuB,KAAK,eAAe,EACrD,CAC3B,MAAMsoB,EAAuBtoB,EAAO,eAAe,KAAK,eAAe,EACvEqoB,EAAY,2BAA6B,GACzCA,EAAY,8BAAgC,EAC5CA,EAAY,WAAa,EAAAC,EAAuB,EACnD,SAEGD,EAAY,gCACRA,EAAY,sBAAwB,IAAMA,EAAY,8BAAgCA,EAAY,oBAClGA,EAAY,2BAA6B,GACzCA,EAAY,8BAAgC,EAG5CA,EAAY,WAAaA,EAAY,gBAAkBF,EAAa,0BAA4B,GAAQE,EAAY,eAGpH,QAAOA,EAAY,gBAAkBF,EAAa,0BAA4B,GAAQE,EAAY,WAI9G,MAAMlD,EAAQ,KAAK,WACnB,GAAIA,EAAM,uBAAwB,CAC9B,MAAMoD,EAA+BpD,EAAM,yBACvC,KAAK,kBAAoB,OACzB,KAAK,gBAAkBnlB,EAAO,eAE9B,KAAK,iBAAmBA,EAAO,oBAAoBqoB,EAAY,4BAA6B,KAAK,eAAe,IAChHE,EAA6B,2BAA2B,IAAI,EAC5DvoB,EAAO,kBAAkBqoB,EAAY,2BAA2B,EAChE,KAAK,sBAAsB,2BAA6B,GAE/D,CACD,OAAOA,EAAY,UACvB,ECpKAhtB,EAAiB,UAAU,uBAAyB,UAAY,CAC5D,OAAO,KAAK,gBAAgB,mBAChC,EACAA,EAAiB,UAAU,oBAAsB,SAAU+F,EAAO,CAC9D,KAAK,gBAAgB,OAASA,GAAS,CAAC,CAAC,KAAK,MAAM,UACxD,EACA/F,EAAiB,UAAU,YAAc,UAAY,CACjD,OAAO,KAAK,gBAAgB,aAChC,EACAA,EAAiB,UAAU,YAAc,SAAU2jB,EAAO,CACtD,YAAK,gBAAgB,YAAYA,CAAK,EAC/B,IACX,EACA3jB,EAAiB,UAAU,uBAAyB,SAAU2jB,EAAO,CACjE,OAAO,KAAK,gBAAgB,uBAAuBA,CAAK,CAC5D,EACA3jB,EAAiB,UAAU,eAAiB,SAAU2jB,EAAO,CACzD,OAAO,KAAK,gBAAgB,eAAeA,CAAK,CACpD,EACA3jB,EAAiB,UAAU,oBAAsB,SAAU+sB,EAAepJ,EAAO,CAC7E,GAAI,KAAK,mBACL,GAAI,KAAK,gBAAgB,cAAcA,CAAK,EACxC,YAAK,oBAAoB,oBAAoBA,CAAK,EAC3C,OAIX,aAAK,YAAY,QAAQ,IAAID,GAAoCC,CAAK,CAAC,EAChE,GAEX,MAAO,EACX,EACA3jB,EAAiB,UAAU,kBAAoB,UAAY,CACvD,OAAI,KAAK,kBACL,KAAK,oBAAoB,oBAGzB,KAAK,YAAY,QAAQ,IAAI4jB,EAAmC,EAE7D,IACX,ECcA,MAAMuJ,GAAsC,CACxC,MAAO,sCACP,UAAW,KACX,OAAQ,OACR,cAAe,EACf,gBAAiB,CACrB,EACMC,GAA0B,CAC5B,MAAO,wBACP,UAAW,KACX,OAAQ,OACR,cAAe,EACf,gBAAiB,CACrB,EACMC,GAAa,IAAIC,GAKhB,MAAMC,UAAqBvtB,CAAiB,CAI/C,IAAI,uBAAwB,CACxB,OAAO,KAAK,mBAAmB,IAClC,CACD,IAAI,sBAAsBiZ,EAAM,CAC5B,KAAK,mBAAmB,KAAOA,CAClC,CAID,wBAAyB,CACrB,KAAK,mBAAmB,OAC3B,CAKD,IAAI,mBAAoB,CACpB,OAAO,KAAK,mBAAmB,OAClC,CACD,IAAI,kBAAkBkP,EAAU,CAC5B,KAAK,mBAAmB,QAAUA,CACrC,CAID,IAAI,sBAAuB,CACvB,OAAO,KAAK,cAAgB,KAAK,cAAc,SAAW,EAC7D,CACD,IAAI,qBAAqBqF,EAAS,CAC1B,KAAK,gBACL,KAAK,cAAc,SAAWA,EAErC,CAID,IAAI,6BAA8B,CAC9B,OAAO,KAAK,qBAAuB,KAAK,qBAAqB,SAAW,EAC3E,CACD,IAAI,4BAA4BA,EAAS,CACjC,KAAK,uBACL,KAAK,qBAAqB,SAAWA,EAE5C,CAID,IAAI,wBAAyB,CACzB,OAAO,KAAK,iBAAmB,KAAK,iBAAiB,SAAW,EACnE,CACD,IAAI,uBAAuBA,EAAS,CAC5B,KAAK,mBACL,KAAK,iBAAiB,SAAWA,EAExC,CAKD,oBAAqB,CACjB,MAAO,EACV,CAMD,cAAcC,EAAM,CAChB,OAAOC,GAAcD,CAAI,CAC5B,CAID,WAAW,kBAAmB,CAC1B,OAAQ,UAAU,IAEZ,UAAU,IACP,eAAgB,EAChB,KAAME,GAAY,CAAC,CAACA,EAAS,IAAM,EAAK,EACxC,MAAM,IAAM,EAAK,EAJpB,QAAQ,QAAQ,EAAK,CAK9B,CAID,WAAW,aAAc,CACrB,OAAAttB,EAAO,KAAK,4CAA4C,EACjD,EACV,CAID,IAAI,wBAAyB,CACzB,MAAO,EACV,CAED,IAAI,qBAAsB,CACtB,OAAO,KAAK,2BACf,CAED,IAAI,mBAAoB,CACpB,OAAO,KAAK,wBACf,CAED,IAAI,iBAAkB,CAClB,OAAO,KAAK,uBACf,CAED,IAAI,eAAgB,CAChB,OAAO,KAAK,aACf,CAID,IAAI,aAAc,CAEd,OADoB,KAAK,KAAO,KAAK,OAExC,CAID,IAAI,SAAU,CACV,MAAO,EACV,CAKD,SAAU,CACN,MAAO,CACH,OAAQ,KAAK,aAAa,QAAU,iBACpC,SAAU,KAAK,aAAa,cAAgB,mBAC5C,QAAS,KAAK,aAAa,aAAe,iBACtD,CACK,CAMD,IAAI,mBAAoB,CACpB,OAAO,KAAK,kBACf,CACD,IAAI,kBAAkB4Y,EAAM,CACxB,KAAK,mBAAqBA,CAC7B,CAED,IAAI,oBAAqB,CACrB,OAAO,KAAK,qBAAuB,KAAK,qBAAqB,QAAU,KAAK,oBAC/E,CAOD,OAAO,YAAY2U,EAAQzC,EAAU,GAAI,CACrC,MAAMxmB,EAAS,IAAI4oB,EAAaK,EAAQzC,CAAO,EAC/C,OAAO,IAAI,QAASrT,GAAY,CAC5BnT,EAAO,UAAUwmB,EAAQ,eAAgBA,EAAQ,YAAY,EAAE,KAAK,IAAMrT,EAAQnT,CAAM,CAAC,CACrG,CAAS,CACJ,CAMD,YAAYipB,EAAQzC,EAAU,GAAI,CAoG9B,GAnGA,MAAMA,EAAQ,WAAa,GAAMA,CAAO,EAExC,KAAK,SAAW,GAEhB,KAAK,yBAA2B,CAAE,MAAO,QAAQ,EACjD,KAAK,yBAA2B,CAAE,MAAO,QAAQ,EAEjD,KAAK,iBAAmB,EAExB,KAAK,wBAA0B,EAE/B,KAAK,mBAAqB,EAC1B,KAAK,oBAAsB,EAC3B,KAAK,SAAW,KAChB,KAAK,UAAY,KACjB,KAAK,8BAAgC,GACrC,KAAK,aAAe,CAChB,OAAQ,GACR,aAAc,GACd,OAAQ,GACR,YAAa,EACzB,EAEQ,KAAK,wBAA0B,GAE/B,KAAK,UAAY,CACb,iBAAkB,EAClB,qBAAsB,EACtB,+BAAgC,EAChC,4BAA6B,CACzC,EAIQ,KAAK,kBAAoB,CACrB,iBAAkB,EAClB,qBAAsB,EACtB,+BAAgC,EAChC,4BAA6B,CACzC,EAIQ,KAAK,uBAAyB,GAI9B,KAAK,OAAS,GAEd,KAAK,eAAiB,IAAI,MAC1B,KAAK,gBAAkB,CAAC,KAAM,IAAI,EAElC,KAAK,uBAAyB,CAC1B,qBAAsB,KACtB,8BAA+B,KAC/B,8BAA+B,KAC/B,2BAA4B,CAAE,EAC9B,mBAAoB,MAChC,EACQ,KAAK,sBAAwB,CACzB,qBAAsB,KACtB,8BAA+B,KAC/B,8BAA+B,KAC/B,2BAA4B,CAAE,EAC9B,mBAAoB,MAChC,EAEQ,KAAK,sBAAwB,GAC7B,KAAK,8BAAgC,KACrC,KAAK,oBAAsB,KAC3B,KAAK,iBAAmB,GACxB,KAAK,mBAAqB,GAI1B,KAAK,gBAAkB,GAIvB,KAAK,oBAAsB,GAI3B,KAAK,8BAAgC,KAKrC,KAAK,kBAAoB,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EACjD,KAAK,iBAAmB,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAChD,KAAK,eAAiB,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAC9C,KAAK,oBAAsB,GAC3B,KAAK,oBAAsB,CAAC,KAAM,KAAM,KAAM,IAAI,EAClD,KAAK,oBAAsB,IAAI0C,GAC/B,KAAK,MAAQ,SACb,KAAK,WAAa,IAAIhuB,GACtBsrB,EAAQ,iBAAmBA,EAAQ,kBAAoB,CAAA,EACvDA,EAAQ,sBAAwBA,EAAQ,uBAAyB,GACjE9qB,EAAO,IAAI,eAAeJ,EAAe,OAAO,MAAM,KAAK,WAAW,SAAS,EAC3E,CAAC,UAAU,IAAK,CAChBI,EAAO,MAAM,0CAA0C,EACvD,MACH,CACD8qB,EAAQ,gBAAkBA,EAAQ,iBAAmB,UAAU,IAAI,2BACnE,KAAK,UAAY,GACjB,KAAK,oBAAsB,SAC3B,KAAK,iBAAmByC,EACxB,KAAK,SAAWzC,EAChB,KAAK,qBAAuBA,EAAQ,UAAY,KAAK,oBAAsB,EACvE,WAAa,UAAU,WACvB,KAAK,mBAAkB,EAE3B,KAAK,YAAY,KAAK,gBAAgB,EACtC,KAAK,iBAAmB,IAAI3hB,GAC5B,KAAK,qBAAuB,IAAI4D,EACnC,CAKD,4BAA6B,CACzB,OAAK,KAAK,gCACN,KAAK,8BAAgC,IAAI,QAAS0K,GAAY,CAC1D,KAAK,aAAa,KAAK,iBAAmB,KAAK,UAAU,cAAc,EAAE,KAAMgW,GAAY,CACvF,KAAK,SAAWA,EAChB,KAAK,UAAY,IAAInG,EACrB,KAAK,UAAU,UAAU,KAAK,eAAiB,KAAK,UAAU,YAAY,EAAE,KAAK,IAAM,CACnF,KAAK,8BAAgC,GACrC7P,GACxB,CAAqB,CACrB,CAAiB,CACjB,CAAa,GAEE,KAAK,6BACf,CAOD,UAAUiW,EAAgBnG,EAAc,CACpC,YAAK,SAAW2F,EAAa,cAC7B,KAAK,gBAAkBQ,EACvB,KAAK,cAAgBnG,EACd,UACF,IAAI,eAAe,KAAK,QAAQ,EAChC,KAAM+F,GAAY,CACnB,GAAKA,EAIA,CACD,KAAK,SAAWA,EAChB,KAAK,4BAA8B,GACnC,KAAK,SAAS,UAAU,QAASK,GAAY,KAAK,4BAA4B,KAAKA,CAAO,CAAC,EAC3F,KAAK,wBAA0B,KAAK,SAAS,OAC7C,KAAK,aAAe,KAAK,SAAS,KAClC,MAAMC,EAAmB,KAAK,SAAS,kBAAoB,CAAA,EACrDC,EAAmBD,GAAkB,mBAAqB,KAAK,SAAS,kBAAoB,KAAK,4BAA8B,QACrI,GAAIC,EAAkB,CAClB,MAAMC,EAAsBD,EACtBE,EAAkB,CAAA,EACxB,UAAWC,KAAaF,EAChB,KAAK,4BAA4B,QAAQE,CAAS,IAAM,IACxDD,EAAgB,KAAKC,CAAS,EAGtCJ,EAAiB,iBAAmBG,CACvC,CACD,GAAI,KAAK,SAAS,kBAAoB,CAACH,EAAiB,eAAgB,CACpEA,EAAiB,eAAiB,GAClC,UAAW9qB,KAAQ,KAAK,wBAChBA,IAAS,mBAAqBA,IAAS,oBAI3C8qB,EAAiB,eAAe9qB,CAAI,EAAI,KAAK,wBAAwBA,CAAI,EAEhF,CACD,OAAA8qB,EAAiB,MAAQ,sBAAsB,KAAK,QAAQ,GACrD,KAAK,SAAS,cAAcA,CAAgB,CACtD,KAhCG,MAAM,wDAiCtB,CAAS,EACI,KAAM3c,GAAW,CAClB,KAAK,QAAUA,EACf,KAAK,yBAA2B,GAChC,KAAK,QAAQ,UAAU,QAAS0c,GAAY,KAAK,yBAAyB,KAAKA,CAAO,CAAC,EACvF,KAAK,cAAgB1c,EAAO,OAC5B,IAAIgd,EAAsB,GAC1B,KAAK,QAAQ,iBAAiB,kBAAoBC,GAAU,CACpD,EAAED,EAAsB,KAAK,uBAC7BjuB,EAAO,KAAK,4BAA4BiuB,EAAsB,CAAC,MAAMC,EAAM,KAAK,MAAMA,EAAM,MAAM,OAAO,EAAE,EAEtGD,MAA0B,KAAK,wBACpCjuB,EAAO,KAAK,+CAA+C,KAAK,sBAAsB,sEAAsE,CAEhL,CAAa,EACI,KAAK,yBACN,KAAK,QAAQ,MAAM,KAAMmuB,GAAS,CAC1B,KAAK,cAGT,KAAK,gBAAkB,GACvBnuB,EAAO,KAAK,wBAA0BmuB,CAAI,EAC1C,KAAK,wBAAwB,gBAAgB,IAAI,EACjD,KAAK,+BAA+B,SAAY,CAC5C,MAAMC,EAAwB,KAAK,sBAC7BC,EAAoB,KAAK,kBACzBC,EAAuB,KAAK,qBAC5BC,EAA8B,KAAK,4BACnCC,EAAyB,KAAK,uBAC9BC,EAA8B,KAAK,4BACzC,MAAM,KAAK,UAAU,KAAK,iBAAmB,KAAK,UAAU,eAAgB,KAAK,eAAiB,KAAK,UAAU,YAAY,EAC7H,KAAK,sBAAwBL,EAC7B,KAAK,kBAAoBC,EACzB,KAAK,qBAAuBC,EAC5B,KAAK,4BAA8BC,EACnC,KAAK,uBAAyBC,EAC9B,KAAK,4BAA8BC,EACnC,KAAK,mBAAqB,IAClD,CAAqB,EACrB,CAAiB,CAEjB,CAAS,EACI,KAAK,IAAM,CACZ,KAAK,kBAAiB,EACtB,KAAK,eAAiB,IAAI1Y,GAAoB,KAAM,KAAK,OAAO,EAChE,KAAK,eAAiB,IAAI/E,GAAqB,KAAM,KAAK,QAAS,KAAK,eAAgB,KAAK,wBAAwB,EACrH,KAAK,cAAgB,IAAIoH,EAAmB,KAAK,OAAO,EACxD,KAAK,iBAAmB,IAAI4I,EAAsB,KAAK,QAAS,KAAK,cAAe,IAAI,EACxF,KAAK,gBAAkB,IAAIsD,GAAqB,KAAM,KAAK,QAAS,KAAK,cAAc,EACvF,KAAK,gBAAkB,KAAK,QAAQ,eAAiB,IAAIM,GAAqB,KAAM,KAAK,QAAS,KAAK,cAAc,EAAI,OACzH,KAAK,YAAc,IAAIlB,GAAiB,KAAK,OAAO,EACpD,KAAK,mBAAqB,IAAIiE,GAAwB,KAAM,KAAK,uBAAwB,KAAK,WAAW,EACzG,KAAK,WAAa,KAAK,eAAe,aAAa,IAAI,aAAa,CAAC,GAAI,CAAC,CAAC,EAAGtW,EAA4B,QAAUA,EAA4B,QAAS,WAAW,EACpK,KAAK,eAAiB,KAAK,eAAe,aAAa,IAAI,aAAa,CAAC,EAAG,CAAC,CAAC,EAAGA,EAA4B,QAAUA,EAA4B,QAAS,eAAe,EACvK,KAAK,8BACD,KAAK,SAAW,SAChB,KAAK,OAAS,EACdrR,EAAO,IAAI,CAAC,aAAe,KAAK,OAAS,WAAY,qBAAqB,CAAC,GAGnF,KAAK,eAAiB,KAAK,QAAQ,qBAAqB,KAAK,wBAAwB,EACrF,KAAK,eAAiB,KAAK,QAAQ,qBAAqB,KAAK,wBAAwB,EACrF,KAAK,mBAAqB,IAAImZ,EAAa,KAAM,CAAC,CAAC,EAAG,GAAI,CACtD,OAAQ,EACR,OAAQ,EACR,KAAM,EACN,MAAO,mBACvB,CAAa,EACD,KAAK,qBAAuB,IAAI6F,EAA8B,KAAK,QAAS,KAAK,kBAAkB,EACnG,KAAK,mBAAqB,IAAIa,GAAwB,KAAK,oBAAoB,EAC/E,KAAK,sBAAwB,IAAIJ,GAA2B,KAAK,oBAAoB,EACrF,KAAK,sBAAsB,cAAgB,KAAK,cAChD,KAAK,mBAAmB,UAAY,GACpC,KAAK,mBAAmB,UAAY,IACpC,KAAK,mBAAmB,UAAY,GACpC,KAAK,eAAe,kBAAkB,KAAK,cAAc,EACzD,KAAK,WAAa,IAAIyC,GAAgB,KAAK,QAAS,KAAM,KAAK,kBAAkB,EACjF,KAAK,oBAAsB,KAAK,oBAChC,KAAK,oBAAsB,KAAK,oBAChC,KAAK,wBAA0B,KAAK,wBACpC,KAAK,wBAA0B,KAAK,wBACpC,KAAK,+BAA8B,EACnC,KAAK,2BAA0B,EAC/B,KAAK,OAAM,CACvB,CAAS,EACI,MAAOsC,GAAM,CACd,MAAAxkB,EAAO,MAAM,+DAA+D,EACtEwkB,CAClB,CAAS,CACJ,CACD,aAAakJ,EAAgB,CAMzB,OALAA,EAAiBA,GAAkB,GACnCA,EAAiB,CACb,GAAGR,EAAa,uBAChB,GAAGQ,CACf,EACYA,EAAe,QACR,QAAQ,QAAQA,EAAe,OAAO,EAE7C,KAAK,QACE,KAAK,QAAQA,EAAe,QAAQ,EAE3CA,EAAe,QAAUA,EAAe,SACjClG,EAAM,uBAAuBkG,EAAe,MAAM,EAAE,KAAK,IACrD,KAAK,QAAQlG,EAAM,oBAAoBkG,EAAe,QAAQ,CAAC,CACzE,EAEE,QAAQ,OAAO,0BAA0B,CACnD,CACD,mBAAoB,CAGhB,KAAK,MAAQ,CACT,sBAAuB,KAAK,cAAc,iCAC1C,2BAA4B,KAAK,cAAc,iCAC/C,8BAA+B,KAAK,cAAc,iCAAmC,EACrF,eAAgB,KAAK,cAAc,sBACnC,sBAAuB,KAAK,cAAc,sBAC1C,qBAAsB,KAAK,cAAc,sBACzC,iBAAkB,KAAK,cAAc,oBACrC,eAAgB,EAChB,kBAAmB,KAAK,cAAc,6BACtC,0BAA2B,KAAK,MAAM,KAAK,cAAc,4BAA8B,CAAC,EACxF,wBAAyB,KAAK,MAAM,KAAK,cAAc,4BAA8B,CAAC,EACtF,oBAAqB,GACrB,KAAO,KAAK,yBAAyB,QAAQ,0BAA0B,GAA8D,EAAI,GAAO,OAChJ,KAAO,KAAK,yBAAyB,QAAQ,wBAAwB,GAA4D,EAAI,GAAO,OAC5I,MAAO,KACP,KAAM,KACN,KAAO,KAAK,yBAAyB,QAAQ,0BAA0B,GAA8D,EAAI,GAAO,OAChJ,KAAM,KAAK,yBAAyB,QAAQ,2BAAoF,EAAI,GAAO,OAC3I,cAAe,GACf,YAAa,GACb,uBAAwB,GACxB,6BAA8B,GAC9B,iBAAkB,GAClB,4BAA6B,GAC7B,yBAA0B,KAAK,yBAAyB,QAAQ,0BAAqF,GAAI,EACzJ,aAAc,GACd,4BAA6B,KAAK,yBAAyB,QAAQ,oBAAyE,GAAI,EAChJ,mBAAoB,GACpB,iBAAkB,GAClB,gCAAiC,GACjC,uBAAwB,GACxB,WAAY,GACZ,WAAY,GACZ,qBAAsB,GACtB,sBAAuB,GACvB,kBAAmB,GACnB,gBAAiB,GACjB,WAAY,OAAO,eAAmB,KAAe,KAAK,yBAAyB,QAAQ,iBAAmE,IAAK,GAAK,GAAO,OAC/K,sBAAuB,OAAO,eAAmB,IACjD,6BAA8B,GAC9B,UAAW,GACX,gBAAiB,GACjB,sBAAuB,OACvB,YAAa,GACb,eAAgB,EAChB,mBAAoB,GACpB,iBAAkB,GAClB,sBAAuB,GACvB,mBAAoB,GACpB,0BAA2B,GAC3B,gBAAiB,GACjB,4BAA6B,KAAK,cAAc,sBAChD,0BAA2B,GAC3B,cAAe,EAC3B,EACQ,KAAK,UAAY,CACb,gCAAiC,GACjC,0CAA2C,GAC3C,2BAA4B,GAC5B,sBAAuB,GACvB,6BAA8B,GAC9B,yBAA0B,GAC1B,iBAAkB,GAClB,6BAA8B,GAC9B,WAAY,GACZ,cAAe,GACf,kBAAmB,GACnB,gCAAiC,GACjC,YAAa,GACb,aAAc,GACd,kBAAmB,GACnB,8BAA+B,GAC/B,0BAA2B,GAC3B,uBAAwB,GACxB,qBAAsB,GACtB,mBAAoB,GACpB,uBAAwB,GACxB,+BAAgC,GAChC,oBAAqB,GACrB,wBAAyB,GACzB,+CAAgD,GAChD,uDAAwD,GACxD,2BAA4B,EACxC,CACK,CACD,gCAAiC,CAC7B,GAAI,CAAC,KAAK,iBAEN,KAAM,yCAEV,KAAK,SAAW,KAAK,iBAAiB,WAAW,QAAQ,EACzD,KAAK,kBAAiB,EACtB,KAAK,aAAe,KAAK,SAAS,gBAClC,KAAK,uBAAuB,2BAA6B,CAAC,IAAIze,GAAsB,IAAI,CAAC,EACzF,KAAK,uBAAuB,2BAA2B,CAAC,EAAE,OAAS,KAAK,aACxE,KAAK,gBAAgB,KAAK,sBAAsB,CACnD,CAED,4BAA6B,CACzB,GAAI,CAAC,KAAK,eACN,OAEJ,KAAK,iBAAgB,EACrB,KAAK,oBAAsB,CACvB,MAAO,KAAK,eAAe,EAAI,EAC/B,OAAQ,KAAK,gBAAgB,EAAI,EACjC,mBAAoB,CAChC,EACQ,MAAMyf,EAAmB,IAAI,aAAa,CAAC,KAAK,gBAAgB,EAAI,CAAC,CAAC,EACtE,KAAK,eAAe,WAAW,KAAK,WAAY,EAAGA,CAAgB,EACnE,KAAK,eAAe,WAAW,KAAK,eAAgB,EAAGA,CAAgB,EACvE,IAAIC,EACJ,GAAI,KAAK,SAAS,UAAW,CACzB,MAAMC,EAAwB,CAC1B,MAAO,qBAAqB,KAAK,oBAAoB,KAAK,IAAI,KAAK,oBAAoB,MAAM,gBAC7F,KAAM,KAAK,oBACX,cAAe,EACf,YAAa,KAAK,qBAClB,UAAW,KACX,OAAQ,KAAK,SAAS,gBACtB,MAAO,EACvB,EACgB,KAAK,cACL,KAAK,eAAe,eAAe,KAAK,YAAY,EAExD,KAAK,aAAe,KAAK,QAAQ,cAAcA,CAAqB,EACpED,EAAuB,CACnB,CACI,KAAM,KAAK,aAAa,WAAW,CAC/B,MAAO,qCACP,UAAW,KACX,OAAQ,KAAK,SAAS,gBACtB,cAAe,EACf,gBAAiB,CACzC,CAAqB,EACD,WAAY,IAAI1B,GAAO,EAAG,EAAG,EAAG,CAAC,EACjC,OAAQ,QACR,QAAS,OACZ,CACjB,CACS,MAEG0B,EAAuB,CACnB,CACI,KAAM,OACN,WAAY,IAAI1B,GAAO,EAAG,EAAG,EAAG,CAAC,EACjC,OAAQ,QACR,QAAS,OACZ,CACjB,EAEQ,KAAK,uBAAuB,mBAAqB,KAAK,gBAAkB,uBAAiF,eACzJ,KAAK,uBAAuB,KAAK,sBAAsB,EACvD,KAAK,gBAAgB,KAAK,sBAAsB,EAChD,MAAM4B,EAAyB,CAC3B,MAAO,4BAA4B,KAAK,oBAAoB,KAAK,IAAI,KAAK,oBAAoB,MAAM,GACpG,KAAM,KAAK,oBACX,cAAe,EACf,YAAa,KAAK,qBAClB,UAAW,KACX,OAAQ,KAAK,uBAAuB,mBACpC,MAAO,EACnB,EACY,KAAK,eACL,KAAK,eAAe,eAAe,KAAK,aAAa,EAEzD,KAAK,cAAgB,KAAK,QAAQ,cAAcA,CAAsB,EACtE,MAAMC,EAAsB,CACxB,KAAM,KAAK,cAAc,WAAW,CAChC,MAAO,gCAAgC,KAAK,oBAAoB,KAAK,IAAI,KAAK,oBAAoB,MAAM,GACxG,UAAW,KACX,OAAQ,KAAK,cAAc,OAC3B,cAAe,EACf,gBAAiB,CACjC,CAAa,EACD,gBAAiB,KAAK,iBACtB,YAAa,QACb,aAAc,QACd,kBAAmB,KAAK,mBACxB,cAAgB,KAAK,gBAA8B,QAAZ,OACvC,eAAiB,KAAK,gBAA8B,QAAZ,MACpD,EACQ,KAAK,uBAAuB,qBAAuB,CAC/C,MAAO,iBACP,iBAAkBH,EAClB,uBAAwBG,CACpC,CACK,CAKD,YAAYvB,EAAQ,CAChB,MAAM,YAAYA,CAAM,EACxBwB,GAAY,KAAMxB,EAAQ,KAAK,gBAAgB,CAClD,CACD,mBAAoB,CAChB,KAAK,SAAS,UAAU,CACpB,OAAQ,KAAK,QACb,OAAQ,KAAK,SAAS,gBACtB,MAAO,GACP,UAAW,KAAK,mBAAqB,gBAAsE,QACvH,CAAS,CACJ,CAQD,kBAAkByB,EAAOC,EAAaC,EAAc,CAChD,OAAOC,GAAkB,KAAMH,EAAOC,EAAaC,CAAY,CAClE,CAOD,6BAA6BE,EAAatE,EAAS,CAC/C,OAAOuE,GAA4B,KAAMD,EAAatE,CAAO,CAChE,CAKD,iBAAiBwE,EAAoB,CAC7B,KAAK,aACL,KAAK,eAAc,EAGnB,KAAK,gBAAgBA,CAAkB,CAE9C,CAKD,gBAAgBA,EAAoB,CAC3B,KAAK,eACN,KAAK,sBAAwBA,EACzB,KAAK,kBACLC,GAAkB,KAAK,gBAAgB,EAGlD,CAID,gBAAiB,CACT,KAAK,cACLC,IAEP,CAID,kBAAmB,CACX,KAAK,kBACLC,GAAmB,KAAK,gBAAgB,CAE/C,CAID,iBAAkB,CACdC,IACH,CACD,iBAAkB,CACd,MAAM,gBAAe,EACrB,UAAWC,KAAiB,KAAK,gBAEzBA,EAAc,UAAS,EAAG,WAAa,KAAK,UAC5CA,EAAc,SAAQ,CAGjC,CACD,+BAA+BC,EAAY,CACvC5Q,EAA8B,WAAU,EACxCgC,EAAsB,WAAU,EAEhC,MAAM6O,EAAeC,GAAW,CAC5B,UAAWrG,KAASqG,EAAQ,CACxB,UAAWC,KAAQtG,EAAM,OAAQ,CAC7B,MAAMuG,EAAYD,EAAK,UACvB,GAAKC,EAGL,UAAWC,KAAWD,EAClBC,EAAQ,cAAgB,EAE/B,CACD,UAAWC,KAAYzG,EAAM,UACzByG,EAAS,kBAAkB,OAElC,CACb,EACQL,EAAY,KAAK,MAAM,EACvBA,EAAY,KAAK,cAAc,EAE/B,MAAMM,EAAU,CAAA,EAChB,UAAW1kB,KAAiB,KAAK,gBACzBA,EAAc,KAAK,QAAQ,UAAU,EAAI,GACzC0kB,EAAQ,KAAK1kB,CAAa,EAGlC,KAAK,gBAAkB0kB,EACvB,MAAM,+BAA+BP,CAAU,CAClD,CAQD,QAAQ9wB,EAAOC,EAAQqxB,EAAe,GAAO,CACzC,OAAK,MAAM,QAAQtxB,EAAOC,EAAQqxB,CAAY,GAG1C,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnCpwB,EAAO,IAAI,CAAC,UAAY,KAAK,OAAS,eAAgBlB,EAAOC,CAAM,CAAC,GAG5E,KAAK,2BAA0B,EAC3B,KAAK,mBAEL,KAAK,uBAAsB,EAExB,IAfI,EAgBd,CAID,oBAAoB8H,EAAgB,CAChC,OAAIA,IAAmB,EACZ,KAAK,qBAET,KAAK,gBACf,CAID,4BAA4BA,EAAgBC,EAAU,CAClD,OAAO,IAAIF,EAA8BC,EAAgBC,CAAQ,CACpE,CACD,uBAAwB,CACpB,OAAI,KAAK,sBAAwB,CAAC,KAAK,mBAEnC,KAAK,6BAA6B,KAAK,qBAAsB,GAAO,KAAM,GAAO,EAAK,EAEhF,KAAK,oBACX,KAAK,qBAAqB,EAAK,EAE5B,KAAK,kBACf,CAED,8BAA+B,CAC3B,OAAO,KAAK,qBAAuB,KAAK,sBAAwB,KAAK,sBACxE,CAKD,aAAc,CACV,KAAK,sBAAsB,QAC3B,KAAK,qBAAqB,qBAAqB,KAAK,YAAY,UAAU,CAC7E,CAMD,WAAWupB,EAAY,CACf,KAAK,+BAAiC,CAACA,IAK3C,KAAK,mBAAqB,GAC1B,KAAK,oBAAsB,KAC3B,KAAK,8BAAgC,KACrC,KAAK,qBAAqB,WAAW,KAAM,KAAM,IAAI,EACjDA,IACA,KAAK,sBAAsB,QAC3B,KAAK,mBAAmB,QACxB,KAAK,mBAAmB,UAAY,IACpC,KAAK,YAAY,QACjB,KAAK,WAAa,EAClB,KAAK,eAAiB,EACtB,KAAK,qBAAqB,qBAAqB,KAAK,YAAY,yBAA0B,KAAK,YAAY,wBAAwB,EACnI,KAAK,qBAAqB,qBAAqB,EAAK,EACpD,KAAK,cAAc,EAAI,GAE3B,KAAK,qBAAuB,KAC5B,KAAK,mBAAqB,KAC1B,KAAK,8BAAgC,KACxC,CAKD,cAAcxwB,EAAQ,CAClB,KAAK,iBAAmBA,EACxB,KAAK,qBAAqB,aAAaA,EAAS,GAAM,CAAC,CAC1D,CAKD,eAAgB,CACZ,OAAO,KAAK,gBACf,CACD,qBAAsB,CAClB,MAAM8F,EAAI,KAAK,gBAAgB,EAAGC,EAAI,KAAK,gBAAgB,EAAGE,EAAI,KAAK,gBAAgB,EAAGid,EAAI,KAAK,gBAAgB,EAC7GuN,EAAS,KAAK,kBAAkB,IAAM3qB,GAAK,KAAK,kBAAkB,IAAMC,GAAK,KAAK,kBAAkB,IAAME,GAAK,KAAK,kBAAkB,IAAMid,EAClJ,OAAIuN,IACA,KAAK,kBAAkB,EAAI,KAAK,gBAAgB,EAChD,KAAK,kBAAkB,EAAI,KAAK,gBAAgB,EAChD,KAAK,kBAAkB,EAAI,KAAK,gBAAgB,EAChD,KAAK,kBAAkB,EAAI,KAAK,gBAAgB,GAE7CA,CACV,CACD,eAAezI,EAAY,CACvB,MAAMliB,EAAI,KAAK,MAAM,KAAK,gBAAgB,CAAC,EACrCG,EAAI,KAAK,MAAM,KAAK,gBAAgB,CAAC,EACrCid,EAAI,KAAK,MAAM,KAAK,gBAAgB,CAAC,EAC3C,IAAInd,EAAI,KAAK,MAAM,KAAK,gBAAgB,CAAC,EACpC,KAAK,uBACNA,EAAI,KAAK,gBAAgB,EAAI,EAAIA,EAAImd,GAErC8E,EACAA,EAAW,QAAQ,IAAI/E,GAAyBnd,EAAGC,EAAGE,EAAGid,CAAC,CAAC,EAG3D,KAAK,wBAAwB,YAAYpd,EAAGC,EAAGE,EAAGid,EAAG,EAAG,CAAC,EAEzD,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnC/iB,EAAO,IAAI,CACP,UAAY,KAAK,OAAS,0BAC1B,KAAK,gBAAgB,EACrB,KAAK,gBAAgB,EACrB,KAAK,gBAAgB,EACrB,KAAK,gBAAgB,EACrB,+BAAiC,KAAK,uBAAwB,CAClF,CAAiB,EAGZ,CAID,UAAU2F,EAAGC,EAAG9G,EAAOC,EAAQ,CAC3B,KAAK,gBAAgB,EAAI4G,EACzB,KAAK,gBAAgB,EAAIC,EACzB,KAAK,gBAAgB,EAAI9G,EACzB,KAAK,gBAAgB,EAAIC,CAC5B,CACD,oBAAqB,CACjB,MAAM4G,EAAI,KAAK,eAAe,EAAGC,EAAI,KAAK,eAAe,EAAGE,EAAI,KAAK,eAAe,EAAGid,EAAI,KAAK,eAAe,EACzGuN,EAAS,KAAK,iBAAiB,IAAM3qB,GAAK,KAAK,iBAAiB,IAAMC,GAAK,KAAK,iBAAiB,IAAME,GAAK,KAAK,iBAAiB,IAAMid,EAC9I,OAAIuN,IACA,KAAK,iBAAiB,EAAI,KAAK,eAAe,EAC9C,KAAK,iBAAiB,EAAI,KAAK,eAAe,EAC9C,KAAK,iBAAiB,EAAI,KAAK,eAAe,EAC9C,KAAK,iBAAiB,EAAI,KAAK,eAAe,GAE3CA,CACV,CACD,cAAczI,EAAY,CACtB,MAAMjiB,EAAI,KAAK,qBAAuB,KAAK,eAAe,EAAI,KAAK,gBAAiB,EAAG,KAAK,eAAe,EAAI,KAAK,eAAe,EAC/HiiB,EACAA,EAAW,QAAQ,IAAI7E,GAAwB,KAAK,eAAe,EAAGpd,EAAG,KAAK,eAAe,EAAG,KAAK,eAAe,CAAC,CAAC,EAGtH,KAAK,sBAAuB,EAAC,eAAe,KAAK,eAAe,EAAGA,EAAG,KAAK,eAAe,EAAG,KAAK,eAAe,CAAC,EAElH,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnC5F,EAAO,IAAI,CACP,UAAY,KAAK,OAAS,yBAC1B,KAAK,eAAe,EACpB,KAAK,eAAe,EACpB,KAAK,eAAe,EACpB,KAAK,eAAe,EACpB,+BAAiC,KAAK,uBAAwB,CAClF,CAAiB,EAGZ,CACD,kBAAmB,CACf,OAAO,KAAK,eAAe,IAAM,GAAK,KAAK,eAAe,IAAM,GAAK,KAAK,eAAe,IAAM,GAAK,KAAK,eAAe,IAAM,CACjI,CACD,cAAc2F,EAAGC,EAAG9G,EAAOC,EAAQ,CAC/B,KAAK,eAAe,EAAI4G,EACxB,KAAK,eAAe,EAAIC,EACxB,KAAK,eAAe,EAAI9G,EACxB,KAAK,eAAe,EAAIC,CAC3B,CACD,gBAAiB,CACb,KAAK,eAAe,EAAI,KAAK,eAAe,EAAI,KAAK,eAAe,EAAI,KAAK,eAAe,EAAI,EAChG,KAAK,iBAAiB,EAAI,KAAK,iBAAiB,EAAI,KAAK,iBAAiB,EAAI,KAAK,iBAAiB,EAAI,CAC3G,CACD,uBAAwB,CACpB,MAAMuxB,EAAS,KAAK,sBAAsB,UAAY,KAAK,oBAC3D,OAAIA,IACA,KAAK,oBAAsB,KAAK,sBAAsB,SAEnDA,CACV,CACD,iBAAiBzI,EAAY,CACrBA,EACAA,EAAW,QAAQ,IAAI5E,GAA2B,KAAK,sBAAsB,SAAW,CAAC,CAAC,EAG1F,KAAK,sBAAqB,EAAG,oBAAoB,KAAK,sBAAsB,SAAW,CAAC,CAE/F,CACD,uBAAwB,CACpB,MAAM7E,EAAa,KAAK,YAAY,gBAC9BkS,EAASlS,EAAW,CAAC,IAAM,KAAK,oBAAoB,CAAC,GACvDA,EAAW,CAAC,IAAM,KAAK,oBAAoB,CAAC,GAC5CA,EAAW,CAAC,IAAM,KAAK,oBAAoB,CAAC,GAC5CA,EAAW,CAAC,IAAM,KAAK,oBAAoB,CAAC,EAChD,OAAIkS,IACA,KAAK,oBAAoB,CAAC,EAAIlS,EAAW,CAAC,EAC1C,KAAK,oBAAoB,CAAC,EAAIA,EAAW,CAAC,EAC1C,KAAK,oBAAoB,CAAC,EAAIA,EAAW,CAAC,EAC1C,KAAK,oBAAoB,CAAC,EAAIA,EAAW,CAAC,GAEvCkS,CACV,CACD,iBAAiBzI,EAAY,CACrBA,EACAA,EAAW,QAAQ,IAAI1E,GAA2B,KAAK,YAAY,gBAAgB,MAAO,CAAA,CAAC,EAG3F,KAAK,sBAAqB,EAAG,iBAAiB,KAAK,YAAY,eAAe,CAErF,CACD,wBAAyB,CACrB,KAAK,kBAAkB,EAAI,KAAK,kBAAkB,EAAI,KAAK,kBAAkB,EAAI,KAAK,kBAAkB,EAAI,EAC5G,KAAK,iBAAiB,EAAI,KAAK,iBAAiB,EAAI,KAAK,iBAAiB,EAAI,KAAK,iBAAiB,EAAI,EACxG,KAAK,oBAAsB,GAC3B,KAAK,oBAAoB,CAAC,EAAI,KAAK,oBAAoB,CAAC,EAAI,KAAK,oBAAoB,CAAC,EAAI,KAAK,oBAAoB,CAAC,EAAI,IAC3H,CAQD,MAAMC,EAAOmN,EAAY7gB,EAAO8gB,EAAU,GAAO,CAEzCpN,GAASA,EAAM,IAAM,SACrBA,EAAM,EAAI,GAEd,MAAMqN,EAAa,KAAK,mBACpB,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnCzwB,EAAO,IAAI,CAAC,UAAY,KAAK,OAAS,yBAA0BuwB,EAAY,UAAW7gB,EAAO,YAAa8gB,EAAS,sBAAuBC,CAAU,CAAC,GAI1J,KAAK,qBACDA,GACK,KAAK,oBACN,KAAK,6BAA6B,KAAK,qBAAsB,GAAOF,EAAanN,EAAQ,KAAM1T,EAAO8gB,CAAO,EAEjH,KAAK,cAAe,KAAK,kBAAuC,KAAnB,KAAK,WAAkB,EACpE,KAAK,eAAeD,EAAanN,EAAQ,KAAM1T,EAAO8gB,CAAO,IAGzD,KAAK,oBACL,KAAK,sBAAqB,EAE9B,KAAK,6BAA6B,KAAK,qBAAsB,GAAMD,EAAanN,EAAQ,KAAM1T,EAAO8gB,CAAO,KAI5G,CAAC,KAAK,oBAAsB,CAACC,IAC7B,KAAK,qBAAqB,CAACA,EAAYF,EAAanN,EAAQ,KAAM1T,EAAO8gB,CAAO,EAEhFC,IACA,KAAK,cAAe,KAAK,kBAAuC,KAAnB,KAAK,WAAkB,EACpE,KAAK,eAAeF,EAAanN,EAAQ,KAAM1T,EAAO8gB,CAAO,GAGxE,CACD,eAAepO,EAAYC,EAAYC,EAAc,CACjD,MAAMH,EAAc,KAAK,kBAA2B,KAAK,wBAAZ,KAC7C,KAAK,WAAW,eAAe,KAAK,YAAY,EAChD,KAAK,WAAW,sBAAsB,KAAK,mBAAmB,EAC9D,KAAK,WAAW,kBAAkB,KAAK,qBAAqB,gBAAkB,CAAE,EAAE,KAAK,qBAAqB,iBAAmB,CAAE,EAAE,KAAK,qBAAqB,eAAe,EACvK,KAAK,kBAINA,EAAW,oBAAoB,KAAK,kBAAkB,EAHtD,KAAK,YAAY,QAAQ,IAAIc,GAA2B,KAAK,kBAAkB,CAAC,EAKpF,MAAMT,EAAS,KAAK,WAAW,MAAML,EAAYC,EAAYC,EAAYC,EAAc,KAAK,kBAAkB,EACzG,KAAK,kBAMN,KAAK,iBAAiB,IAAI,GAL1B,KAAK,YAAY,UAAUE,CAAM,EACjC,KAAK,iBAAiB,KAAK,WAAW,EACtC,KAAK,gBAAe,EAK3B,CAWD,mBAAmB5K,EAAM8Y,EAAY7c,EAAO,CACxC,IAAIqU,EACJ,OAAItQ,aAAgB,MAChBsQ,EAAO,IAAI,aAAatQ,CAAI,EAEvBA,aAAgB,YACrBsQ,EAAO,IAAI,WAAWtQ,CAAI,EAG1BsQ,EAAOtQ,EAEQ,KAAK,eAAe,aAAasQ,EAAM7W,EAA4B,OAASA,EAA4B,QAASwC,CAAK,CAE5I,CAOD,0BAA0B+D,EAAM/D,EAAO,CACnC,OAAO,KAAK,mBAAmB+D,EAAM,OAAW/D,CAAK,CACxD,CAQD,kBAAkB8c,EAASD,EAAY7c,EAAO,CAC1C,IAAI+c,EAAW,GACX1I,EACJ,GAAIyI,aAAmB,aAAeA,aAAmB,WACrDzI,EAAOyI,UAEFA,aAAmB,YACxBzI,EAAOyI,EACPC,EAAW,OAEV,CACD,QAAS5rB,EAAQ,EAAGA,EAAQ2rB,EAAQ,OAAQ3rB,IACxC,GAAI2rB,EAAQ3rB,CAAK,EAAI,MAAO,CACxBkjB,EAAO,IAAI,YAAYyI,CAAO,EAC9B,KACH,CAEAzI,IACDA,EAAO,IAAI,YAAYyI,CAAO,EAC9BC,EAAW,GAElB,CACD,MAAMpa,EAAa,KAAK,eAAe,aAAa0R,EAAM7W,EAA4B,MAAQA,EAA4B,QAASwC,CAAK,EACxI,OAAA2C,EAAW,SAAWoa,EACfpa,CACV,CAOD,yBAAyB4F,EAAauU,EAAStZ,EAAS,EAAG,CACvD,MAAM5B,EAAY2G,EAClB,IAAI8L,EACA9L,EAAY,SACZ8L,EAAOyI,aAAmB,YAAcA,EAAU,IAAI,YAAYA,CAAO,EAGzEzI,EAAOyI,aAAmB,YAAcA,EAAU,IAAI,YAAYA,CAAO,EAE7E,KAAK,eAAe,WAAWlb,EAAW4B,EAAQ6Q,CAAI,CACzD,CAQD,0BAA0B1L,EAAc5E,EAAMiZ,EAAYha,EAAY,CAClE,MAAML,EAAagG,EACfqU,IAAe,SACfA,EAAa,GAEjB,IAAI3I,EACArR,IAAe,QACXe,aAAgB,MAChBsQ,EAAO,IAAI,aAAatQ,CAAI,EAEvBA,aAAgB,YACrBsQ,EAAO,IAAI,WAAWtQ,CAAI,EAG1BsQ,EAAOtQ,EAEXf,EAAaqR,EAAK,YAGdtQ,aAAgB,MAChBsQ,EAAO,IAAI,aAAatQ,CAAI,EAEvBA,aAAgB,YACrBsQ,EAAO,IAAI,WAAWtQ,CAAI,EAG1BsQ,EAAOtQ,EAGf,KAAK,eAAe,WAAWpB,EAAYqa,EAAY3I,EAAM,EAAGrR,CAAU,CAC7E,CAID,cAAce,EAAMtD,EAAeT,EAAO,CACtC,IAAIqU,EACAtQ,aAAgB,MAChBsQ,EAAO,IAAI,aAAatQ,CAAI,EAEvBA,aAAgB,YACrBsQ,EAAO,IAAI,WAAWtQ,CAAI,EAG1BsQ,EAAOtQ,EAEX,IAAI5B,EAAQ,EACZ,OAAI1B,EAAgB,IAChB0B,GAAS3E,EAA4B,SAErCiD,EAAgB,IAChB0B,GAAS3E,EAA4B,SAErCiD,EAAgB,IAChB0B,GAAS3E,EAA4B,SAErCiD,EAAgB,IAChB0B,GAAS3E,EAA4B,QAErCiD,EAAgB,KAChB0B,GAAS3E,EAA4B,OAErCiD,EAAgB,KAChB0B,GAAS3E,EAA4B,SAErCiD,EAAgB,KAChB0B,GAAS3E,EAA4B,UAElC,KAAK,eAAe,aAAa6W,EAAMlS,EAAOnC,CAAK,CAC7D,CAID,qBAAsB,CAElB,KAAM,2BACT,CAID,8BAA+B,CAE3B,KAAM,2BACT,CAID,0BAA2B,CAE1B,CAQD,YAAYyF,EAAe8C,EAAa7X,EAAQ8X,EAAuB,CACnE,KAAK,oBAAsBD,EAC3B,KAAK,8BAAgCC,GAAyB,KAC9D,KAAK,qBAAqB,WAAW/C,EAAe8C,EAAa,KAAK,6BAA6B,CACtG,CAID,eAAehH,EAAQ,CACnB,OAAO,KAAK,eAAe,cAAcA,CAAM,CAClD,CAWD,oBAAoB0b,EAAUjd,EAAO,CACjC,IAAIqU,EACJ,OAAI4I,aAAoB,MACpB5I,EAAO,IAAI,aAAa4I,CAAQ,EAGhC5I,EAAO4I,EAEQ,KAAK,eAAe,aAAa5I,EAAM7W,EAA4B,QAAUA,EAA4B,QAASwC,CAAK,CAE7I,CAQD,2BAA2Bid,EAAUjd,EAAO,CACxC,OAAO,KAAK,oBAAoBid,EAAUjd,CAAK,CAClD,CASD,oBAAoBpI,EAAeqlB,EAAUzZ,EAAQ0M,EAAO,CACpD1M,IAAW,SACXA,EAAS,GAEb,MAAMb,EAAa/K,EACnB,IAAIyc,EACAnE,IAAU,QACN+M,aAAoB,aACpB5I,EAAO4I,EAGP5I,EAAO,IAAI,aAAa4I,CAAQ,EAEpC/M,EAAQmE,EAAK,YAGT4I,aAAoB,aACpB5I,EAAO4I,EAGP5I,EAAO,IAAI,aAAa4I,CAAQ,EAGxC,KAAK,eAAe,WAAWta,EAAYa,EAAQ6Q,EAAM,EAAGnE,CAAK,CACpE,CAOD,sBAAsB3O,EAAQ2b,EAAWjuB,EAAM,CAC3C,KAAK,oBAAoB,UAAUA,EAAMsS,CAAM,CAClD,CAID,kBAAmB,CAAG,CAmBtB,aAAa4b,EAAUC,EAA0BC,EAAuBtsB,EAAU+G,EAASwlB,EAAWC,EAAYtH,EAASuH,EAAiBxqB,EAAiB,EAA6ByqB,EAA2B,CACjN,MAAMC,EAAS,OAAOP,GAAa,SAAWA,EAAWA,EAAS,aAAeA,EAAS,cAAgBA,EAAS,eAAiBA,EAAS,OACvIQ,EAAW,OAAOR,GAAa,SAAWA,EAAWA,EAAS,eAAiBA,EAAS,gBAAkBA,EAAS,iBAAmBA,EAAS,SAC/IS,EAAgB,KAAK,oBACrBC,EAAYT,EAAyB,aAAe,OAC1D,IAAIU,EAAchmB,GAAWslB,EAAyB,SAAW,GAC7DQ,IACAE,GAAe;AAAA,EAAOF,GAE1B,MAAM3uB,EAAOyuB,EAAS,IAAMC,EAAW,IAAMG,EAC7C,GAAI,KAAK,iBAAiB7uB,CAAI,EAAG,CAC7B,MAAM8uB,EAAiB,KAAK,iBAAiB9uB,CAAI,EACjD,OAAIsuB,GAAcQ,EAAe,WAC7BR,EAAWQ,CAAc,EAE7BA,EAAe,YACRA,CACV,CACD,MAAMrtB,EAAS,IAAIstB,GAAOb,EAAUC,EAA0BS,EAAY,KAAOR,EAAuBtsB,EAAU,KAAM+G,EAASwlB,EAAWC,EAAYtH,EAASuH,EAAiBvuB,EAAMmuB,EAAyB,gBAAkBpqB,EAAgBoqB,EAAyB,2BAA6BK,CAAyB,EAClU,YAAK,iBAAiBxuB,CAAI,EAAIyB,EACvBA,CACV,CACD,yBAAyB2iB,EAAQ9nB,EAAM,CACnC,OAAO,KAAK,SAAS,YAAY8nB,EAAQ9nB,CAAI,CAChD,CACD,sBAAsB8nB,EAAQ9nB,EAAMuM,EAASmmB,EAAe,CACxD,OAAO,KAAK,yBAAyBA,GAAiBnmB,EAAUA,EAAU;AAAA,EAAO,IAAMub,EAAQ9nB,CAAI,CACtG,CACD,eAAe8nB,EAAQ9nB,EAAMuM,EAAS,CAClC,OAAIA,EACAA,EAAU,KAAOA,EAAQ,MAAM;AAAA,CAAI,EAAE,KAAK;AAAA,GAAM,EAAI;AAAA,EAGpDA,EAAU,GAEPA,EAAUub,CACpB,CACD,+BAA+B6K,EAAcC,EAAgBnrB,EAAgBorB,EAAmCC,EAAqC,CACjJ,OAAI,KAAK,WAAarrB,IAAmB,IACrCkrB,EAAe,KAAK,UAAU,kBAAkBA,EAAcE,CAAiC,EAC/FD,EAAiB,KAAK,UAAU,kBAAkBA,EAAgBE,CAAmC,GAElG,CACH,YAAa,CACT,OAAQ,KAAK,QAAQ,mBAAmB,CACpC,MAAO,SACP,KAAMH,CAC1B,CAAiB,EACD,WAAY,MACf,EACD,cAAe,CACX,OAAQ,KAAK,QAAQ,mBAAmB,CACpC,MAAO,WACP,KAAMC,CAC1B,CAAiB,EACD,WAAY,MACf,CACb,CACK,CACD,mCAAmCzlB,EAAYC,EAAc3F,EAAgB,CACzE,MAAMorB,EAAoC1lB,EAAW,QAAQ,qCAAqC,GAAK,EACjG2lB,EAAsC1lB,EAAa,QAAQ,qCAAqC,GAAK,EACrGulB,EAAelrB,IAAmB,EAA8B,KAAK,yBAAyB0F,EAAY,QAAQ,EAAIA,EACtHylB,EAAiBnrB,IAAmB,EAA8B,KAAK,yBAAyB2F,EAAc,UAAU,EAAIA,EAClI,OAAO,KAAK,+BAA+BulB,EAAcC,EAAgBnrB,EAAgBorB,EAAmCC,CAAmC,CAClK,CACD,gCAAgC3lB,EAAYC,EAAcb,EAAS9E,EAAgB,CAC/E,KAAK,oCAAoC,gBAAgB,IAAI,EAC7D,MAAMorB,EAAoC1lB,EAAW,QAAQ,qCAAqC,GAAK,EACjG2lB,EAAsC1lB,EAAa,QAAQ,qCAAqC,GAAK,EACrGslB,EAAgB;AAAA,EAChBC,EAAelrB,IAAmB,EAA8B,KAAK,sBAAsB0F,EAAY,SAAUZ,EAASmmB,CAAa,EAAI,KAAK,eAAevlB,EAAY,SAAUZ,CAAO,EAC5LqmB,EAAiBnrB,IAAmB,EACpC,KAAK,sBAAsB2F,EAAc,WAAYb,EAASmmB,CAAa,EAC3E,KAAK,eAAetlB,EAAc,WAAYb,CAAO,EACrDwmB,EAAU,KAAK,+BAA+BJ,EAAcC,EAAgBnrB,EAAgBorB,EAAmCC,CAAmC,EACxK,YAAK,mCAAmC,gBAAgB,IAAI,EACrDC,CACV,CAID,wBAAyB,CAErB,KAAM,yBACT,CAID,qBAAsB,CAElB,KAAM,yBACT,CAMD,iBAAiBxpB,EAAM,CACnB,MAAMypB,EAAM,IAAIlN,GAAkBvc,CAAI,EACtC,OAAAypB,EAAI,MAAQ,GACZA,EAAI,YAAW,EACRA,EAAI,IACd,CAMD,sBAAsB/tB,EAAyB,CAC3C,OAAO,IAAID,GAAsBC,EAAyB,IAAI,CACjE,CAKD,uBAAwB,CACpB,OAAO,IAAI4b,EACd,CAKD,mBAAoB,CAChB,OAAO,IAAIM,GAAkB,KAAK,cAAc,CACnD,CAID,MAAM,wBAAwBhH,EAAiB8Y,EAAkBC,EAAoBC,EAAaC,EAAqBC,EAAuBC,EAAgB/mB,EAASgnB,EAA4BC,EAAMC,EAAS,CAC9M,MAAMC,EAAgBvZ,EAChB1S,EAAiBisB,EAAc,wBAAwB,eACzDjsB,IAAmB,GAA+B,CAAC,KAAK,+BACxD,MAAM,KAAK,6BAEX,KAAK,oBACL7G,EAAO,IAAI,CAAC,UAAW2L,CAAO,CAAC,EAC/B3L,EAAO,IAAIqyB,CAAgB,EAC3BryB,EAAO,IAAIsyB,CAAkB,EAC7BtyB,EAAO,IAAI,iDAAiD,GAEhE8yB,EAAc,QAAU,CACpB,SAAUR,EACV,OAAQD,EACR,UAAWG,EACX,YAAaC,CACzB,EACYF,EACAO,EAAc,OAAS,KAAK,mCAAmCT,EAAkBC,EAAoBzrB,CAAc,EAGnHisB,EAAc,OAAS,KAAK,gCAAgCT,EAAkBC,EAAoB3mB,EAAS9E,CAAc,EAE7HgsB,GACH,CAOD,cAActZ,EAAiB1U,EAAiB,CAC5C,MAAMkuB,EAAU,IAAI,MAAMluB,EAAgB,MAAM,EAC1CmuB,EAAqBzZ,EAC3B,QAAS,EAAI,EAAG,EAAI1U,EAAgB,OAAQ,IAAK,CAC7C,MAAMouB,EAAgBpuB,EAAgB,CAAC,EACjCquB,EAAoBF,EAAmB,wBAAwB,oBAAoBC,CAAa,EAClGC,IAAsB,SAG1BH,EAAQ,CAAC,EAAIG,EAChB,CACD,OAAOH,CACV,CAKD,aAAaxuB,EAAQ,CACjB,GAAKA,EAGL,IAAI,CAAC4uB,GAAU5uB,CAAM,EACjB,KAAK,eAAiBA,EACtB,KAAK,wBAA0B,KAAK,wBACpC,KAAK,oBAAsB,KAAK,oBAChC,KAAK,UAAU,mBACX,KAAK,wBACLvE,EAAO,KAAK,kFAAkFuE,EAAO,QAAQ,iBAAiBA,EAAO,IAAI,wBAAwB,OAAOA,EAAO,MAAS,SAAW,GAAKA,EAAO,KAAK,MAAM,0BAA0B,OAAOA,EAAO,MAAS,SAAW,GAAKA,EAAO,KAAK,QAAQ,GAAI,EAAE,UAGpT,CAACA,EAAO,QACZA,EAAO,SAAW,KAAK,gBACpBA,EAAO,kBAAoB,KAAK,yBAChCA,EAAO,cAAgB,KAAK,qBAC5B,CAAC,KAAK,mBAAqB,CAC/B,GAAI,CAACA,EAAO,QAAU,KAAK,8BACvB,MAAAvE,EAAO,IAAI,CAAC,eAAgBuE,CAAM,CAAC,EAE7B,8DAEV,MACH,SAEG,KAAK,eAAiBA,EAAO,OAC7B,KAAK,wBAA0BA,EAAO,gBACtC,KAAK,oBAAsBA,EAAO,YAClC,KAAK,UAAU,uBACX,CAAC,KAAK,wBACN,MAAAvE,EAAO,IAAI,CAAC,eAAgBuE,CAAM,CAAC,EAE7B,uEAGd,KAAK,sBAAsB,gBAAkB,OAC7C,KAAK,mBAAqB,GACtB,KAAK,eAAe,QACpB,KAAK,eAAe,OAAO,KAAK,cAAc,EAE9C,KAAK,eAAe,mBACpB,KAAK,eAAe,kBAAkB,gBAAgB,KAAK,cAAc,EAEhF,CAID,eAAeA,EAAQ,CACf,KAAK,iBAAiBA,EAAO,IAAI,IACjC,OAAO,KAAK,iBAAiBA,EAAO,IAAI,EACxC,KAAK,uBAAuBA,EAAO,mBAAoB,CAAA,EAE9D,CAID,gBAAiB,CACb,UAAWzB,KAAQ,KAAK,iBAAkB,CACtC,MAAMswB,EAAwB,KAAK,iBAAiBtwB,CAAI,EAAE,mBAAkB,EAC5E,KAAK,uBAAuBswB,CAAqB,CACpD,CACD,KAAK,iBAAmB,GACxB,KAAK,2BAA2B,gBAAgB,IAAI,CACvD,CACD,uBAAuB7Z,EAAiB,CACpC,MAAM4D,EAAwB5D,EAC1B4D,GACAkW,GAAoBlW,CAAqB,CAEhD,CAQD,IAAI,iBAAkB,CAClB,MAAO,EACV,CAED,wBAAyB,CACrB,OAAO,IAAIlO,GAAsB,IAAI,CACxC,CAID,gBAAgB/P,EAAS,CACrB,MAAM8F,EAAQ,KAAK,uBAAuB,QAAQ9F,CAAO,EACrD8F,IAAU,IACV,KAAK,uBAAuB,OAAOA,EAAO,CAAC,EAE/C,KAAK,eAAe,eAAe9F,CAAO,CAC7C,CAID,mCAAoC,CAChC,MAAO,EACV,CACD,gCAAgCA,EAASotB,EAAoB,CACzDptB,EAAQ,oBAAsBotB,CACjC,CAUD,uBAAuB9mB,EAAMslB,EAASwI,EAA0B,GAAMpM,EAAS,EAAuC,CAClH,MAAM8E,EAAc,CAAA,EAChBlB,IAAY,QAAa,OAAOA,GAAY,UAC5CkB,EAAY,gBAAkBlB,EAAQ,gBACtCkB,EAAY,cAAgBlB,EAAQ,cACpCkB,EAAY,KAAOlB,EAAQ,OAAS,OAAY,EAAIA,EAAQ,KAC5DkB,EAAY,aAAelB,EAAQ,eAAiB,OAAY,EAAIA,EAAQ,aAC5EkB,EAAY,OAASlB,EAAQ,SAAW,OAAY,EAAIA,EAAQ,OAChEkB,EAAY,QAAUlB,EAAQ,SAAW,EACzCkB,EAAY,cAAgBlB,EAAQ,eAAiB,EACrDkB,EAAY,cAAgBlB,EAAQ,eAAiB,GACrDkB,EAAY,MAAQlB,EAAQ,QAG5BkB,EAAY,gBAAkBlB,EAC9BkB,EAAY,KAAO,EACnBA,EAAY,aAAe,EAC3BA,EAAY,OAAS,EACrBA,EAAY,QAAU,EACtBA,EAAY,cAAgB,EAC5BA,EAAY,cAAgB,KAE5BA,EAAY,OAAS,GAAK,CAAC,KAAK,MAAM,6BAGjCA,EAAY,OAAS,GAAK,CAAC,KAAK,MAAM,mCAC3CA,EAAY,aAAe,GAE3BA,EAAY,OAAS,GAAK,CAAC,KAAK,MAAM,eACtCA,EAAY,KAAO,EACnBhsB,EAAO,KAAK,4EAA4E,GAE5F,MAAMd,EAAU,IAAI8gB,EAAgB,KAAMkH,CAAM,EAC1CpoB,EAAQ0G,EAAK,OAASA,EACtBzG,EAASyG,EAAK,QAAUA,EACxBkK,EAAQlK,EAAK,OAAS,EACtBwN,EAASxN,EAAK,QAAU,EAmB9B,GAlBAtG,EAAQ,UAAYJ,EACpBI,EAAQ,WAAaH,EACrBG,EAAQ,MAAQJ,EAChBI,EAAQ,OAASH,EACjBG,EAAQ,MAAQwQ,GAASsD,EACzB9T,EAAQ,QAAU,GAClBA,EAAQ,QAAU8sB,EAAY,QAC9B9sB,EAAQ,gBAAkB,CAAC,CAAC8sB,EAAY,gBACxC9sB,EAAQ,aAAe8sB,EAAY,aACnC9sB,EAAQ,KAAO8sB,EAAY,KAC3B9sB,EAAQ,OAAS8sB,EAAY,OAC7B9sB,EAAQ,UAAY8T,EAAS,EAC7B9T,EAAQ,KAAOwQ,EAAQ,EACvBxQ,EAAQ,aAAe,EACvBA,EAAQ,aAAe,EACvBA,EAAQ,eAAiB8sB,EAAY,cACrC9sB,EAAQ,MAAQ8sB,EAAY,MAC5B,KAAK,uBAAuB,KAAK9sB,CAAO,EACpC,CAACo0B,EAAyB,CAC1B,MAAMC,EAAoB,CAACvH,EAAY,iBAAmBA,EAAY,cAClEuH,IAEAr0B,EAAQ,gBAAkB,IAE9B,KAAK,eAAe,mCAAmCA,EAASJ,EAAOC,EAAQiU,GAAU,EAAGgZ,EAAY,aAAa,EACjHuH,IAEAr0B,EAAQ,gBAAkB,GAEjC,CACD,OAAOA,CACV,CAwBD,cAAcsqB,EAAKE,EAAUrX,EAASoX,EAAOR,EAAe,EAAGY,EAAS,KAAMC,EAAU,KAAM1U,EAAS,KAAMmW,EAAW,KAAMtsB,EAAS,KAAMksB,EAAkB,KAAMqI,EAAUhI,EAAelX,EAAejV,EAAe,CACxN,OAAO,KAAK,mBAAmBmqB,EAAKE,EAAUrX,EAASoX,EAAOR,EAAcY,EAAQC,EAAS,CAAC5qB,EAAS8uB,EAAWvE,EAAOgK,EAAKphB,EAASqX,EAAUgK,EAAcC,IAAoB,CAC/K,MAAMx0B,EAAcs0B,EASpB,GARAv0B,EAAQ,UAAYC,EAAY,MAChCD,EAAQ,WAAaC,EAAY,OACjCD,EAAQ,MAAQC,EAAY,MAC5BD,EAAQ,OAASC,EAAY,OAC7BD,EAAQ,OAASA,EAAQ,SAAW,GAAKA,EAAQ,OAAUD,GAAU,EACrEC,EAAQ,KAAOA,EAAQ,OAAS,GAAKA,EAAQ,KAAO,EACpDA,EAAQ,eAAiBoV,GAAiB,EAC1Cqf,EAAgBz0B,EAAQ,MAAOA,EAAQ,OAAQC,EAAa6uB,EAAW9uB,EAAS,IAAM,CAAA,CAAG,EACpFA,EAAQ,kBAAkB,mBAUtB,CAACwqB,GAAY,CAACgK,GACnB,KAAK,iBAAiBx0B,EAAS,KAAK,cAAc,MAXH,CAE/C,MAAMsV,EAAoB,KAAK,eAAe,mCAAmCtV,EAASC,EAAY,MAAOA,EAAY,OAAQ,OAAWmV,CAAa,EACrJzV,EAAoB,cAAcM,CAAW,IAC7C,KAAK,eAAe,cAAcA,EAAaD,EAASC,EAAY,MAAOA,EAAY,OAAQD,EAAQ,MAAOsV,EAAkB,OAAQ,EAAG,EAAGnC,EAAS,GAAO,EAAG,CAAC,EAC9J,CAACqX,GAAY,CAACgK,GACd,KAAK,iBAAiBx0B,EAAS,KAAK,cAAc,EAG7D,CAIGuqB,GACAA,EAAM,kBAAkBvqB,CAAO,EAEnCA,EAAQ,QAAU,GAClBA,EAAQ,mBAAmB,gBAAgBA,CAAO,EAClDA,EAAQ,mBAAmB,OACvC,EAAW,IAAM,GAAOkW,EAAQmW,EAAUtsB,EAAQksB,EAAiBqI,EAAUhI,EAAensB,CAAa,CACpG,CAMD,kBAAkBH,EAAS,CACvB,MAAMkQ,EAAkB,IAAIH,GAAsB,KAAM/P,CAAO,EACzD6rB,EAAkB,IAAI/K,EAAgB,KAAM,EAAuC,EAAI,EAC7F,OAAA+K,EAAgB,iBAAmB3b,EACnC2b,EAAgB,QAAU,GACnBA,CACV,CAMD,kBAAmB,CACf,MAAM,IAAI,MAAM,mEAAmE,CACtF,CAID,kBAAkB1rB,EAAeu0B,EAAW,CACxC,OAAOv0B,GAAiB,KAAK,MAAM,kBACtC,CAID,aAAaw0B,EAAQ,CAAG,CAOxB,0BAA0B5K,EAAc/pB,EAASoQ,EAAkB,GAAO,CAClEA,IACApQ,EAAQ,gBAAkB,GAC1B,KAAK,iBAAiBA,CAAO,GAEjCA,EAAQ,aAAe+pB,CAC1B,CAQD,0BAA0B/pB,EAAS40B,EAAOC,EAAQ,KAAMC,EAAQ,KAAM,CAC9DF,IAAU,OACV50B,EAAQ,aAAe40B,GAEvBC,IAAU,OACV70B,EAAQ,aAAe60B,IAEtB70B,EAAQ,WAAaA,EAAQ,OAAS80B,IAAU,OACjD90B,EAAQ,aAAe80B,EAE9B,CAQD,wBAAwB90B,EAASJ,EAAOC,EAAQ2Q,EAAQ,EAAG,CAKvD,GAJI,CAACxQ,EAAQ,kBAITA,EAAQ,QAAUJ,GAASI,EAAQ,SAAWH,GAAUG,EAAQ,QAAUwQ,EAC1E,OAEJ,MAAMkE,EAAmB1U,EAAQ,iBAAiB,wBAClDA,EAAQ,iBAAiB,UACzB,KAAK,eAAe,mCAAmCA,EAASJ,EAAOC,EAAQ2Q,EAAOkE,CAAgB,CACzG,CAID,oBAAoB9Q,EAAM5D,EAAS8xB,EAAU,CAEzC,GADAA,EAAWA,GAAYluB,EACnB,KAAK,eAAgB,CAErB,MAAMmxB,EADwB,KAAK,eAAe,iBACH,wBAAwB,kBAAkBjD,CAAQ,EAEjG,GADA,KAAK,wBAAwB,WAAWluB,EAAM5D,CAAO,EACjD+0B,GAAoBA,EAAiB,gBAAiB,CACtD,MAAMppB,EAAcmmB,EAAW,UAC/B,KAAK,wBAAwB,WAAWnmB,EAAa3L,CAAO,CAC/D,CACJ,CACJ,CAcD,6BAA6B+rB,EAASxB,EAAO4B,EAAUC,EAAWzB,EAAS,KAAMC,EAAU,KAAM7qB,EAAQksB,EAAkB,KAAMC,EAAoB,GAAM,CACvJ,MAAMzB,EAAYuK,GAAa,CAC3B,GAAI,CAACA,EAAU,CACPrK,GACAA,EAAO,IAAI,EAEf,MACH,CACD,MAAM3qB,EAAUg1B,EAAS,QACpB9I,EAGI8I,EAAS,KAAK,sBACnBh1B,EAAQ,qBAAuBg1B,EAAS,KAAK,qBAH7Ch1B,EAAQ,qBAAuB,IAAIi1B,GAKvCj1B,EAAQ,QAAU,EACd2qB,GACAA,EAAO3qB,CAAO,CAE9B,EACQ,OAAO,KAAK,kBAAkB+rB,EAASxB,EAAO,KAAM,GAAOE,EAAUG,EAAS7qB,EAAQksB,EAAiBC,EAAmBC,EAAUC,CAAS,CAChJ,CAQD,WAAWiB,EAAS6H,EAAQl1B,EAAS4D,EAAM,CACvC,KAAK,YAAYypB,EAASrtB,EAAS,GAAO,GAAO4D,EAAMA,CAAI,CAC9D,CAQD,gBAAgBypB,EAAS6H,EAAQC,EAAUvxB,EAAM,CAC7C,QAASkC,EAAQ,EAAGA,EAAQqvB,EAAS,OAAQrvB,IACzC,KAAK,YAAY,GAAIqvB,EAASrvB,CAAK,EAAG,GAAM,GAAOlC,EAAOkC,EAAM,SAAU,EAAElC,CAAI,CAEvF,CAID,YAAYypB,EAASrtB,EAErBo1B,EAAuB,GAAOC,EAAsB,GAAOzxB,EAAO,GAAIkuB,EAAU,CAM5E,GADAA,EAAWA,GAAYluB,EACnB,KAAK,eAAgB,CACrB,GAAI,CAAC5D,EACD,YAAK,wBAAwB,WAAW4D,EAAM,IAAI,EAC3C,GAGX,GAAI5D,EAAQ,MACRA,EAAQ,OAAM,UAETA,EAAQ,iBAAmB,EAEhC,OAAAA,EAAQ,UAAS,EACV,GAEX,IAAI6rB,EAAkB,KAmBtB,GAlBIwJ,EACAxJ,EAAkB7rB,EAAQ,oBAErBA,EAAQ,UACb6rB,EAAkB7rB,EAAQ,qBAErBA,EAAQ,OACb6rB,EAAkB,KAAK,iBAElB7rB,EAAQ,KACb6rB,EAAkB,KAAK,eAElB7rB,EAAQ,UACb6rB,EAAkB,KAAK,oBAGvBA,EAAkB,KAAK,aAEvBA,GAAmB,CAACA,EAAgB,YAAa,CAEjD,GAAIA,EAAgB,QAAUA,EAAgB,yBAA2B7rB,EAAQ,gBAAiB,CAC9F6rB,EAAgB,uBAAyB7rB,EAAQ,gBACjD,MAAMs1B,EAAkBt1B,EAAQ,kBAAoB,GAAKA,EAAQ,kBAAoB,EAC/E,EACA,EACNA,EAAQ,MAAQs1B,EAChBt1B,EAAQ,MAAQs1B,CACnB,CACDzJ,EAAgB,aAAe7rB,EAAQ,MACvC6rB,EAAgB,aAAe7rB,EAAQ,MACnC6rB,EAAgB,OAChBA,EAAgB,aAAe7rB,EAAQ,OAE3C,KAAK,qBAAqB,EAAG6rB,EAAiB7rB,EAAQ,yBAAyB,CAClF,CACD,KAAK,oBAAoB4D,EAAMioB,EAAiBiG,CAAQ,CAC3D,MAEO,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnChxB,EAAO,IAAI,CAAC,UAAY,KAAK,OAAS,6DAA8Dd,CAAO,CAAC,GAIxH,MAAO,EACV,CAID,qBAAqBu1B,EAAQ1J,EAAiB2J,EAA2B,CACjE3J,EAAgB,mCAAqC2J,IACrD3J,EAAgB,iCAAmC,KAAK,IAAI2J,EAA2B,KAAK,MAAM,aAAa,EAEtH,CAID,aAAanI,EAASrtB,EAAS4D,EAAM,CAC7BypB,IAAY,QAGhB,KAAK,oBAAoBzpB,EAAM5D,CAAO,CACzC,CAKD,gBAAgBA,EAAS,CACrB,KAAK,iBAAiBA,CAAO,CAChC,CAaD,kBAAkBA,EAASy1B,EAAWC,EAASC,EAAS/1B,EAAOC,EAAQ+T,EAAY,EAAGgiB,EAAM,EAAGxlB,EAAkB,GAAO,CACpH,IAAIkF,EAAoBtV,EAAQ,iBAC3BA,EAAQ,kBAAkB,qBAC3BsV,EAAoB,KAAK,eAAe,mCAAmCtV,CAAO,GAEtF,MAAM0Y,EAAO,IAAI,WAAW+c,EAAU,OAAQA,EAAU,WAAYA,EAAU,UAAU,EACxF,KAAK,eAAe,cAAc/c,EAAM1Y,EAASJ,EAAOC,EAAQG,EAAQ,MAAOsV,EAAkB,OAAQ1B,EAAWgiB,EAAK51B,EAAQ,QAAS,GAAO01B,EAASC,CAAO,EAC7JvlB,GACA,KAAK,iBAAiBpQ,CAAO,CAEpC,CAID,uCAAuCA,EAAS61B,EAAgBj2B,EAAOC,EAAQ41B,EAAW7hB,EAAY,EAAGgiB,EAAM,EAAG,CAC9G,IAAItgB,EAAoBtV,EAAQ,iBAC3BA,EAAQ,kBAAkB,qBAC3BA,EAAQ,OAAS61B,EACjBvgB,EAAoB,KAAK,eAAe,mCAAmCtV,EAASJ,EAAOC,CAAM,GAErG,MAAM6Y,EAAO,IAAI,WAAW+c,EAAU,OAAQA,EAAU,WAAYA,EAAU,UAAU,EACxF,KAAK,eAAe,cAAc/c,EAAM1Y,EAASJ,EAAOC,EAAQG,EAAQ,MAAOsV,EAAkB,OAAQ1B,EAAWgiB,EAAK,GAAO,GAAO,EAAG,CAAC,CAC9I,CAID,6BAA6B51B,EAASy1B,EAAW7hB,EAAY,EAAGgiB,EAAM,EAAGE,EAAuBC,EAA2B,GAAO,CAC9H,MAAMC,EAAc,KAAK,MAAM,KAAK,IAAIh2B,EAAQ,KAAK,EAAI,KAAK,KAAK,EAC7Di2B,EAAe,KAAK,MAAM,KAAK,IAAIj2B,EAAQ,MAAM,EAAI,KAAK,KAAK,EAC/DJ,EAAQm2B,EAA2B/1B,EAAQ,MAAQ,KAAK,IAAI,EAAG,KAAK,IAAIg2B,EAAcJ,EAAK,CAAC,CAAC,EAC7F/1B,EAASk2B,EAA2B/1B,EAAQ,OAAS,KAAK,IAAI,EAAG,KAAK,IAAIi2B,EAAeL,EAAK,CAAC,CAAC,EACtG,IAAItgB,EAAoBtV,EAAQ,iBAC3BA,EAAQ,kBAAkB,qBAC3BsV,EAAoB,KAAK,eAAe,mCAAmCtV,EAASJ,EAAOC,CAAM,GAErG,MAAM6Y,EAAO,IAAI,WAAW+c,EAAU,OAAQA,EAAU,WAAYA,EAAU,UAAU,EACxF,KAAK,eAAe,cAAc/c,EAAM1Y,EAASJ,EAAOC,EAAQG,EAAQ,MAAOsV,EAAkB,OAAQ1B,EAAWgiB,EAAK51B,EAAQ,QAAS,GAAO,EAAG,CAAC,CACxJ,CAID,gCAAgCA,EAASy1B,EAAW7hB,EAAY,EAAGgiB,EAAM,EAAG,CACxE,KAAK,6BAA6B51B,EAASy1B,EAAW7hB,EAAWgiB,CAAG,CACvE,CAID,sBAAsB51B,EAAS8vB,EAAOlc,EAAY,EAAGgiB,EAAM,EAAG,CAC1D,IAAItgB,EAAoBtV,EAAQ,iBAIhC,GAHKA,EAAQ,kBAAkB,qBAC3BsV,EAAoB,KAAK,eAAe,mCAAmCtV,CAAO,GAElF8vB,aAAiB,iBAEjB,KAAM,0EAEV,MAAMoG,EAASpG,EACTlwB,EAAQ,KAAK,KAAKI,EAAQ,OAAS,GAAK41B,EAAI,EAC5C/1B,EAAS,KAAK,KAAKG,EAAQ,QAAU,GAAK41B,EAAI,EACpD,KAAK,eAAe,cAAcM,EAAQl2B,EAASJ,EAAOC,EAAQG,EAAQ,MAAOsV,EAAkB,OAAQ1B,EAAWgiB,EAAK51B,EAAQ,QAAS,GAAO,EAAG,CAAC,CAC1J,CAaD,WAAWyG,EAAGC,EAAG9G,EAAOC,EAAQs2B,EAAW,GAAMxK,EAAgB,GAAMjT,EAAO,KAAM,CAEhF,MAAMxI,EADoB,KAAK,+BACW,2BAA2B,CAAC,EACtE,GAAI,CAACA,EAED,OAAO,QAAQ,QAAQ,IAAI,WAAW,CAAC,CAAC,EAE5C,MAAMmE,EAAanE,EAAgB,mBAC7BkmB,EAAmBlmB,EAAgB,OACzC,OAAKmE,GAIDsX,GACA,KAAK,iBAAgB,EAElB,KAAK,eAAe,WAAWtX,EAAY5N,EAAGC,EAAG9G,EAAOC,EAAQu2B,EAAkB,OAAW,OAAW1d,CAAI,GALxG,QAAQ,QAAQ,IAAI,WAAW,CAAC,CAAC,CAM/C,CAID,aAAc,CACV,KAAK,oBAAoB,cACzB,KAAK,KAAO,KAAK,oBAAoB,WACrC,KAAK,WAAa,KAAK,oBAAoB,wBAA0B,CACxE,CAKD,IAAI,oBAAqB,CACrB,OAAO,KAAK,mBACf,CAID,YAAa,CACT,KAAK,YAAW,EAChB,MAAM,WAAU,CACnB,CAID,UAAW,CAQP,GAPA,KAAK,sBAAqB,EAC1B,KAAK,mBAAmB,WACxB,KAAK,gBAAgB,SAAS,KAAK,cAAc,EACjD,KAAK,gBAAkB,EACvB,KAAK,iBAAgB,EACrB,KAAK,eAAe,0BACpB,KAAK,eAAe,yBAChB,KAAK,UAAU,2BAA4B,CAC3C,GAAI,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,GAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,yBAAyB,CAC5D,MAAM2d,EAAO,CAAA,EACb,UAAWzyB,KAAQwC,GAAc,oBAC7BiwB,EAAK,KAAKzyB,EAAO,IAAMwC,GAAc,oBAAoBxC,CAAI,CAAC,EAElE9C,EAAO,IAAI,CAAC,UAAY,KAAK,OAAS,oBAAqBu1B,EAAK,KAAK,IAAI,CAAC,CAAC,CAC9E,CAELjwB,GAAc,oBAAsB,EACvC,CACD,KAAK,kBAAkB,iBAAmB,KAAK,UAAU,iBACzD,KAAK,kBAAkB,qBAAuB,KAAK,UAAU,qBAC7D,KAAK,kBAAkB,+BAAiC,KAAK,UAAU,+BACvE,KAAK,kBAAkB,4BAA8B,KAAK,UAAU,4BACpE,KAAK,UAAU,iBAAmB,EAClC,KAAK,UAAU,qBAAuB,EACtC,KAAK,UAAU,+BAAiC,EAChD,KAAK,UAAU,4BAA8B,EAC7C,KAAK,qBAAqB,WAC1B,KAAK,iBAAiB,WACtB,KAAK,sBAAsB,OAAS,EAChC,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,GAEd,KAAK,OAAS,KAAK,yBACnBtF,EAAO,IAAI,CAAC,aAAe,KAAK,OAAS,SAAU,qBAAqB,CAAC,EAEzE,KAAK,OAAS,KAAK,0BACnB,KAAK,SACD,KAAK,SAAW,KAAK,yBACrBA,EAAO,IAAI,CAAC,aAAe,KAAK,OAAS,WAAY,qBAAqB,CAAC,IAIvF,MAAM,SAAQ,CACjB,CAED,mBAAoB,CAChB,MAAO,EACV,CAID,kBAAmB,CAEf,KAAK,sBAAqB,EAC1B,KAAK,gBAAgB,CAAC,EAAI,KAAK,eAAe,SAC9C,KAAK,gBAAgB,CAAC,EAAI,KAAK,eAAe,SAC9C,KAAK,QAAQ,MAAM,OAAO,KAAK,eAAe,EAC9C,KAAK,eAAiB,KAAK,QAAQ,qBAAqB,KAAK,wBAAwB,EACrF,KAAK,eAAiB,KAAK,QAAQ,qBAAqB,KAAK,wBAAwB,EACrF,KAAK,gBAAgB,WAAW,KAAK,cAAc,EACnD,KAAK,eAAe,kBAAkB,KAAK,cAAc,EACzD,KAAK,YAAY,OACpB,CAED,yCAA0C,CACtC,OAAO,KAAK,wBACf,CAID,6BAA6Bw1B,EAAqBC,EAAgBrT,EAAYC,EAAYC,EAAc,CACpG,KAAK,sBAAqB,EAC1B,MAAMyJ,EAAYyJ,EACZjB,EAAsBxI,EAAU,qBAChC2J,EAAyBnB,GAAqB,iBAC9CoB,EAAyBD,GAAwB,mBACjDE,EAA6BF,GAAwB,eAAe,CAAC,EACrEG,EAAmBF,GAAwB,WAAW,KAAK,sBAAsB,6BAA6B,EAC9GG,EAAuBF,GAA4B,WAAW,KAAK,sBAAsB,6BAA6B,EACtHG,EAAyBL,EAAyB72B,EAAoB,iBAAiB62B,EAAuB,MAAM,EAAI,GACxHM,EAAmB,CAAA,EACrB,KAAK,uBACL,KAAK,iCAAgC,EAEzC,MAAMC,EAAyBjJ,GAC3B5K,IACA6T,EAAuB,EAAI7T,EAAW,EAAI,IAC1C6T,EAAuB,EAAI7T,EAAW,EAAI,IAC1C6T,EAAuB,EAAI7T,EAAW,EAAI,IAC1C6T,EAAuB,EAAI7T,EAAW,EAAI,KAE9C,MAAM8T,EAAiBT,GAAkBrT,EACnC+T,EAAiBV,GAAkBpT,EACnC+T,EAAmBX,GAAkBnT,EAC3C,GAAIyJ,EAAU,cAAgBA,EAAU,QAAS,EAEzC,CAAC,KAAK,iBAAmB,KAAK,gBAAgB,SAAW,KACzD,KAAK,gBAAkBA,EAAU,qBAErC,QAASjsB,EAAI,EAAGA,EAAI,KAAK,gBAAgB,OAAQ,EAAEA,EAAG,CAClD,MAAMkF,EAAQ,KAAK,gBAAgBlF,CAAC,EAC9Bu2B,EAAatK,EAAU,SAASjsB,CAAC,EACjCw2B,EAAgBD,GAAY,iBAC5BE,EAAgBD,GAAe,mBACrC,GAAIA,GAAiBC,EAAe,CAChC,MAAMC,EAAiBzK,EAAU,kBAAkBjsB,CAAC,EAC9C8U,EAAiB0hB,EAAc,eAAeE,CAAc,EAC5DC,EAAiB,CACnB,GAAG,KAAK,sBAAsB,8BAC9B,UAAWJ,EAAW,KAAO,KAAsD,KACnF,OAAQC,EAAc,OACtB,eAAAE,CACxB,EAC0BE,GAAqB,CACvB,GAAG,KAAK,sBAAsB,8BAC9B,UAAWL,EAAW,KAAO,KAAsD,KACnF,OAAQC,EAAc,OACtB,eAAgB,CACxC,EAC0BK,GAAcN,EAAW,OAAS,GAAKA,EAAW,OAAS,EAC3DO,GAAmBL,EAAc,WAAWE,CAAc,EAC1DI,GAAuBjiB,GAAgB,WAAW8hB,EAAkB,EAC1EV,EAAiB,KAAK,CAClB,KAAMa,IAA8CD,GACpD,cAAehiB,EAAiBgiB,GAAmB,OACnD,WAAYP,EAAW,KAAQtK,EAAU,eAAejsB,CAAC,GAAK,EAAK,OACnE,WAAYkF,IAAU,GAAKkxB,EAAkBS,GAAcV,EAAyB7T,EAAc,OAClG,OAAQpd,IAAU,GAAKkxB,EAAiB,QAA6C,OACrF,QAAS,OACjC,CAAqB,CACJ,CACJ,CACD,KAAK,qBAAqB,OAAOnK,EAAU,SAAU,KAAK,gBAAgB,MAAM,EAChF,KAAK,qBAAqB,kBAAkB,KAAK,eAAe,CACnE,KACI,CAED,MAAMhB,EAAkBgB,EAAU,QAClC,GAAIhB,EAAiB,CACjB,MAAMvP,EAAauP,EAAgB,iBAC7BxX,EAAaiI,EAAW,mBAC9B,IAAIsb,EACA/K,EAAU,OACV+K,EAAa,KAAK,sBAAsB,8BAA8B,eACtE,KAAK,sBAAsB,8BAA8B,eAAiB,GAE9E,MAAMliB,EAAiB4G,EAAW,eAAe,CAAC,EAC5Cob,EAAmBrjB,EAAW,WAAW,KAAK,sBAAsB,6BAA6B,EACjGsjB,EAAuBjiB,GAAgB,WAAW,KAAK,sBAAsB,6BAA6B,EAC1G+hB,EAAc5L,EAAgB,OAAS,GAAKA,EAAgB,OAAS,EAC3EiL,EAAiB,KAAK,CAClB,KAAMa,GAA8CD,EACpD,cAAehiB,EAAiBgiB,EAAmB,OACnD,WAAAE,EACA,WAAYZ,EAAkBS,EAAcV,EAAyB7T,EAAc,OACnF,OAAQ8T,EAAiB,QAA6C,OACtE,QAAS,OAC7B,CAAiB,CACJ,MAEGF,EAAiB,KAAK,IAAI,CAEjC,CAwBD,GAvBA,KAAK,kBAAkB,sBAAwBR,EAAoB,MAAQ,KAAOA,EAAoB,MAAQ,IAAM,IAAK,CAAC,EAC1H,KAAK,sBAAsB,qBAAuB,CAC9C,OAAQA,EAAoB,OAAS,OAAS,gBAC9C,iBAAAQ,EACA,uBAAwBzB,GAAuBoB,EACzC,CACE,KAAMG,GAA8CD,EACpD,gBAAiBM,EAAkB,KAAK,sBAAwB,KAAK,wBAA0B,KAAK,iBAAoB,OACxH,YAAaA,EAAiB,QAA6C,OAC3E,aAAc,QACd,kBAAmBpK,EAAU,iCAAmCqK,EAAmB,KAAK,mBAAqB,OAC7G,cAAgBL,EAEVhK,EAAU,iCAAmCqK,EACzC,QACA,OAHJ,OAIN,eAAiBL,EAAqC,QAAZ,MAC7C,EACC,OACN,kBAAmB,KAAK,iBAAiB,WAAa,KAAK,gBAAgB,SAAW,MAClG,EACQ,KAAK,gBAAgB,UAAU,KAAK,sBAAsB,qBAAsB,KAAK,eAAe,EACpG,KAAK,mBAAqB,KAAK,eAAe,gBAAgB,KAAK,sBAAsB,oBAAoB,EACzG,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,GAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,yBAAyB,CAC5D,MAAMhL,EAAkBgB,EAAU,QAClC/rB,EAAO,IAAI,CACP,UACI,KAAK,OACL,0CACAw1B,EAAoB,MACpB,8BACAzK,EAAgB,SAChB,WACAA,EAAgB,MAChB,YACAA,EAAgB,OAChB,oBACA0K,EACJ,wBACA,KAAK,sBAAsB,oBAC/C,CAAiB,CACJ,CAEL,KAAK,6BAA0B,EAC/B,KAAK,uBAAsB,GACvB,CAACC,GAA0B,CAAC72B,EAAoB,iBAAiB62B,EAAuB,MAAM,KAC9F,KAAK,sBAAsB,QAAU,GAE5C,CACD,qBAAqBD,EAAgBrT,EAAYC,EAAYC,EAAc,CACvE,KAAK,sBAAqB,EACtB,KAAK,uBACL,KAAK,iCAAgC,EAEzC,MAAM4T,EAAiBT,GAAkBrT,EACnC+T,EAAiBV,GAAkBpT,EACnC+T,EAAmBX,GAAkBnT,EAC3C,KAAK,uBAAuB,qBAAqB,iBAAiB,CAAC,EAAE,WAAa4T,EAAiB9T,EAAa,OAChH,KAAK,uBAAuB,qBAAqB,iBAAiB,CAAC,EAAE,OAAS8T,EAAiB,QAA6C,OAC5I,KAAK,uBAAuB,qBAAqB,uBAAuB,gBAAkBC,EACpF,KAAK,sBACD,KAAK,wBACL,KAAK,iBACT,OACN,KAAK,uBAAuB,qBAAqB,uBAAuB,YAAcA,EAAiB,QAA6C,OACpJ,KAAK,uBAAuB,qBAAqB,uBAAuB,kBAAoBC,EAAmB,KAAK,mBAAqB,OACzI,KAAK,uBAAuB,qBAAqB,uBAAuB,cAAiB,KAAK,gBAExFA,EACI,QACA,OAHJ,OAIN,KAAK,uBAAuB,qBAAqB,kBAAoB,KAAK,iBAAiB,WAAa,KAAK,gBAAgB,SAAW,OACxI,MAAMW,EAAmB,KAAK,SAAS,kBAAiB,EACxD,KAAK,uBAAuB,2BAA2B,CAAC,EAAE,IAAIA,CAAgB,EAE1E,KAAK,SAAS,WACdjK,GAAoC,OAASiK,EAAiB,OAC9D,KAAK,uBAAuB,qBAAqB,iBAAiB,CAAC,EAAE,cAAgBA,EAAiB,WAAWjK,EAAmC,IAGpJC,GAAwB,OAASgK,EAAiB,OAClD,KAAK,uBAAuB,qBAAqB,iBAAiB,CAAC,EAAE,KAAOA,EAAiB,WAAWhK,EAAuB,GAE/H,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnC/sB,EAAO,IAAI,CACP,UAAY,KAAK,OAAS,sCAAwC,KAAK,oBAAoB,MAC3F,WAAa,KAAK,oBAAoB,OAAS,oBAAsBy1B,EACrE,wBACA,KAAK,uBAAuB,oBAChD,CAAiB,GAGT,KAAK,kBAAkB,YAAa,CAAC,EACrC,KAAK,gBAAgB,UAAU,KAAK,uBAAuB,qBAAsB,KAAK,eAAe,EACrG,KAAK,mBAAqB,KAAK,eAAe,gBAAgB,KAAK,uBAAuB,oBAAoB,EAC9G,KAAK,uBAAuB,KAAK,sBAAsB,EACvD,KAAK,gBAAgB,KAAK,sBAAsB,EAChD,KAAK,6BAA0B,EAC/B,KAAK,uBAAsB,EACtB,KAAK,mBACN,KAAK,sBAAsB,QAAU,GAE5C,CAWD,gBAAgBv2B,EAAS4T,EAAY,EAAGkkB,EAAeC,EAAgBC,EAAyBC,EAAW,EAAGC,EAAQ,EAAG,CACrH,MAAMhoB,EAAkBlQ,EAAQ,SAAS,iBACrC,KAAK,qBACL,KAAK,kBAAkB,KAAK,oBAAoB,EAGhD,KAAK,sBAAqB,EAE9B,KAAK,qBAAuBA,EAC5B,MAAMq1B,EAAsB,KAAK,qBAAqB,qBACtD,KAAK,sBAAsB,2BAA2B,CAAC,EAAInlB,EAC3D,KAAK,sBAAsB,mBAAqBmlB,EAAsB11B,EAAoB,uBAAuB,GAAI01B,EAAoB,MAAM,EAAI,OACnJ,KAAK,uBAAuB,KAAK,qBAAqB,EACtD,KAAK,gBAAgB,KAAK,qBAAqB,EAC/C,KAAK,sBAAsB,8BAAgC,CACvD,OAAQ,KAAK,aACb,UAAWr1B,EAAQ,KAAO,KAAsD,KAChF,cAAe,EACf,eAAgBA,EAAQ,OAASk4B,EAAQ,EAAItkB,EAAYskB,EACzD,aAAcD,EACd,gBAAiB,EACjB,OAAQ,KACpB,EACQ,KAAK,sBAAsB,8BAAgC,CACvD,OAAQ,KAAK,oBACb,UAAW5C,GAAuBA,EAAoB,KAAO,KAAsD,KACnH,cAAe,EACf,eAAgBA,EAAuBA,EAAoB,OAAS6C,EAAQ,EAAItkB,EAAYskB,EAAS,EACrG,aAAc,EACd,gBAAiB,EACjB,OAAQ,KACpB,EACY,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnCp3B,EAAO,IAAI,CACP,UACI,KAAK,OACL,iCACAd,EAAQ,MACR,8BACAA,EAAQ,SAAS,SACjB,UACA4T,EACA,cACAqkB,EACA,WACAC,EACJ,iCACA,KAAK,sBAAsB,8BAC3B,iCACA,KAAK,sBAAsB,6BAC/C,CAAiB,GAIL,KAAK,iBAAmB,CAACF,EACzB,KAAK,YAAY,KAAK,gBAAiBF,EAAeC,CAAc,GAG/DD,IACDA,EAAgB93B,EAAQ,MACpBi4B,IACAH,EAAgBA,EAAgB,KAAK,IAAI,EAAGG,CAAQ,IAGvDF,IACDA,EAAiB/3B,EAAQ,OACrBi4B,IACAF,EAAiBA,EAAiB,KAAK,IAAI,EAAGE,CAAQ,IAG9D,KAAK,UAAU,EAAG,EAAGH,EAAeC,CAAc,GAEtD,KAAK,WAAU,CAClB,CAOD,kBAAkB/3B,EAASm4B,EAAyB,GAAOC,EAAgB,CACvE,MAAMC,EAAU,KAAK,qBACrB,KAAK,qBAAuB,KACxBD,GACAA,IAEJ,KAAK,qBAAuBC,EAC5B,KAAK,sBAAqB,EACrBF,IACGn4B,EAAQ,QACR,KAAK,gCAAgCA,CAAO,EAG5C,KAAK,2BAA2BA,CAAO,GAG/C,KAAK,qBAAuB,KACxB,KAAK,+BACD,KAAK,SAAW,SAChB,KAAK,OAAS,IAEd,CAAC,KAAK,QAAU,KAAK,OAAS,KAAK,0BACnCc,EAAO,IAAI,UAAY,KAAK,OAAS,mCAAqCd,EAAQ,MAAQ,8BAA+BA,EAAQ,SAAS,QAAQ,GAG1J,KAAK,gBAAkB,GACvB,KAAK,qBAAqB,OAAO,CAAA,CAAE,EACnC,KAAK,qBAAqB,kBAAkB,KAAK,eAAe,CACnE,CAKD,2BAA2BA,EAAS,CAC5B,CAACA,EAAQ,SAAWA,EAAQ,SAAS,iBAAmB,CAACA,EAAQ,QACjE,KAAK,iBAAiBA,EAAQ,OAAO,CAE5C,CAMD,mBAAmBs4B,EAAU,CACzB,MAAM,IAAI,MAAM,sDAAsD,CACzE,CAID,2BAA4B,CACpB,KAAK,qBACL,KAAK,kBAAkB,KAAK,oBAAoB,EAE1C,KAAK,oBACX,KAAK,qBAAqB,EAAK,EAE/B,KAAK,iBACL,KAAK,YAAY,KAAK,eAAe,EAEzC,KAAK,WAAU,CAClB,CAOD,gBAAgBvL,EAAS,CACrB,MAAMhtB,EAASgtB,EAAQ,2BAA2B,CAAC,GAAG,QAAU,KAChE,KAAK,qBAAqB,eAAehtB,CAAM,EAC3C,KAAK,eAAiBA,IAG1B,KAAK,aAAeA,EACvB,CAID,uBAAuBgtB,EAAS,CAC5B,KAAK,qBAAqB,sBAAsBA,EAAQ,kBAAkB,EACtE,KAAK,sBAAwBA,EAAQ,qBAGzC,KAAK,oBAAsBA,EAAQ,mBACtC,CACD,mBAAoB,CAEnB,CACD,oBAAqB,CAEpB,CAID,qCAAqC1S,EAAiBke,EAAQ,CAG1DA,GACH,CAID,cAAe,CAAG,CAElB,sBAAuB,CACnB,MAAO,EACV,CAID,sBAAuB,CACnB,MAAO,EACV,CACD,qBAAqBC,EAAeC,EAAQ,GAAO,CAC/C,MAAMpd,EAAY,KAAK,eAAiBmd,GAAiB,GAAQ,EAAI,GACjE,KAAK,mBAAmB,WAAand,GAAYod,KACjD,KAAK,mBAAmB,SAAWpd,EAE1C,CAWD,SAASqd,EAASld,EAAU,EAAGid,EAAOE,EAAc,GAAOH,EAAelH,EAAS7V,EAAe,EAAG,EAE7F,KAAK,mBAAmB,OAASid,GAAWD,KAC5C,KAAK,mBAAmB,KAAOC,GAGnC,KAAK,qBAAqBF,EAAeC,CAAK,EAE9C,KAAK,WAAWjd,CAAO,EACvB,KAAK,gBAAgBC,CAAY,EAEjC,MAAML,EAAYud,EAAe,KAAK,qBAAuB,EAAI,EAAK,KAAK,qBAAuB,EAAI,GAClG,KAAK,mBAAmB,YAAcvd,GAAaqd,KACnD,KAAK,mBAAmB,UAAYrd,GAExC,KAAK,sBAAsB,gBAAkBkW,CAChD,CACD,wBAAwB3I,EAAY,CAChC,MAAMiQ,EAAwB,KAAK,sBAAsB,QAAkB,KAAK,wBAAb,GAC7DC,EAAwB,KAAK,YAAY,WAAqB,KAAK,wBAAb,GACxD,KAAK,uBACL,KAAK,eAAelQ,CAAU,EAE9B,KAAK,sBACL,KAAK,cAAcA,CAAU,EAE7BiQ,GACA,KAAK,iBAAiBjQ,CAAU,EAEhCkQ,GACA,KAAK,iBAAiBlQ,CAAU,CAEvC,CACD,MAAMmQ,EAAU9d,EAAU+d,EAAOlU,EAAOmU,EAAgB,CACpD,MAAM/V,EAAa,KAAK,wBAClB0F,EAAa,KAAK,YACxB,KAAK,YAAW,EAChB,MAAM1K,EAAwB,KAAK,eAAe,iBAMlD,GALA,KAAK,sBAAsB,KAAK,qBAAuB,KAAK,WAAa,KAAK,eAAgB,EAAGta,EAAsB,gBAAgB,EACnIsa,EAAsB,gBACtBA,EAAsB,cAAc,SACpC,KAAK,sBAAsBA,EAAsB,cAAc,UAAS,EAAI,EAAGta,EAAsB,gBAAgB,GAErH,KAAK,mBAAmB,KAAM,CAC9B,KAAK,gBAAe,EACpB,MACH,CACG,CAAC,KAAK,oBACL,KAAK,oBAAoB,QAAQ,KAAK,wBAAwB,QAAQ,GAAK,KAAK,wBAAwB,SAAW,KAAK,wBAAwB,0BACjJ,KAAK,oBAAoB,WAAa,QAE1C,MAAMs1B,EAAc,CAAC,KAAK,mBAAqB,KAAK,oBAAoB,WACxE,IAAI5V,EAAcJ,EAClB,GAAIgW,GAAe,KAAK,mBAAmB,OAAQ,CAE/C,GADA,KAAK,wBAAwBtQ,CAAU,EACnC,CAAC,KAAK,mBAAmB,OAAQ,CACjC,KAAK,UAAU,8BACX,KAAK,oBAAoB,oBACzB,KAAK,oBAAoB,gBAAgB9D,EAAOmU,GAAkB,EAAGD,CAAK,EAE9EpQ,EAAW,UAAU,KAAK,oBAAoB,UAAU,EACxD,KAAK,gBAAe,EACpB,MACH,CACDtF,EAAcsF,EAAW,iBAAiB,KAAK,qBAAqB,aAAc,KAAK,oBAAqB,KAAK,kBAAkB,EACnIA,EAAW,cACd,CACD,IAAI1N,EAAe,EACnB,GAAI,KAAK,wBAAwB,wBAAyB,CACtD,IAAIyD,EAAS,EACb,QAAS9d,EAAI,EAAGA,EAAIqd,EAAsB,wBAAwB,aAAa,OAAQ,EAAErd,EAAG,CACxF,MAAMkE,EAAcmZ,EAAsB,wBAAwB,aAAard,CAAC,EAC1EZ,EAAU,KAAK,wBAAwB,SAAS8E,CAAW,GAAG,QAC9Do0B,EAAiBl5B,GAAWA,EAAQ,QAAU,IAAMA,EAAQ,QAAU,IACvEA,GAAS,OAAS,GAAK,CAAC,KAAK,MAAM,6BAAgCk5B,KACpEje,GAAgByD,GAEpBA,EAASA,GAAU,CACtB,CACJ,CACD,KAAK,wBAAwB,aAAezD,EAC5C,MAAMjI,EAAW,KAAK,qBAAqB,kBAAkBgI,EAAU,KAAK,eAAgB,KAAK,mBAAoBC,CAAY,EAC3HiH,EAAa,KAAK,iBAAiB,cAAcjE,EAAuB,KAAK,oBAAqB,KAAK,uBAAuB,EAC/H,KAAK,mBAAmB,SACzB,KAAK,wBAAyB,KAAK,kBAAiC,KAAb0K,CAAiB,EACnE,KAAK,oBACN,KAAK,UAAU,iCACftF,EAAc,KAAK,QAAQ,0BAA0B,CACjD,aAAc,KAAK,qBAAqB,aACxC,mBAAoB,KAAK,oBACzB,YAAa1jB,EAAoB,UAAU,KAAK,kBAAkB,CACtF,CAAiB,IAIT0jB,EAAY,YAAYrQ,CAAQ,EAE5B,KAAK,qBACLqQ,EAAY,eAAe,KAAK,oBAAoB,mBAAoB,KAAK,oBAAoB,SAAW,SAAoD,SAAmD,CAAC,EAExN,MAAMjJ,EAAgB,KAAK,qBAAqB,cAChD,QAAStU,EAAQ,EAAGA,EAAQsU,EAAc,OAAQtU,IAAS,CACvD,MAAMwX,EAAelD,EAActU,CAAK,EAClCoQ,EAASoH,EAAa,gBACxBpH,GACAmN,EAAY,gBAAgBvd,EAAOoQ,EAAO,mBAAoBoH,EAAa,kBAAoB,EAAIA,EAAa,UAAU,CAEjI,CAED,QAAS1c,EAAI,EAAGA,EAAIshB,EAAW,OAAQthB,IACnCyiB,EAAY,aAAaziB,EAAGshB,EAAWthB,CAAC,CAAC,EAG7C,MAAMu4B,EAAgB,CAAC,KAAK,mBAAqB,CAAC,KAAK,mBAAmB,OACtEA,GAAiB,KAAK,oBAAoB,oBAC1C,KAAK,oBAAoB,gBAAgBtU,EAAOmU,GAAkB,EAAGD,CAAK,EACtED,IAAa,EACbzV,EAAY,oBAAoB,KAAK,oBAAoB,mBAAoB,CAAC,EAG9EA,EAAY,aAAa,KAAK,oBAAoB,mBAAoB,CAAC,GAGtEyV,IAAa,EAClBzV,EAAY,YAAYwB,EAAOmU,GAAkB,EAAGD,EAAO,EAAG,CAAC,EAG/D1V,EAAY,KAAKwB,EAAOmU,GAAkB,EAAGD,EAAO,CAAC,EAErDI,IACA,KAAK,oBAAoB,WAAa9V,EAAY,OAAM,EACxDsF,EAAW,UAAU,KAAK,oBAAoB,UAAU,GAE5D,KAAK,gBAAe,CACvB,CAQD,iBAAiB3N,EAAUoe,EAAYC,EAAYL,EAAiB,EAAG,CACnE,KAAK,MAAM,EAAGhe,EAAUoe,EAAYC,EAAYL,CAAc,CACjE,CAQD,eAAehe,EAAUse,EAAeC,EAAeP,EAAiB,EAAG,CACvE,KAAK,oBAAsB,KAC3B,KAAK,MAAM,EAAGhe,EAAUse,EAAeC,EAAeP,CAAc,CACvE,CAOD,SAAU,CACN,KAAK,YAAc,GACnB,KAAK,cAAa,EAClB,KAAK,gBAAgB,UACrB,KAAK,cAAc,UACnB,KAAK,eAAe,UACpB,KAAK,eAAe,0BACpB,KAAK,eAAe,yBACpB,KAAK,QAAQ,UACbQ,GAAe,KAAM,KAAK,gBAAgB,EAC1C,MAAM,QAAO,CAChB,CASD,eAAeC,EAAY,GAAO,CAC9B,MAAI,CAACA,GAAa,KAAK,qBACZ,KAAK,qBAAqB,MAE9B,KAAK,kBAAkB,OAAS,CAC1C,CAMD,gBAAgBA,EAAY,GAAO,CAC/B,MAAI,CAACA,GAAa,KAAK,qBACZ,KAAK,qBAAqB,OAE9B,KAAK,kBAAkB,QAAU,CAC3C,CAQD,UAAW,CAEP,MAAO,EACV,CASD,sBAAsBvmB,EAAO,CAEzB,OADgB,IAAIyW,GAAsBzW,CAAK,CAElD,CAMD,mBAAmBtP,EAAM5D,EAAS,CAC9B,GAAI,CAACA,EAAS,CACV,KAAK,wBAAwB,WAAW4D,EAAM,IAAI,EAClD,MACH,CACD,KAAK,oBAAoBA,EAAM5D,CAAO,CACzC,CASD,kBAAkB4D,EAAMmC,EAAS,CAC7B,KAAK,yBAAyB,WAAWnC,EAAMmC,CAAO,CACzD,CAWD,oBAAoB2S,EAAMtD,EAAeT,EAAO,CAC5C,OAAO,KAAK,cAAc+D,EAAMtD,EAAgB,GAAIT,CAAK,CAC5D,CAQD,oBAAoBuB,EAAQwC,EAAMiZ,EAAYha,EAAY,CACtD,MAAML,EAAapB,EACfyb,IAAe,SACfA,EAAa,GAEjB,IAAI3I,EACArR,IAAe,QACXe,aAAgB,MAChBsQ,EAAO,IAAI,aAAatQ,CAAI,EAEvBA,aAAgB,YACrBsQ,EAAO,IAAI,WAAWtQ,CAAI,EAG1BsQ,EAAOtQ,EAEXf,EAAaqR,EAAK,YAGdtQ,aAAgB,MAChBsQ,EAAO,IAAI,aAAatQ,CAAI,EAEvBA,aAAgB,YACrBsQ,EAAO,IAAI,WAAWtQ,CAAI,EAG1BsQ,EAAOtQ,EAGf,KAAK,eAAe,WAAWpB,EAAYqa,EAAY3I,EAAM,EAAGrR,CAAU,CAC7E,CACD,mBAAmBpB,EAAWjQ,EAAM4P,EAAQwjB,EAAS,CACjD,OAAO,IAAI,QAAQ,CAACnhB,EAASC,IAAW,CACpC,MAAMmhB,EAAiB,IAAM,CACzBpjB,EAAU,SAAS,EAAsC,EAAGjQ,CAAI,EAAE,KAAK,IAAM,CACzE,MAAMmS,EAAkBlC,EAAU,eAAe,EAAGjQ,CAAI,EACxD,IAAIoS,EAAOxC,EACX,GAAIwC,IAAS,OACTA,EAAO,IAAI,WAAWpS,CAAI,EAC1BoS,EAAK,IAAI,IAAI,WAAWD,CAAe,CAAC,MAEvC,CACD,MAAMmhB,EAAOlhB,EAAK,YAClBA,EAAO,IAAIkhB,EAAKlhB,EAAK,MAAM,EAC3BA,EAAK,IAAI,IAAIkhB,EAAKnhB,CAAe,CAAC,CACrC,CACDlC,EAAU,MAAK,EACf,KAAK,eAAe,cAAcA,CAAS,EAC3CgC,EAAQG,CAAI,CACf,EAAGI,GAAW,CACP,KAAK,WACLP,EAAQ,IAAI,UAAY,EAGxBC,EAAOM,CAAM,CAErC,CAAiB,CACjB,EACgB4gB,GACA,KAAK,iBAAgB,EACrBC,KAKA,KAAK,qBAAqB,QAAQ,IAAM,CACpCA,GACpB,CAAiB,CAEjB,CAAS,CACJ,CAUD,sBAAsBlJ,EAAetY,EAAQ7R,EAAM4P,EAAQwjB,EAAS,CAChEpzB,EAAOA,GAAQmqB,EAAc,SAC7B,MAAMla,EAAY,KAAK,eAAe,gBAAgBjQ,EAAM6L,EAA4B,QAAUA,EAA4B,QAAS,OAAW,2BAA2B,EAC7K,YAAK,eAAe,mBAAmBse,EAAc,mBAAoBtY,GAAU,EAAG5B,EAAW,EAAGjQ,CAAI,EACjG,KAAK,mBAAmBiQ,EAAWjQ,EAAM4P,EAAQwjB,CAAO,CAClE,CAUD,+BAA+BG,EAAgB1hB,EAAQ7R,EAAM4P,EAAQwjB,EAAS,CAC1EpzB,EAAOA,GAAQuzB,EAAe,CAAC,EAAE,SACjC,MAAMtjB,EAAY,KAAK,eAAe,gBAAgBjQ,EAAOuzB,EAAe,OAAQ1nB,EAA4B,QAAUA,EAA4B,QAAS,OAAW,oCAAoC,EAC9M,QAASvR,EAAI,EAAGA,EAAIi5B,EAAe,OAAQj5B,IACvC,KAAK,eAAe,mBAAmBi5B,EAAej5B,CAAC,EAAE,mBAAoBuX,GAAU,EAAG5B,EAAW3V,EAAI0F,EAAMA,CAAI,EAEvH,OAAO,KAAK,mBAAmBiQ,EAAWjQ,EAAOuzB,EAAe,OAAQ3jB,EAAQwjB,CAAO,CAC1F,CAMD,iBAAiB91B,EAAMsS,EAAQ,CAC3B,KAAK,qBAAqB,UAAUtS,EAAMsS,GAAQ,UAAS,GAAM,IAAI,CACxE,CACL,CAEA8X,EAAa,uBAAyB,CAClC,OAAQ,GAAG1F,EAAM,cAAc,sBAC/B,SAAU,GAAGA,EAAM,cAAc,uBACrC,EACA0F,EAAa,YAAc","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46]}